const SHAREPOINT_CSS_BASE64 = `
OnJvb3QsCmJvZHkuaXMtbGlnaHQtYmFzZSB7CiAgICAgIGNvbG9yLXNjaGVtZTogbGlnaHQ7CiAgICAgIC0tZ3JlZW4tNzAwOiAjMDA1MzAwOwogICAgICAtLWdyZWVuLTYwMDogIzAwNmUwMDsKICAgICAgLS1ncmVlbi01MDA6ICMwMDhhMDA7CiAgICAgIC0tZ3JlZW4tMjAwOiAjOTlkMDk5OwogICAgICAtLXRlYWwtNTAwOiAjMDk3Mjg4OwogICAgICAtLWJsdWUtNTAwOiAjM2E4NGMxOwogICAgICAtLWluZGlnby01MDA6ICM1MTQ2ZDY7CiAgICAgIC0tZ29sZC01MDA6ICNmNmJkMTg7CiAgICAgIC0tZ3JleS05MDA6ICMxMjE0MTY7CiAgICAgIC0tZ3JleS04MDA6ICMxZjIzMjU7CiAgICAgIC0tZ3JleS03MDA6ICMyZTM0Mzg7CiAgICAgIC0tZ3JleS02MDA6ICMzZTQ2NGE7CiAgICAgIC0tZ3JleS01MDA6ICM0ZDU3NWQ7CiAgICAgIC0tZ3JleS00MDA6ICM3MTc5N2Q7CiAgICAgIC0tZ3JleS0zMDA6ICM5Y2EzYTc7CiAgICAgIC0tZ3JleS0yMDA6ICNiOGJjYmU7CiAgICAgIC0tZ3JleS0xMDA6ICNkYmRkZGY7CiAgICAgIC0tZ3JleS03NTogI2U3ZThlODsKICAgICAgLS1ncmV5LTUwOiAjZWRlZWVlOwogICAgICAtLWdyZXktMjU6ICNmN2Y3Zjc7CiAgICAgIC0tc2hhZG93LWNhcmQ6IDAgMTZweCAzMnB4IHJnYmEoMCwgMzIsIDMyLCAwLjA4KTsKICAgICAgLS1zdXJmYWNlLWNhcmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC45NCk7CiAgICAgIC0tc3VyZmFjZS1zdWJ0bGU6IHJnYmEoMjM3LCAyMzgsIDIzOCwgMC41NSk7CiAgICAgIC0tc3VyZmFjZS1wYW5lbDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjkyKTsKICAgICAgLS1wYW5lbC1ib3JkZXItY29sb3I6IHJnYmEoMTg5LCAxOTcsIDIwMCwgMC40KTsKICAgICAgLS1ncmlkLWNvbG9yOiByZ2JhKDE1MywgMjA4LCAxNTMsIDAuMTgpOwogICAgICAtLXRleHQtYm9keTogdmFyKC0tZ3JleS04MDApOwogICAgICAtLXRleHQtbXV0ZWQ6IHZhcigtLWdyZXktNjAwKTsKICAgICAgLS1hY2NlbnQtcHJpbWFyeTogIzAwOGEwMDsKICAgICAgLS1hY2NlbnQtcHJpbWFyeS1yZ2I6IDAsIDEzOCwgMDsKICAgICAgLS1hY2NlbnQtY29udHJhc3Q6ICNmZmZmZmY7CiAgICAgIAogICAgICAvKiBTdGFuZGFyZGl6ZWQgc3BhY2luZyBzeXN0ZW0gKDhweCBiYXNlIHVuaXQpICovCiAgICAgIC0tc3BhY2UteHM6IDhweDsKICAgICAgLS1zcGFjZS1zbTogMTJweDsKICAgICAgLS1zcGFjZS1tZDogMTZweDsKICAgICAgLS1zcGFjZS1sZzogMjRweDsKICAgICAgLS1zcGFjZS14bDogMzJweDsKICAgICAgLS1zcGFjZS0yeGw6IDQwcHg7CiAgICAgIC0tc3BhY2UtM3hsOiA0OHB4OwogICAgICAKICAgICAgLyogQm9yZGVyIHJhZGl1cyBzY2FsZSAqLwogICAgICAtLXJhZGl1cy1zbTogOHB4OwogICAgICAtLXJhZGl1cy1tZDogMTJweDsKICAgICAgLS1yYWRpdXMtbGc6IDE2cHg7CiAgICAgIC0tcmFkaXVzLXhsOiAyMHB4OwogICAgICAtLXJhZGl1cy1mdWxsOiA5OTlweDsKICAgICAgCiAgICAgIC8qIFNoYWRvdyBzY2FsZSAobW9kZXJuaXplZCAtIHNvZnRlciwgc2hvcnRlcikgKi8KICAgICAgLS1zaGFkb3cteHM6IDAgMXB4IDNweCByZ2JhKDAsIDAsIDAsIDAuMDgpOwogICAgICAtLXNoYWRvdy1zbTogMCAycHggOHB4IHJnYmEoMCwgMCwgMCwgMC4wOCk7CiAgICAgIC0tc2hhZG93LW1kOiAwIDRweCAxNnB4IHJnYmEoMCwgMCwgMCwgMC4xMik7CiAgICAgIC0tc2hhZG93LWxnOiAwIDhweCAyNHB4IHJnYmEoMCwgMCwgMCwgMC4xNik7CiAgICAgIC0tc2hhZG93LWNhcmQ6IDAgNHB4IDE2cHggcmdiYSgwLCAzMiwgMzIsIDAuMDgpOwogICAgICAKICAgICAgLyogVHJhbnNpdGlvbiB0aW1pbmcgKi8KICAgICAgLS10cmFuc2l0aW9uLWZhc3Q6IDE1MG1zIGN1YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSk7CiAgICAgIC0tdHJhbnNpdGlvbi1iYXNlOiAyMDBtcyBjdWJpYy1iZXppZXIoMC40LCAwLCAwLjIsIDEpOwogICAgICAtLXRyYW5zaXRpb24tc2xvdzogMzAwbXMgY3ViaWMtYmV6aWVyKDAuNCwgMCwgMC4yLCAxKTsKICAgICAgCiAgICAgIC8qIFR5cG9ncmFwaHkgc2NhbGUgKi8KICAgICAgLS1mb250LXNpemUteHM6IDAuNzVyZW07ICAgICAgLyogMTJweCAqLwogICAgICAtLWZvbnQtc2l6ZS1zbTogMC44NzVyZW07ICAgICAvKiAxNHB4ICovCiAgICAgIC0tZm9udC1zaXplLWJhc2U6IDFyZW07ICAgICAgIC8qIDE2cHggKi8KICAgICAgLS1mb250LXNpemUtbWQ6IDEuMTI1cmVtOyAgICAgLyogMThweCAqLwogICAgICAtLWZvbnQtc2l6ZS1sZzogMS4yNXJlbTsgICAgICAvKiAyMHB4ICovCiAgICAgIC0tZm9udC1zaXplLXhsOiAxLjVyZW07ICAgICAgIC8qIDI0cHggKi8KICAgICAgLS1mb250LXNpemUtMnhsOiAycmVtOyAgICAgICAgLyogMzJweCAqLwogICAgICAtLWZvbnQtc2l6ZS0zeGw6IDIuNXJlbTsgICAgICAvKiA0MHB4ICovCiAgICAgIAogICAgICAvKiBMaW5lIGhlaWdodHMgKi8KICAgICAgLS1saW5lLWhlaWdodC10aWdodDogMS4yOwogICAgICAtLWxpbmUtaGVpZ2h0LW5vcm1hbDogMS41OwogICAgICAtLWxpbmUtaGVpZ2h0LXJlbGF4ZWQ6IDEuNzU7CiAgICB9Cgpib2R5LmlzLWxpZ2h0LWNvb2wgewogICAgICBjb2xvci1zY2hlbWU6IGxpZ2h0OwogICAgICAtLWdyZWVuLTcwMDogIzBkM2Q3MzsKICAgICAgLS1ncmVlbi02MDA6ICMxNjUwOGU7CiAgICAgIC0tZ3JlZW4tNTAwOiAjMWY2MmFhOwogICAgICAtLWdyZWVuLTIwMDogI2EzYzRmNTsKICAgICAgLS10ZWFsLTUwMDogIzIxNzZjNzsKICAgICAgLS1ibHVlLTUwMDogIzRjOGJmNTsKICAgICAgLS1pbmRpZ28tNTAwOiAjNmY4ZWY5OwogICAgICAtLWdvbGQtNTAwOiAjN2VkNGY3OwogICAgICAtLWdyZXktOTAwOiAjMTIyMDM5OwogICAgICAtLWdyZXktODAwOiAjMWEyZjRlOwogICAgICAtLWdyZXktNzAwOiAjMjQzZTY1OwogICAgICAtLWdyZXktNjAwOiAjMmY0ZTdjOwogICAgICAtLWdyZXktNTAwOiAjM2M1Zjk1OwogICAgICAtLWdyZXktNDAwOiAjNGY3MGFhOwogICAgICAtLWdyZXktMzAwOiAjNmI4NmJkOwogICAgICAtLWdyZXktMjAwOiAjOGVhNGQwOwogICAgICAtLWdyZXktMTAwOiAjYjNjMmUwOwogICAgICAtLWdyZXktNzU6ICNjZmQ2ZWE7CiAgICAgIC0tZ3JleS01MDogI2UzZWNmODsKICAgICAgLS1ncmV5LTI1OiAjZjJmNWZiOwogICAgICAtLXNoYWRvdy1jYXJkOiAwIDE4cHggMzZweCByZ2JhKDEzLCAzMCwgNTgsIDAuMTgpOwogICAgICAtLXN1cmZhY2UtY2FyZDogcmdiYSgyNDQsIDI0OCwgMjU1LCAwLjk2KTsKICAgICAgLS1zdXJmYWNlLXN1YnRsZTogcmdiYSgyMjYsIDIzNiwgMjU1LCAwLjY1KTsKICAgICAgLS1ncmlkLWNvbG9yOiByZ2JhKDc2LCAxMzksIDI0NSwgMC4xOCk7CiAgICAgIC0tdGV4dC1ib2R5OiB2YXIoLS1ncmV5LTkwMCk7CiAgICAgIC0tdGV4dC1tdXRlZDogIzQ0NjQ5NDsKICAgIH0KCmJvZHkuaXMtZGFyayB7CiAgICAgIGNvbG9yLXNjaGVtZTogZGFyazsKICAgICAgLS1ncmVlbi03MDA6ICMyZmI0N2E7CiAgICAgIC0tZ3JlZW4tNjAwOiAjMWZhNTY5OwogICAgICAtLWdyZWVuLTUwMDogIzM2YzI3ZjsKICAgICAgLS1ibHVlLTUwMDogIzRmOWVkMzsKICAgICAgLS1pbmRpZ28tNTAwOiAjODg5MmUzOwogICAgICAtLWdvbGQtNTAwOiAjZDhjMzhjOwogICAgICAtLXN1cmZhY2UtY2FyZDogcmdiYSgyMCwgMjQsIDMyLCAwLjk2KTsKICAgICAgLS1zdXJmYWNlLXN1YnRsZTogcmdiYSgyOCwgMzIsIDQyLCAwLjkpOwogICAgICAtLXN1cmZhY2UtcGFuZWw6IHJnYmEoMjAsIDI2LCAzNiwgMC45NCk7CiAgICAgIC0tcGFuZWwtYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCA5NCwgMTIwLCAwLjU1KTsKICAgICAgLS1ncmlkLWNvbG9yOiByZ2JhKDgzLCAxNjYsIDE0NiwgMC4yOCk7CiAgICAgIC0tdGV4dC1ib2R5OiAjZjNmNmZiOwogICAgICAtLXRleHQtbXV0ZWQ6ICNkMGQ5ZWE7CiAgICAgIC0tZ3JleS05MDA6ICNmM2Y2ZmI7CiAgICAgIC0tZ3JleS04MDA6ICNkZmU0ZWQ7CiAgICAgIC0tZ3JleS03MDA6ICNjN2NmZGQ7CiAgICAgIC0tZ3JleS02MDA6ICNhZGI3Yzc7CiAgICAgIC0tZ3JleS01MDA6ICM5MmEwYjM7CiAgICAgIC0tZ3JleS00MDA6ICM3Yjg4OWI7CiAgICAgIC0tZ3JleS0zMDA6ICM2NTcwODU7CiAgICAgIC0tZ3JleS0yMDA6ICM1MDVhNmQ7CiAgICAgIC0tZ3JleS0xMDA6ICMzZDQ1NTY7CiAgICAgIC0tZ3JleS03NTogIzMxMzg0NjsKICAgICAgLS1ncmV5LTUwOiAjMjgyZjNiOwogICAgICAtLWdyZXktMjU6ICMxZjI1MmY7CiAgICAgIC0tc2hhZG93LWNhcmQ6IDAgMjRweCA0NHB4IHJnYmEoMywgNiwgMTIsIDAuNTgpOwogICAgICAtLWFjY2VudC1wcmltYXJ5OiAjMjRiMzdmOwogICAgICAtLWFjY2VudC1wcmltYXJ5LXJnYjogMzYsIDE3OSwgMTI3OwogICAgICAtLWFjY2VudC1jb250cmFzdDogIzA1MTIxZjsKICAgICAgYmFja2dyb3VuZDoKICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDEyJSAtOCUsIHJnYmEoNzEsIDEyMCwgMTQzLCAwLjI4KSAwJSwgdHJhbnNwYXJlbnQgNDglKSwKICAgICAgICByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDgyJSAtNiUsIHJnYmEoNDAsIDgyLCAxMTQsIDAuMjQpIDAlLCB0cmFuc3BhcmVudCA0MCUpLAogICAgICAgIGxpbmVhci1ncmFkaWVudCgxODBkZWcsICMwYTExMWIgMCUsICMwYzE1MjAgNDQlLCAjMDgxMDFhIDEwMCUpOwogICAgfQoKYm9keS5pcy1kYXJrLWFsdCB7CiAgICAgIGNvbG9yLXNjaGVtZTogZGFyazsKICAgICAgLS1ncmVlbi03MDA6ICMzY2Q3OWU7CiAgICAgIC0tZ3JlZW4tNjAwOiAjMjRiMzdmOwogICAgICAtLWdyZWVuLTUwMDogIzFmOWVhMzsKICAgICAgLS10ZWFsLTUwMDogIzNhYjRjZjsKICAgICAgLS1ibHVlLTUwMDogIzVmYWVmMTsKICAgICAgLS1pbmRpZ28tNTAwOiAjN2Y4ZGZmOwogICAgICAtLWdvbGQtNTAwOiAjZjRjZTczOwogICAgICAtLXN1cmZhY2UtY2FyZDogcmdiYSgxNCwgMTksIDMxLCAwLjk2KTsKICAgICAgLS1zdXJmYWNlLXN1YnRsZTogcmdiYSgxNywgMjUsIDM4LCAwLjkyKTsKICAgICAgLS1zdXJmYWNlLXBhbmVsOiByZ2JhKDE0LCAyMSwgMzMsIDAuOTQpOwogICAgICAtLXBhbmVsLWJvcmRlci1jb2xvcjogcmdiYSg1OCwgODYsIDEyMCwgMC41KTsKICAgICAgLS1ncmlkLWNvbG9yOiByZ2JhKDk2LCAyMTAsIDE3MywgMC4zMik7CiAgICAgIC0tdGV4dC1ib2R5OiAjZjJmNmZmOwogICAgICAtLXRleHQtbXV0ZWQ6ICM5ZmI0ZDE7CiAgICAgIC0tZ3JleS05MDA6ICNmMmY2ZmY7CiAgICAgIC0tZ3JleS04MDA6ICNkZmU3ZmY7CiAgICAgIC0tZ3JleS03MDA6ICNjN2Q0Zjg7CiAgICAgIC0tZ3JleS02MDA6ICNhOWJiZWI7CiAgICAgIC0tZ3JleS01MDA6ICM4ZGEzZDg7CiAgICAgIC0tZ3JleS00MDA6ICM3NDg4YzM7CiAgICAgIC0tZ3JleS0zMDA6ICM1ZTcyYWI7CiAgICAgIC0tZ3JleS0yMDA6ICM0YTVjOTA7CiAgICAgIC0tZ3JleS0xMDA6ICMzYTRhNzM7CiAgICAgIC0tZ3JleS03NTogIzM0NDA2NDsKICAgICAgLS1ncmV5LTUwOiAjMmIzNzRmOwogICAgICAtLWdyZXktMjU6ICMyMDJhM2M7CiAgICAgIC0tc2hhZG93LWNhcmQ6IDAgMjZweCA0NnB4IHJnYmEoMywgNiwgMTgsIDAuNik7CiAgICAgIC0tYWNjZW50LXByaW1hcnk6ICMyYWM0OTM7CiAgICAgIC0tYWNjZW50LXByaW1hcnktcmdiOiA0MiwgMTk2LCAxNDc7CiAgICAgIC0tYWNjZW50LWNvbnRyYXN0OiAjMDgxMDFiOwogICAgICBiYWNrZ3JvdW5kOgogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMTglIC02JSwgcmdiYSg4MCwgMTMwLCAxNzAsIDAuMzIpIDAlLCB0cmFuc3BhcmVudCA0NiUpLAogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgODIlIDglLCByZ2JhKDM4LCA4NCwgMTI4LCAwLjI4KSAwJSwgdHJhbnNwYXJlbnQgNDIlKSwKICAgICAgICBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjMGIxNTI0IDAlLCAjMTAxZDMxIDQ1JSwgIzBhMTcyOSAxMDAlKTsKICAgIH0KCmJvZHkuaXMtZGFyay1jYXJib24gewogICAgICBjb2xvci1zY2hlbWU6IGRhcms7CiAgICAgIC0tZ3JlZW4tNzAwOiAjZjdmN2YyOwogICAgICAtLWdyZWVuLTYwMDogI2Y3ZjdmMjsKICAgICAgLS1ncmVlbi01MDA6ICNlNWU1ZGY7CiAgICAgIC0tZ3JlZW4tNDAwOiAjZDJkMmNkOwogICAgICAtLWdyZWVuLTMwMDogI2JjYmNiNzsKICAgICAgLS10ZWFsLTUwMDogI2Y3ZjdmMjsKICAgICAgLS1ibHVlLTUwMDogI2Y3ZjdmMjsKICAgICAgLS1pbmRpZ28tNTAwOiAjZjdmN2YyOwogICAgICAtLWdvbGQtNTAwOiAjZjdmN2YyOwogICAgICAtLXN1cmZhY2UtY2FyZDogcmdiYSgwLCAwLCAwLCAwLjkyKTsKICAgICAgLS1zdXJmYWNlLXN1YnRsZTogcmdiYSgwLCAwLCAwLCAwLjc4KTsKICAgICAgLS1zdXJmYWNlLXBhbmVsOiByZ2JhKDAsIDAsIDAsIDAuODIpOwogICAgICAtLXBhbmVsLWJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA4KTsKICAgICAgLS1ncmlkLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTIpOwogICAgICAtLXRleHQtYm9keTogI2Y3ZjdmMjsKICAgICAgLS10ZXh0LW11dGVkOiByZ2JhKDI0NywgMjQ3LCAyNDIsIDAuNyk7CiAgICAgIC0tZ3JleS05MDA6ICNmN2Y3ZjI7CiAgICAgIC0tZ3JleS04MDA6ICNkZmRmZDk7CiAgICAgIC0tZ3JleS03MDA6ICNjN2M3YzE7CiAgICAgIC0tZ3JleS02MDA6ICNhZmFmYTk7CiAgICAgIC0tZ3JleS01MDA6ICM5ODk4OTM7CiAgICAgIC0tZ3JleS00MDA6ICM4MDgwN2M7CiAgICAgIC0tZ3JleS0zMDA6ICM2OTY5NjU7CiAgICAgIC0tZ3JleS0yMDA6ICM1MTUxNGU7CiAgICAgIC0tZ3JleS0xMDA6ICMzYTNhMzg7CiAgICAgIC0tZ3JleS03NTogIzI4MjgyNzsKICAgICAgLS1ncmV5LTUwOiAjMWIxYjFhOwogICAgICAtLWdyZXktMjU6ICMwZTBlMGU7CiAgICAgIC0tc2hhZG93LWNhcmQ6IDAgMzBweCA2MHB4IHJnYmEoMCwgMCwgMCwgMC44NSk7CiAgICAgIC0tYWNjZW50LXByaW1hcnk6ICNmZmZmZmY7CiAgICAgIC0tYWNjZW50LXByaW1hcnktcmdiOiAyNTUsIDI1NSwgMjU1OwogICAgICAtLWFjY2VudC1jb250cmFzdDogIzA1MDUwNTsKICAgICAgYmFja2dyb3VuZDogIzAwMDAwMDsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN1bW1hcnktY2FyZCB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxNTBkZWcsIHJnYmEoMzQsIDM4LCA0NiwgMC45NiksIHJnYmEoMjAsIDI1LCAzMSwgMC45NCkpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjM0KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN1bW1hcnktY2FyZDo6YmVmb3JlIHsKICAgICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAxOCUgMTUlLCByZ2JhKDcyLCAxNDgsIDEyNCwgMC4zKSwgdHJhbnNwYXJlbnQgNjUlKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN1bW1hcnktY2FyZDo6YWZ0ZXIgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wOCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5zdW1tYXJ5LWNhcmQgLnN1bW1hcnktdmFsdWUgewogICAgICBjb2xvcjogI2YzZjZmYTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN1bW1hcnktY2FyZCAuc3VtbWFyeS1ub3RlIHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY2hpcCB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMzgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4xNik7CiAgICAgIGNvbG9yOiAjZjNmNmZhOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY2hpcC5pcy1tdXRlZCB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgxMzAsIDE0MiwgMTYwLCAwLjI4KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxMzAsIDE0MiwgMTYwLCAwLjEyKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuaW50cm8tY2FyZCwKICAgIGJvZHkuaXMtZGFyayAuZGF0YXNldC1jYXJkLAogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXBhbmVsLAogICAgYm9keS5pcy1kYXJrIC5zdW1tYXJ5LWNhcmQsCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLWNhcmQsCiAgICBib2R5LmlzLWRhcmsgLmdyb3VwLWNhcmQsCiAgICBib2R5LmlzLWRhcmsgLmNhdGVnb3J5LWNhcmQsCiAgICBib2R5LmlzLWRhcmsgLmV4cG9ydC1tZW51IHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDk2LCAxMDgsIDEyNCwgMC4zMik7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1sZyk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5pbnRyby1jYXJkOjpiZWZvcmUsCiAgICBib2R5LmlzLWRhcmsgLmludHJvLWNhcmQ6OmFmdGVyLAogICAgYm9keS5pcy1kYXJrIC5kYXRhc2V0LWNhcmQ6OmJlZm9yZSwKICAgIGJvZHkuaXMtZGFyayAuZGF0YXNldC1jYXJkOjphZnRlciB7CiAgICAgIG9wYWNpdHk6IDA7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5pbnNpZ2h0LXBhbmVsIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDk2LCAxMDgsIDEyNCwgMC4zKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmNoYXJ0LWVtcHR5IHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4yNCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5pbnNpZ2h0LXN1bW1hcnkgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4xOCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMzIpOwogICAgICBjb2xvcjogI2U4ZjRlZDsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnVwbG9hZC16b25lIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4zMik7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMjgsIDMyLCAzOCwgMC45NikgMCUsIHJnYmEoMzIsIDM2LCA0MiwgMC45NCkgMTAwJSk7CiAgICAgIGJveC1zaGFkb3c6IDAgMjBweCAzNnB4IHJnYmEoNiwgOSwgMTQsIDAuNSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtem9uZS5pcy1kcmFnb3ZlciB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuNDYpOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDMyLCA0NiwgNTIsIDAuOTgpIDAlLCByZ2JhKDMwLCA0MSwgNDgsIDAuOTYpIDEwMCUpOwogICAgICBib3gtc2hhZG93OiAwIDI0cHggNDRweCByZ2JhKDYsIDEwLCAxNiwgMC41OCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtaGludCB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN0b3JhZ2UtY29udHJvbHMgewogICAgICBib3JkZXItdG9wLWNvbG9yOiByZ2JhKDEzMCwgMTQxLCAxNjAsIDAuMjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuc3RvcmFnZS1jb25zZW50IHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5zdG9yYWdlLWJ1dHRvbiB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgxMzIsIDE0MiwgMTU1LCAwLjM1KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuc3RvcmFnZS1idXR0b24tLWlubGluZSB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjMyKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnN0b3JhZ2UtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMTgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjM2KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtYnV0dG9uIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDc5LCAxNDQsIDEyMiwgMC4zMik7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoNzIsIDE0OCwgMTI0LCAwLjI4KSAwJSwgcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMjQpIDEwMCUpOwogICAgICBjb2xvcjogI2YyZjZmYjsKICAgICAgYm94LXNoYWRvdzogMCAxNnB4IDMwcHggcmdiYSg2LCA5LCAxNCwgMC41Mik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMzQpIDAlLCByZ2JhKDcyLCAxNDgsIDEyNCwgMC4zKSAxMDAlKTsKICAgICAgYm94LXNoYWRvdzogMCAyMHB4IDM2cHggcmdiYSg2LCAxMCwgMTYsIDAuNik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtYnV0dG9uLS1naG9zdCB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgxMzIsIDE0MiwgMTU1LCAwLjMyKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudXBsb2FkLWJ1dHRvbi0tZ2hvc3Q6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4xNik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMzYpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmludHJvLWNhcmQgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDM0LCAzOCwgNDYsIDAuOTYpIDAlLCByZ2JhKDI5LCAzMiwgMzgsIDAuOTQpIDEwMCUpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjM0KTsKICAgICAgYm94LXNoYWRvdzogMCAyMnB4IDM2cHggcmdiYSg2LCA5LCAxNCwgMC41Mik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5kYXRhc2V0LWNhcmQgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDM0LCAzOCwgNDYsIDAuOTYpIDAlLCByZ2JhKDI5LCAzMiwgMzgsIDAuOTQpIDEwMCUpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjM0KTsKICAgICAgYm94LXNoYWRvdzogMCAyMnB4IDM2cHggcmdiYSg2LCA5LCAxNCwgMC41Mik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXBhbmVsIHsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1wYW5lbCk7CiAgICAgIGJvcmRlci1jb2xvcjogdmFyKC0tcGFuZWwtYm9yZGVyLWNvbG9yKTsKICAgICAgYm94LXNoYWRvdzogMCAyOHB4IDQ4cHggcmdiYSg0LCA4LCAxNiwgMC42NSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50cmVuZC12aWV3LXRvZ2dsZSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4yOCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50cmVuZC12aWV3LWJ1dHRvbiB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLXZpZXctYnV0dG9uLmlzLWFjdGl2ZSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjI2KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdC0tdG9nZ2xlIC5jb250cm9sLWxhYmVsLAogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLmNvbnRyb2wtaGludCwKICAgIGJvZHkuaXMtZGFyayAucmFuZ2UtaGludCB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuZmlsdGVyLXBpbGwgewogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yNSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgICBib3gtc2hhZG93OiBub25lOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuZmlsdGVyLXBpbGw6aG92ZXIgewogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC40NSk7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29udHJhc3QpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5maWx0ZXItcGlsbC5pcy1hY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMzIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC42NSk7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29udHJhc3QpOwogICAgICBib3gtc2hhZG93OiAwIDEycHggMjZweCByZ2JhKDYsIDE2LCAxMiwgMC4zNik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5maWx0ZXItcGlsbC5pcy1kaXNhYmxlZCwKICAgIGJvZHkuaXMtZGFyayAuZmlsdGVyLXBpbGw6ZGlzYWJsZWQgewogICAgICBvcGFjaXR5OiAwLjQ1OwogICAgICBjdXJzb3I6IG5vdC1hbGxvd2VkOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudHJlbmQtY29sb3ItY29udHJvbHMgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDQxLCA0NywgNTYsIDAuOTIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjI0KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLWNvbG9yLWNvbnRyb2xzIGxhYmVsIHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudHJlbmQtY29sb3ItY29udHJvbHNfX2hpbnQgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50cmVuZC1jb2xvci1jb250cm9scyBpbnB1dFt0eXBlPSJjb2xvciJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNCwgMjcsIDMzLCAwLjkpOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDEzMiwgMTQyLCAxNTUsIDAuMzUpOwogICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudHJlbmQtY29sb3ItYnV0dG9uIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4zNik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjIpOwogICAgICBjb2xvcjogI2VhZjdmMTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLWNvbG9yLWJ1dHRvbjpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjMyKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC41KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLWNvbG9yLWJ1dHRvbi5pcy1zZWNvbmRhcnkgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMTMyLCAxNDIsIDE1NSwgMC4zNSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNTgsIDY0LCA3NCwgMC40KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50cmVuZC1jb2xvci1idXR0b24uaXMtc2Vjb25kYXJ5OmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuNDIpOwogICAgfQoKICAgICogewogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQoKICAgIGJvZHkgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtZmFtaWx5OiAiSW50ZXIiLCAiSW50ZXIgdmFyIiwgc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBCbGlua01hY1N5c3RlbUZvbnQsICJTZWdvZSBVSSIsIHNhbnMtc2VyaWY7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICNmOGZhZjggMCUsICNmMmY3ZjAgNDUlLCAjZjhmYmY4IDEwMCUpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWJhc2UpOwogICAgICBsaW5lLWhlaWdodDogMS42OwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIG92ZXJmbG93LXg6IGhpZGRlbjsKICAgIH0KCiAgICBib2R5OjpiZWZvcmUgewogICAgICBjb250ZW50OiAiIjsKICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICBpbnNldDogLTE2MHB4OwogICAgICBiYWNrZ3JvdW5kOgogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMTglIDE4JSwgcmdiYSgwLCAxMzgsIDAsIDAuMTgpLCB0cmFuc3BhcmVudCA1MiUpLAogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgNzglIDAlLCByZ2JhKDksIDExNCwgMTM2LCAwLjE2KSwgdHJhbnNwYXJlbnQgNTUlKTsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIHotaW5kZXg6IDA7CiAgICAgIGZpbHRlcjogYmx1cigwLjVweCk7CiAgICAgIG9wYWNpdHk6IDAuOTsKICAgIH0KCiAgICBib2R5OjphZnRlciB7CiAgICAgIGNvbnRlbnQ6ICIiOwogICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgIGluc2V0OiAwOwogICAgICBiYWNrZ3JvdW5kLWltYWdlOgogICAgICAgIGxpbmVhci1ncmFkaWVudCg5MGRlZywgcmdiYSg5LCAxMTQsIDEzNiwgMC4wMykgMXB4LCB0cmFuc3BhcmVudCAxcHgpLAogICAgICAgIGxpbmVhci1ncmFkaWVudChyZ2JhKDksIDExNCwgMTM2LCAwLjAyNSkgMXB4LCB0cmFuc3BhcmVudCAxcHgpOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDEyMHB4IDEyMHB4OwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogMDsKICAgICAgb3BhY2l0eTogMC42OwogICAgICBtaXgtYmxlbmQtbW9kZTogbXVsdGlwbHk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrOjpiZWZvcmUsCiAgICBib2R5LmlzLWRhcms6OmFmdGVyIHsKICAgICAgb3BhY2l0eTogMDsKICAgIH0KCiAgICBtYWluIHsKICAgICAgbWF4LXdpZHRoOiAxMjQwcHg7CiAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS0yeGwpIHZhcigtLXNwYWNlLWxnKSB2YXIoLS1zcGFjZS0zeGwpOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IHZhcigtLXNwYWNlLTN4bCk7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgei1pbmRleDogMTsKICAgIH0KCiAgICAvKiBUeXBvZ3JhcGh5IHN0YW5kYXJkaXphdGlvbiAqLwogICAgaDEsIC5oMSB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLTJ4bCk7CiAgICAgIGxpbmUtaGVpZ2h0OiB2YXIoLS1saW5lLWhlaWdodC10aWdodCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICB9CgogICAgaDIsIC5oMiB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhsKTsKICAgICAgbGluZS1oZWlnaHQ6IHZhcigtLWxpbmUtaGVpZ2h0LXRpZ2h0KTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgIH0KCiAgICBoMywgLmgzIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICBsaW5lLWhlaWdodDogdmFyKC0tbGluZS1oZWlnaHQtdGlnaHQpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgfQoKICAgIGg0LCAuaDQgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1tZCk7CiAgICAgIGxpbmUtaGVpZ2h0OiB2YXIoLS1saW5lLWhlaWdodC1ub3JtYWwpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgfQoKICAgIHAsIC5ib2R5LXRleHQgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1iYXNlKTsKICAgICAgbGluZS1oZWlnaHQ6IHZhcigtLWxpbmUtaGVpZ2h0LW5vcm1hbCk7CiAgICB9CgogICAgLnRleHQtc20gewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGxpbmUtaGVpZ2h0OiB2YXIoLS1saW5lLWhlaWdodC1ub3JtYWwpOwogICAgfQoKICAgIC50ZXh0LXhzIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICBsaW5lLWhlaWdodDogdmFyKC0tbGluZS1oZWlnaHQtbm9ybWFsKTsKICAgIH0KCiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgVU5JRklFRCBCVVRUT04gU1lTVEVNCiAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwogICAgCiAgICAvKiBCYXNlIGJ1dHRvbiBzdHlsZXMgLSBzaGFyZWQgZm91bmRhdGlvbiAqLwogICAgLmJ0biB7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtZnVsbCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYWxsIHZhcigtLXRyYW5zaXRpb24tYmFzZSk7CiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgICAgIGxpbmUtaGVpZ2h0OiAxLjI7CiAgICB9CgogICAgLyogQnV0dG9uIHNpemVzICovCiAgICAuYnRuLS1zbSB7CiAgICAgIHBhZGRpbmc6IDhweCAxNHB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICB9CgogICAgLmJ0bi0tbWQgewogICAgICBwYWRkaW5nOiAxMHB4IDIwcHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgIH0KCiAgICAuYnRuLS1sZyB7CiAgICAgIHBhZGRpbmc6IDdweCAxNnB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1iYXNlKTsKICAgIH0KCiAgICAvKiBCdXR0b24gdmFyaWFudHMgKi8KICAgIC5idG4tLXByaW1hcnkgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuOTgpIDAlLCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuOSkgMTAwJSk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjM1KTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1jb250cmFzdCk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1zbSk7CiAgICB9CgogICAgLmJ0bi0tcHJpbWFyeTpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMSkgMCUsIHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC45NSkgMTAwJSk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1tZCk7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgIH0KCiAgICAuYnRuLS1zZWNvbmRhcnkgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMDgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yNCk7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtcHJpbWFyeSk7CiAgICB9CgogICAgLmJ0bi0tc2Vjb25kYXJ5OmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMzQpOwogICAgfQoKICAgIC5idG4tLWdob3N0IHsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI4KTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1wcmltYXJ5KTsKICAgIH0KCiAgICAuYnRuLS1naG9zdDpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjQpOwogICAgfQoKICAgIC5idG4tLW5ldXRyYWwgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDc3LCA4NywgOTMsIDAuMDgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzcsIDg3LCA5MywgMC4yNCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKICAgIC5idG4tLW5ldXRyYWw6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDc3LCA4NywgOTMsIDAuMTYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzcsIDg3LCA5MywgMC4zKTsKICAgIH0KCiAgICAvKiBCdXR0b24gc3RhdGVzICovCiAgICAuYnRuOmRpc2FibGVkLAogICAgLmJ0bi5pcy1kaXNhYmxlZCB7CiAgICAgIG9wYWNpdHk6IDAuNTsKICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICB9CgogICAgLmJ0bjpmb2N1cy12aXNpYmxlIHsKICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yNSk7CiAgICB9CgogICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgICAucGFnZS1oZWFkZXIgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IG1pbm1heCgwLCAxZnIpOwogICAgICBnYXA6IHZhcigtLXNwYWNlLXNtKTsKICAgICAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7CiAgICB9CgogICAgQG1lZGlhIChtaW4td2lkdGg6IDkwMHB4KSB7CiAgICAgIC5wYWdlLWhlYWRlciB7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiBtaW5tYXgoMCwgMS4yNWZyKSBtaW5tYXgoMCwgMWZyKTsKICAgICAgICBnYXA6IHZhcigtLXNwYWNlLW1kKTsKICAgICAgfQogICAgfQoKICAgIC5pbnRyby1jYXJkIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE0MGRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjk4KSwgcmdiYSgyMzcsIDI0NiwgMjQxLCAwLjk0KSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy14bCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTM4LCAwLCAwLjE1KTsKICAgICAgYm94LXNoYWRvdzogMCAxOHB4IDMycHggcmdiYSgxNCwgNTMsIDM4LCAwLjA3KTsKICAgICAgcGFkZGluZzogdmFyKC0tc3BhY2UtbWQpOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IHZhcigtLXNwYWNlLXNtKTsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICBpc29sYXRpb246IGlzb2xhdGU7CiAgICB9CgogICAgLmludHJvLWNhcmQ6OmJlZm9yZSB7CiAgICAgIGNvbnRlbnQ6ICIiOwogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIGluc2V0OiAwOwogICAgICBiYWNrZ3JvdW5kOiByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IDEwJSAyMCUsIHJnYmEoMCwgMTM4LCAwLCAwLjEyKSwgdHJhbnNwYXJlbnQgNTUlKTsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIHotaW5kZXg6IDA7CiAgICB9CgogICAgLmludHJvLWNhcmQ6OmFmdGVyIHsKICAgICAgY29udGVudDogIiI7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgaW5zZXQ6IDEwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IGluaGVyaXQ7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC40KTsKICAgICAgb3BhY2l0eTogMC43OwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogMDsKICAgIH0KCiAgICAuaW50cm8taGVhZGVyIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IGNhbGModmFyKC0tc3BhY2UteHMpICogMC41KTsKICAgICAgbWFyZ2luLWJvdHRvbTogY2FsYyh2YXIoLS1zcGFjZS14cykgKiAwLjMpOwogICAgfQoKICAgIC5kYXNoYm9hcmQtcGlsbCB7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgcGFkZGluZzogN3B4IDE0cHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi02MDApOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAwLjAxZW07CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTEwLCAwLCAwLjE4KTsKICAgICAgYm94LXNoYWRvdzogbm9uZTsKICAgICAgd2lkdGg6IGZpdC1jb250ZW50OwogICAgfQoKICAgIC5pbnRybyB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtYmFzZSk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIGxpbmUtaGVpZ2h0OiB2YXIoLS1saW5lLWhlaWdodC1ub3JtYWwpOwogICAgICBtYXgtd2lkdGg6IDQyMHB4OwogICAgfQoKICAgIC51cGxvYWQtem9uZSB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSg1MywgMTIwLCA4MCwgMC4xOCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1tZCk7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC45NikgMCUsIHJnYmEoMjQ3LCAyNTIsIDI0NSwgMC45NCkgMTAwJSk7CiAgICAgIHBhZGRpbmc6IHZhcigtLXNwYWNlLXNtKTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1zbSk7CiAgICAgIHRyYW5zaXRpb246IGFsbCB2YXIoLS10cmFuc2l0aW9uLWJhc2UpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctc20pOwogICAgfQoKICAgIC51cGxvYWQtem9uZS5pcy1kcmFnb3ZlciB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgwLCAxMTAsIDAsIDAuNDIpOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDI0NCwgMjUyLCAyNDIsIDAuOTgpIDAlLCByZ2JhKDIzNCwgMjQ4LCAyMzQsIDAuOTQpIDEwMCUpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctbWQpOwogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTFweCk7CiAgICB9CgogICAgLnVwbG9hZC16b25lLmlzLWVycm9yIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDIwMCwgNDUsIDQ1LCAwLjc1KTsKICAgICAgYm94LXNoYWRvdzogMCAxNHB4IDI4cHggcmdiYSgyMDAsIDQ1LCA0NSwgMC4yKTsKICAgIH0KCiAgICAudXBsb2FkLWFjdGlvbnMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS14cyk7CiAgICB9CgogICAgLnVwbG9hZC1idXR0b25zIHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICB9CgogICAgLnVwbG9hZC1idXR0b24tZ3JvdXAgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBnYXA6IDZweDsKICAgICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIH0KCiAgICAudXBsb2FkLWhpbnQgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICB9CgogICAgLnN0b3JhZ2UtY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGdhcDogOHB4OwogICAgICBtYXJnaW4tdG9wOiA4cHg7CiAgICAgIHBhZGRpbmctdG9wOiA2cHg7CiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDUzLCAxMjAsIDgwLCAwLjEyKTsKICAgIH0KCiAgICAuc3RvcmFnZS1jb25zZW50IHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQoKICAgIC5zdG9yYWdlLWNvbnNlbnQgaW5wdXQgewogICAgICB3aWR0aDogMThweDsKICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICBhY2NlbnQtY29sb3I6IHZhcigtLWdyZWVuLTYwMCk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIH0KCiAgICAuc3RvcmFnZS1jb250cm9scyAuc3RvcmFnZS1oaW50IHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICAgIGZsZXg6IDEgMSAxODBweDsKICAgICAgbWluLXdpZHRoOiAxNTBweDsKICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICB9CgogICAgLnNuYXBzaG90LWNvbnRyb2xzIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIGZsZXg6IDEgMSAyNDBweDsKICAgICAgbWluLXdpZHRoOiAyMjBweDsKICAgIH0KCiAgICAuc25hcHNob3QtY29udHJvbHNfX2J1dHRvbnMgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDE2OHB4LCAxZnIpKTsKICAgICAgZ2FwOiA2cHg7CiAgICB9CgogICAgLnNuYXBzaG90LWNvbnRyb2xzX19oaW50IHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxLjM1OwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgICBtYXgtd2lkdGg6IDMyMHB4OwogICAgfQoKICAgIEBtZWRpYSAobWF4LXdpZHRoOiA5MDBweCkgewogICAgICAuZGF0YXNldC1hY3Rpb25zIHsKICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoOwogICAgICB9CgogICAgICAuc25hcHNob3QtY29udHJvbHMgewogICAgICAgIG1pbi13aWR0aDogMDsKICAgICAgfQoKICAgICAgLnNuYXBzaG90LWNvbnRyb2xzX19idXR0b25zIHsKICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDFmcjsKICAgICAgfQogICAgfQoKLnN0b3JhZ2UtYnV0dG9uIHsKICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDUzLCAxMjAsIDgwLCAwLjI0KTsKICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICBjb2xvcjogdmFyKC0tZ3JlZW4tNjAwKTsKICBmb250LXdlaWdodDogNjAwOwogIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICBwYWRkaW5nOiA4cHggMTZweDsKICBib3JkZXItcmFkaXVzOiA5OTlweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZTsKfQoKLnN0b3JhZ2UtYnV0dG9uLS1pbmxpbmUgewogIHBhZGRpbmc6IDhweCAxNHB4OwogIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKfQoKLnN0b3JhZ2UtYnV0dG9uOmRpc2FibGVkLAouc3RvcmFnZS1idXR0b24uaXMtZGlzYWJsZWQgewogIG9wYWNpdHk6IDAuNTU7CiAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICBwb2ludGVyLWV2ZW50czogbm9uZTsKfQoKLnN0b3JhZ2UtYnV0dG9uOmhvdmVyIHsKICBiYWNrZ3JvdW5kOiByZ2JhKDUzLCAxMjAsIDgwLCAwLjA4KTsKICBib3JkZXItY29sb3I6IHJnYmEoNTMsIDEyMCwgODAsIDAuMzIpOwp9CgogICAgLnVwbG9hZC1idXR0b24gewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMjgpOwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgcGFkZGluZzogN3B4IDE2cHg7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsIHJnYmEoMCwgMTEwLCAwLCAwLjkyKSAwJSwgcmdiYSgwLCAxMzgsIDAsIDAuOSkgMTAwJSk7CiAgICAgIGNvbG9yOiAjZmZmZmZmOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4ycyBlYXNlOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3cteHMpOwogICAgfQoKICAgIC51cGxvYWQtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSgwLCAxMTAsIDAsIDAuOTgpIDAlLCByZ2JhKDAsIDEzOCwgMCwgMC45NikgMTAwJSk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1tZCk7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMXB4KTsKICAgIH0KCiAgICAudXBsb2FkLWJ1dHRvbi0tZ2hvc3QgewogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTYwMCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTEwLCAwLCAwLjIyKTsKICAgICAgYm94LXNoYWRvdzogbm9uZTsKICAgICAgcGFkZGluZzogNnB4IDE0cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZTsKICAgIH0KCiAgICAudXBsb2FkLWJ1dHRvbi0tZ2hvc3Q6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgwLCAxMTAsIDAsIDAuMyk7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZyB7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLWxnKTsKICAgICAgcGFkZGluZzogMDsKICAgICAgd2lkdGg6IG1pbig1MjBweCwgOTB2dyk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1jYXJkKTsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZzo6YmFja2Ryb3AgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDEyLCAyNCwgMjAsIDAuNDUpOwogICAgfQoKICAgIC5zbmFwc2hvdC1kaWFsb2dfX2Zvcm0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDI0cHg7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fdGl0bGUgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhsKTsKICAgIH0KCiAgICAuc25hcHNob3QtZGlhbG9nX19kZXNjcmlwdGlvbiB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC5zbmFwc2hvdC1kaWFsb2dfX2xhYmVsIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fbGFiZWwgaW5wdXQsCiAgICAuc25hcHNob3QtZGlhbG9nX19sYWJlbCB0ZXh0YXJlYSB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDExMCwgMCwgMC4xOCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1iYXNlKTsKICAgICAgZm9udC1mYW1pbHk6IGluaGVyaXQ7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC45Mik7CiAgICAgIGNvbG9yOiBpbmhlcml0OwogICAgfQoKICAgIC5zbmFwc2hvdC1kaWFsb2dfX2xhYmVsIHRleHRhcmVhIHsKICAgICAgcmVzaXplOiB2ZXJ0aWNhbDsKICAgICAgbWluLWhlaWdodDogMTIwcHg7CiAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fZmlsZSBpbnB1dCB7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fZXJyb3IgewogICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSg5LCAxMTQsIDEzNiwgMC4xMik7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTcwMCk7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fZXJyb3JbZGF0YS10b25lPSJlcnJvciJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDM4LCAzOCwgMC4xMik7CiAgICAgIGNvbG9yOiAjYjkxYzFjOwogICAgfQoKICAgIC5zbmFwc2hvdC1kaWFsb2dfX2Vycm9yW2RhdGEtdG9uZT0ic3VjY2VzcyJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxNiwgMTg1LCAxMjksIDAuMTgpOwogICAgICBjb2xvcjogIzBmNzY2ZTsKICAgIH0KCiAgICAuc25hcHNob3QtZGlhbG9nX19vdXRwdXQgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDEwcHg7CiAgICAgIG1hcmdpbi10b3A6IDZweDsKICAgIH0KCiAgICAuc25hcHNob3QtZGlhbG9nX19vdXRwdXQtYWN0aW9ucyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGdhcDogNHB4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICB9CgogICAgLnNuYXBzaG90LWRpYWxvZ19fYWN0aW9ucyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7CiAgICAgIGdhcDogMTBweDsKICAgICAgbWFyZ2luLXRvcDogOHB4OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuc25hcHNob3QtZGlhbG9nIHsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5zbmFwc2hvdC1kaWFsb2dfX2xhYmVsIGlucHV0LAogICAgYm9keS5pcy1kYXJrIC5zbmFwc2hvdC1kaWFsb2dfX2xhYmVsIHRleHRhcmVhIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgzMCwgMzYsIDQwLCAwLjkyKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4yNCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5zbmFwc2hvdC1kaWFsb2dfX2Vycm9yIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg5LCAxMTQsIDEzNiwgMC4yNik7CiAgICAgIGNvbG9yOiAjYzdlZWY1OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuc25hcHNob3QtZGlhbG9nX19lcnJvcltkYXRhLXRvbmU9ImVycm9yIl0gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIyMCwgMzgsIDM4LCAwLjMyKTsKICAgICAgY29sb3I6ICNmZWNhY2E7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5zbmFwc2hvdC1kaWFsb2dfX2Vycm9yW2RhdGEtdG9uZT0ic3VjY2VzcyJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxNiwgMTg1LCAxMjksIDAuMzIpOwogICAgICBjb2xvcjogI2JiZjdkMDsKICAgIH0KCiAgICAudXBsb2FkLXByb2dyZXNzIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiAxMnB4OwogICAgICB3aWR0aDogMTAwJTsKICAgIH0KCiAgICAudXBsb2FkLXByb2dyZXNzW2hpZGRlbl0gewogICAgICBkaXNwbGF5OiBub25lOwogICAgfQoKICAgIC51cGxvYWQtcHJvZ3Jlc3NfX2JhciB7CiAgICAgIGZsZXg6IDE7CiAgICAgIGhlaWdodDogMTJweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICB9CgogICAgLnVwbG9hZC1wcm9ncmVzc19fYmFyOjotd2Via2l0LXByb2dyZXNzLWJhciB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMCwgMTM4LCAwLCAwLjEyKTsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICB9CgogICAgLnVwbG9hZC1wcm9ncmVzc19fYmFyOjotd2Via2l0LXByb2dyZXNzLXZhbHVlIHsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZ3JlZW4tNjAwKTsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICB9CgogICAgLnVwbG9hZC1wcm9ncmVzc19fYmFyOjotbW96LXByb2dyZXNzLWJhciB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWdyZWVuLTYwMCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgfQoKICAgIC51cGxvYWQtY2FuY2VsIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSg3NywgODcsIDkzLCAwLjMpOwogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNzAwKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBwYWRkaW5nOiA4cHggMTZweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZTsKICAgIH0KCiAgICAudXBsb2FkLWNhbmNlbDpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzcsIDg3LCA5MywgMC4wOCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtY2FuY2VsIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDEzMiwgMTQyLCAxNTUsIDAuMzgpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC51cGxvYWQtY2FuY2VsOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMTYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjM2KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLmNvbnRyb2wtYWN0aW9ucyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIG1hcmdpbi10b3A6IDEycHg7CiAgICB9CgogICAgLnJlc2V0LWJ1dHRvbiB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNzcsIDg3LCA5MywgMC4yNCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzcsIDg3LCA5MywgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTcwMCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgcGFkZGluZzogMTBweCAyMHB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC5yZXNldC1idXR0b246aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDc3LCA4NywgOTMsIDAuMTYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzcsIDg3LCA5MywgMC4zKTsKICAgIH0KCiAgICAudXBsb2FkLWhpbnQgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNTAwKTsKICAgIH0KCiAgICAudXBsb2FkLW1ldGEgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNTAwKTsKICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7CiAgICAgIG1heC13aWR0aDogMTAwJTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnVwbG9hZC1tZXRhIHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC51cGxvYWQtc3RhdHVzIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgfQoKICAgIC50aGVtZS10b2dnbGUgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CgogICAgLnRoZW1lLXRvZ2dsZV9fYnV0dG9uIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMjQpOwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgcGFkZGluZzogMTBweCAyMnB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZSwgYm94LXNoYWRvdyAwLjJzIGVhc2U7CiAgICAgIHdpZHRoOiBmaXQtY29udGVudDsKICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGdhcDogOHB4OwogICAgfQoKICAgIC50aGVtZS10b2dnbGVfX2J1dHRvbjpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDAsIDExMCwgMCwgMC40KTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LXNtKTsKICAgIH0KCiAgICAudGhlbWUtdG9nZ2xlX19idXR0b25bYXJpYS1leHBhbmRlZD0idHJ1ZSJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMTAsIDAsIDAuMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgwLCAxMTAsIDAsIDAuNDUpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctc20pOwogICAgfQoKICAgIC8qIFRoZW1lIG1lbnUgZHJvcGRvd24gKi8KICAgIC50aGVtZS1tZW51IHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICB0b3A6IGNhbGMoMTAwJSArIDEwcHgpOwogICAgICBsZWZ0OiAwOwogICAgICB6LWluZGV4OiAxMDA7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY2FyZCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC40NSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE4cHg7CiAgICAgIGJveC1zaGFkb3c6IDAgMjBweCA0MHB4IHJnYmEoMCwgMzIsIDMyLCAwLjE2KTsKICAgICAgcGFkZGluZzogMjBweDsKICAgICAgbWluLXdpZHRoOiA0MjBweDsKICAgICAgbWF4LXdpZHRoOiA5MHZ3OwogICAgfQoKICAgIC50aGVtZS1tZW51LWhlYWRlciB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgbWFyZ2luLWJvdHRvbTogMTZweDsKICAgICAgcGFkZGluZy1ib3R0b206IDEycHg7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMzUpOwogICAgfQoKICAgIC50aGVtZS1tZW51LXRpdGxlIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS05MDApOwogICAgfQoKICAgIC50aGVtZS1tZW51LWNsb3NlIHsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDc3LCA4NywgOTMsIDAuMDgpOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS02MDApOwogICAgICB3aWR0aDogMjhweDsKICAgICAgaGVpZ2h0OiAyOHB4OwogICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1tZCk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC50aGVtZS1tZW51LWNsb3NlOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMDAsIDQ1LCA0NSwgMC4xMik7CiAgICAgIGNvbG9yOiAjYzgyZDJkOwogICAgfQoKICAgIC50aGVtZS1tZW51LWdyaWQgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpbGwsIG1pbm1heCgxMjBweCwgMWZyKSk7CiAgICAgIGdhcDogMTJweDsKICAgIH0KCiAgICAudGhlbWUtb3B0aW9uIHsKICAgICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjM1KTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGdhcDogOHB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJhY2tncm91bmQgMC4ycyBlYXNlLCB0cmFuc2Zvcm0gMC4xcyBlYXNlOwogICAgfQoKICAgIC50aGVtZS1vcHRpb246aG92ZXIgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMCwgMTEwLCAwLCAwLjUpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wNSk7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMnB4KTsKICAgIH0KCiAgICAudGhlbWUtb3B0aW9uLmlzLWFjdGl2ZSB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgwLCAxMTAsIDAsIDAuNyk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjEyKTsKICAgICAgYm94LXNoYWRvdzogMCA4cHggMTZweCByZ2JhKDAsIDExMCwgMCwgMC4xNSk7CiAgICB9CgogICAgLnRoZW1lLW9wdGlvbi1wcmV2aWV3IHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGFzcGVjdC1yYXRpbzogMTYgLyA5OwogICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgIGJveC1zaGFkb3c6IGluc2V0IDAgMnB4IDhweCByZ2JhKDAsIDAsIDAsIDAuMTUpOwogICAgfQoKICAgIC50aGVtZS1vcHRpb24tcHJldmlldy0tbGlnaHQgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjZjdmOWY1IDAlLCAjZTdmM2UwIDEwMCUpOwogICAgfQoKICAgIC50aGVtZS1vcHRpb24tcHJldmlldy0tbGlnaHQtY29vbCB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICNmNGY4ZmYgMCUsICNlM2VjZjggMTAwJSk7CiAgICB9CgogICAgLnRoZW1lLW9wdGlvbi1wcmV2aWV3LS1kYXJrLW1pZG5pZ2h0IHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzBhMTAxYiAwJSwgIzFhMjg0MCAxMDAlKTsKICAgIH0KCiAgICAudGhlbWUtb3B0aW9uLXByZXZpZXctLWRhcmstY2FyYm9uIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzA1MDUwNSAwJSwgIzFhMWExYSAxMDAlKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEpOwogICAgfQoKICAgIC50aGVtZS1vcHRpb24tbmFtZSB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNzAwKTsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGhlbWUtbWVudSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjAsIDI0LCAzMiwgMC45OCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg5NiwgMTA4LCAxMjQsIDAuNCk7CiAgICAgIGJveC1zaGFkb3c6IDAgMjRweCA0OHB4IHJnYmEoMywgNiwgMTIsIDAuNSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50aGVtZS1tZW51LWhlYWRlciB7CiAgICAgIGJvcmRlci1ib3R0b20tY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjMpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGhlbWUtbWVudS10aXRsZSB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGhlbWUtbWVudS1jbG9zZSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTMyLCAxNDIsIDE1NSwgMC4xNSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRoZW1lLW1lbnUtY2xvc2U6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIyMCwgMzgsIDM4LCAwLjI1KTsKICAgICAgY29sb3I6ICNmZWNhY2E7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50aGVtZS1vcHRpb24gewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMTMyLCAxNDIsIDE1NSwgMC4zNSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50aGVtZS1vcHRpb246aG92ZXIgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjUpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC4xMik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50aGVtZS1vcHRpb24uaXMtYWN0aXZlIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDcyLCAxNDgsIDEyNCwgMC43KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMik7CiAgICAgIGJveC1zaGFkb3c6IDAgOHB4IDE2cHggcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGhlbWUtb3B0aW9uLW5hbWUgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBAbWVkaWEgKG1heC13aWR0aDogNjQwcHgpIHsKICAgICAgLnRoZW1lLW1lbnUgewogICAgICAgIG1pbi13aWR0aDogMDsKICAgICAgICB3aWR0aDogY2FsYygxMDB2dyAtIDQwcHgpOwogICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgIH0KCiAgICAgIC50aGVtZS1tZW51LWdyaWQgewogICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIDFmcik7CiAgICAgIH0KICAgIH0KCiAgICAuZGF0YXNldC1jYXJkIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE2MGRlZywgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjk2KSwgcmdiYSgyNDEsIDI0NywgMjQzLCAwLjkyKSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy14bCk7CiAgICAgIHBhZGRpbmc6IHZhcigtLXNwYWNlLW1kKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMzgsIDAsIDAuMTIpOwogICAgICBib3gtc2hhZG93OiAwIDEycHggMjhweCByZ2JhKDksIDUzLCAyNywgMC4wNyk7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogdmFyKC0tc3BhY2Utc20pOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgIGlzb2xhdGlvbjogaXNvbGF0ZTsKICAgIH0KCiAgICAuZGF0YXNldC1jYXJkOjpiZWZvcmUgewogICAgICBjb250ZW50OiAiIjsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBpbnNldDogMDsKICAgICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCA4MCUgMTAlLCByZ2JhKDksIDExNCwgMTM2LCAwLjE4KSwgdHJhbnNwYXJlbnQgNTUlKTsKICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgIHotaW5kZXg6IDA7CiAgICB9CgogICAgLmRhdGFzZXQtY2FyZDo6YWZ0ZXIgewogICAgICBjb250ZW50OiAiIjsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICBpbnNldDogMDsKICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44KTsKICAgICAgb3BhY2l0eTogMC42OwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogMDsKICAgIH0KCiAgICAuZGF0YXNldC1jYXJkIGgyIHsKICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgY29sb3I6IHZhcigtLWdyZXktODAwKTsKICAgICAgfQoKICAgICAgLmRhdGFzZXQtY2FyZCA+IC5tdXRlZCB7CiAgICAgICAgbWFyZ2luOiAwOwogICAgICAgIGZvbnQtc2l6ZTogMC43cmVtOwogICAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIH0KCiAgICAuZGF0YXNldC1tZXRhLWdyaWQgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDEzMHB4LCAxZnIpKTsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS14cykgdmFyKC0tc3BhY2Utc20pOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIG1hcmdpbi10b3A6IHZhcigtLXNwYWNlLXhzKTsKICAgIH0KCiAgICAuZGF0YXNldC1hY3Rpb25zIHsKICAgICAgbWFyZ2luLXRvcDogdmFyKC0tc3BhY2Utc20pOwogICAgICBwYWRkaW5nLXRvcDogdmFyKC0tc3BhY2UteHMpOwogICAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSg1MywgMTIwLCA4MCwgMC4xNik7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS14cykgdmFyKC0tc3BhY2Utc20pOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgfQoKICAgIC5tZXRhLWl0ZW0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IHZhcigtLXNwYWNlLXhzKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgIH0KCiAgICAubWV0YS1pdGVtIHN0cm9uZyB7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTgwMCk7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLW1kKTsKICAgICAgbGV0dGVyLXNwYWNpbmc6IC0wLjAxZW07CiAgICB9CgogICAgLmRhdGFzZXQtYWN0aW9ucyAudGhlbWUtdG9nZ2xlIHsKICAgICAgb3JkZXI6IDI7CiAgICAgIGZsZXg6IDAgMCAxMDAlOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtc3RhcnQ7CiAgICAgIG1hcmdpbi10b3A6IDJweDsKICAgIH0KCiAgICAuZGF0YXNldC1hY3Rpb25zIC50aGVtZS10b2dnbGVfX2J1dHRvbiB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgcGFkZGluZzogNnB4IDE0cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgIH0KCiAgICAuc25hcHNob3QtY29udHJvbHMgewogICAgICBvcmRlcjogMTsKICAgICAgZmxleDogMSAxIDI0MHB4OwogICAgICBtaW4td2lkdGg6IDIyMHB4OwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuc25hcHNob3QtY29udHJvbHNfX2J1dHRvbnMgewogICAgICBnYXA6IDZweDsKICAgIH0KCiAgICAuc25hcHNob3QtY29udHJvbHNfX2hpbnQgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIG1heC13aWR0aDogMzIwcHg7CiAgICB9CgogICAgLmNvbnRyb2wtcGFuZWwgewogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLXBhbmVsKTsKICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLXhsKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tcGFuZWwtYm9yZGVyLWNvbG9yKTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LWNhcmQpOwogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1sZykgdmFyKC0tc3BhY2UteGwpOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogdmFyKC0tc3BhY2UtbGcpOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgdG9wOiBhdXRvOwogICAgICB6LWluZGV4OiAxOwogICAgLXdlYmtpdC1iYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTRweCk7CiAgICBiYWNrZHJvcC1maWx0ZXI6IGJsdXIoMTRweCk7CiAgICB9CgogICAgLyogQWN0aXZlIGZpbHRlcnMgc3VtbWFyeSAqLwogICAgLmFjdGl2ZS1maWx0ZXJzLXN1bW1hcnkgewogICAgICB3aWR0aDogMTAwJTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1tZCk7CiAgICAgIHBhZGRpbmc6IHZhcigtLXNwYWNlLWxnKTsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgwLCAxMzgsIDAsIDAuMDgpLCByZ2JhKDksIDExNCwgMTM2LCAwLjA2KSk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTM4LCAwLCAwLjIyKTsKICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLWxnKTsKICAgICAgbWFyZ2luLWJvdHRvbTogdmFyKC0tc3BhY2Utc20pOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWN0aXZlLWZpbHRlcnMtc3VtbWFyeSB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEoMzYsIDE3OSwgMTI3LCAwLjE4KSwgcmdiYSgzMCwgODAsIDk4LCAwLjIyKSk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgzNiwgMTc5LCAxMjcsIDAuMzUpOwogICAgICBib3gtc2hhZG93OiAwIDIwcHggNDBweCByZ2JhKDUsIDEwLCAxOCwgMC40NSk7CiAgICB9CgogICAgLmFjdGl2ZS1maWx0ZXJzLWhlYWRlciB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1tZCk7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgIH0KCiAgICAuYWN0aXZlLWZpbHRlcnMtbGFiZWwgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgICBsZXR0ZXItc3BhY2luZzogMC4wMmVtOwogICAgfQoKICAgIC5jbGVhci1hbGwtZmlsdGVycyB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTEwLCAwLCAwLjI4KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMTAsIDAsIDAuMTIpOwogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNzAwKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICBwYWRkaW5nOiA2cHggMTRweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZTsKICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGdhcDogNnB4OwogICAgfQoKICAgIC5jbGVhci1hbGwtZmlsdGVyczpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMCwgMTEwLCAwLCAwLjQpOwogICAgfQoKICAgIC5jbGVhci1hbGwtZmlsdGVyczpmb2N1cy12aXNpYmxlIHsKICAgICAgb3V0bGluZTogM3B4IHNvbGlkIHZhcigtLWdyZWVuLTUwMCk7CiAgICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7CiAgICB9CgogICAgLmFjdGl2ZS1maWx0ZXJzLWxpc3QgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogdmFyKC0tc3BhY2Utc20pOwogICAgfQoKICAgIC5hY3RpdmUtZmlsdGVyLWNoaXAgewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIHBhZGRpbmc6IDZweCAxMnB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuODUpOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDExMCwgMCwgMC4yNCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTcwMCk7CiAgICB9CgogICAgLmFjdGl2ZS1maWx0ZXItY2hpcF9fbGFiZWwgewogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNzAwKTsKICAgIH0KCiAgICAuYWN0aXZlLWZpbHRlci1jaGlwX192YWx1ZSB7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTgwMCk7CiAgICB9CgogICAgLmFjdGl2ZS1maWx0ZXItY2hpcF9fcmVtb3ZlIHsKICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICB3aWR0aDogMThweDsKICAgICAgaGVpZ2h0OiAxOHB4OwogICAgICBib3JkZXI6IG5vbmU7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjE1KTsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgICBwYWRkaW5nOiAwOwogICAgfQoKICAgIC5hY3RpdmUtZmlsdGVyLWNoaXBfX3JlbW92ZTpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjAwLCA0NSwgNDUsIDAuODUpOwogICAgICBjb2xvcjogI2ZmZmZmZjsKICAgIH0KCiAgICAuYWN0aXZlLWZpbHRlci1jaGlwX19yZW1vdmU6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDJweCBzb2xpZCB2YXIoLS1ncmVlbi01MDApOwogICAgICBvdXRsaW5lLW9mZnNldDogMnB4OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWN0aXZlLWZpbHRlcnMtc3VtbWFyeSB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsIHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xOCksIHJnYmEoNDQsIDkyLCAxMjIsIDAuMTYpKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMzIpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWN0aXZlLWZpbHRlcnMtbGFiZWwgewogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LXByaW1hcnkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY2xlYXItYWxsLWZpbHRlcnMgewogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4zOCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yKTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1jb250cmFzdCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jbGVhci1hbGwtZmlsdGVyczpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4zMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWN0aXZlLWZpbHRlci1jaGlwIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgzMCwgMzYsIDQwLCAwLjg1KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMjgpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmFjdGl2ZS1maWx0ZXItY2hpcF9fbGFiZWwgewogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LXByaW1hcnkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWN0aXZlLWZpbHRlci1jaGlwX19yZW1vdmUgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMjIpOwogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LWNvbnRyYXN0KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmFjdGl2ZS1maWx0ZXItY2hpcF9fcmVtb3ZlOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDM4LCAzOCwgMC43NSk7CiAgICAgIGNvbG9yOiAjZmZmZmZmOwogICAgfQoKICAgIC5jaGlwIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjA4KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICAgIHBhZGRpbmc6IDZweCAxNHB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC5jaGlwLmlzLW11dGVkIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuNik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4xOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICB9CgogICAgLmNvbnRyb2wtc2VsZWN0IHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogMC43cmVtOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS02MDApOwogICAgICBtaW4td2lkdGg6IDE4MHB4OwogICAgfQoKICAgIC5jb250cm9sLXNlbGVjdCBzZWxlY3QsCiAgICAuY29udHJvbC1zZWxlY3QgaW5wdXRbdHlwZT0iZGF0ZSJdIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjYpOwogICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBwYWRkaW5nOiAxMHB4IDEycHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWJhc2UpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgICAgdHJhbnNpdGlvbjogYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgYm94LXNoYWRvdyAwLjJzIGVhc2U7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdCBzZWxlY3QsCiAgICBib2R5LmlzLWRhcmsgLmNvbnRyb2wtc2VsZWN0IGlucHV0W3R5cGU9ImRhdGUiXSB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtcGFuZWwpOwogICAgICBib3JkZXItY29sb3I6IHZhcigtLXBhbmVsLWJvcmRlci1jb2xvcik7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY29udHJvbC1zZWxlY3Qgc2VsZWN0IG9wdGlvbiB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtcGFuZWwpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmNvbnRyb2wtc2VsZWN0IHNlbGVjdCBvcHRpb246Y2hlY2tlZCB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjM1KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLmNvbnRyb2wtc2VsZWN0IHNlbGVjdDpmb2N1cywKICAgIC5jb250cm9sLXNlbGVjdCBpbnB1dFt0eXBlPSJkYXRlIl06Zm9jdXMgewogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC42KTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xOCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdCBzZWxlY3Q6Zm9jdXMsCiAgICBib2R5LmlzLWRhcmsgLmNvbnRyb2wtc2VsZWN0IGlucHV0W3R5cGU9ImRhdGUiXTpmb2N1cyB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuNjUpOwogICAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMjgpOwogICAgfQoKICAgIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLm11bHRpLXNlbGVjdCB7CiAgICAgIHBhZGRpbmc6IDEycHg7CiAgICAgIG1pbi1oZWlnaHQ6IDE4MHB4OwogICAgICBib3JkZXItcmFkaXVzOiAxNnB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1wYW5lbC1ib3JkZXItY29sb3IpOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1iYXNlKTsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLm11bHRpLXNlbGVjdCB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXN1cmZhY2UtcGFuZWwpOwogICAgICBib3JkZXItY29sb3I6IHZhcigtLXBhbmVsLWJvcmRlci1jb2xvcik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLm11bHRpLXNlbGVjdCBvcHRpb24gewogICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1zdXJmYWNlLXBhbmVsKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLm11bHRpLXNlbGVjdCBvcHRpb246Y2hlY2tlZCB7CiAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMzYsIDE3OSwgMTI3LCAwLjM1KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLmNvbnRyb2wtc2VsZWN0LS1tdWx0aSB7CiAgICAgIGZsZXg6IDEgMSAyNjBweDsKICAgIH0KCiAgICAuY29udHJvbC1zZWxlY3QtLW11bHRpIC5tdWx0aS1zZWxlY3Qgb3B0aW9uIHsKICAgICAgcGFkZGluZzogNnB4IDhweDsKICAgIH0KCiAgICAuY29udHJvbC1zZWxlY3QtLW11bHRpIC5tdWx0aS1zZWxlY3Q6Zm9jdXMgewogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC42KTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgM3B4IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xOCk7CiAgICB9CgogICAgLmNvbnRyb2wtc2VsZWN0LS1tdWx0aSAuY29udHJvbC1oaW50IHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICB9CgogICAgLmNvbnRyb2wtc2VsZWN0LS10b2dnbGUgLmNvbnRyb2wtbGFiZWwgewogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS02MDApOwogICAgfQoKICAgIC5maWx0ZXItdG9nZ2xlIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuZmlsdGVyLXBpbGwgewogICAgICBmbGV4OiAwIDAgYXV0bzsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjE4KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjA1KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBwYWRkaW5nOiA4cHggMThweDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlLCBib3JkZXItY29sb3IgMC4ycyBlYXNlLCBjb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4yczsKICAgIH0KCiAgICAuZmlsdGVyLXBpbGw6aG92ZXIgewogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC40KTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1wcmltYXJ5KTsKICAgIH0KCiAgICAuZmlsdGVyLXBpbGwuaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC41NSk7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtcHJpbWFyeSk7CiAgICAgIGJveC1zaGFkb3c6IDAgMTBweCAyMHB4IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xOCk7CiAgICB9CgogICAgLmN1c3RvbS1yYW5nZS1pbnB1dHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgfQoKICAgIC5jdXN0b20tcmFuZ2UtaW5wdXRzIGlucHV0W3R5cGU9ImRhdGUiXSB7CiAgICAgIGZsZXg6IDEgMSAxNTBweDsKICAgICAgbWluLXdpZHRoOiAxNDBweDsKICAgIH0KCiAgICAuY3VzdG9tLXJhbmdlLWlucHV0cyAucmFuZ2Utc2VwYXJhdG9yIHsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNTAwKTsKICAgIH0KCiAgICAucmFuZ2UtaGludCB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgfQogICAgLnN1bW1hcnktZ3JpZCB7CiAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjIwcHgsIDFmcikpOwogICAgICBnYXA6IHZhcigtLXNwYWNlLW1kKTsKICAgIH0KCiAgICAuc3VtbWFyeS1jYXJkIHsKICAgICAgLS1zdW1tYXJ5LWNhcmQtYWNjZW50OiB2YXIoLS1ncmVlbi02MDApOwogICAgICAtLXN1bW1hcnktY2FyZC1ib3JkZXI6IHJnYmEoMzQsIDE5NywgOTQsIDAuMik7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgI2ZmZmZmZiAwJSwgI2YzZmJmNiA0MCUsICNlY2ZkZjMgMTAwJSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1sZyk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXN1bW1hcnktY2FyZC1ib3JkZXIpOwogICAgICBib3gtc2hhZG93OiAwIDE2cHggMzJweCByZ2JhKDE2LCAxODUsIDEyOSwgMC4xMik7CiAgICAgIHBhZGRpbmc6IHZhcigtLXNwYWNlLWxnKTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1zbSk7CiAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgIG1pbi1oZWlnaHQ6IDE0MHB4OwogICAgICBpc29sYXRpb246IGlzb2xhdGU7CiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSB2YXIoLS10cmFuc2l0aW9uLWJhc2UpLCBib3gtc2hhZG93IHZhcigtLXRyYW5zaXRpb24tYmFzZSk7CiAgICB9CgogICAgLnN1bW1hcnktY2FyZDo6YmVmb3JlLAogICAgLnN1bW1hcnktY2FyZDo6YWZ0ZXIgewogICAgICBjb250ZW50OiBub25lOwogICAgfQoKICAgIC5zdW1tYXJ5LWNhcmQ6aG92ZXIgewogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1tZCk7CiAgICB9CgogICAgLnN1bW1hcnktY2FyZCA+ICogewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIHotaW5kZXg6IDE7CiAgICB9CgogICAgLnN1bW1hcnktY2FyZF9fbWV0YSB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGdhcDogdmFyKC0tc3BhY2UtbWQpOwogICAgfQoKICAgIC5zdW1tYXJ5LWljb24gewogICAgICB3aWR0aDogNDBweDsKICAgICAgaGVpZ2h0OiA0MHB4OwogICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtZnVsbCk7CiAgICAgIGJhY2tncm91bmQ6IHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzAlIDMwJSwgcmdiYSgzNCwgMTk3LCA5NCwgMC4yNiksIHRyYW5zcGFyZW50IDY1JSksICNmM2ZiZjY7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXN1bW1hcnktY2FyZC1ib3JkZXIpOwogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgIGNvbG9yOiB2YXIoLS1zdW1tYXJ5LWNhcmQtYWNjZW50KTsKICAgICAgYm94LXNoYWRvdzogMCAxMHB4IDIwcHggcmdiYSgxNiwgMTg1LCAxMjksIDAuMTYpOwogICAgfQoKICAgIC5zdW1tYXJ5LWljb24gc3ZnIHsKICAgICAgd2lkdGg6IDI0cHg7CiAgICAgIGhlaWdodDogMjRweDsKICAgIH0KCiAgICAuc3VtbWFyeS1pY29uIHN2ZyAqIHsKICAgICAgc3Ryb2tlOiBjdXJyZW50Q29sb3I7CiAgICAgIGZpbGw6IG5vbmU7CiAgICAgIHN0cm9rZS13aWR0aDogMS42OwogICAgICBzdHJva2UtbGluZWNhcDogcm91bmQ7CiAgICAgIHN0cm9rZS1saW5lam9pbjogcm91bmQ7CiAgICB9CgogICAgLnN1bW1hcnktbGFiZWwgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA4ZW07CiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgIG1hcmdpbjogMDsKICAgIH0KCiAgICAuc3VtbWFyeS12YWx1ZSB7CiAgICAgIGZvbnQtc2l6ZTogY2xhbXAoMnJlbSwgMS44dncgKyAxLjRyZW0sIDIuN3JlbSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTkwMCk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAtMC4wMWVtOwogICAgICBtYXJnaW46IDA7CiAgICB9CgogICAgLnN1bW1hcnktbm90ZSB7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgbWFyZ2luOiAwOwogICAgICBsaW5lLWhlaWdodDogdmFyKC0tbGluZS1oZWlnaHQtbm9ybWFsKTsKICAgIH0KCiAgICAuc3VtbWFyeS12YWx1ZS5zdW1tYXJ5LXZhbHVlLS1sYXRlc3QgewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiAwLjFyZW07CiAgICB9CgogICAgLnN1bW1hcnktbGF0ZXN0LXBlcmlvZC1sYWJlbCB7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAwOwogICAgICB0ZXh0LXRyYW5zZm9ybTogbm9uZTsKICAgICAgbWFyZ2luLWJvdHRvbTogMC4wNXJlbTsKICAgIH0KCiAgICAuc3VtbWFyeS1sYXRlc3QtbWV0cmljIHsKICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgIGZvbnQtc2l6ZTogY2xhbXAoMnJlbSwgMS44dncgKyAxLjRyZW0sIDIuN3JlbSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTkwMCk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAtMC4wMWVtOwogICAgfQoKICAgIC5zdW1tYXJ5LWNhcmQtLWFjdGlvbnMsCiAgICAuc3VtbWFyeS1jYXJkLS1ob3VycywKICAgIC5zdW1tYXJ5LWNhcmQtLXVzZXJzLAogICAgLnN1bW1hcnktY2FyZC0tcGVyaW9kIHsKICAgICAgLS1zdW1tYXJ5LWNhcmQtYWNjZW50OiB2YXIoLS1ncmVlbi02MDApOwogICAgfQoKICAgIC50cmVuZC1jYXJkIHsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLWxnKTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjMpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctY2FyZCk7CiAgICAgIHBhZGRpbmc6IHZhcigtLXNwYWNlLXhsKTsKICAgICAgdHJhbnNpdGlvbjogYWxsIHZhcigtLXRyYW5zaXRpb24tYmFzZSk7CiAgICB9CgogICAgLnRyZW5kLWNhcmQ6aG92ZXIgewogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1sZyk7CiAgICB9CgogICAgLnRyZW5kLWNhcmQgaGVhZGVyIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBhbGlnbi1pdGVtczogYmFzZWxpbmU7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiAxNHB4OwogICAgICBtYXJnaW4tYm90dG9tOiAxNHB4OwogICAgfQoKICAgIC5jaGFydC10aXRsZSB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteGwpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS05MDApOwogICAgfQoKICAgIC5jaGFydC1zdWJ0aXRsZSB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgfQoKICAgIC5jYXRlZ29yeS1jb250cmliLWxpc3QgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDEwcHg7CiAgICAgIG1hcmdpbjogMTZweCAwIDA7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGxpc3Qtc3R5bGU6IG5vbmU7CiAgICB9CgogICAgLmNhdGVnb3J5LWNvbnRyaWItbGlzdCBsaSB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiAxMnB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTM4LCAwLCAwLjEyKTsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIHBhZGRpbmc6IDhweCAxNnB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDEzOCwgMCwgMC4xOCk7CiAgICB9CgogICAgLmNhdGVnb3J5LWNvbnRyaWItbGlzdCAuY29udHJpYi1sYWJlbCB7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICB9CgogICAgLmNhdGVnb3J5LWNvbnRyaWItbGlzdCAuY29udHJpYi12YWx1ZSB7CiAgICAgIGZvbnQtdmFyaWFudC1udW1lcmljOiB0YWJ1bGFyLW51bXM7CiAgICAgIGZvbnQtd2VpZ2h0OiA3MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi02MDApOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY2F0ZWdvcnktY29udHJpYi1saXN0IGxpIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMTYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjI4KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmNhdGVnb3J5LWNvbnRyaWItbGlzdCAuY29udHJpYi1sYWJlbCB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCi5jaGFydC1hY3Rpb25zIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtd3JhcDogd3JhcDsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICBnYXA6IDEycHg7CiAgbWFyZ2luLWJvdHRvbTogMThweDsKfQoKLmNoYXJ0LWV4cG9ydC1ncm91cCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LXdyYXA6IHdyYXA7CiAgZ2FwOiA4cHg7CiAgbWFyZ2luOiAwOwp9CgouY2hhcnQtZXhwb3J0LWdyb3VwIC5zdG9yYWdlLWJ1dHRvbiB7CiAgZmxleDogMCAwIGF1dG87Cn0KCi5jYXJkLWhlYWRlci13aXRoLWFjdGlvbnMgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgZ2FwOiAxMnB4OwogIG1hcmdpbi1ib3R0b206IDEycHg7Cn0KCi5jYXJkLWhlYWRlci13aXRoLWFjdGlvbnMgPiBkaXY6Zmlyc3QtY2hpbGQgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBnYXA6IDZweDsKfQoKLmNhcmQtaGVhZGVyLWFjdGlvbnMgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC13cmFwOiB3cmFwOwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKICBnYXA6IDEwcHg7Cn0KCi5jYXJkLWhlYWRlci1hY3Rpb25zIC5jaGFydC1leHBvcnQtZ3JvdXAgewogIG1hcmdpbjogMDsKfQoKLmNhcmQtaGVhZGVyLWFjdGlvbnMgLmNoaXAsCi5jYXJkLWhlYWRlci1hY3Rpb25zIC51c2FnZS10cmVuZC1jb250cm9scywKLmNhcmQtaGVhZGVyLWFjdGlvbnMgLnVzYWdlLXRyZW5kLXRvZ2dsZSB7CiAgbWFyZ2luOiAwOwp9CgpAbWVkaWEgKG1heC13aWR0aDogNzgwcHgpIHsKICAuY2FyZC1oZWFkZXItd2l0aC1hY3Rpb25zIHsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgIGdhcDogMTBweDsKICB9CgogIC5jYXJkLWhlYWRlci1hY3Rpb25zIHsKICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICB9Cn0KCiAgICAudHJlbmQtdmlldy10b2dnbGUgewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA2cHg7CiAgICAgIHBhZGRpbmc6IDRweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjA4KTsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMTYpOwogICAgICBmbGV4LXNocmluazogMDsKICAgIH0KCiAgICAudHJlbmQtdmlldy1idXR0b24gewogICAgICBib3JkZXI6IG5vbmU7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIHBhZGRpbmc6IDZweCAxNHB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC50cmVuZC12aWV3LWJ1dHRvbi5pcy1hY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4xOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgfQoKICAgIC50cmVuZC12aWV3LWJ1dHRvbjpmb2N1cy12aXNpYmxlIHsKICAgICAgb3V0bGluZTogbm9uZTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgMnB4IHJnYmEoMCwgMTEwLCAwLCAwLjI0KTsKICAgIH0KCiAgICAuaW5zaWdodC1jYXJkIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiAyNHB4OwogICAgfQoKICAgIC5pbnNpZ2h0LWdyaWQgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDI4MHB4LCAxZnIpKTsKICAgICAgZ2FwOiAyNHB4OwogICAgfQoKICAgIC5pbnNpZ2h0LXBhbmVsIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiAxMnB4OwogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLXN1YnRsZSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE4cHg7CiAgICAgIHBhZGRpbmc6IDE4cHggMjBweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgxNywgMjQsIDM5LCAwLjA2KTsKICAgIH0KCiAgICAuaW5zaWdodC1wYW5lbF9faGVhZGVyIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA0cHg7CiAgICB9CgogICAgLmluc2lnaHQtcGFuZWxfX2hlYWRlciBoMyB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS04MDApOwogICAgfQoKICAgIC5pbnNpZ2h0LXBhbmVsX19oZWFkZXIgLm11dGVkIHsKICAgICAgbWFyZ2luLXRvcDogNHB4OwogICAgfQoKICAgIC5pbnNpZ2h0LXBhbmVsX19jaGFydCB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgaGVpZ2h0OiAyNjBweDsKICAgIH0KCiAgICAuaW5zaWdodC1wYW5lbF9fY2hhcnQgY2FudmFzIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGhlaWdodDogMTAwJTsKICAgIH0KCiAgICAuaW5zaWdodC1wYW5lbF9fbm90ZSB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLnVzYWdlLW1vbnRoLWNvbnRyb2xzIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBnYXA6IDEwcHg7CiAgICAgIG1hcmdpbjogMTJweCAwIDRweDsKICAgIH0KCiAgICAudXNhZ2UtdGhyZXNob2xkcyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZ2FwOiAxMnB4OwogICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICBhbGlnbi1pdGVtczogZmxleC1lbmQ7CiAgICB9CgogICAgLnVzYWdlLXRocmVzaG9sZHNfX2ZpZWxkIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgICBtaW4td2lkdGg6IDEyMHB4OwogICAgfQoKICAgIC51c2FnZS10aHJlc2hvbGRzX19maWVsZCBpbnB1dFt0eXBlPSJudW1iZXIiXSB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTEwLCAwLCAwLjI0KTsKICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgcGFkZGluZzogOHB4IDEwcHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWJhc2UpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgbWluLXdpZHRoOiAxMjBweDsKICAgIH0KCiAgICAudXNhZ2UtdGhyZXNob2xkc19fZmllbGQgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMgewogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMCwgMTEwLCAwLCAwLjYpOwogICAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSgwLCAxMTAsIDAsIDAuMTgpOwogICAgfQoKICAgIC51c2FnZS1tb250aC10b2dnbGUsCiAgICAudXNhZ2UtbW9udGgtdXRpbGl0eSB7CiAgICAgIHBhZGRpbmc6IDZweCAxMnB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMjgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMDgpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlLCBib3gtc2hhZG93IDAuMnMgZWFzZTsKICAgIH0KCiAgICAudXNhZ2UtbW9udGgtdG9nZ2xlOmhvdmVyLAogICAgLnVzYWdlLW1vbnRoLXV0aWxpdHk6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTYpOwogICAgfQoKICAgIC51c2FnZS1tb250aC10b2dnbGUuaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjk1KSwgcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjgpKTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1jb250cmFzdCk7CiAgICAgIGJveC1zaGFkb3c6IDAgOHB4IDE2cHggcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjIpOwogICAgICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50OwogICAgfQoKICAgIC51c2FnZS1tb250aC11dGlsaXR5IHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDgyLCA5MywgMTAyLCAwLjI0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSg4MiwgOTMsIDEwMiwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICAudXNhZ2UtbW9udGgtdXRpbGl0eTpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoODIsIDkzLCAxMDIsIDAuMTQpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICAudXNhZ2UtbW9udGgtZ3JpZCB7CiAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgIGdhcDogMjRweDsKICAgICAgbWFyZ2luLXRvcDogMTJweDsKICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoYXV0by1maXQsIG1pbm1heCg0ODBweCwgMWZyKSk7CiAgICB9CgogICAgLnVzYWdlLW1vbnRoLWNhcmQgewogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNhcmQpOwogICAgICBib3JkZXItcmFkaXVzOiAyMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuNDUpOwogICAgICBib3gtc2hhZG93OiB2YXIoLS1zaGFkb3ctY2FyZCk7CiAgICAgIHBhZGRpbmc6IDIwcHggMjJweCAyNHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDE2cHg7CiAgICB9CgogICAgLnVzYWdlLW1vbnRoLWNhcmRfX2hlYWRlciBoMyB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS05MDApOwogICAgfQoKICAgIC51c2FnZS1tb250aC1jYXJkX19oZWFkZXIgcCB7CiAgICAgIG1hcmdpbjogNHB4IDAgMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLnVzYWdlLW1vbnRoLWNhcmRfX2hlYWRlciBzcGFuIHsKICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICBtYXJnaW4tdG9wOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC51c2FnZS1tb250aC1jYXJkX19jaGFydHMgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBnYXA6IDE2cHg7CiAgICB9CgogICAgQG1lZGlhIChtaW4td2lkdGg6IDcyMHB4KSB7CiAgICAgIC51c2FnZS1tb250aC1jYXJkX19jaGFydHMgewogICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIG1pbm1heCgwLCAxZnIpKTsKICAgICAgfQogICAgfQoKICAgIC51c2FnZS1tb250aC1jYXJkX19wYW5lbCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogMTBweDsKICAgIH0KCiAgICAudXNhZ2UtbW9udGgtY2FyZF9fcGFuZWwgaDQgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWJhc2UpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS04MDApOwogICAgfQoKICAgIC51c2FnZS1tb250aC1jYXJkX19wYW5lbCBjYW52YXMgewogICAgICB3aWR0aDogMTAwJTsKICAgICAgaGVpZ2h0OiAyNjBweDsKICAgICAgbWF4LWhlaWdodDogMjYwcHg7CiAgICB9CgogICAgLnVzYWdlLW1vbnRoLWNhcmRfX25vdGUgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgICAgbWFyZ2luOiAwOwogICAgfQoKICAgIC51c2FnZS10cmVuZC1jb250cm9scyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZ2FwOiAxMHB4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgfQoKICAgIC51c2FnZS10cmVuZC10b2dnbGUgewogICAgICBwYWRkaW5nOiA2cHggMTRweDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMjgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlLCBjb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlOwogICAgfQoKICAgIC51c2FnZS10cmVuZC10b2dnbGU6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4xNCk7CiAgICB9CgogICAgLnVzYWdlLXRyZW5kLXRvZ2dsZS5pcy1hY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCByZ2JhKDAsIDExMCwgMCwgMC45MiksIHJnYmEoMCwgMTM4LCAwLCAwLjkyKSk7CiAgICAgIGNvbG9yOiAjZmZmZmZmOwogICAgICBib3gtc2hhZG93OiAwIDhweCAxNnB4IHJnYmEoMCwgMTEwLCAwLCAwLjE4KTsKICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgIH0KCiAgICAudXNhZ2UtcmVnaW9uLWNvbnRyb2xzLAogICAgLnJldHVybmluZy1yZWdpb24tY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogMTBweDsKICAgICAgbWFyZ2luLXRvcDogMTJweDsKICAgIH0KCiAgICAucmVnaW9uLXRvZ2dsZSB7CiAgICAgIHBhZGRpbmc6IDZweCAxNHB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDExMCwgMCwgMC4yOCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjA4KTsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZSwgYm94LXNoYWRvdyAwLjJzIGVhc2U7CiAgICB9CgogICAgLnJlZ2lvbi10b2dnbGU6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4xNCk7CiAgICB9CgogICAgLnJlZ2lvbi10b2dnbGUuaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgcmdiYSgwLCAxMTAsIDAsIDAuOTIpLCByZ2JhKDAsIDEzOCwgMCwgMC45MikpOwogICAgICBjb2xvcjogI2ZmZmZmZjsKICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgYm94LXNoYWRvdzogMCA4cHggMTZweCByZ2JhKDAsIDExMCwgMCwgMC4xOCk7CiAgICB9CgogICAgLnVzYWdlLXRyZW5kLWNoYXJ0IHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBoZWlnaHQ6IDM2MHB4OwogICAgfQoKICAgIC51c2FnZS1jYXJkIC5jaGFydC1lbXB0eSwKICAgIFtkYXRhLXVzYWdlLWNhcmRdIC5jaGFydC1lbXB0eSB7CiAgICAgIHBvc2l0aW9uOiBzdGF0aWM7CiAgICAgIGluc2V0OiBhdXRvOwogICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgcGFkZGluZzogMjRweCAwOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICB9CgogICAgLmluc2lnaHQtY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogZmxleC1lbmQ7CiAgICAgIGdhcDogMTZweDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwogICAgfQoKICAgIC5pbnNpZ2h0LXNlbGVjdCB7CiAgICAgIG1pbi13aWR0aDogMTkwcHg7CiAgICB9CgogICAgLmluc2lnaHQtc2VsZWN0IHNlbGVjdCB7CiAgICAgIG1pbi13aWR0aDogMTkwcHg7CiAgICB9CgogICAgLnJldHVybmluZy1jaGFydCB7CiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgaGVpZ2h0OiAzMjBweDsKICAgIH0KCiAgICAucmV0dXJuaW5nLWNoYXJ0IGNhbnZhcyB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBoZWlnaHQ6IDEwMCU7CiAgICB9CgogICAgLmVuYWJsZWQtbGljZW5zZXMtY2hhcnQgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIGhlaWdodDogMzIwcHg7CiAgICB9CgogICAgLmVuYWJsZWQtbGljZW5zZXMtY2hhcnQgY2FudmFzIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGhlaWdodDogMTAwJTsKICAgIH0KCi5lbmFibGVkLWxpY2Vuc2VzLWNvbnRyb2xzIHsKICBkaXNwbGF5OiBmbGV4OwogIGZsZXgtd3JhcDogd3JhcDsKICBnYXA6IDE2cHg7CiAgYWxpZ24taXRlbXM6IGZsZXgtZW5kOwogIG1hcmdpbi10b3A6IDZweDsKfQoKICAgIC5lbmFibGVkLWxpY2Vuc2VzLWNvbG9yLWNvbnRyb2xzIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBnYXA6IDEycHg7CiAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsKICAgIH0KCiAgICAuZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9sc19fZ3JvdXAgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDZweDsKICAgICAgbWluLXdpZHRoOiAxNDBweDsKICAgIH0KCiAgICAuZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9sc19fYWN0aW9ucyB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGdhcDogMTBweDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgfQoKICAgIC5lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlIHsKICAgICAgbWF4LXdpZHRoOiAyNDBweDsKICAgICAgZmxleDogMSAxIDIyMHB4OwogICAgfQoKICAgIC5lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19pbnB1dHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZV9faW5wdXRzIGlucHV0W3R5cGU9Im51bWJlciJdIHsKICAgICAgd2lkdGg6IDEyMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuNik7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CiAgICAgIHBhZGRpbmc6IDhweCAxMHB4OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuODUpOwogICAgfQoKICAgIC5lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19pbnB1dHMgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMgewogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMCwgMTEwLCAwLCAwLjUpOwogICAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSgwLCAxMzgsIDAsIDAuMTIpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZV9faW5wdXRzIGlucHV0W3R5cGU9Im51bWJlciJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMCwgMjQsIDMyLCAwLjkyKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDk2LCAxMDgsIDEyNCwgMC40KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICB9CgogICAgLmVuYWJsZWQtbGljZW5zZXMtb3ZlcnJpZGVfX2J1dHRvbnMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZV9faGludCB7CiAgICAgIG1hcmdpbjogNnB4IDAgMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLmVuYWJsZWQtbGljZW5zZXMtZ3JhZGllbnQtdG9nZ2xlIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC5lbmFibGVkLWxpY2Vuc2VzLWdyYWRpZW50LXRvZ2dsZSBpbnB1dCB7CiAgICAgIG1hcmdpbjogMDsKICAgIH0KCiAgICAuZW5hYmxlZC1saWNlbnNlcy12YWx1ZS10b2dnbGUgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBmb250LXdlaWdodDogNTAwOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLmVuYWJsZWQtbGljZW5zZXMtdmFsdWUtdG9nZ2xlIGlucHV0IHsKICAgICAgbWFyZ2luOiAwOwogICAgfQoKICAgIC5yZXR1cm5pbmctc3VtbWFyeSB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZ2FwOiAxMnB4OwogICAgfQoKICAgIC5pbnNpZ2h0LXN1bW1hcnkgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDEwcHggMTZweDsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMTEwLCAwLCAwLjE4KTsKICAgIH0KCiAgICAuYWN0aXZlLWRheXMtY2FyZCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogMjBweDsKICAgIH0KCiAgICAuYWN0aXZlLWRheXMtZ3JpZCB7CiAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMTYwcHgsIDFmcikpOwogICAgICBnYXA6IDE2cHg7CiAgICB9CgogICAgLmFjdGl2ZS1kYXlzLWl0ZW0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDZweDsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1zdWJ0bGUpOwogICAgICBib3JkZXItcmFkaXVzOiAxNnB4OwogICAgICBwYWRkaW5nOiAxNHB4IDE2cHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTcsIDI0LCAzOSwgMC4wOCk7CiAgICAgIG1pbi1oZWlnaHQ6IDg4cHg7CiAgICB9CgogICAgLmFjdGl2ZS1kYXlzLWxhYmVsIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBsZXR0ZXItc3BhY2luZzogMC4wNGVtOwogICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLmFjdGl2ZS1kYXlzLXZhbHVlIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteGwpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNjAwKTsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgIH0KCiAgICAuc2VyaWVzLWJ1bGstdG9nZ2xlIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI0KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjA4KTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgcGFkZGluZzogOHB4IDE4cHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGNvbG9yIDAuMnMgZWFzZSwgYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgYm94LXNoYWRvdyAwLjJzIGVhc2U7CiAgICAgIGZsZXg6IDAgMCBhdXRvOwogICAgfQoKICAgIC5zZXJpZXMtYnVsay10b2dnbGU6aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTYpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC40KTsKICAgIH0KCiAgICAuc2VyaWVzLWJ1bGstdG9nZ2xlW2FyaWEtcHJlc3NlZD0idHJ1ZSJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNik7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29udHJhc3QpOwogICAgICBib3gtc2hhZG93OiAwIDEwcHggMjBweCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTQpOwogICAgfQoKICAgIC5zZXJpZXMtYnVsay10b2dnbGUuaXMtZGlzYWJsZWQgewogICAgICBvcGFjaXR5OiAwLjU7CiAgICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgICB9CgogICAgLnRyZW5kLWNvbG9yLWNvbnRyb2xzIHsKCiAgICAgIGRpc3BsYXk6IGZsZXg7CgogICAgICBmbGV4LXdyYXA6IHdyYXA7CgogICAgICBnYXA6IDEycHg7CgogICAgICBhbGlnbi1pdGVtczogZmxleC1lbmQ7CgogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIzNywgMjM4LCAyMzgsIDAuNTUpOwoKICAgICAgcGFkZGluZzogMTZweCAxOHB4OwoKICAgICAgYm9yZGVyLXJhZGl1czogMTZweDsKCiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTcsIDI0LCAzOSwgMC4wNik7CgogICAgICBtYXJnaW4tYm90dG9tOiAxNnB4OwoKICAgIH0KCgoKICAgIC50cmVuZC1jb2xvci1jb250cm9sc19fZ3JvdXAgewoKICAgICAgZGlzcGxheTogZmxleDsKCiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CgogICAgICBnYXA6IDZweDsKCiAgICB9CgoKCiAgICAudHJlbmQtY29sb3ItY29udHJvbHMgbGFiZWwgewoKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwoKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKCiAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA0ZW07CgogICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwoKICAgICAgY29sb3I6IHZhcigtLWdyZXktNTAwKTsKCiAgICB9CgoKCiAgICAudHJlbmQtY29sb3ItY29udHJvbHMgaW5wdXRbdHlwZT0iY29sb3IiXSB7CgogICAgICB3aWR0aDogNTRweDsKCiAgICAgIGhlaWdodDogMzRweDsKCiAgICAgIGJvcmRlcjogbm9uZTsKCiAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7CgogICAgICBwYWRkaW5nOiAwOwoKICAgICAgY3Vyc29yOiBwb2ludGVyOwoKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CgogICAgfQoKCgogICAgLnRyZW5kLWNvbG9yLWNvbnRyb2xzX19hY3Rpb25zIHsKCiAgICAgIGRpc3BsYXk6IGZsZXg7CgogICAgICBmbGV4LXdyYXA6IHdyYXA7CgogICAgICBnYXA6IDEwcHg7CgogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwoKICAgIH0KCgoKICAgIC50cmVuZC1jb2xvci1idXR0b24gewogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMjQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTIpOwogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LXByaW1hcnkpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIHBhZGRpbmc6IDhweCAxNnB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC50cmVuZC1jb2xvci1idXR0b246aG92ZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjM1KTsKICAgIH0KCiAgICAudHJlbmQtY29sb3ItYnV0dG9uLmlzLXNlY29uZGFyeSB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNzcsIDg3LCA5MywgMC4yNCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoNzcsIDg3LCA5MywgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKCgogICAgLnRyZW5kLWNvbG9yLWJ1dHRvbi5pcy1zZWNvbmRhcnk6aG92ZXIgewoKICAgICAgYmFja2dyb3VuZDogcmdiYSg3NywgODcsIDkzLCAwLjE2KTsKCiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSg3NywgODcsIDkzLCAwLjMpOwoKICAgIH0KCgoKICAgIC50cmVuZC1jb2xvci1jb250cm9sc19faGludCB7CgogICAgICBtYXJnaW46IDA7CgogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CgogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwoKICAgICAgZmxleC1iYXNpczogMTAwJTsKCiAgICB9CgoKCgogICAgLnNlcmllcy10b2dnbGUtcmFpbCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtd3JhcDogd3JhcDsKICAgICAgZ2FwOiAxMHB4OwogICAgICBmbGV4OiAxIDEgYXV0bzsKICAgIH0KCiAgICAuZXhwb3J0LWNvbnRyb2xzIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBmbGV4OiAwIDAgYXV0bzsKICAgICAgbWFyZ2luLWxlZnQ6IGF1dG87CiAgICB9CgogICAgLmV4cG9ydC10cmlnZ2VyIHsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMjQpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIHBhZGRpbmc6IDZweCAxNnB4OwogICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlLCBjb2xvciAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlOwogICAgfQoKICAgIC5leHBvcnQtdHJpZ2dlcjpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDAsIDExMCwgMCwgMC40KTsKICAgIH0KCiAgICAuZXhwb3J0LXRyaWdnZXI6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDAsIDExMCwgMCwgMC4yNCk7CiAgICB9CgogICAgLmV4cG9ydC1tZW51IHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICB0b3A6IGNhbGMoMTAwJSArIDhweCk7CiAgICAgIHJpZ2h0OiAwOwogICAgICBtaW4td2lkdGg6IDIwMHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDhweDsKICAgICAgcGFkZGluZzogMTRweCAxNnB4OwogICAgICBib3JkZXItcmFkaXVzOiAxNHB4OwogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNhcmQpOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDExMCwgMCwgMC4xOCk7CiAgICAgIGJveC1zaGFkb3c6IDAgMThweCAzMHB4IHJnYmEoMCwgMzIsIDMyLCAwLjEyKTsKICAgICAgei1pbmRleDogNDA7CiAgICB9CgogICAgLmV4cG9ydC1tZW51IGJ1dHRvbiB7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICAgIHRleHQtYWxpZ246IGxlZnQ7CiAgICAgIHBhZGRpbmc6IDZweCAwOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGNvbG9yIDAuMnMgZWFzZTsKICAgIH0KCiAgICAuZXhwb3J0LW1lbnUgYnV0dG9uOmhvdmVyIHsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTUwMCk7CiAgICB9CgogICAgLmV4cG9ydC1vcHRpb24gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgICAgcGFkZGluZy10b3A6IDhweDsKICAgICAgbWFyZ2luLXRvcDogNHB4OwogICAgICBib3JkZXItdG9wOiAxcHggc29saWQgcmdiYSgwLCAxMTAsIDAsIDAuMDgpOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICB9CgogICAgLmV4cG9ydC1vcHRpb24gaW5wdXQgewogICAgICB3aWR0aDogMTZweDsKICAgICAgaGVpZ2h0OiAxNnB4OwogICAgICBhY2NlbnQtY29sb3I6IHZhcigtLWdyZWVuLTYwMCk7CiAgICB9CgogICAgLmV4cG9ydC1oaW50IHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxLjQ7CiAgICB9CgogICAgLnNlcmllcy10b2dnbGUgewogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDExMCwgMCwgMC4yNSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjA4KTsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgcGFkZGluZzogNnB4IDE0cHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlLCBjb2xvciAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlOwogICAgfQoKICAgIC5zZXJpZXMtdG9nZ2xlLmlzLWFjdGl2ZSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjE4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDAsIDExMCwgMCwgMC40KTsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICB9CgogICAgLnNlcmllcy10b2dnbGU6bm90KC5pcy1hY3RpdmUpIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxODksIDE5NywgMjAwLCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuNDUpOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgfQoKICAgIC5zZXJpZXMtdG9nZ2xlOmRpc2FibGVkIHsKICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICAgICAgb3BhY2l0eTogMC41NTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgxODksIDE5NywgMjAwLCAwLjE4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuNCk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTQwMCk7CiAgICAgIGJveC1zaGFkb3c6IG5vbmU7CiAgICB9CgogICAgLnNlcmllcy10b2dnbGU6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDNweCByZ2JhKDAsIDExMCwgMCwgMC4yNCk7CiAgICB9CgogICAgLmNoYXJ0LWhpbnQgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICAgIG1hcmdpbi10b3A6IC02cHg7CiAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICB9CgogICAgLmNoYXJ0LXdyYXBwZXIgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIG1pbi1oZWlnaHQ6IDMyMHB4OwogICAgfQoKICAgIGNhbnZhcyB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBoZWlnaHQ6IDEwMCU7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIGNhbnZhcyB7CiAgICAgIGJhY2tncm91bmQ6CiAgICAgICAgcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCAzMCUgMjAlLCByZ2JhKDcyLCAxMzUsIDE3MCwgMC4yOCksIHRyYW5zcGFyZW50IDY1JSksCiAgICAgICAgbGluZWFyLWdyYWRpZW50KDE4MGRlZywgcmdiYSg5LCAxNiwgMjcsIDAuOSksIHJnYmEoOCwgMTgsIDMwLCAwLjkpKTsKICAgICAgYm9yZGVyLXJhZGl1czogMThweDsKICAgIH0KCiAgICAuY2hhcnQtZW1wdHkgewogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIGluc2V0OiAwOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtYmFzZSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1jYXJkKTsKICAgICAgYm9yZGVyLXJhZGl1czogMThweDsKICAgICAgYm9yZGVyOiAxcHggZGFzaGVkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zKTsKICAgIH0KCiAgICAuZ3JvdXAtY2FyZCB7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY2FyZCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1sZyk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zKTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LWNhcmQpOwogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS14bCk7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogdmFyKC0tc3BhY2UtbGcpOwogICAgICB0cmFuc2l0aW9uOiBhbGwgdmFyKC0tdHJhbnNpdGlvbi1iYXNlKTsKICAgIH0KCiAgICAuZ3JvdXAtY2FyZDpob3ZlciB7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMnB4KTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LWxnKTsKICAgIH0KCiAgICAuZ3JvdXAtaGVhZGVyIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgIGdhcDogMTRweDsKICAgIH0KCiAgICAuZ3JvdXAtaGVhZGVyIGgyIHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1sZyk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTkwMCk7CiAgICB9CgogICAgLmdyb3VwLXRhYmxlIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgIH0KCiAgICAuZ3JvdXAtdGFibGUgdGhlYWQgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgMTEwLCAwLCAwLjkpIDAlLCByZ2JhKDAsIDEzOCwgMCwgMC45KSAxMDAlKTsKICAgICAgY29sb3I6ICNmZmZmZmY7CiAgICB9CgogICAgLmdyb3VwLXRhYmxlIHRoIHsKICAgICAgcGFkZGluZzogMTRweCAxOHB4OwogICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA1ZW07CiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgIGZvbnQtd2VpZ2h0OiA1MDA7CiAgICB9CgogICAgLmdyb3VwLXRhYmxlIHRoLnZhbHVlLWNvbCwKICAgIC5ncm91cC10YWJsZSB0ZC52YWx1ZS1jZWxsIHsKICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICB9CgogICAgLmdyb3VwLXRhYmxlIHRoLnVzZXJzLWNvbCwKICAgIC5ncm91cC10YWJsZSB0ZC51c2Vycy1jZWxsIHsKICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICB9CgogICAgLmdyb3VwLXRhYmxlIHRoLmF2Zy1jb2wsCiAgICAuZ3JvdXAtdGFibGUgdGQuYXZnLWNlbGwgewogICAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgIH0KCiAgICAuZ3JvdXAtdGFibGUgdGguc2hhcmUtY29sLAogICAgLmdyb3VwLXRhYmxlIHRkLnNoYXJlLWNlbGwgewogICAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgIH0KCiAgICAuZ3JvdXAtdGFibGUgdGQgewogICAgICBwYWRkaW5nOiAxMnB4IDE4cHg7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDIzNywgMjM4LCAyMzgsIDAuODUpOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS03MDApOwogICAgfQoKICAgIC5ncm91cC1iYXIgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIGhlaWdodDogMTBweDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMTEwLCAwLCAwLjE2KTsKICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgIH0KCiAgICAuZ3JvdXAtYmFyIHNwYW4gewogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIGluc2V0OiAwOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMCwgMTEwLCAwLCAwLjg1KSwgcmdiYSgwLCAxMzgsIDAsIDAuOTUpKTsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGxlZnQ7CiAgICB9CgoKICAgIGJvZHkuaXMtZGFyayAuZ3JvdXAtdGFibGUgdGhlYWQgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMzYsIDE3OSwgMTI3LCAwLjk1KSwgcmdiYSgyNywgMTA4LCAxNDcsIDAuOTUpKTsKICAgICAgY29sb3I6ICNmNWY3ZmY7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5ncm91cC10YWJsZSB0aCB7CiAgICAgIGNvbG9yOiAjZjVmN2ZmOwogICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSg1OCwgODgsIDExOCwgMC40KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmdyb3VwLXRhYmxlIHRib2R5IHRyIHsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5ncm91cC10YWJsZSB0Ym9keSB0cjpudGgtY2hpbGQoZXZlbikgewogICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmdyb3VwLXRhYmxlIHRkIHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtYm9keSk7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDU4LCA4OCwgMTE4LCAwLjM1KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmdyb3VwLWJhciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMzYsIDE3OSwgMTI3LCAwLjIyKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmdyb3VwLWJhciBzcGFuIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCByZ2JhKDM2LCAxNzksIDEyNywgMC45KSwgcmdiYSg2MiwgMTQ1LCAyMDEsIDAuOSkpOwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZS13cmFwcGVyIHsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICBvdmVyZmxvdy14OiBhdXRvOwogICAgICBtaW4taGVpZ2h0OiAyMjBweDsKICAgIH0KCiAgICAuYWRvcHRpb24tY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwogICAgICBtYXJnaW4tYm90dG9tOiAxNHB4OwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1iYXNlKTsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgICAgbWluLXdpZHRoOiA1MjBweDsKICAgIH0KCiAgICAuYWRvcHRpb24tdGFibGUgdGhlYWQgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4wOCk7CiAgICB9CgogICAgLmFkb3B0aW9uLXRhYmxlIHRoIHsKICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgIGxldHRlci1zcGFjaW5nOiAwLjA0ZW07CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICB9CgogICAgLmFkb3B0aW9uLXRhYmxlIHRoLmlzLW51bWVyaWMsCiAgICAuYWRvcHRpb24tdGFibGUgdGQuaXMtbnVtZXJpYyB7CiAgICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSB0Ym9keSB0ciB7CiAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50OwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSB0ZCB7CiAgICAgIHBhZGRpbmc6IDEycHggMTZweDsKICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zNSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSB0ci5pcy1hcHAgewogICAgICAtLWFkb3B0aW9uLWFjY2VudDogdmFyKC0tYWNjZW50LXByaW1hcnkpOwogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHZhcigtLWFkb3B0aW9uLWFjY2VudCk7CiAgICB9CgogICAgLmFkb3B0aW9uLXRhYmxlIHRyLmlzLWFwcCA+IHRkOmZpcnN0LWNoaWxkIHsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWFkb3B0aW9uLWFjY2VudCk7CiAgICB9CgogICAgLmFkb3B0aW9uLXRhYmxlIHRyLmlzLWZlYXR1cmUgewogICAgICBib3JkZXItbGVmdDogNHB4IHNvbGlkIHRyYW5zcGFyZW50OwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSB0ci5pcy1mZWF0dXJlW2RhdGEtYXBwLWtleV0gewogICAgICBib3JkZXItbGVmdC1jb2xvcjogdmFyKC0tYWRvcHRpb24tYWNjZW50KTsKICAgIH0KCiAgICAuYWRvcHRpb24tdGFibGUgdHIuaXMtZmVhdHVyZSB0ZDpmaXJzdC1jaGlsZCB7CiAgICAgIHBhZGRpbmctbGVmdDogMzZweDsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSAuYWRvcHRpb24tbGFiZWwgewogICAgICBkaXNwbGF5OiBpbmxpbmUtZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5hZG9wdGlvbi10YWJsZSB0aGVhZCB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjgsIDQwLCA2MCwgMC45Mik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5hZG9wdGlvbi10YWJsZSB0aCB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmFkb3B0aW9uLXRhYmxlIHRkIHsKICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogcmdiYSg2MCwgODQsIDEyMCwgMC40NSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5hZG9wdGlvbi10YWJsZSB0ci5pcy1hcHAgewogICAgICBib3JkZXItbGVmdC1jb2xvcjogcmdiYSgzNiwgMTc5LCAxMjcsIDAuNjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWRvcHRpb24tdGFibGUgdHIuaXMtYXBwID4gdGQ6Zmlyc3QtY2hpbGQgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmFkb3B0aW9uLXRhYmxlIHRyLmlzLWZlYXR1cmUgdGQ6Zmlyc3QtY2hpbGQgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLmFkb3B0aW9uLWJ1bGxldCB7CiAgICAgIHdpZHRoOiA2cHg7CiAgICAgIGhlaWdodDogNnB4OwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgYmFja2dyb3VuZDogdmFyKC0tYWRvcHRpb24tYWNjZW50LCB2YXIoLS1ncmVlbi01MDApKTsKICAgICAgb3BhY2l0eTogMC42OwogICAgfQoKICAgIC5hZG9wdGlvbi10YWJsZSAuaXMtZW1wdHktcm93IHRkIHsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICBmb250LXN0eWxlOiBpdGFsaWM7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICAuYWdlbnQtY2FyZCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogMTZweDsKICAgIH0KCiAgICAuYWdlbnQtY29udHJvbHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogMTJweDsKICAgIH0KCiAgICAuYWdlbnQtbW9kZS1idXR0b25zIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICB9CgogICAgLmFnZW50LWZpbHRlci1iYXIgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBnYXA6IDEycHg7CiAgICAgIG1hcmdpbi10b3A6IDEycHg7CiAgICB9CgogICAgLmFnZW50LWZpbHRlci1zZWFyY2ggewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuYWdlbnQtc2VhcmNoLWlucHV0IHsKICAgICAgZmxleDogMTsKICAgICAgbWluLXdpZHRoOiAyMDBweDsKICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjYpOwogICAgICBib3JkZXItcmFkaXVzOiA5OTlweDsKICAgICAgcGFkZGluZzogOHB4IDE0cHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWJhc2UpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOCk7CiAgICAgIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC1zZWFyY2gtaW5wdXQ6Zm9jdXMgewogICAgICBvdXRsaW5lOiBub25lOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoMCwgMTM4LCAwLCAwLjUpOwogICAgICBib3gtc2hhZG93OiAwIDAgMCAzcHggcmdiYSgwLCAxMzgsIDAsIDAuMTIpOwogICAgfQoKICAgIC5hZ2VudC1zZWFyY2gtaW5wdXQ6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDJweCBzb2xpZCB2YXIoLS1ncmVlbi01MDApOwogICAgICBvdXRsaW5lLW9mZnNldDogMnB4OwogICAgfQoKICAgIC5hZ2VudC1jbGVhci1idXR0b24gewogICAgICBib3JkZXI6IG5vbmU7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4yKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNzAwKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIHBhZGRpbmc6IDZweCAxNHB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlLCBjb2xvciAwLjJzIGVhc2U7CiAgICB9CgogICAgLmFnZW50LWNsZWFyLWJ1dHRvbjpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zMik7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTgwMCk7CiAgICB9CgogICAgLmFnZW50LXF1aWNrLWZpbHRlcnMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogOHB4OwogICAgfQoKICAgIC5hZ2VudC1xdWljay1sYWJlbCB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgIH0KCiAgICAuYWdlbnQtY2hpcCB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yNCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBwYWRkaW5nOiA2cHggMTRweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC1jaGlwOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjE4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNCk7CiAgICB9CgogICAgLmFnZW50LWNoaXAuaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI4KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNTUpOwogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LWNvbnRyYXN0KTsKICAgIH0KCiAgICAuYWdlbnQtY2xlYXItYnV0dG9uOmZvY3VzLXZpc2libGUsCiAgICAuYWdlbnQtY2hpcDpmb2N1cy12aXNpYmxlLAogICAgLmFnZW50LXRvZ2dsZS1idXR0b246Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDJweCBzb2xpZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNik7CiAgICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7CiAgICB9CgogICAgLmFnZW50LWZpbHRlci1tb2RlIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICBnYXA6IDhweDsKICAgIH0KCiAgICAuYWdlbnQtdmlldy1idXR0b25zIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiA4cHg7CiAgICB9CgogICAgLmFnZW50LXVwbG9hZC1idXR0b24gewogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMzIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTIpOwogICAgICBjb2xvcjogdmFyKC0tYWNjZW50LXByaW1hcnkpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBwYWRkaW5nOiAxMHB4IDIwcHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzIGVhc2UsIGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJveC1zaGFkb3cgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC11cGxvYWQtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC40NSk7CiAgICAgIGJveC1zaGFkb3c6IDAgMTJweCAyMHB4IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4xOCk7CiAgICB9CgogICAgLmFnZW50LXRhYmxlLXdyYXBwZXIgewogICAgICBvdmVyZmxvdy14OiBhdXRvOwogICAgfQoKICAgIC5hZ2VudC10YWJsZSB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICB9CgogICAgLmFnZW50LXRhYmxlIHRoLAogICAgLmFnZW50LXRhYmxlIHRkIHsKICAgICAgcGFkZGluZzogMTBweCAxMnB4OwogICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjI0KTsKICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgIH0KCiAgICAuYWdlbnQtdGFibGUgdGggewogICAgICBwYWRkaW5nOiAwOwogICAgfQoKICAgIC5hZ2VudC10YWJsZSB0aCB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhzKTsKICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsKICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDRlbTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgIH0KCiAgICAuYWdlbnQtdGFibGUgdGguaXMtbnVtZXJpYywKICAgIC5hZ2VudC10YWJsZSB0ZC5pcy1udW1lcmljIHsKICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7CiAgICAgIGZvbnQtdmFyaWFudC1udW1lcmljOiB0YWJ1bGFyLW51bXM7CiAgICB9CgogICAgLmFnZW50LXNvcnQtYnV0dG9uIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDEwcHggMTJweDsKICAgICAgYmFja2dyb3VuZDogbm9uZTsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBjb2xvcjogaW5oZXJpdDsKICAgICAgZm9udDogaW5oZXJpdDsKICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICAgICAgZ2FwOiA4cHg7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgIH0KCiAgICAuYWdlbnQtdGFibGUgdGguaXMtbnVtZXJpYyAuYWdlbnQtc29ydC1idXR0b24gewogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kOwogICAgfQoKICAgIC5hZ2VudC1zb3J0LWJ1dHRvbjpob3ZlciAuYWdlbnQtc29ydC1sYWJlbCB7CiAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOwogICAgfQoKICAgIC5hZ2VudC1zb3J0LWJ1dHRvbi5pcy1hY3RpdmUgLmFnZW50LXNvcnQtbGFiZWwgewogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNzAwKTsKICAgIH0KCiAgICAuYWdlbnQtc29ydC1pbmRpY2F0b3IgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTUwMCk7CiAgICB9CgogICAgLmFnZW50LXNvcnQtYnV0dG9uLmlzLWFjdGl2ZSAuYWdlbnQtc29ydC1pbmRpY2F0b3IgewogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNzAwKTsKICAgIH0KCiAgICAuYWdlbnQtdG9nZ2xlLWJ1dHRvbiB7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4yNCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4wOCk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LWJvZHkpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBwYWRkaW5nOiA4cHggMTZweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgYm9yZGVyLWNvbG9yIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC10b2dnbGUtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjE2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNCk7CiAgICB9CgogICAgLmFnZW50LXRvZ2dsZS1idXR0b24uaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjI2KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNik7CiAgICAgIGNvbG9yOiB2YXIoLS1hY2NlbnQtY29udHJhc3QpOwogICAgICBib3gtc2hhZG93OiAwIDEwcHggMjBweCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMTYpOwogICAgfQoKICAgIC5hZ2VudC10YWJsZSB0Ym9keSB0cjpsYXN0LWNoaWxkIHRkIHsKICAgICAgYm9yZGVyLWJvdHRvbTogbm9uZTsKICAgIH0KCiAgICAuYWdlbnQtaHViIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1sZyk7CiAgICB9CgogICAgLmFnZW50LXRhYmxpc3QgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LXdyYXA6IHdyYXA7CiAgICAgIGdhcDogOHB4OwogICAgfQoKICAgIC5hZ2VudC10YWIgewogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMjgpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuMDYpOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDk5OXB4OwogICAgICBwYWRkaW5nOiA4cHggMTZweDsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlLCBib3JkZXItY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC10YWIuaXMtYWN0aXZlIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjIpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC42KTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1wcmltYXJ5KTsKICAgIH0KCiAgICAuYWdlbnQtcGFuZWwgewogICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1wYW5lbC1ib3JkZXItY29sb3IpOwogICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtbGcpOwogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1tZCk7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY2FyZCk7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogdmFyKC0tc3BhY2Utc20pOwogICAgfQoKICAgIC5hZ2VudC1kcm9wem9uZSB7CiAgICAgIGJvcmRlcjogMXB4IGRhc2hlZCByZ2JhKHZhcigtLWFjY2VudC1wcmltYXJ5LXJnYiksIDAuNDUpOwogICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtbWQpOwogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1tZCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4wNCk7CiAgICAgIHRyYW5zaXRpb246IGJvcmRlci1jb2xvciAwLjJzIGVhc2UsIGJhY2tncm91bmQgMC4ycyBlYXNlOwogICAgfQoKICAgIC5hZ2VudC1kcm9wem9uZS5pcy1hY3RpdmUgewogICAgICBib3JkZXItY29sb3I6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC44KTsKICAgICAgYmFja2dyb3VuZDogcmdiYSh2YXIoLS1hY2NlbnQtcHJpbWFyeS1yZ2IpLCAwLjEyKTsKICAgIH0KCiAgICAuYWdlbnQtaW5saW5lLXVwbG9hZCB7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYmFja2dyb3VuZDogbm9uZTsKICAgICAgY29sb3I6IHZhcigtLWFjY2VudC1wcmltYXJ5KTsKICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgcGFkZGluZzogMDsKICAgICAgZm9udC1zaXplOiBpbmhlcml0OwogICAgfQoKICAgIC5hZ2VudC1zdGF0dXMgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC5hZ2VudC1tZXRhIHsKICAgICAgbWFyZ2luOiAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICAuYWdlbnQtdGFibGUtd3JhcHBlciB7CiAgICAgIG92ZXJmbG93LXg6IGF1dG87CiAgICB9CgogICAgLmFnZW50LWRhdGEtdGFibGUgewogICAgICB3aWR0aDogMTAwJTsKICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC5hZ2VudC1kYXRhLXRhYmxlIHRoLAogICAgLmFnZW50LWRhdGEtdGFibGUgdGQgewogICAgICBwYWRkaW5nOiAxMHB4IDEycHg7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMzUpOwogICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgfQoKICAgIC5hZ2VudC1kYXRhLXRhYmxlIHRoIHsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICBsZXR0ZXItc3BhY2luZzogMC4wNWVtOwogICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgLmFnZW50LWRhdGEtdGFibGUgdGguaXMtbnVtZXJpYywKICAgIC5hZ2VudC1kYXRhLXRhYmxlIHRkLmlzLW51bWVyaWMgewogICAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgIH0KCiAgICAuYWdlbnQtZW1wdHkgewogICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1zbSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IHZhcigtLXJhZGl1cy1tZCk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEodmFyKC0tYWNjZW50LXByaW1hcnktcmdiKSwgMC4wNik7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC5hZ2VudC1zdGF0dXMgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgIH0KCiAgICAuYWdlbnQtY2FyZCAuY2hhcnQtZW1wdHkgewogICAgICBwb3NpdGlvbjogc3RhdGljOwogICAgICBib3JkZXI6IDFweCBkYXNoZWQgcmdiYSgxODksIDE5NywgMjAwLCAwLjQ1KTsKICAgICAgYm9yZGVyLXJhZGl1czogMTZweDsKICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIH0KCiAgICAuYWRvcHRpb24tZm9vdGVyIHsKICAgICAgbWFyZ2luLXRvcDogMTZweDsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGJhc2VsaW5lOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgIGdhcDogMThweDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC5hZG9wdGlvbi10b3RhbCB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLWxnKTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktOTAwKTsKICAgIH0KCiAgICAudmlldy1tb3JlLWJ1dHRvbiB7CiAgICAgIGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYm9yZGVyLXJhZGl1czogOTk5cHg7CiAgICAgIHBhZGRpbmc6IDhweCAxOHB4OwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDExMCwgMCwgMC4xMik7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi03MDApOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4ycyBlYXNlOwogICAgfQoKICAgIC52aWV3LW1vcmUtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMTAsIDAsIDAuMik7CiAgICB9CgogICAgLmNhdGVnb3J5LWdyaWQgewogICAgICBkaXNwbGF5OiBncmlkOwogICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdChhdXRvLWZpdCwgbWlubWF4KDMyMHB4LCAxZnIpKTsKICAgICAgZ2FwOiAyOHB4OwogICAgfQogICAgQG1lZGlhIChtaW4td2lkdGg6IDEyODBweCkgewogICAgICAuY2F0ZWdvcnktZ3JpZCB7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMywgbWlubWF4KDAsIDFmcikpOwogICAgICB9CiAgICB9CgogICAgLmNhdGVnb3J5LWNhcmQgewogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1zdXJmYWNlLWNhcmQpOwogICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMtbGcpOwogICAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMyk7CiAgICAgIGJveC1zaGFkb3c6IHZhcigtLXNoYWRvdy1jYXJkKTsKICAgICAgcGFkZGluZzogdmFyKC0tc3BhY2UteGwpOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IHZhcigtLXNwYWNlLWxnKTsKICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICB0cmFuc2l0aW9uOiBhbGwgdmFyKC0tdHJhbnNpdGlvbi1iYXNlKTsKICAgIH0KCiAgICAuY2F0ZWdvcnktY2FyZDpob3ZlciB7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtMnB4KTsKICAgICAgYm94LXNoYWRvdzogdmFyKC0tc2hhZG93LWxnKTsKICAgIH0KCiAgICAuY2F0ZWdvcnktY2FyZF9faGVhZGVyIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgZ2FwOiAxNnB4OwogICAgfQoKICAgIC5jYXRlZ29yeS1pY29uIHsKICAgICAgZmxleDogMCAwIGF1dG87CiAgICAgIHdpZHRoOiA0NHB4OwogICAgICBoZWlnaHQ6IDQ0cHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgZm9udC13ZWlnaHQ6IDcwMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICBjb2xvcjogI2ZmZmZmZjsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDE1MGRlZywgcmdiYSgwLCAxMTAsIDAsIDAuOSksIHJnYmEoOSwgMTE0LCAxMzYsIDAuOTIpKTsKICAgICAgYm94LXNoYWRvdzogMCAxMnB4IDIycHggcmdiYSgwLCAxMTAsIDAsIDAuMjIpOwogICAgfQoKICAgIC5jYXRlZ29yeS1pY29uOjphZnRlciB7CiAgICAgIGNvbnRlbnQ6IGF0dHIoZGF0YS1sZXR0ZXIpOwogICAgfQoKICAgIC5jYXRlZ29yeS1jYXJkX19oZWFkZXItdGV4dCBoMyB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICBmb250LXdlaWdodDogNjAwOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS05MDApOwogICAgfQoKICAgIC5jYXRlZ29yeS1jYXJkX19oZWFkZXItdGV4dCBwIHsKICAgICAgbWFyZ2luOiA0cHggMCAwOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgICAgbGluZS1oZWlnaHQ6IDEuNTsKICAgICAgbWF4LXdpZHRoOiAzNjBweDsKICAgIH0KCiAgICAuY2F0ZWdvcnktY2FyZF9fc3RhdHMgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDE2cHg7CiAgICB9CgogICAgLmNhdGVnb3J5LWNhcmRfX3N0YXQgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgICAgZ2FwOiAxOHB4OwogICAgfQoKICAgIC5jYXRlZ29yeS1jYXJkX192YWx1ZSB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLTJ4bCk7CiAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmVlbi01MDApOwogICAgICBsaW5lLWhlaWdodDogMS4xOwogICAgICBmb250LXZhcmlhbnQtbnVtZXJpYzogdGFidWxhci1udW1zOwogICAgICBtaW4td2lkdGg6IDEyMHB4OwogICAgfQoKICAgIC5jYXRlZ29yeS1jYXJkX19zdGF0LmlzLWVtcGhhc2l6ZWQgLmNhdGVnb3J5LWNhcmRfX3ZhbHVlIHsKICAgICAgZm9udC1zaXplOiAycmVtOwogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNjAwKTsKICAgIH0KCiAgICAuY2F0ZWdvcnktY2FyZF9fbGFiZWwgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgICAgbGluZS1oZWlnaHQ6IDEuNTsKICAgIH0KCiAgICAuY2F0ZWdvcnktY2FyZF9fcGxhY2Vob2xkZXIgewogICAgICBtYXJnaW46IDA7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIC5jYXRlZ29yeS1jYXJkLmlzLWVtcHR5IC5jYXRlZ29yeS1jYXJkX192YWx1ZSB7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmNhdGVnb3J5LWNhcmQgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjM0KTsKICAgICAgYm94LXNoYWRvdzogMCAyMHB4IDM2cHggcmdiYSg2LCA5LCAxNCwgMC40OCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jYXRlZ29yeS1jYXJkX19oZWFkZXItdGV4dCBoMyB7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTkwMCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5jYXRlZ29yeS1jYXJkX19oZWFkZXItdGV4dCBwIHsKICAgICAgY29sb3I6IHZhcigtLXRleHQtbXV0ZWQpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY2F0ZWdvcnktY2FyZF9fdmFsdWUgewogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNTAwKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLmNhdGVnb3J5LWNhcmRfX3N0YXQuaXMtZW1waGFzaXplZCAuY2F0ZWdvcnktY2FyZF9fdmFsdWUgewogICAgICBjb2xvcjogdmFyKC0tZ3JlZW4tNjAwKTsKICAgIH0KCiAgICBAbWVkaWEgKG1heC13aWR0aDogNjQwcHgpIHsKICAgICAgLmNhdGVnb3J5LWNhcmQgewogICAgICAgIHBhZGRpbmc6IDI0cHggMjJweDsKICAgICAgfQogICAgICAuY2F0ZWdvcnktY2FyZF9fc3RhdCB7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBnYXA6IDZweDsKICAgICAgfQogICAgICAuY2F0ZWdvcnktY2FyZF9fdmFsdWUgewogICAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXhsKTsKICAgICAgICBtaW4td2lkdGg6IDA7CiAgICAgIH0KICAgIH0KCiAgICAudG9wLXVzZXJzIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiAxMnB4OwogICAgfQoKICAgIC50b3AtdXNlcnMtbGlzdCB7CiAgICAgIG1hcmdpbjogMDsKICAgICAgcGFkZGluZy1sZWZ0OiAyMHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDEwcHg7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNzAwKTsKICAgIH0KCiAgICAudG9wLXVzZXJzLWxpc3RfX2l0ZW0gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgIGdhcDogMTJweDsKICAgICAgZm9udC12YXJpYW50LW51bWVyaWM6IHRhYnVsYXItbnVtczsKICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zKTsKICAgICAgcGFkZGluZy1ib3R0b206IDZweDsKICAgIH0KCiAgICAudG9wLXVzZXJzLWxpc3RfX2l0ZW06bGFzdC1jaGlsZCB7CiAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7CiAgICB9CgogICAgLnRvcC11c2Vycy1saXN0X19uYW1lIHsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgY29sb3I6IHZhcigtLWdyZXktODAwKTsKICAgIH0KCiAgICAudG9wLXVzZXJzLWxpc3RfX2luZm8gewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDJweDsKICAgIH0KCiAgICAudG9wLXVzZXJzLWxpc3RfX29yZyB7CiAgICAgIGZvbnQtc2l6ZTogdmFyKC0tZm9udC1zaXplLXNtKTsKICAgICAgY29sb3I6IHZhcigtLWdyZXktNTAwKTsKICAgIH0KCiAgICAudG9wLXVzZXJzLWxpc3RfX3ZhbHVlIHsKICAgICAgY29sb3I6IHZhcigtLWdyZWVuLTcwMCk7CiAgICB9CiAgICAubXV0ZWQgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgW2hpZGRlbl0gewogICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7CiAgICB9CgogICAgQG1lZGlhIChtYXgtd2lkdGg6IDg2MHB4KSB7CiAgICAgIC50cmVuZC1jb2xvci1jb250cm9scyB7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgICAgfQoKICAgICAgLnRyZW5kLWNvbG9yLWNvbnRyb2xzX19hY3Rpb25zLAogICAgICAudHJlbmQtY29sb3ItYnV0dG9uIHsKICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgfQoKICAgICAgLnN0b3JhZ2UtY29udHJvbHMgewogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7CiAgICAgIH0KCiAgICAgIC5zdG9yYWdlLWJ1dHRvbiB7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIH0KCiAgICAgIC51cGxvYWQtcHJvZ3Jlc3MgewogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7CiAgICAgIH0KCiAgICAgIG1haW4gewogICAgICAgIHBhZGRpbmc6IDMycHggMjBweCA3MnB4OwogICAgICB9CiAgICAgIC5jb250cm9sLXBhbmVsIHsKICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogICAgICB9CiAgICAgIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgewogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICB9CiAgICAgIC5jb250cm9sLXNlbGVjdC0tbXVsdGkgLm11bHRpLXNlbGVjdCB7CiAgICAgICAgbWluLWhlaWdodDogMTQwcHg7CiAgICAgIH0KICAgICAgLmZpbHRlci10b2dnbGUgewogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICB9CiAgICAgIC5maWx0ZXItdG9nZ2xlIC5maWx0ZXItcGlsbCB7CiAgICAgICAgZmxleDogMSAxIGNhbGMoNTAlIC0gOHB4KTsKICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgIH0KICAgICAgLmdyb3VwLWhlYWRlciB7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgICAgfQogICAgfQoKICAgIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICBFTkhBTkNFRCBSRVNQT05TSVZFIEJSRUFLUE9JTlRTCiAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKICAgIC8qIFNtYWxsIG1vYmlsZSAobWF4LXdpZHRoOiA2NDBweCkgKi8KICAgIEBtZWRpYSAobWF4LXdpZHRoOiA2NDBweCkgewogICAgICBtYWluIHsKICAgICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1sZykgdmFyKC0tc3BhY2UtbWQpIHZhcigtLXNwYWNlLTJ4bCk7CiAgICAgICAgZ2FwOiB2YXIoLS1zcGFjZS1sZyk7CiAgICAgIH0KCiAgICAgIC5zdW1tYXJ5LWdyaWQgewogICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyOwogICAgICB9CgogICAgICAuY2hhcnQtYWN0aW9ucyB7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgICAgfQoKICAgICAgLmJ0biB7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgIH0KCiAgICAgIC51cGxvYWQtYnV0dG9uLWdyb3VwIHsKICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICB9CgogICAgICAuaW50cm8tY2FyZCwKICAgICAgLmRhdGFzZXQtY2FyZCwKICAgICAgLnRyZW5kLWNhcmQsCiAgICAgIC5ncm91cC1jYXJkIHsKICAgICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS1sZyk7CiAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tcmFkaXVzLWxnKTsKICAgICAgfQogICAgfQoKICAgIC8qIFRhYmxldCBwb3J0cmFpdCAobWluLXdpZHRoOiA2NDFweCBhbmQgbWF4LXdpZHRoOiA3NjhweCkgKi8KICAgIEBtZWRpYSAobWluLXdpZHRoOiA2NDFweCkgYW5kIChtYXgtd2lkdGg6IDc2OHB4KSB7CiAgICAgIG1haW4gewogICAgICAgIGdhcDogdmFyKC0tc3BhY2UteGwpOwogICAgICB9CgogICAgICAuc3VtbWFyeS1ncmlkIHsKICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpOwogICAgICB9CgogICAgICAuY29udHJvbC1wYW5lbCB7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoMiwgMWZyKTsKICAgICAgfQogICAgfQoKICAgIC8qIFRhYmxldCBsYW5kc2NhcGUgKG1pbi13aWR0aDogNzY5cHggYW5kIG1heC13aWR0aDogMTAyNHB4KSAqLwogICAgQG1lZGlhIChtaW4td2lkdGg6IDc2OXB4KSBhbmQgKG1heC13aWR0aDogMTAyNHB4KSB7CiAgICAgIC5wYWdlLWhlYWRlciB7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7CiAgICAgIH0KCiAgICAgIC5zdW1tYXJ5LWdyaWQgewogICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIDFmcik7CiAgICAgIH0KCiAgICAgIC5jb250cm9sLXBhbmVsIHsKICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgzLCAxZnIpOwogICAgICB9CgogICAgICAuY2hhcnQtYWN0aW9ucyB7CiAgICAgICAgZmxleC13cmFwOiB3cmFwOwogICAgICB9CiAgICB9CgogICAgLyogRGVza3RvcCAobWluLXdpZHRoOiAxMDI1cHggYW5kIG1heC13aWR0aDogMTI4MHB4KSAqLwogICAgQG1lZGlhIChtaW4td2lkdGg6IDEwMjVweCkgYW5kIChtYXgtd2lkdGg6IDEyODBweCkgewogICAgICBtYWluIHsKICAgICAgICBtYXgtd2lkdGg6IDExNDBweDsKICAgICAgfQoKICAgICAgLnN1bW1hcnktZ3JpZCB7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiByZXBlYXQoNCwgMWZyKTsKICAgICAgfQogICAgfQoKICAgIC8qIExhcmdlIGRlc2t0b3AgKG1pbi13aWR0aDogMTI4MXB4KSAqLwogICAgQG1lZGlhIChtaW4td2lkdGg6IDEyODFweCkgewogICAgICBtYWluIHsKICAgICAgICBtYXgtd2lkdGg6IDEyNDBweDsKICAgICAgfQoKICAgICAgLnRyZW5kLWNhcmQsCiAgICAgIC5ncm91cC1jYXJkIHsKICAgICAgICBwYWRkaW5nOiB2YXIoLS1zcGFjZS14bCk7CiAgICAgIH0KCiAgICAgIC5zdW1tYXJ5LWdyaWQgewogICAgICAgIGdhcDogdmFyKC0tc3BhY2UtbGcpOwogICAgICB9CiAgICB9CgogICAgLyogVG91Y2ggZGV2aWNlIG9wdGltaXphdGlvbnMgKi8KICAgIEBtZWRpYSAoaG92ZXI6IG5vbmUpIGFuZCAocG9pbnRlcjogY29hcnNlKSB7CiAgICAgIC5idG4sCiAgICAgIC5maWx0ZXItcGlsbCwKICAgICAgLnNlcmllcy10b2dnbGUgewogICAgICAgIG1pbi1oZWlnaHQ6IDQ0cHg7CiAgICAgICAgbWluLXdpZHRoOiA0NHB4OwogICAgICB9CgogICAgICAuY29udHJvbC1zZWxlY3Qgc2VsZWN0LAogICAgICAuY29udHJvbC1zZWxlY3QgaW5wdXQgewogICAgICAgIG1pbi1oZWlnaHQ6IDQ0cHg7CiAgICAgIH0KICAgIH0KCiAgICAvKiBNb3Rpb24gcHJlZmVyZW5jZXMgKi8KICAgIEBtZWRpYSAocHJlZmVycy1yZWR1Y2VkLW1vdGlvbjogcmVkdWNlKSB7CiAgICAgICosCiAgICAgICo6OmJlZm9yZSwKICAgICAgKjo6YWZ0ZXIgewogICAgICAgIGFuaW1hdGlvbi1kdXJhdGlvbjogMC4wMW1zICFpbXBvcnRhbnQ7CiAgICAgICAgYW5pbWF0aW9uLWl0ZXJhdGlvbi1jb3VudDogMSAhaW1wb3J0YW50OwogICAgICAgIHRyYW5zaXRpb24tZHVyYXRpb246IDAuMDFtcyAhaW1wb3J0YW50OwogICAgICAgIHNjcm9sbC1iZWhhdmlvcjogYXV0byAhaW1wb3J0YW50OwogICAgICB9CiAgICB9CgogICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgUkVTUE9OU0lWRSBUQUJMRSBJTVBST1ZFTUVOVFMKICAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgogICAgLyogU2Nyb2xsIHNoYWRvd3MgZm9yIGhvcml6b250YWwgc2Nyb2xsaW5nICovCiAgICAudGFibGUtc2Nyb2xsLXdyYXBwZXIgewogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgIG92ZXJmbG93LXg6IGF1dG87CiAgICAgIG92ZXJmbG93LXk6IHZpc2libGU7CiAgICB9CgogICAgLnRhYmxlLXNjcm9sbC13cmFwcGVyOjpiZWZvcmUsCiAgICAudGFibGUtc2Nyb2xsLXdyYXBwZXI6OmFmdGVyIHsKICAgICAgY29udGVudDogIiI7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdG9wOiAwOwogICAgICBib3R0b206IDA7CiAgICAgIHdpZHRoOiAyMHB4OwogICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsKICAgICAgei1pbmRleDogMjsKICAgICAgb3BhY2l0eTogMDsKICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAwLjNzIGVhc2U7CiAgICB9CgogICAgLnRhYmxlLXNjcm9sbC13cmFwcGVyOjpiZWZvcmUgewogICAgICBsZWZ0OiAwOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsIHJnYmEoMCwgMCwgMCwgMC4xKSwgdHJhbnNwYXJlbnQpOwogICAgfQoKICAgIC50YWJsZS1zY3JvbGwtd3JhcHBlcjo6YWZ0ZXIgewogICAgICByaWdodDogMDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIGxlZnQsIHJnYmEoMCwgMCwgMCwgMC4xKSwgdHJhbnNwYXJlbnQpOwogICAgfQoKICAgIC50YWJsZS1zY3JvbGwtd3JhcHBlci5pcy1zY3JvbGxhYmxlLXN0YXJ0OjpiZWZvcmUgewogICAgICBvcGFjaXR5OiAxOwogICAgfQoKICAgIC50YWJsZS1zY3JvbGwtd3JhcHBlci5pcy1zY3JvbGxhYmxlLWVuZDo6YWZ0ZXIgewogICAgICBvcGFjaXR5OiAxOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGFibGUtc2Nyb2xsLXdyYXBwZXI6OmJlZm9yZSB7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgcmdiYSgwLCAwLCAwLCAwLjMpLCB0cmFuc3BhcmVudCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50YWJsZS1zY3JvbGwtd3JhcHBlcjo6YWZ0ZXIgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gbGVmdCwgcmdiYSgwLCAwLCAwLCAwLjMpLCB0cmFuc3BhcmVudCk7CiAgICB9CgogICAgLyogTW9iaWxlIHJlc3BvbnNpdmUgdGFibGVzIC0gQ2FyZCB2aWV3ICovCiAgICBAbWVkaWEgKG1heC13aWR0aDogNzgwcHgpIHsKICAgICAgLyogR3JvdXAgdGFibGUgcmVzcG9uc2l2ZSAqLwogICAgICAuZ3JvdXAtdGFibGUgewogICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgfQoKICAgICAgLmdyb3VwLXRhYmxlIHRoZWFkIHsKICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgbGVmdDogLTk5OTlweDsKICAgICAgICB3aWR0aDogMXB4OwogICAgICAgIGhlaWdodDogMXB4OwogICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgY2xpcDogcmVjdCgwLCAwLCAwLCAwKTsKICAgICAgfQoKICAgICAgLmdyb3VwLXRhYmxlIHRib2R5IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgZ2FwOiAxNnB4OwogICAgICB9CgogICAgICAuZ3JvdXAtdGFibGUgdGJvZHkgdHIgewogICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyOwogICAgICAgIGdhcDogMTJweDsKICAgICAgICBwYWRkaW5nOiAxNnB4OwogICAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1zdWJ0bGUpOwogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zNSk7CiAgICAgICAgbWFyZ2luLWJvdHRvbTogMDsKICAgICAgfQoKICAgICAgLmdyb3VwLXRhYmxlIHRkIHsKICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgcGFkZGluZzogMDsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgZ2FwOiA0cHg7CiAgICAgIH0KCiAgICAgIC5ncm91cC10YWJsZSB0ZDo6YmVmb3JlIHsKICAgICAgICBjb250ZW50OiBhdHRyKGRhdGEtbGFiZWwpOwogICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUteHMpOwogICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7CiAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDVlbTsKICAgICAgICBjb2xvcjogdmFyKC0tZ3JleS01MDApOwogICAgICB9CgogICAgICAuZ3JvdXAtdGFibGUgdGQ6Zmlyc3QtY2hpbGQgewogICAgICAgIGdyaWQtY29sdW1uOiAxIC8gLTE7CiAgICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtbGcpOwogICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgY29sb3I6IHZhcigtLWdyZXktOTAwKTsKICAgICAgICBwYWRkaW5nLWJvdHRvbTogOHB4OwogICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMzUpOwogICAgICB9CgogICAgICAuZ3JvdXAtdGFibGUgdGQ6Zmlyc3QtY2hpbGQ6OmJlZm9yZSB7CiAgICAgICAgZGlzcGxheTogbm9uZTsKICAgICAgfQoKICAgICAgLmdyb3VwLXRhYmxlIHRkLnZhbHVlLWNlbGwsCiAgICAgIC5ncm91cC10YWJsZSB0ZC51c2Vycy1jZWxsLAogICAgICAuZ3JvdXAtdGFibGUgdGQuYXZnLWNlbGwsCiAgICAgIC5ncm91cC10YWJsZSB0ZC5zaGFyZS1jZWxsIHsKICAgICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICB9CgogICAgICAvKiBBZG9wdGlvbiB0YWJsZSByZXNwb25zaXZlICovCiAgICAgIC5hZG9wdGlvbi10YWJsZS13cmFwcGVyIHsKICAgICAgICBtaW4taGVpZ2h0OiAwOwogICAgICB9CgogICAgICAuYWRvcHRpb24tdGFibGUgewogICAgICAgIG1pbi13aWR0aDogMTAwJTsKICAgICAgfQoKICAgICAgLmFkb3B0aW9uLXRhYmxlIHRoZWFkIHsKICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgbGVmdDogLTk5OTlweDsKICAgICAgICB3aWR0aDogMXB4OwogICAgICAgIGhlaWdodDogMXB4OwogICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgY2xpcDogcmVjdCgwLCAwLCAwLCAwKTsKICAgICAgfQoKICAgICAgLmFkb3B0aW9uLXRhYmxlIHRib2R5IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgZ2FwOiAxMnB4OwogICAgICB9CgogICAgICAuYWRvcHRpb24tdGFibGUgdGJvZHkgdHIgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBnYXA6IDEwcHg7CiAgICAgICAgcGFkZGluZzogMTRweCAxNnB4OwogICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1zdWJ0bGUpOwogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zNSk7CiAgICAgIH0KCiAgICAgIC5hZG9wdGlvbi10YWJsZSB0ZCB7CiAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgYWxpZ24taXRlbXM6IGJhc2VsaW5lOwogICAgICAgIGdhcDogMTJweDsKICAgICAgfQoKICAgICAgLmFkb3B0aW9uLXRhYmxlIHRkOjpiZWZvcmUgewogICAgICAgIGNvbnRlbnQ6IGF0dHIoZGF0YS1sYWJlbCk7CiAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgfQoKICAgICAgLmFkb3B0aW9uLXRhYmxlIHRkLmlzLW51bWVyaWMgewogICAgICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgICB9CgogICAgICAvKiBBZ2VudCB0YWJsZSByZXNwb25zaXZlICovCiAgICAgIC5hZ2VudC10YWJsZS13cmFwcGVyIHsKICAgICAgICBvdmVyZmxvdy14OiBhdXRvOwogICAgICB9CgogICAgICAuYWdlbnQtdGFibGUgewogICAgICAgIG1pbi13aWR0aDogMTAwJTsKICAgICAgfQoKICAgICAgLmFnZW50LXRhYmxlIHRoZWFkIHsKICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgbGVmdDogLTk5OTlweDsKICAgICAgICB3aWR0aDogMXB4OwogICAgICAgIGhlaWdodDogMXB4OwogICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgY2xpcDogcmVjdCgwLCAwLCAwLCAwKTsKICAgICAgfQoKICAgICAgLmFnZW50LXRhYmxlIHRib2R5IHsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgZ2FwOiAxMnB4OwogICAgICB9CgogICAgICAuYWdlbnQtdGFibGUgdGJvZHkgdHIgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICBnYXA6IDEwcHg7CiAgICAgICAgcGFkZGluZzogMTRweCAxNnB4OwogICAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tc3VyZmFjZS1zdWJ0bGUpOwogICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zNSk7CiAgICAgIH0KCiAgICAgIC5hZ2VudC10YWJsZSB0ZCB7CiAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgYWxpZ24taXRlbXM6IGJhc2VsaW5lOwogICAgICAgIGdhcDogMTJweDsKICAgICAgfQoKICAgICAgLmFnZW50LXRhYmxlIHRkOjpiZWZvcmUgewogICAgICAgIGNvbnRlbnQ6IGF0dHIoZGF0YS1sYWJlbCk7CiAgICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgICAgY29sb3I6IHZhcigtLWdyZXktNjAwKTsKICAgICAgICBmbGV4LXNocmluazogMDsKICAgICAgfQoKICAgICAgLmFnZW50LXRhYmxlIHRkLmlzLW51bWVyaWMgewogICAgICAgIHRleHQtYWxpZ246IHJpZ2h0OwogICAgICB9CgogICAgICAvKiBEYXJrIG1vZGUgYWRqdXN0bWVudHMgZm9yIG1vYmlsZSBjYXJkcyAqLwogICAgICBib2R5LmlzLWRhcmsgLmdyb3VwLXRhYmxlIHRib2R5IHRyLAogICAgICBib2R5LmlzLWRhcmsgLmFkb3B0aW9uLXRhYmxlIHRib2R5IHRyLAogICAgICBib2R5LmlzLWRhcmsgLmFnZW50LXRhYmxlIHRib2R5IHRyIHsKICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDMwLCAzNiwgNDAsIDAuNyk7CiAgICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDk2LCAxMDgsIDEyNCwgMC4zKTsKICAgICAgfQoKICAgICAgYm9keS5pcy1kYXJrIC5ncm91cC10YWJsZSB0ZDpmaXJzdC1jaGlsZCB7CiAgICAgICAgYm9yZGVyLWJvdHRvbS1jb2xvcjogcmdiYSg5NiwgMTA4LCAxMjQsIDAuMyk7CiAgICAgIH0KICAgIH0KCiAgICAvKiBTdGlja3kgdGFibGUgaGVhZGVycyBmb3IgZGVza3RvcCAqLwogICAgQG1lZGlhIChtaW4td2lkdGg6IDc4MXB4KSB7CiAgICAgIC5ncm91cC10YWJsZSB0aGVhZCwKICAgICAgLmFkb3B0aW9uLXRhYmxlIHRoZWFkLAogICAgICAuYWdlbnQtdGFibGUgdGhlYWQgewogICAgICAgIHBvc2l0aW9uOiBzdGlja3k7CiAgICAgICAgdG9wOiAwOwogICAgICAgIHotaW5kZXg6IDEwOwogICAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDhweCByZ2JhKDAsIDAsIDAsIDAuMDgpOwogICAgICB9CiAgICB9CgogICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgIEFDQ0VTU0lCSUxJVFkgSU1QUk9WRU1FTlRTCiAgICAgICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoKICAgIC8qIFNraXAgbGluayBmb3Iga2V5Ym9hcmQgbmF2aWdhdGlvbiAqLwogICAgLnNraXAtbGluayB7CiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgdG9wOiAwOwogICAgICBsZWZ0OiAwOwogICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTE1MCUpOwogICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1ncmVlbi02MDApOwogICAgICBjb2xvcjogI2ZmZmZmZjsKICAgICAgcGFkZGluZzogOHB4IDE2cHg7CiAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgYm9yZGVyLXJhZGl1czogMCAwIDhweCAwOwogICAgICB6LWluZGV4OiAxMDA7CiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzIGVhc2U7CiAgICB9CgogICAgLnNraXAtbGluazpmb2N1cywKICAgIC5za2lwLWxpbms6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsKICAgICAgb3V0bGluZTogM3B4IHNvbGlkIHZhcigtLWdvbGQtNTAwKTsKICAgICAgb3V0bGluZS1vZmZzZXQ6IDJweDsKICAgIH0KCiAgICAvKiBGb2N1cy12aXNpYmxlIHN0YXRlcyBmb3IgYWxsIGludGVyYWN0aXZlIGVsZW1lbnRzICovCiAgICAudXBsb2FkLWJ1dHRvbjpmb2N1cy12aXNpYmxlLAogICAgLnN0b3JhZ2UtYnV0dG9uOmZvY3VzLXZpc2libGUsCiAgICAucmVzZXQtYnV0dG9uOmZvY3VzLXZpc2libGUsCiAgICAudXBsb2FkLWNhbmNlbDpmb2N1cy12aXNpYmxlLAogICAgLnZpZXctbW9yZS1idXR0b246Zm9jdXMtdmlzaWJsZSwKICAgIC5zZXJpZXMtYnVsay10b2dnbGU6Zm9jdXMtdmlzaWJsZSwKICAgIC5leHBvcnQtdHJpZ2dlcjpmb2N1cy12aXNpYmxlLAogICAgLmFnZW50LXVwbG9hZC1idXR0b246Zm9jdXMtdmlzaWJsZSwKICAgIC50cmVuZC1jb2xvci1idXR0b246Zm9jdXMtdmlzaWJsZSwKICAgIC51c2FnZS1tb250aC10b2dnbGU6Zm9jdXMtdmlzaWJsZSwKICAgIC51c2FnZS1tb250aC11dGlsaXR5OmZvY3VzLXZpc2libGUsCiAgICAudXNhZ2UtdHJlbmQtdG9nZ2xlOmZvY3VzLXZpc2libGUsCiAgICAucmVnaW9uLXRvZ2dsZTpmb2N1cy12aXNpYmxlLAogICAgLmFnZW50LXRvZ2dsZS1idXR0b246Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDNweCBzb2xpZCB2YXIoLS1ncmVlbi01MDApOwogICAgICBvdXRsaW5lLW9mZnNldDogM3B4OwogICAgICBib3gtc2hhZG93OiAwIDAgMCA2cHggcmdiYSgwLCAxMzgsIDAsIDAuMTUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudXBsb2FkLWJ1dHRvbjpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5zdG9yYWdlLWJ1dHRvbjpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5yZXNldC1idXR0b246Zm9jdXMtdmlzaWJsZSwKICAgIGJvZHkuaXMtZGFyayAudXBsb2FkLWNhbmNlbDpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC52aWV3LW1vcmUtYnV0dG9uOmZvY3VzLXZpc2libGUsCiAgICBib2R5LmlzLWRhcmsgLnNlcmllcy1idWxrLXRvZ2dsZTpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5leHBvcnQtdHJpZ2dlcjpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5hZ2VudC11cGxvYWQtYnV0dG9uOmZvY3VzLXZpc2libGUsCiAgICBib2R5LmlzLWRhcmsgLnRyZW5kLWNvbG9yLWJ1dHRvbjpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC51c2FnZS1tb250aC10b2dnbGU6Zm9jdXMtdmlzaWJsZSwKICAgIGJvZHkuaXMtZGFyayAudXNhZ2UtbW9udGgtdXRpbGl0eTpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC51c2FnZS10cmVuZC10b2dnbGU6Zm9jdXMtdmlzaWJsZSwKICAgIGJvZHkuaXMtZGFyayAucmVnaW9uLXRvZ2dsZTpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5hZ2VudC10b2dnbGUtYnV0dG9uOmZvY3VzLXZpc2libGUgewogICAgICBvdXRsaW5lLWNvbG9yOiB2YXIoLS1ncmVlbi00MDApOwogICAgICBib3gtc2hhZG93OiAwIDAgMCA2cHggcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMjUpOwogICAgfQoKICAgIC5maWx0ZXItcGlsbDpmb2N1cy12aXNpYmxlIHsKICAgICAgb3V0bGluZTogM3B4IHNvbGlkIHZhcigtLWdyZWVuLTUwMCk7CiAgICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDVweCByZ2JhKDAsIDEzOCwgMCwgMC4xMik7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5maWx0ZXItcGlsbDpmb2N1cy12aXNpYmxlIHsKICAgICAgb3V0bGluZS1jb2xvcjogdmFyKC0tZ3JlZW4tNDAwKTsKICAgICAgYm94LXNoYWRvdzogMCAwIDAgNXB4IHJnYmEoNzIsIDE0OCwgMTI0LCAwLjIyKTsKICAgIH0KCiAgICAudGhlbWUtdG9nZ2xlX19idXR0b246Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDNweCBzb2xpZCB2YXIoLS1ncmVlbi01MDApOwogICAgICBvdXRsaW5lLW9mZnNldDogM3B4OwogICAgICBib3gtc2hhZG93OiAwIDAgMCA2cHggcmdiYSgwLCAxMzgsIDAsIDAuMTUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudGhlbWUtdG9nZ2xlX19idXR0b246Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmUtY29sb3I6IHZhcigtLWdyZWVuLTQwMCk7CiAgICAgIGJveC1zaGFkb3c6IDAgMCAwIDZweCByZ2JhKDcyLCAxNDgsIDEyNCwgMC4yNSk7CiAgICB9CgogICAgLyogRm9jdXMgZm9yIGZvcm0gaW5wdXRzICovCiAgICAuY29udHJvbC1zZWxlY3Qgc2VsZWN0OmZvY3VzLXZpc2libGUsCiAgICAuY29udHJvbC1zZWxlY3QgaW5wdXRbdHlwZT0iZGF0ZSJdOmZvY3VzLXZpc2libGUsCiAgICAudXNhZ2UtdGhyZXNob2xkc19fZmllbGQgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMtdmlzaWJsZSwKICAgIC5lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19pbnB1dHMgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMtdmlzaWJsZSwKICAgIC5hZ2VudC1zZWFyY2gtaW5wdXQ6Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmU6IDNweCBzb2xpZCB2YXIoLS1ncmVlbi01MDApOwogICAgICBvdXRsaW5lLW9mZnNldDogMnB4OwogICAgICBib3gtc2hhZG93OiAwIDAgMCA1cHggcmdiYSgwLCAxMzgsIDAsIDAuMTIpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuY29udHJvbC1zZWxlY3Qgc2VsZWN0OmZvY3VzLXZpc2libGUsCiAgICBib2R5LmlzLWRhcmsgLmNvbnRyb2wtc2VsZWN0IGlucHV0W3R5cGU9ImRhdGUiXTpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC51c2FnZS10aHJlc2hvbGRzX19maWVsZCBpbnB1dFt0eXBlPSJudW1iZXIiXTpmb2N1cy12aXNpYmxlLAogICAgYm9keS5pcy1kYXJrIC5lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19pbnB1dHMgaW5wdXRbdHlwZT0ibnVtYmVyIl06Zm9jdXMtdmlzaWJsZSwKICAgIGJvZHkuaXMtZGFyayAuYWdlbnQtc2VhcmNoLWlucHV0OmZvY3VzLXZpc2libGUgewogICAgICBvdXRsaW5lLWNvbG9yOiB2YXIoLS1ncmVlbi00MDApOwogICAgICBib3gtc2hhZG93OiAwIDAgMCA1cHggcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMjIpOwogICAgfQoKICAgIC8qIFRhYmxlIHJvdyBmb2N1cyBmb3Iga2V5Ym9hcmQgbmF2aWdhdGlvbiAqLwogICAgLmdyb3VwLXRhYmxlIHRib2R5IHRyOmZvY3VzLXdpdGhpbiwKICAgIC5hZG9wdGlvbi10YWJsZSB0Ym9keSB0cjpmb2N1cy13aXRoaW4sCiAgICAuYWdlbnQtdGFibGUgdGJvZHkgdHI6Zm9jdXMtd2l0aGluIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAxMzgsIDAsIDAuMDgpOwogICAgICBvdXRsaW5lOiAycHggc29saWQgdmFyKC0tZ3JlZW4tNTAwKTsKICAgICAgb3V0bGluZS1vZmZzZXQ6IC0ycHg7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC5ncm91cC10YWJsZSB0Ym9keSB0cjpmb2N1cy13aXRoaW4sCiAgICBib2R5LmlzLWRhcmsgLmFkb3B0aW9uLXRhYmxlIHRib2R5IHRyOmZvY3VzLXdpdGhpbiwKICAgIGJvZHkuaXMtZGFyayAuYWdlbnQtdGFibGUgdGJvZHkgdHI6Zm9jdXMtd2l0aGluIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSg3MiwgMTQ4LCAxMjQsIDAuMTUpOwogICAgICBvdXRsaW5lLWNvbG9yOiB2YXIoLS1ncmVlbi00MDApOwogICAgfQoKICAgIC8qIFNvcnRhYmxlIGJ1dHRvbiBmb2N1cyAqLwogICAgLmFnZW50LXNvcnQtYnV0dG9uOmZvY3VzLXZpc2libGUgewogICAgICBvdXRsaW5lOiAycHggc29saWQgdmFyKC0tZ3JlZW4tNTAwKTsKICAgICAgb3V0bGluZS1vZmZzZXQ6IDJweDsKICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuYWdlbnQtc29ydC1idXR0b246Zm9jdXMtdmlzaWJsZSB7CiAgICAgIG91dGxpbmUtY29sb3I6IHZhcigtLWdyZWVuLTQwMCk7CiAgICB9CgogICAgLyogUmVkdWNlZCBtb3Rpb24gcHJlZmVyZW5jZSAqLwogICAgQG1lZGlhIChwcmVmZXJzLXJlZHVjZWQtbW90aW9uOiByZWR1Y2UpIHsKICAgICAgKiwKICAgICAgKjo6YmVmb3JlLAogICAgICAqOjphZnRlciB7CiAgICAgICAgYW5pbWF0aW9uLWR1cmF0aW9uOiAwLjAxbXMgIWltcG9ydGFudDsKICAgICAgICBhbmltYXRpb24taXRlcmF0aW9uLWNvdW50OiAxICFpbXBvcnRhbnQ7CiAgICAgICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogMC4wMW1zICFpbXBvcnRhbnQ7CiAgICAgICAgc2Nyb2xsLWJlaGF2aW9yOiBhdXRvICFpbXBvcnRhbnQ7CiAgICAgIH0KCiAgICAgIC51cGxvYWQtem9uZS5pcy1kcmFnb3ZlciB7CiAgICAgICAgdHJhbnNmb3JtOiBub25lOwogICAgICB9CiAgICB9CgogICAgLyogSGlnaCBjb250cmFzdCBtb2RlIHN1cHBvcnQgKi8KICAgIEBtZWRpYSAocHJlZmVycy1jb250cmFzdDogaGlnaCkgewogICAgICA6cm9vdCB7CiAgICAgICAgLS1ncmVlbi02MDA6ICMwMDY0MDA7CiAgICAgICAgLS1ncmVlbi03MDA6ICMwMDRkMDA7CiAgICAgICAgLS1ncmV5LTYwMDogIzAwMDAwMDsKICAgICAgICAtLWdyZXktNzAwOiAjMDAwMDAwOwogICAgICB9CgogICAgICBib2R5LmlzLWRhcmsgewogICAgICAgIC0tZ3JlZW4tNTAwOiAjMDBmZjAwOwogICAgICAgIC0tZ3JlZW4tNjAwOiAjMDBjYzAwOwogICAgICAgIC0tdGV4dC1ib2R5OiAjZmZmZmZmOwogICAgICB9CgogICAgICAuZmlsdGVyLXBpbGwsCiAgICAgIC51cGxvYWQtYnV0dG9uLAogICAgICAuc3RvcmFnZS1idXR0b24gewogICAgICAgIGJvcmRlci13aWR0aDogMnB4OwogICAgICB9CiAgICB9CgogICAgLyogU2NyZWVuIHJlYWRlciBvbmx5IGNvbnRlbnQgKi8KICAgIC5zci1vbmx5IHsKICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICB3aWR0aDogMXB4OwogICAgICBoZWlnaHQ6IDFweDsKICAgICAgcGFkZGluZzogMDsKICAgICAgbWFyZ2luOiAtMXB4OwogICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICBjbGlwOiByZWN0KDAsIDAsIDAsIDApOwogICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICBib3JkZXItd2lkdGg6IDA7CiAgICB9CgogICAgLnNyLW9ubHktZm9jdXNhYmxlOmZvY3VzIHsKICAgICAgcG9zaXRpb246IHN0YXRpYzsKICAgICAgd2lkdGg6IGF1dG87CiAgICAgIGhlaWdodDogYXV0bzsKICAgICAgb3ZlcmZsb3c6IHZpc2libGU7CiAgICAgIGNsaXA6IGF1dG87CiAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7CiAgICB9CgogICAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgIFNLRUxFVE9OIExPQURFUlMKICAgICAgID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgogICAgLnNrZWxldG9uIHsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDkwZGVnLCAKICAgICAgICByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMikgMCUsIAogICAgICAgIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC4zNSkgNTAlLCAKICAgICAgICByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMikgMTAwJQogICAgICApOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDIwMCUgMTAwJTsKICAgICAgYW5pbWF0aW9uOiBza2VsZXRvbi1sb2FkaW5nIDEuNXMgZWFzZS1pbi1vdXQgaW5maW5pdGU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgIH0KCiAgICBAa2V5ZnJhbWVzIHNrZWxldG9uLWxvYWRpbmcgewogICAgICAwJSB7CiAgICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMjAwJSAwOwogICAgICB9CiAgICAgIDEwMCUgewogICAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IC0yMDAlIDA7CiAgICAgIH0KICAgIH0KCiAgICAuc2tlbGV0b24tdGV4dCB7CiAgICAgIGhlaWdodDogMWVtOwogICAgICBtYXJnaW4tYm90dG9tOiAwLjVlbTsKICAgIH0KCiAgICAuc2tlbGV0b24tdGV4dDpsYXN0LWNoaWxkIHsKICAgICAgbWFyZ2luLWJvdHRvbTogMDsKICAgICAgd2lkdGg6IDYwJTsKICAgIH0KCiAgICAuc2tlbGV0b24tY2FyZCB7CiAgICAgIHBhZGRpbmc6IDI0cHg7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY2FyZCk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDIwcHg7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC40NSk7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgIGdhcDogMTZweDsKICAgIH0KCiAgICAuc2tlbGV0b24tY2hhcnQgewogICAgICB3aWR0aDogMTAwJTsKICAgICAgaGVpZ2h0OiAzMjBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgIH0KCiAgICAuc2tlbGV0b24tdGFibGUtcm93IHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZ2FwOiAxNnB4OwogICAgICBwYWRkaW5nOiAxMnB4IDA7CiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCByZ2JhKDE4OSwgMTk3LCAyMDAsIDAuMjUpOwogICAgfQoKICAgIC5za2VsZXRvbi10YWJsZS1jZWxsIHsKICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICBmbGV4OiAxOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAuc2tlbGV0b24gewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIAogICAgICAgIHJnYmEoOTYsIDEwOCwgMTI0LCAwLjE1KSAwJSwgCiAgICAgICAgcmdiYSg5NiwgMTA4LCAxMjQsIDAuMykgNTAlLCAKICAgICAgICByZ2JhKDk2LCAxMDgsIDEyNCwgMC4xNSkgMTAwJQogICAgICApOwogICAgICBiYWNrZ3JvdW5kLXNpemU6IDIwMCUgMTAwJTsKICAgIH0KCiAgICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgVE9BU1QgTk9USUZJQ0FUSU9OUwogICAgICAgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCiAgICAudG9hc3QtY29udGFpbmVyIHsKICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICB0b3A6IDIwcHg7CiAgICAgIHJpZ2h0OiAyMHB4OwogICAgICB6LWluZGV4OiA5OTk5OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBnYXA6IDEycHg7CiAgICAgIG1heC13aWR0aDogNDIwcHg7CiAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOwogICAgfQoKICAgIC50b2FzdCB7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLXN1cmZhY2UtY2FyZCk7CiAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMTg5LCAxOTcsIDIwMCwgMC40NSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIHBhZGRpbmc6IDE2cHggMjBweDsKICAgICAgYm94LXNoYWRvdzogMCAxNnB4IDMycHggcmdiYSgwLCAzMiwgMzIsIDAuMTgpOwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsKICAgICAgZ2FwOiAxMnB4OwogICAgICBwb2ludGVyLWV2ZW50czogYXV0bzsKICAgICAgYW5pbWF0aW9uOiB0b2FzdC1zbGlkZS1pbiAwLjNzIGVhc2Utb3V0OwogICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuM3MgZWFzZSwgdHJhbnNmb3JtIDAuM3MgZWFzZTsKICAgIH0KCiAgICAudG9hc3QuaXMtaGlkaW5nIHsKICAgICAgb3BhY2l0eTogMDsKICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDEwMCUpOwogICAgfQoKICAgIEBrZXlmcmFtZXMgdG9hc3Qtc2xpZGUtaW4gewogICAgICBmcm9tIHsKICAgICAgICBvcGFjaXR5OiAwOwogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgxMDAlKTsKICAgICAgfQogICAgICB0byB7CiAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7CiAgICAgIH0KICAgIH0KCiAgICAudG9hc3QtaWNvbiB7CiAgICAgIGZsZXgtc2hyaW5rOiAwOwogICAgICB3aWR0aDogMjRweDsKICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgfQoKICAgIC50b2FzdC1jb250ZW50IHsKICAgICAgZmxleDogMTsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgZ2FwOiA0cHg7CiAgICB9CgogICAgLnRvYXN0LXRpdGxlIHsKICAgICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgICAgZm9udC1zaXplOiB2YXIoLS1mb250LXNpemUtc20pOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS05MDApOwogICAgICBtYXJnaW46IDA7CiAgICB9CgogICAgLnRvYXN0LW1lc3NhZ2UgewogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS14cyk7CiAgICAgIGNvbG9yOiB2YXIoLS1ncmV5LTYwMCk7CiAgICAgIG1hcmdpbjogMDsKICAgICAgbGluZS1oZWlnaHQ6IDEuNDsKICAgIH0KCiAgICAudG9hc3QtY2xvc2UgewogICAgICBmbGV4LXNocmluazogMDsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDc3LCA4NywgOTMsIDAuMDgpOwogICAgICBjb2xvcjogdmFyKC0tZ3JleS02MDApOwogICAgICB3aWR0aDogMjRweDsKICAgICAgaGVpZ2h0OiAyNHB4OwogICAgICBib3JkZXItcmFkaXVzOiA1MCU7CiAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBmb250LXNpemU6IHZhcigtLWZvbnQtc2l6ZS1zbSk7CiAgICAgIGxpbmUtaGVpZ2h0OiAxOwogICAgICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kIDAuMnMgZWFzZSwgY29sb3IgMC4ycyBlYXNlOwogICAgfQoKICAgIC50b2FzdC1jbG9zZTpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjAwLCA0NSwgNDUsIDAuMTIpOwogICAgICBjb2xvcjogI2M4MmQyZDsKICAgIH0KCiAgICAvKiBUb2FzdCB2YXJpYW50cyAqLwogICAgLnRvYXN0LS1zdWNjZXNzIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDE2LCAxODUsIDEyOSwgMC40KTsKICAgIH0KCiAgICAudG9hc3QtLXN1Y2Nlc3MgLnRvYXN0LWljb24gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDE2LCAxODUsIDEyOSwgMC4xNSk7CiAgICAgIGNvbG9yOiAjMDU5NjY5OwogICAgfQoKICAgIC50b2FzdC0tZXJyb3IgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjIwLCAzOCwgMzgsIDAuNCk7CiAgICB9CgogICAgLnRvYXN0LS1lcnJvciAudG9hc3QtaWNvbiB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjIwLCAzOCwgMzgsIDAuMTUpOwogICAgICBjb2xvcjogI2RjMjYyNjsKICAgIH0KCiAgICAudG9hc3QtLXdhcm5pbmcgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjQpOwogICAgfQoKICAgIC50b2FzdC0td2FybmluZyAudG9hc3QtaWNvbiB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjE1KTsKICAgICAgY29sb3I6ICNkOTc3MDY7CiAgICB9CgogICAgLnRvYXN0LS1pbmZvIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC40KTsKICAgIH0KCiAgICAudG9hc3QtLWluZm8gLnRvYXN0LWljb24gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4xNSk7CiAgICAgIGNvbG9yOiAjMjU2M2ViOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDIwLCAyNCwgMzIsIDAuOTgpOwogICAgICBib3JkZXItY29sb3I6IHJnYmEoOTYsIDEwOCwgMTI0LCAwLjQpOwogICAgICBib3gtc2hhZG93OiAwIDIwcHggNDBweCByZ2JhKDMsIDYsIDEyLCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtdGl0bGUgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1ib2R5KTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRvYXN0LW1lc3NhZ2UgewogICAgICBjb2xvcjogdmFyKC0tdGV4dC1tdXRlZCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrIC50b2FzdC1jbG9zZSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTMyLCAxNDIsIDE1NSwgMC4xNSk7CiAgICAgIGNvbG9yOiB2YXIoLS10ZXh0LW11dGVkKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmsgLnRvYXN0LWNsb3NlOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDM4LCAzOCwgMC4yNSk7CiAgICAgIGNvbG9yOiAjZmVjYWNhOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLXN1Y2Nlc3MgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMTYsIDE4NSwgMTI5LCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLXN1Y2Nlc3MgLnRvYXN0LWljb24gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDE2LCAxODUsIDEyOSwgMC4yNSk7CiAgICAgIGNvbG9yOiAjMzRkMzk5OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLWVycm9yIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDIyMCwgMzgsIDM4LCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLWVycm9yIC50b2FzdC1pY29uIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyMjAsIDM4LCAzOCwgMC4yNSk7CiAgICAgIGNvbG9yOiAjZjg3MTcxOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLXdhcm5pbmcgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjQ1LCAxNTgsIDExLCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLXdhcm5pbmcgLnRvYXN0LWljb24gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI0NSwgMTU4LCAxMSwgMC4yNSk7CiAgICAgIGNvbG9yOiAjZmJiZjI0OwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLWluZm8gewogICAgICBib3JkZXItY29sb3I6IHJnYmEoNTksIDEzMCwgMjQ2LCAwLjUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyayAudG9hc3QtLWluZm8gLnRvYXN0LWljb24gewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDU5LCAxMzAsIDI0NiwgMC4yNSk7CiAgICAgIGNvbG9yOiAjNjBhNWZhOwogICAgfQoKICAgIEBtZWRpYSAobWF4LXdpZHRoOiA2NDBweCkgewogICAgICAudG9hc3QtY29udGFpbmVyIHsKICAgICAgICByaWdodDogMTJweDsKICAgICAgICBsZWZ0OiAxMnB4OwogICAgICAgIG1heC13aWR0aDogbm9uZTsKICAgICAgfQogICAgfQogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAuaW50cm8tY2FyZCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmRhdGFzZXQtY2FyZCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmNvbnRyb2wtcGFuZWwsCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC5zdW1tYXJ5LWNhcmQsCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC50cmVuZC1jYXJkLAogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAuZ3JvdXAtY2FyZCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmNhdGVnb3J5LWNhcmQsCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC5leHBvcnQtbWVudSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44OCk7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA4KTsKICAgICAgYm94LXNoYWRvdzogMCAyNXB4IDYwcHggcmdiYSgwLCAwLCAwLCAwLjkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmRhdGFzZXQtY2FyZDo6YmVmb3JlLAogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAuZGF0YXNldC1jYXJkOjphZnRlciwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmludHJvLWNhcmQ6OmJlZm9yZSwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmludHJvLWNhcmQ6OmFmdGVyIHsKICAgICAgb3BhY2l0eTogMDsKICAgIH0KCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC51cGxvYWQtem9uZSB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjEyKTsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjc4KTsKICAgICAgYm94LXNoYWRvdzogbm9uZTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC51cGxvYWQtem9uZS5pcy1kcmFnb3ZlciB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuOTIpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnVwbG9hZC1idXR0b24sCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC5zdG9yYWdlLWJ1dHRvbiwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnN0b3JhZ2UtYnV0dG9uLnN0b3JhZ2UtYnV0dG9uLS1naG9zdCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnN0b3JhZ2UtYnV0dG9uLnN0b3JhZ2UtYnV0dG9uLS1pbmxpbmUgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yNSk7CiAgICAgIGNvbG9yOiAjZjdmN2YyOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnVwbG9hZC1idXR0b24sCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC5zdG9yYWdlLWJ1dHRvbiB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wOCk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAudXBsb2FkLWJ1dHRvbjpob3ZlciwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnN0b3JhZ2UtYnV0dG9uOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjE0KTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMzUpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnVwbG9hZC1idXR0b24tLWdob3N0IHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTgpOwogICAgICBjb2xvcjogI2Y3ZjdmMjsKICAgIH0KCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC51cGxvYWQtYnV0dG9uLS1naG9zdDpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4xMik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnN0b3JhZ2UtY29uc2VudCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnN0b3JhZ2UtaGludCwKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnVwbG9hZC1oaW50IHsKICAgICAgY29sb3I6IHJnYmEoMjQ3LCAyNDcsIDI0MiwgMC43NSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAuYWN0aXZlLWZpbHRlcnMtc3VtbWFyeSB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC43Mik7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA4KTsKICAgICAgYm94LXNoYWRvdzogMCAxOHB4IDQ4cHggcmdiYSgwLCAwLCAwLCAwLjkpOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnNlcmllcy10b2dnbGUsCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC5zZXJpZXMtYnVsay10b2dnbGUgewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yMik7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wNCk7CiAgICAgIGNvbG9yOiAjZjdmN2YyOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLnNlcmllcy10b2dnbGUuaXMtYWN0aXZlLAogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAuc2VyaWVzLWJ1bGstdG9nZ2xlW2FyaWEtcHJlc3NlZD0idHJ1ZSJdIHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIyKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNCk7CiAgICAgIGNvbG9yOiAjMDUwNTA1OwogICAgICBib3gtc2hhZG93OiBub25lOwogICAgfQoKICAgIGJvZHkuaXMtZGFyay1jYXJib24gLmNoYXJ0LWVtcHR5IHsKICAgICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjgyKTsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMik7CiAgICAgIGNvbG9yOiByZ2JhKDI0NywgMjQ3LCAyNDIsIDAuNyk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrLWNhcmJvbiBjYW52YXMgewogICAgICBiYWNrZ3JvdW5kOgogICAgICAgIHJhZGlhbC1ncmFkaWVudChjaXJjbGUgYXQgMzAlIDIwJSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA4KSwgdHJhbnNwYXJlbnQgNTUlKSwKICAgICAgICBsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCByZ2JhKDAsIDAsIDAsIDAuOTgpLCByZ2JhKDgsIDgsIDgsIDAuOTgpKTsKICAgIH0KCiAgICBib2R5LmlzLWRhcmstY2FyYm9uIC50aGVtZS1vcHRpb24gewogICAgICBib3JkZXItY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yNSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAudGhlbWUtb3B0aW9uOmhvdmVyIHsKICAgICAgYm9yZGVyLWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNSk7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4wNSk7CiAgICB9CgogICAgYm9keS5pcy1kYXJrLWNhcmJvbiAudGhlbWUtb3B0aW9uLmlzLWFjdGl2ZSB7CiAgICAgIGJvcmRlci1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpOwogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTIpOwogICAgICBib3gtc2hhZG93OiAwIDhweCAxNnB4IHJnYmEoMCwgMCwgMCwgMC42KTsKICAgIH0KCmJvZHkuaXMtZGFyay1jYXJib24gLnRoZW1lLW9wdGlvbi1uYW1lIHsKICBjb2xvcjogcmdiYSgyNDcsIDI0NywgMjQyLCAwLjgpOwp9CgoucGFnZS1mb290ZXIgewogIG1heC13aWR0aDogMTI0MHB4OwogIG1hcmdpbjogNDBweCBhdXRvIDMycHg7CiAgcGFkZGluZzogMCAyOHB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKfQo=
`;
const SHAREPOINT_JS_BASE64 = `
KGZ1bmN0aW9uICgpIHsNCiAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJsb2FkaW5nIikgew0KICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLCBpbml0aWFsaXplRGFzaGJvYXJkKTsNCiAgfSBlbHNlIHsNCiAgICBpbml0aWFsaXplRGFzaGJvYXJkKCk7DQogIH0NCg0KICBmdW5jdGlvbiBpbml0aWFsaXplRGFzaGJvYXJkKCkgew0KICAgIGNvbnN0IEhJR0hfUkVTX1BJWEVMX1JBVElPID0gTWF0aC5tYXgod2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSwgMi41KTsNCiAgICAgICAgICBDaGFydC5kZWZhdWx0cy5kZXZpY2VQaXhlbFJhdGlvID0gSElHSF9SRVNfUElYRUxfUkFUSU87DQogICAgICAgICAgY29uc3QgR0lGX1dPUktFUl9TT1VSQ0VfVVJMID0gImh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZ2lmLmpzLm9wdGltaXplZEAxLjAuMS9kaXN0L2dpZi53b3JrZXIuanMiOw0KICAgICAgICAgIGxldCBnaWZXb3JrZXJVcmxQcm9taXNlID0gbnVsbDsNCiAgICAgICAgICBsZXQgYWN0aXZlUGFyc2VDb250cm9sbGVyID0gbnVsbDsNCiAgICAgICAgICBsZXQgYnVmZmVyZWRTYW1wbGVDc3YgPSBudWxsOw0KICAgICAgICAgIGxldCBidWZmZXJlZENzdlRleHQgPSBudWxsOw0KICAgICAgICAgIGxldCBmaWx0ZXJQcmVmZXJlbmNlc0FwcGxpZWQgPSBmYWxzZTsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IG51bWJlckZvcm1hdHRlciA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZW4tVVMiKTsNCiAgICAgICAgICBjb25zdCBob3Vyc0Zvcm1hdHRlciA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgiZW4tVVMiLCB7IG1heGltdW1GcmFjdGlvbkRpZ2l0czogMSwgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAwIH0pOw0KICAgICAgICAgIGNvbnN0IGNvbXBhY3ROdW1iZXJGb3JtYXR0ZXIgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoImVuLVVTIiwgeyBub3RhdGlvbjogImNvbXBhY3QiLCBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IDEgfSk7DQogICAgICAgICAgY29uc3QgZGltZW5zaW9uUGFsZXR0ZSA9IFsNCiAgICAgICAgICAgICIjMEI4QTAwIiwNCiAgICAgICAgICAgICIjMDk3Mjg4IiwNCiAgICAgICAgICAgICIjNTE0NkQ2IiwNCiAgICAgICAgICAgICIjRjZCRDE4IiwNCiAgICAgICAgICAgICIjQTg1NUY3IiwNCiAgICAgICAgICAgICIjRUY0NDQ0IiwNCiAgICAgICAgICAgICIjMTBCOTgxIiwNCiAgICAgICAgICAgICIjM0I4MkY2IiwNCiAgICAgICAgICAgICIjRjk3MzE2IiwNCiAgICAgICAgICAgICIjN0MzQUVEIiwNCiAgICAgICAgICAgICIjMEVBNUU5IiwNCiAgICAgICAgICAgICIjNjM2NkYxIg0KICAgICAgICAgIF07DQogICAgICAgICAgY29uc3QgTUFYX1ZJU0lCTEVfR1JPVVBfUk9XUyA9IDU7DQogICAgICAgICAgY29uc3QgTUFYX1ZJU0lCTEVfVE9QX1VTRVJTID0gNTsNCiAgICAgICAgICBjb25zdCBERUZBVUxUX1JFVFVSTklOR19JTlRFUlZBTCA9ICJ3ZWVrbHkiOw0KICAgICAgICAgIGNvbnN0IFNOQVBTSE9UX1ZFUlNJT04gPSAxOw0KICAgICAgICAgIGNvbnN0IFNOQVBTSE9UX0tERl9JVEVSQVRJT05TID0gMTUwMDAwOw0KICAgICAgICAgIGNvbnN0IFNOQVBTSE9UX1BSRUZJWCA9ICJDT1BJTE9UU05BUFNIT1QiOw0KICAgICAgICAgIGNvbnN0IFNOQVBTSE9UX0ZJTEVfRVhURU5TSU9OID0gIi5jb3BpbG90LXNuYXBzaG90IjsNCiAgICAgICAgICBjb25zdCBTTkFQU0hPVF9GSUxFX0JBU0VOQU1FID0gImNvcGlsb3QtZGFzaGJvYXJkIjsNCiAgICAgICAgICBjb25zdCBTTkFQU0hPVF9VTkNPTVBSRVNTRURfTElNSVQgPSA4ICogMTAyNCAqIDEwMjQ7DQogICAgICAgICAgY29uc3Qgc3VwcG9ydHNTbmFwc2hvdEVuY3J5cHRpb24gPSBCb29sZWFuKA0KICAgICAgICAgICAgd2luZG93LmNyeXB0bw0KICAgICAgICAgICAgJiYgd2luZG93LmNyeXB0by5zdWJ0bGUNCiAgICAgICAgICAgICYmIHR5cGVvZiBUZXh0RW5jb2RlciAhPT0gInVuZGVmaW5lZCINCiAgICAgICAgICAgICYmIHR5cGVvZiBUZXh0RGVjb2RlciAhPT0gInVuZGVmaW5lZCINCiAgICAgICAgICApOw0KICAgICAgICAgIGNvbnN0IHN1cHBvcnRzRGlhbG9nRWxlbWVudCA9IHR5cGVvZiBIVE1MRGlhbG9nRWxlbWVudCAhPT0gInVuZGVmaW5lZCI7DQogICAgICAgICAgY29uc3Qgc2hhcmVQb2ludEdsb2JhbCA9DQogICAgICAgICAgICB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gIm9iamVjdCIgJiYgZ2xvYmFsVGhpcw0KICAgICAgICAgICAgICA/IGdsb2JhbFRoaXMNCiAgICAgICAgICAgICAgOiB0eXBlb2Ygd2luZG93ID09PSAib2JqZWN0IiAmJiB3aW5kb3cNCiAgICAgICAgICAgICAgPyB3aW5kb3cNCiAgICAgICAgICAgICAgOiB0eXBlb2Ygc2VsZiA9PT0gIm9iamVjdCIgJiYgc2VsZg0KICAgICAgICAgICAgICA/IHNlbGYNCiAgICAgICAgICAgICAgOiBudWxsOw0KICAgICAgICAgIGNvbnN0IEJVTExFVF9TRVBBUkFUT1IgPSAiIFx1MDBiNyAiOw0KICAgICAgICAgIGxldCBwZW5kaW5nU25hcHNob3RQYXlsb2FkID0gbnVsbDsNCiAgICAgICAgICBsZXQgbGF0ZXN0U25hcHNob3RFeHBvcnQgPSAiIjsNCiAgICAgICAgICBsZXQgc25hcHNob3REb3dubG9hZFVybCA9IG51bGw7DQogICAgICAgICAgbGV0IHNuYXBzaG90Q29weVRpbWVvdXQgPSBudWxsOw0KICAgICAgDQogICAgICAgICAgY29uc3Qgc3RhdGUgPSB7DQogICAgICAgICAgICByb3dzOiBbXSwNCiAgICAgICAgICAgIHVuaXF1ZVBlcnNvbnM6IG5ldyBTZXQoKSwNCiAgICAgICAgICAgIGxhdGVzdERhdGU6IG51bGwsDQogICAgICAgICAgICBlYXJsaWVzdERhdGU6IG51bGwsDQogICAgICAgICAgICB1bmlxdWVPcmdhbml6YXRpb25zOiBuZXcgU2V0KCksDQogICAgICAgICAgICBmaWx0ZXJzOiB7DQogICAgICAgICAgICAgIG9yZ2FuaXphdGlvbjogbmV3IFNldCgpLA0KICAgICAgICAgICAgICBjb3VudHJ5OiBuZXcgU2V0KCksDQogICAgICAgICAgICAgIHRpbWVmcmFtZTogImFsbCIsDQogICAgICAgICAgICAgIGN1c3RvbVN0YXJ0OiBudWxsLA0KICAgICAgICAgICAgICBjdXN0b21FbmQ6IG51bGwsDQogICAgICAgICAgICAgIGN1c3RvbVJhbmdlSW52YWxpZDogZmFsc2UsDQogICAgICAgICAgICAgIGFnZ3JlZ2F0ZTogIndlZWtseSIsDQogICAgICAgICAgICAgIG1ldHJpYzogImFjdGlvbnMiLA0KICAgICAgICAgICAgICBncm91cDogIm9yZ2FuaXphdGlvbiIsDQogICAgICAgICAgICAgIGNhdGVnb3J5U2VsZWN0aW9uOiBudWxsDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcGVyc2lzdERhdGFzZXRzOiBmYWxzZSwNCiAgICAgICAgICAgIGNoYXJ0czogew0KICAgICAgICAgICAgICB0cmVuZDogbnVsbCwNCiAgICAgICAgICAgIHVzYWdlRnJlcXVlbmN5OiBuZXcgTWFwKCksDQogICAgICAgICAgICB1c2FnZUNvbnNpc3RlbmN5OiBuZXcgTWFwKCksDQogICAgICAgICAgICB1c2FnZVRyZW5kOiBudWxsLA0KICAgICAgICAgICAgcmV0dXJuaW5nVXNlcnM6IG51bGwsDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXM6IG51bGwsDQogICAgICAgICAgICBkaW1lbnNpb25Db21wYXJpc29uOiBudWxsDQogICAgICAgICAgfSwNCiAgICAgICAgICBsYXRlc3RUcmVuZFBlcmlvZHM6IFtdLA0KICAgICAgICAgIGxhdGVzdFVzYWdlTW9udGhzOiBbXSwNCiAgICAgICAgICBsYXRlc3RVc2FnZVRyZW5kUm93czogW10sDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNDb2xvcnM6IGdldERlZmF1bHRFbmFibGVkTGljZW5zZXNDb2xvcnMoKSwNCiAgICAgICAgICAgIGxhdGVzdEVuYWJsZWRUaW1lbGluZTogW10sDQogICAgICAgICAgICBsYXRlc3RHcm91cERhdGE6IG51bGwsDQogICAgICAgICAgICBsYXRlc3RUb3BVc2VyczogW10sDQogICAgICAgICAgICBsYXRlc3RSZXR1cm5pbmdBZ2dyZWdhdGVzOiBudWxsLA0KICAgICAgICAgICAgbGF0ZXN0QWRvcHRpb246IG51bGwsDQogICAgICAgICAgICBsYXRlc3RBY3RpdmVEYXlzOiBudWxsLA0KICAgICAgICAgICAgbGF0ZXN0RGltZW5zaW9uVG90YWxzOiB7DQogICAgICAgICAgICAgIGNvdW50cnk6IFtdLA0KICAgICAgICAgICAgICBvcmdhbml6YXRpb246IFtdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbGF0ZXN0RGltZW5zaW9uVGltZWxpbmVzOiB7DQogICAgICAgICAgICAgIGNvdW50cnk6IFtdLA0KICAgICAgICAgICAgICBvcmdhbml6YXRpb246IFtdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYWRvcHRpb25TaG93RGV0YWlsczogZmFsc2UsDQogICAgICAgICAgICBleHBvcnRQcmVmZXJlbmNlczogew0KICAgICAgICAgICAgICBpbmNsdWRlRGV0YWlsczogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHRyZW5kQ29sb3JQcmVmZXJlbmNlOiB7DQogICAgICAgICAgICAgIHN0YXJ0OiBudWxsLA0KICAgICAgICAgICAgICBlbmQ6IG51bGwNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXJpZXNWaXNpYmlsaXR5OiB7fSwNCiAgICAgICAgICAgIHNlcmllc0RldGFpbE1vZGU6ICJyZXNwZWN0IiwNCiAgICAgICAgICAgIHJldHVybmluZ01ldHJpYzogInRvdGFsIiwNCiAgICAgICAgICAgIHJldHVybmluZ0ludGVydmFsOiBERUZBVUxUX1JFVFVSTklOR19JTlRFUlZBTCwNCiAgICAgICAgICAgIGdyb3Vwc0V4cGFuZGVkOiBmYWxzZSwNCiAgICAgICAgICAgIHRvcFVzZXJzRXhwYW5kZWQ6IGZhbHNlLA0KICAgICAgICAgICAgYWN0aXZlRGF5c1ZpZXc6ICJ1c2VycyIsDQogICAgICAgICAgICB1c2FnZVRocmVzaG9sZHM6IHsNCiAgICAgICAgICAgICAgbWlkZGxlOiAxNywNCiAgICAgICAgICAgICAgaGlnaDogMzUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB1c2FnZU1vbnRoU2VsZWN0aW9uOiBbXSwNCiAgICAgICAgICAgIHVzYWdlVHJlbmRNb2RlOiAibnVtYmVyIiwNCiAgICAgICAgICAgIHVzYWdlVHJlbmRSZWdpb246ICJhbGwiLA0KICAgICAgICAgICAgcmV0dXJuaW5nUmVnaW9uOiAiYWxsIiwNCiAgICAgICAgICAgIHRoZW1lOiAibGlnaHQiLA0KICAgICAgICAgICAgdHJlbmRWaWV3OiAidG90YWwiLA0KICAgICAgICAgICAgYWdlbnRVc2FnZVJvd3M6IFtdLA0KICAgICAgICAgICAgYWdlbnRVc2FnZU1ldGE6IG51bGwsDQogICAgICAgICAgICBzaG93RW5hYmxlZExpY2Vuc2VMYWJlbHM6IHRydWUsCiAgICAgICAgICAgIGFnZW50RGlzcGxheUxpbWl0OiA1LAogICAgICAgICAgICBhZ2VudFNvcnQ6IHsgY29sdW1uOiAicmVzcG9uc2VzIiwgZGlyZWN0aW9uOiAiZGVzYyIgfSwKICAgICAgICAgICAgYWdlbnRIdWI6IHsKICAgICAgICAgICAgICBhY3RpdmVUYWI6ICJ1c2VycyIsCiAgICAgICAgICAgICAgZGF0YXNldHM6IHsKICAgICAgICAgICAgICAgIHVzZXJzOiB7IHJvd3M6IFtdLCBtZXRhOiBudWxsIH0sCiAgICAgICAgICAgICAgICBhZ2VudHM6IHsgcm93czogW10sIG1ldGE6IG51bGwgfSwKICAgICAgICAgICAgICAgIGNvbWJpbmVkOiB7IHJvd3M6IFtdLCBtZXRhOiBudWxsIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNvcnQ6IHsKICAgICAgICAgICAgICAgIHVzZXJzOiB7IGNvbHVtbjogbnVsbCwgZGlyZWN0aW9uOiAiYXNjIiB9LAogICAgICAgICAgICAgICAgYWdlbnRzOiB7IGNvbHVtbjogbnVsbCwgZGlyZWN0aW9uOiAiYXNjIiB9LAogICAgICAgICAgICAgICAgY29tYmluZWQ6IHsgY29sdW1uOiBudWxsLCBkaXJlY3Rpb246ICJhc2MiIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGZpbHRlcnM6IHsKICAgICAgICAgICAgICAgIHVzZXJzOiAiIiwKICAgICAgICAgICAgICAgIGFnZW50czogIiIsCiAgICAgICAgICAgICAgICBjb21iaW5lZDogIiIKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxhdGVzdFBlckFwcEFjdGlvbnM6IFtdLAogICAgICAgICAgICBkaW1lbnNpb25TZWxlY3Rpb246IHsKICAgICAgICAgICAgICBkaW1lbnNpb246ICJjb3VudHJ5IiwKICAgICAgICAgICAgICBtZXRyaWM6ICJhY3Rpb25zIiwNCiAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHsNCiAgICAgICAgICAgICAgICBjb3VudHJ5OiBuZXcgU2V0KCksDQogICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uOiBuZXcgU2V0KCkNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICBzdGF0ZS5hdmFpbGFibGVSZWdpb25zID0gWyJhbGwiXTsNCiAgICAgICAgICBsZXQgbGFzdFBhcnNlZENzdlRleHQgPSBudWxsOwogICAgICAgICAgbGV0IGxhc3RQYXJzZWRDc3ZNZXRhID0gbnVsbDsKICAgICAgICAgIGxldCBsYXN0UGFyc2VkQWdlbnRDc3ZUZXh0ID0gbnVsbDsKICAgICAgICAgIGxldCBsYXN0UGFyc2VkQWdlbnRNZXRhID0gbnVsbDsKICAgICAgICAgIGxldCBjdXJyZW50Q3N2RmllbGRMb29rdXAgPSBudWxsOw0KICAgICAgICAgIGNvbnN0IE1BWF9ESU1FTlNJT05fU0VSSUVTID0gNjsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGNzdkZpZWxkTWFwID0gew0KICAgICAgICAgICAgdG90YWxBY3Rpb25zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsNCiAgICAgICAgICAgICAgICAiVG90YWwgQWN0aXZlIENvcGlsb3QgQWN0aW9ucyBUYWtlbiIsDQogICAgICAgICAgICAgICAgIlRvdGFsIENvcGlsb3QgYWN0aW9ucyB0YWtlbiINCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGFzc2lzdGVkSG91cnM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IGFzc2lzdGVkIGhvdXJzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjb3BpbG90RW5hYmxlZFVzZXI6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IEVuYWJsZWQgVXNlciJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY29waWxvdFRlYW1zRW5hYmxlZFVzZXI6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IFRlYW1zIEVuYWJsZWQgVXNlciJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY29waWxvdFByb2R1Y3Rpdml0eUVuYWJsZWRVc2VyOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBQcm9kdWN0aXZpdHkgQXBwcyBFbmFibGVkIFVzZXIiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNvcGlsb3RDaGF0RW5hYmxlZFVzZXI6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IENoYXQgRW5hYmxlZCBVc2VyIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBtZWV0aW5nUmVjYXA6IHsKICAgICAgICAgICAgICBwcmltYXJ5OiBbCiAgICAgICAgICAgICAgICAiTWVldGluZ3MgcmVjYXBwZWQgYnkgQ29waWxvdCIsCiAgICAgICAgICAgICAgICAiSW50ZWxsaWdlbnQgcmVjYXAgYWN0aW9ucyB0YWtlbiIsCiAgICAgICAgICAgICAgICAiUmVjYXAiCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICBtZWV0aW5nU3VtbWFyaWVzVG90YWw6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJNZWV0aW5ncyBzdW1tYXJpemVkIGJ5IENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJNZWV0aW5ncyBzdW1tYXJpemVkIGJ5IENvcGlsb3QgaW4gVGVhbXMiLA0KICAgICAgICAgICAgICAgICJUb3RhbCBtZWV0aW5ncyBzdW1tYXJpemVkIGJ5IENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJUb3RhbCBtZWV0aW5ncyBzdW1tYXJpemVkIGJ5IENvcGlsb3QgaW4gVGVhbXMiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG1lZXRpbmdTdW1tYXJpZXNBY3Rpb25zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiU3VtbWFyaXplIG1lZXRpbmcgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IGluIFRlYW1zIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBtZWV0aW5nSG91cnM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJNZWV0aW5nIGhvdXJzIHJlY2FwcGVkIGJ5IENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJNZWV0aW5nIGhvdXJzIHN1bW1hcml6ZWQgYnkgQ29waWxvdCIsDQogICAgICAgICAgICAgICAgIk1lZXRpbmcgaG91cnMgc3VtbWFyaXplZCBieSBDb3BpbG90IGluIFRlYW1zIg0KICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICBwcmVmZXJNYXg6IHRydWUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbWFpbERyYWZ0czogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbDQogICAgICAgICAgICAgICAgIkdlbmVyYXRlIGVtYWlsIGRyYWZ0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCIsDQogICAgICAgICAgICAgICAgIkdlbmVyYXRlIGVtYWlsIGRyYWZ0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBPdXRsb29rIg0KICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICBwcmVmZXJNYXg6IHRydWUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbWFpbENvYWNoaW5nOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsNCiAgICAgICAgICAgICAgICAiRW1haWwgY29hY2hpbmcgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IiwNCiAgICAgICAgICAgICAgICAiRW1haWwgY29hY2hpbmcgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IGluIE91dGxvb2siDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGVtYWlsU3VtbWFyaWVzOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsNCiAgICAgICAgICAgICAgICAiU3VtbWFyaXplIGVtYWlsIHRocmVhZCBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJTdW1tYXJpemUgZW1haWwgdGhyZWFkIGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBPdXRsb29rIg0KICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICBwcmVmZXJNYXg6IHRydWUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbWFpbFRvdGFsV2l0aENvcGlsb3Q6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJUb3RhbCBlbWFpbHMgc2VudCB1c2luZyBDb3BpbG90IGluIE91dGxvb2siXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGVtYWlsc1NlbnQ6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJFbWFpbHMgc2VudCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hhdENvbXBvc2U6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJDb21wb3NlIGNoYXQgbWVzc2FnZSBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJDb21wb3NlIGNoYXQgbWVzc2FnZSBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QgaW4gVGVhbXMiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRTdW1tYXJpZXM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJTdW1tYXJpemUgY2hhdCBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJTdW1tYXJpemUgY2hhdCBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QgaW4gVGVhbXMiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRDb252ZXJzYXRpb25zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsNCiAgICAgICAgICAgICAgICAiVG90YWwgY2hhdCBjb252ZXJzYXRpb25zIHN1bW1hcml6ZWQgYnkgQ29waWxvdCIsDQogICAgICAgICAgICAgICAgIlRvdGFsIGNoYXQgY29udmVyc2F0aW9ucyBzdW1tYXJpemVkIGJ5IENvcGlsb3QgaW4gVGVhbXMiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRQcm9tcHRzV29yazogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgY2hhdCAod29yaykgcHJvbXB0cyBzdWJtaXR0ZWQiXSwNCiAgICAgICAgICAgICAgZmFsbGJhY2tTdW06IFsNCiAgICAgICAgICAgICAgICAiQ29waWxvdCBDaGF0ICh3b3JrKSBwcm9tcHRzIHN1Ym1pdHRlZCBpbiBUZWFtcyIsDQogICAgICAgICAgICAgICAgIkNvcGlsb3QgQ2hhdCAod29yaykgcHJvbXB0cyBzdWJtaXR0ZWQgaW4gT3V0bG9vayINCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRQcm9tcHRzV29ya1RlYW1zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBDaGF0ICh3b3JrKSBwcm9tcHRzIHN1Ym1pdHRlZCBpbiBUZWFtcyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hhdFByb21wdHNXb3JrT3V0bG9vazogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgQ2hhdCAod29yaykgcHJvbXB0cyBzdWJtaXR0ZWQgaW4gT3V0bG9vayJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hhdFByb21wdHNXZWI6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IENoYXQgKHdlYikgcHJvbXB0cyBzdWJtaXR0ZWQiXSwNCiAgICAgICAgICAgICAgZmFsbGJhY2tTdW06IFsNCiAgICAgICAgICAgICAgICAiQ29waWxvdCBDaGF0IChXZWIpIHByb21wdHMgc3VibWl0dGVkIGluIFRlYW1zIiwNCiAgICAgICAgICAgICAgICAiQ29waWxvdCBDaGF0IChXZWIpIHByb21wdHMgc3VibWl0dGVkIGluIE91dGxvb2siDQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaGF0UHJvbXB0c1dlYlRlYW1zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBDaGF0IChXZWIpIHByb21wdHMgc3VibWl0dGVkIGluIFRlYW1zIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaGF0UHJvbXB0c1dlYk91dGxvb2s6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IENoYXQgKFdlYikgcHJvbXB0cyBzdWJtaXR0ZWQgaW4gT3V0bG9vayJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hhdFByb21wdHNUZWFtczogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgQ2hhdCAod29yaykgcHJvbXB0cyBzdWJtaXR0ZWQgaW4gVGVhbXMiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGRvY3VtZW50U3VtbWFyaWVzOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsNCiAgICAgICAgICAgICAgICAiU3VtbWFyaXplIFdvcmQgZG9jdW1lbnQgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IiwNCiAgICAgICAgICAgICAgICAiU3VtbWFyaXplIFdvcmQgZG9jdW1lbnQgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IGluIFdvcmQiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHByZXNlbnRhdGlvbkNyZWF0ZWQ6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJDcmVhdGUgcHJlc2VudGF0aW9uIGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCIsDQogICAgICAgICAgICAgICAgIkNyZWF0ZSBwcmVzZW50YXRpb24gYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IGluIFBvd2VyUG9pbnQiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGV4Y2VsQW5hbHlzaXM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWw0KICAgICAgICAgICAgICAgICJFeGNlbCBhbmFseXNpcyBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiLA0KICAgICAgICAgICAgICAgICJFeGNlbCBhbmFseXNpcyBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QgaW4gRXhjZWwiDQogICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgIHByZWZlck1heDogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHdvcmRBY3Rpb25zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBhY3Rpb25zIHRha2VuIGluIFdvcmQiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHRlYW1zQWN0aW9uczogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgYWN0aW9ucyB0YWtlbiBpbiBUZWFtcyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcG93ZXJwb2ludEFjdGlvbnM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IGFjdGlvbnMgdGFrZW4gaW4gUG93ZXJwb2ludCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZXhjZWxBY3Rpb25zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBhY3Rpb25zIHRha2VuIGluIEV4Y2VsIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvdXRsb29rQWN0aW9uczogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgYWN0aW9ucyB0YWtlbiBpbiBPdXRsb29rIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaGF0V29ya0FjdGlvbnM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IGFjdGlvbnMgdGFrZW4gaW4gQ29waWxvdCBjaGF0ICh3b3JrKSJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdmlzdWFsaXplVGFibGVXb3JkOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiVmlzdWFsaXplIGFzIHRhYmxlIGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBXb3JkIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB3b3JkQ2hhdFByb21wdHM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDaGF0IChDb3BpbG90IGluIFdvcmQpIHByb21wdHMgc3VibWl0dGVkIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBhZGRDb250ZW50UHJlc2VudGF0aW9uOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQWRkIGNvbnRlbnQgdG8gcHJlc2VudGF0aW9uIGFjdGlvbnMgdGFrZW4iXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG9yZ2FuaXplUHJlc2VudGF0aW9uOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiT3JnYW5pemUgcHJlc2VudGF0aW9uIGFjdGlvbnMgdGFrZW4iXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHBvd2VycG9pbnRDaGF0UHJvbXB0czogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNoYXQgKENvcGlsb3QgaW4gUG93ZXJQb2ludCkgcHJvbXB0cyBzdWJtaXR0ZWQiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGV4Y2VsQ2hhdFByb21wdHM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDaGF0IChDb3BpbG90IGluIEV4Y2VsKSBwcm9tcHRzIHN1Ym1pdHRlZCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc3VtbWFyaXplUHJlc2VudGF0aW9uOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiU3VtbWFyaXplIHByZXNlbnRhdGlvbiBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QgaW4gUG93ZXJQb2ludCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcmV3cml0ZVRleHRXb3JkOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiUmV3cml0ZSB0ZXh0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBXb3JkIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkcmFmdFdvcmQ6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJEcmFmdCBXb3JkIGRvY3VtZW50IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZXhjZWxGb3JtdWxhOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ3JlYXRlIEV4Y2VsIGZvcm11bGEgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90Il0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBleGNlbEZvcm1hdHRpbmc6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJFeGNlbCBmb3JtYXR0aW5nIGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZGF5c0FjdGl2ZVdvcmQ6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJEYXlzIG9mIGFjdGl2ZSBDb3BpbG90IHVzYWdlIGluIFdvcmQiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGRheXNBY3RpdmVUZWFtczogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkRheXMgb2YgYWN0aXZlIENvcGlsb3QgdXNhZ2UgaW4gVGVhbXMiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGRheXNBY3RpdmVQb3dlclBvaW50OiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiRGF5cyBvZiBhY3RpdmUgQ29waWxvdCB1c2FnZSBpbiBQb3dlcnBvaW50Il0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkYXlzQWN0aXZlT3V0bG9vazogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkRheXMgb2YgYWN0aXZlIENvcGlsb3QgdXNhZ2UgaW4gT3V0bG9vayJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZGF5c0FjdGl2ZU9uZU5vdGU6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJEYXlzIG9mIGFjdGl2ZSBDb3BpbG90IHVzYWdlIGluIE9uZU5vdGUiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGRheXNBY3RpdmVMb29wOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiRGF5cyBvZiBhY3RpdmUgQ29waWxvdCB1c2FnZSBpbiBMb29wIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkYXlzQWN0aXZlRXhjZWw6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJEYXlzIG9mIGFjdGl2ZSBDb3BpbG90IHVzYWdlIGluIEV4Y2VsIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkYXlzQWN0aXZlQ2hhdFdvcms6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJEYXlzIG9mIGFjdGl2ZSBDb3BpbG90IGNoYXQgKHdvcmspIHVzYWdlIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBkYXlzQWN0aXZlQ2hhdFdlYjogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkRheXMgb2YgYWN0aXZlIENvcGlsb3QgQ2hhdCAod2ViKSB1c2FnZSJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdG90YWxBY3RpdmVEYXlzOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiVG90YWwgQ29waWxvdCBhY3RpdmUgZGF5cyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgdG90YWxFbmFibGVkRGF5czogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIlRvdGFsIENvcGlsb3QgZW5hYmxlZCBkYXlzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmFibGVkRGF5c1RlYW1zOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiQ29waWxvdCBlbmFibGVkIGRheXMgZm9yIFRlYW1zIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmFibGVkRGF5c1Byb2R1Y3Rpdml0eTogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgZW5hYmxlZCBkYXlzIGZvciBQcm9kdWN0aXZpdHkgQXBwIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbmFibGVkRGF5c1Bvd2VyUGxhdGZvcm06IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IGVuYWJsZWQgZGF5cyBmb3IgUG93ZXIgUGxhdGZvcm0gY29ubmVjdG9ycyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZW5hYmxlZERheXNJbnRlbGxpZ2VudFNlYXJjaDogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvcGlsb3QgZW5hYmxlZCBkYXlzIGZvciBJbnRlbGxpZ2VudCBTZWFyY2giXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRXb3JrRW5hYmxlZERheXM6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogWyJDb3BpbG90IGNoYXQgKHdvcmspIGVuYWJsZWQgZGF5cyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgYXR0ZW5kZWRNZWV0aW5nczogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkF0dGVuZGVkIG1lZXRpbmdzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBtZWV0aW5nc1RvdGFsOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiTWVldGluZ3MiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG1lZXRpbmdIb3Vyc1RvdGFsOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiTWVldGluZyBob3VycyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbWVldGluZ0hvdXJzVW5pbnRlcnJ1cHRlZDogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIlVuaW50ZXJydXB0ZWQgaG91cnMiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG1lZXRpbmdIb3Vyc1NtYWxsOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiU21hbGwgbWVldGluZyBob3VycyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbWVldGluZ0hvdXJzTXVsdGl0YXNraW5nOiB7DQogICAgICAgICAgICAgIHByaW1hcnk6IFsiTXVsdGl0YXNraW5nIGhvdXJzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBtZWV0aW5nSG91cnNDb25mbGljdGluZzogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNvbmZsaWN0aW5nIG1lZXRpbmcgaG91cnMiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRzU2VudDogew0KICAgICAgICAgICAgICBwcmltYXJ5OiBbIkNoYXRzIHNlbnQiXQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH07DQogICAgICAgICAgY29uc3QgY3N2RmllbGRFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoY3N2RmllbGRNYXApOw0KICAgICAgICAgIGNvbnN0IENTVl9GSUVMRF9FTlRSSUVTX0NPVU5UID0gY3N2RmllbGRFbnRyaWVzLmxlbmd0aDsNCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGdldENvbHVtblZhbHVlKHJhdywgY29sdW1uKSB7DQogICAgICAgICAgICBpZiAoIXJhdyB8fCAhY29sdW1uKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGV0IGNhbmRpZGF0ZUNvbHVtbiA9IGNvbHVtbjsNCiAgICAgICAgICAgIGlmICghKGNhbmRpZGF0ZUNvbHVtbiBpbiByYXcpKSB7DQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29sdW1uID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBjb2x1bW4udHJpbSgpOw0KICAgICAgICAgICAgICAgIGlmICh0cmltbWVkICYmIHRyaW1tZWQgIT09IGNvbHVtbiAmJiB0cmltbWVkIGluIHJhdykgew0KICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlQ29sdW1uID0gdHJpbW1lZDsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRDc3ZGaWVsZExvb2t1cCkgew0KICAgICAgICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZUhlYWRlcktleShjb2x1bW4pOw0KICAgICAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWQgPSBjdXJyZW50Q3N2RmllbGRMb29rdXAuZ2V0KG5vcm1hbGl6ZWQpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocmVzb2x2ZWQgJiYgcmVzb2x2ZWQgaW4gcmF3KSB7DQogICAgICAgICAgICAgICAgICAgICAgY2FuZGlkYXRlQ29sdW1uID0gcmVzb2x2ZWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghKGNhbmRpZGF0ZUNvbHVtbiBpbiByYXcpKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcmF3VmFsdWUgPSByYXdbY2FuZGlkYXRlQ29sdW1uXTsNCiAgICAgICAgICAgIGlmIChyYXdWYWx1ZSA9PSBudWxsKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiByYXdWYWx1ZSA9PT0gInN0cmluZyIgJiYgIXJhd1ZhbHVlLnRyaW0oKSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlTnVtYmVyKHJhd1ZhbHVlKTsNCiAgICAgICAgICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUocGFyc2VkKSA/IHBhcnNlZCA6IG51bGw7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZ2V0Rmlyc3RBdmFpbGFibGVWYWx1ZShyYXcsIGNvbHVtbnMpIHsNCiAgICAgICAgICAgIGlmICghY29sdW1ucykgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShjb2x1bW5zKSkgew0KICAgICAgICAgICAgICByZXR1cm4gZ2V0Q29sdW1uVmFsdWUocmF3LCBjb2x1bW5zKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjb2x1bW5zLmxlbmd0aDsgaW5kZXggKz0gMSkgew0KICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldENvbHVtblZhbHVlKHJhdywgY29sdW1uc1tpbmRleF0pOw0KICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZ2V0TWF4T2ZDb2x1bW5zKHJhdywgY29sdW1ucykgew0KICAgICAgICAgICAgaWYgKCFjb2x1bW5zKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbGlzdCA9IEFycmF5LmlzQXJyYXkoY29sdW1ucykgPyBjb2x1bW5zIDogW2NvbHVtbnNdOw0KICAgICAgICAgICAgbGV0IG1heCA9IG51bGw7DQogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbGlzdC5sZW5ndGg7IGluZGV4ICs9IDEpIHsNCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRDb2x1bW5WYWx1ZShyYXcsIGxpc3RbaW5kZXhdKTsNCiAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBpZiAobWF4ID09IG51bGwgfHwgdmFsdWUgPiBtYXgpIHsNCiAgICAgICAgICAgICAgICAgIG1heCA9IHZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG1heDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBnZXRTdW1PZkNvbHVtbnMocmF3LCBjb2x1bW5zKSB7DQogICAgICAgICAgICBpZiAoIWNvbHVtbnMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBsaXN0ID0gQXJyYXkuaXNBcnJheShjb2x1bW5zKSA/IGNvbHVtbnMgOiBbY29sdW1uc107DQogICAgICAgICAgICBsZXQgdG90YWwgPSAwOw0KICAgICAgICAgICAgbGV0IHVzZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsaXN0Lmxlbmd0aDsgaW5kZXggKz0gMSkgew0KICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGdldENvbHVtblZhbHVlKHJhdywgbGlzdFtpbmRleF0pOw0KICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHRvdGFsICs9IHZhbHVlOw0KICAgICAgICAgICAgICAgIHVzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdXNlZCA/IHRvdGFsIDogbnVsbDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBleHRyYWN0TWV0cmljVmFsdWUocmF3LCBtYXBwaW5nKSB7DQogICAgICAgICAgICBpZiAoIW1hcHBpbmcpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIG1hcHBpbmcgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIGNvbnN0IGRpcmVjdCA9IGdldENvbHVtblZhbHVlKHJhdywgbWFwcGluZyk7DQogICAgICAgICAgICAgIHJldHVybiBkaXJlY3QgIT0gbnVsbCA/IGRpcmVjdCA6IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXBwaW5nKSkgew0KICAgICAgICAgICAgICBjb25zdCBmaXJzdCA9IGdldEZpcnN0QXZhaWxhYmxlVmFsdWUocmF3LCBtYXBwaW5nKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0ICE9IG51bGwgPyBmaXJzdCA6IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBwcmVmZXJNYXggPSBCb29sZWFuKG1hcHBpbmcucHJlZmVyTWF4KTsNCiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlDb2x1bW5zID0gbWFwcGluZy5wcmltYXJ5IHx8IG1hcHBpbmcuY29sdW1uczsNCiAgICAgICAgICAgIGNvbnN0IHByaW1hcnlWYWx1ZSA9IHByZWZlck1heA0KICAgICAgICAgICAgICA/IGdldE1heE9mQ29sdW1ucyhyYXcsIHByaW1hcnlDb2x1bW5zKQ0KICAgICAgICAgICAgICA6IGdldEZpcnN0QXZhaWxhYmxlVmFsdWUocmF3LCBwcmltYXJ5Q29sdW1ucyk7DQogICAgICAgICAgICBpZiAocHJpbWFyeVZhbHVlICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgY29uc3Qgc3VtRXh0cmFzID0gZ2V0U3VtT2ZDb2x1bW5zKHJhdywgbWFwcGluZy5zdW0pOw0KICAgICAgICAgICAgICByZXR1cm4gc3VtRXh0cmFzICE9IG51bGwgPyBwcmltYXJ5VmFsdWUgKyBzdW1FeHRyYXMgOiBwcmltYXJ5VmFsdWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBhbHRlcm5hdGVDb2x1bW5zID0gbWFwcGluZy5hbHRlcm5hdGUgfHwgbWFwcGluZy5zeW5vbnltcyB8fCBtYXBwaW5nLmxlZ2FjeTsNCiAgICAgICAgICAgIGlmIChhbHRlcm5hdGVDb2x1bW5zKSB7DQogICAgICAgICAgICAgIGNvbnN0IGFsdGVybmF0ZVZhbHVlID0gcHJlZmVyTWF4DQogICAgICAgICAgICAgICAgPyBnZXRNYXhPZkNvbHVtbnMocmF3LCBhbHRlcm5hdGVDb2x1bW5zKQ0KICAgICAgICAgICAgICAgIDogZ2V0Rmlyc3RBdmFpbGFibGVWYWx1ZShyYXcsIGFsdGVybmF0ZUNvbHVtbnMpOw0KICAgICAgICAgICAgICBpZiAoYWx0ZXJuYXRlVmFsdWUgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IHN1bUV4dHJhcyA9IGdldFN1bU9mQ29sdW1ucyhyYXcsIG1hcHBpbmcuc3VtKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gc3VtRXh0cmFzICE9IG51bGwgPyBhbHRlcm5hdGVWYWx1ZSArIHN1bUV4dHJhcyA6IGFsdGVybmF0ZVZhbHVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBmYWxsYmFja1N1bSA9IGdldFN1bU9mQ29sdW1ucyhyYXcsIG1hcHBpbmcuZmFsbGJhY2tTdW0pOw0KICAgICAgICAgICAgaWYgKGZhbGxiYWNrU3VtICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgY29uc3QgYWRkaXRpb25hbCA9IGdldFN1bU9mQ29sdW1ucyhyYXcsIG1hcHBpbmcuc3VtKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGFkZGl0aW9uYWwgIT0gbnVsbCA/IGZhbGxiYWNrU3VtICsgYWRkaXRpb25hbCA6IGZhbGxiYWNrU3VtOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc3VtVmFsdWUgPSBnZXRTdW1PZkNvbHVtbnMocmF3LCBtYXBwaW5nLnN1bSk7DQogICAgICAgICAgICByZXR1cm4gc3VtVmFsdWUgIT0gbnVsbCA/IHN1bVZhbHVlIDogMDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBnZXRNZXRyaWNEaXNwbGF5TGFiZWwobWV0cmljS2V5KSB7DQogICAgICAgICAgICBjb25zdCBtYXBwaW5nID0gY3N2RmllbGRNYXBbbWV0cmljS2V5XTsNCiAgICAgICAgICAgIGlmICghbWFwcGluZykgew0KICAgICAgICAgICAgICByZXR1cm4gbWV0cmljS2V5Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXBwaW5nID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICByZXR1cm4gbWFwcGluZzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hcHBpbmcpKSB7DQogICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nWzBdIHx8IG1ldHJpY0tleTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG1hcHBpbmcucHJpbWFyeSkgJiYgbWFwcGluZy5wcmltYXJ5Lmxlbmd0aCkgew0KICAgICAgICAgICAgICByZXR1cm4gbWFwcGluZy5wcmltYXJ5WzBdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgYWx0ZXJuYXRlID0gbWFwcGluZy5hbHRlcm5hdGUgfHwgbWFwcGluZy5zeW5vbnltcyB8fCBtYXBwaW5nLmxlZ2FjeTsNCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFsdGVybmF0ZSkgJiYgYWx0ZXJuYXRlLmxlbmd0aCkgew0KICAgICAgICAgICAgICByZXR1cm4gYWx0ZXJuYXRlWzBdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtYXBwaW5nLnByaW1hcnkgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIHJldHVybiBtYXBwaW5nLnByaW1hcnk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbWV0cmljS2V5Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGNhdGVnb3J5Q29uZmlnID0gew0KICAgICAgICAgICAgbWVldGluZ3M6IHsNCiAgICAgICAgICAgICAgcHJpbWFyeTogIm1lZXRpbmdSZWNhcCIsDQogICAgICAgICAgICAgIHNlY29uZGFyeTogWyJtZWV0aW5nU3VtbWFyaWVzVG90YWwiLCAibWVldGluZ1N1bW1hcmllc0FjdGlvbnMiXSwNCiAgICAgICAgICAgICAgZm9ybWF0dGVyczogWw0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLA0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLA0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpDQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBlbWFpbHM6IHsKICAgICAgICAgICAgICBwcmltYXJ5OiAiZW1haWxEcmFmdHMiLAogICAgICAgICAgICAgIHNlY29uZGFyeTogWyJlbWFpbENvYWNoaW5nIiwgImVtYWlsU3VtbWFyaWVzIl0sCiAgICAgICAgICAgICAgZm9ybWF0dGVyczogWwogICAgICAgICAgICAgICAgdmFsdWUgPT4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKHZhbHVlKSksCiAgICAgICAgICAgICAgICB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQodmFsdWUpKSwKICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICBjaGF0czogewogICAgICAgICAgICAgIHByaW1hcnk6ICJ0ZWFtc0FjdGlvbnMiLAogICAgICAgICAgICAgIHNlY29uZGFyeTogWyJjaGF0Q29tcG9zZSIsICJjaGF0U3VtbWFyaWVzIiwgImNoYXRDb252ZXJzYXRpb25zIl0sCiAgICAgICAgICAgICAgZm9ybWF0dGVyczogWwogICAgICAgICAgICAgICAgdmFsdWUgPT4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKHZhbHVlKSksCiAgICAgICAgICAgICAgICB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQodmFsdWUpKSwKICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLAogICAgICAgICAgICAgICAgdmFsdWUgPT4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKHZhbHVlKSkKICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRvY3VtZW50czogewogICAgICAgICAgICAgIHByaW1hcnk6ICJ3b3JkQWN0aW9ucyIsCiAgICAgICAgICAgICAgc2Vjb25kYXJ5OiBbImRvY3VtZW50U3VtbWFyaWVzIiwgInByZXNlbnRhdGlvbkNyZWF0ZWQiLCAiZXhjZWxBbmFseXNpcyJdLAogICAgICAgICAgICAgIGZvcm1hdHRlcnM6IFsKICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLAogICAgICAgICAgICAgICAgdmFsdWUgPT4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKHZhbHVlKSksCiAgICAgICAgICAgICAgICB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQodmFsdWUpKSwKICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICAiY29waWxvdC1jaGF0Ijogew0KICAgICAgICAgICAgICBwcmltYXJ5OiAiY2hhdFByb21wdHNXb3JrIiwNCiAgICAgICAgICAgICAgc2Vjb25kYXJ5OiBbImNoYXRQcm9tcHRzV2ViIiwgImNoYXRQcm9tcHRzVGVhbXMiXSwNCiAgICAgICAgICAgICAgZm9ybWF0dGVyczogWw0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLA0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpLA0KICAgICAgICAgICAgICAgIHZhbHVlID0+IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZCh2YWx1ZSkpDQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KICAgICAgICAgIGNvbnN0IGNhdGVnb3J5TWV0cmljTGFiZWxzID0gew0KICAgICAgICAgICAgbWVldGluZ3M6IHsNCiAgICAgICAgICAgICAgbWVldGluZ1JlY2FwOiAiSW50ZWxsaWdlbnQgcmVjYXAgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IiwNCiAgICAgICAgICAgICAgbWVldGluZ1N1bW1hcmllc1RvdGFsOiAiVG90YWwgbWVldGluZ3Mgc3VtbWFyaXplZCBvciByZWNhcHBlZCBieSBDb3BpbG90IiwNCiAgICAgICAgICAgICAgbWVldGluZ1N1bW1hcmllc0FjdGlvbnM6ICJTdW1tYXJpemUgbWVldGluZyBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgZW1haWxzOiB7DQogICAgICAgICAgICAgIGVtYWlsRHJhZnRzOiAiRHJhZnRzIGdlbmVyYXRlZCB3aXRoIENvcGlsb3QiLA0KICAgICAgICAgICAgICBlbWFpbENvYWNoaW5nOiAiRW1haWwgY29hY2hpbmcgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IiwNCiAgICAgICAgICAgICAgZW1haWxTdW1tYXJpZXM6ICJTdW1tYXJpemUgZW1haWwgdGhyZWFkIGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCINCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaGF0czogewogICAgICAgICAgICAgIGNoYXRDb21wb3NlOiAiQ29tcG9zZSBjaGF0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBUZWFtcyIsCiAgICAgICAgICAgICAgY2hhdFN1bW1hcmllczogIlN1bW1hcml6ZSBjaGF0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCBpbiBUZWFtcyIsCiAgICAgICAgICAgICAgY2hhdENvbnZlcnNhdGlvbnM6ICJUb3RhbCBjaGF0IGNvbnZlcnNhdGlvbnMgc3VtbWFyaXplZCBieSBDb3BpbG90IGluIFRlYW1zIiwKICAgICAgICAgICAgICB0ZWFtc0FjdGlvbnM6ICJDb3BpbG90IGFjdGlvbnMgdGFrZW4gaW4gVGVhbXMiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRvY3VtZW50czogewogICAgICAgICAgICAgIHdvcmRBY3Rpb25zOiAiQ29waWxvdCBhY3Rpb25zIHRha2VuIGluIFdvcmQiLAogICAgICAgICAgICAgIGRvY3VtZW50U3VtbWFyaWVzOiAiRG9jdW1lbnQgc3VtbWFyaWVzIGNyZWF0ZWQgd2l0aCBDb3BpbG90IiwKICAgICAgICAgICAgICBwcmVzZW50YXRpb25DcmVhdGVkOiAiUHJlc2VudGF0aW9ucyBjcmVhdGVkIHVzaW5nIENvcGlsb3QiLAogICAgICAgICAgICAgIGV4Y2VsQW5hbHlzaXM6ICJFeGNlbCBhbmFseXNpcyBhY3Rpb25zIHRha2VuIHVzaW5nIENvcGlsb3QiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJjb3BpbG90LWNoYXQiOiB7DQogICAgICAgICAgICAgIGNoYXRQcm9tcHRzV29yazogIkNvcGlsb3QgQ2hhdCAod29yaykgcHJvbXB0cyBzdWJtaXR0ZWQiLA0KICAgICAgICAgICAgICBjaGF0UHJvbXB0c1dlYjogIkNvcGlsb3QgQ2hhdCAod2ViKSBwcm9tcHRzIHN1Ym1pdHRlZCIsDQogICAgICAgICAgICAgIGNoYXRQcm9tcHRzVGVhbXM6ICJUZWFtcyBjaGF0IHByb21wdHMgc3VibWl0dGVkIHRvIENvcGlsb3QiDQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCiAgICAgICAgICBjb25zdCBjYXRlZ29yeUhvdXJGaWVsZE1hcCA9IHsNCiAgICAgICAgICAgIG1lZXRpbmdzOiAibWVldGluZ0hvdXJzIg0KICAgICAgICAgIH07DQogICAgICANCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGNhdGVnb3J5TGFiZWxzID0gewogICAgICAgICAgICBtZWV0aW5nczogIk1lZXRpbmdzIiwKICAgICAgICAgICAgZW1haWxzOiAiRW1haWxzIiwKICAgICAgICAgICAgY2hhdHM6ICJUZWFtcyIsCiAgICAgICAgICAgIGRvY3VtZW50czogIkRvY3VtZW50cyIsCiAgICAgICAgICAgICJjb3BpbG90LWNoYXQiOiAiQ29waWxvdCBjaGF0IiwKICAgICAgICAgICAgImNvcGlsb3QtY2hhdC13b3JrIjogIkNvcGlsb3QgY2hhdCAod29yaykiLAogICAgICAgICAgICAiY29waWxvdC1jaGF0LXdlYiI6ICJDb3BpbG90IGNoYXQgKHdlYikiCiAgICAgICAgICB9OwoKICAgICAgICAgIGZ1bmN0aW9uIGdldENhdGVnb3J5VG90YWxWYWx1ZShlbnRyeSkgewogICAgICAgICAgICBpZiAoIWVudHJ5IHx8IHR5cGVvZiBlbnRyeSAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGVudHJ5LnRvdGFsKSkgewogICAgICAgICAgICAgIHJldHVybiBlbnRyeS50b3RhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwcmltYXJ5ID0gTnVtYmVyKGVudHJ5LnByaW1hcnkpIHx8IDA7CiAgICAgICAgICAgIGNvbnN0IHNlY29uZGFyeVN1bSA9IEFycmF5LmlzQXJyYXkoZW50cnkuc2Vjb25kYXJ5KQogICAgICAgICAgICAgID8gZW50cnkuc2Vjb25kYXJ5LnJlZHVjZSgoc3VtLCB2YWx1ZSkgPT4gc3VtICsgKE51bWJlcih2YWx1ZSkgfHwgMCksIDApCiAgICAgICAgICAgICAgOiAwOwogICAgICAgICAgICByZXR1cm4gcHJpbWFyeSArIHNlY29uZGFyeVN1bTsKICAgICAgICAgIH0KICAgICAgDQogICAgICAgICAgY29uc3QgYWdlbnRDc3ZGaWVsZE1hcCA9IHsNCiAgICAgICAgICAgIGlkOiAiQWdlbnQgSUQiLA0KICAgICAgICAgICAgbmFtZTogIkFnZW50IG5hbWUiLA0KICAgICAgICAgICAgY3JlYXRvclR5cGU6ICJDcmVhdG9yIHR5cGUiLA0KICAgICAgICAgICAgYWN0aXZlTGljZW5zZWQ6ICJBY3RpdmUgdXNlcnMgKGxpY2Vuc2VkKSIsDQogICAgICAgICAgICBhY3RpdmVVbmxpY2Vuc2VkOiAiQWN0aXZlIHVzZXJzICh1bmxpY2Vuc2VkKSIsDQogICAgICAgICAgICByZXNwb25zZXM6ICJSZXNwb25zZXMgc2VudCB0byB1c2VycyIsDQogICAgICAgICAgICBsYXN0QWN0aXZpdHk6ICJMYXN0IGFjdGl2aXR5IGRhdGUgKFVUQykiDQogICAgICAgICAgfTsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGFnZW50U29ydExhYmVscyA9IHsKICAgICAgICAgICAgbmFtZTogIkFnZW50IG5hbWUiLAogICAgICAgICAgICBjcmVhdG9yVHlwZTogIkNyZWF0b3IgdHlwZSIsCiAgICAgICAgICAgIHRvdGFsQWN0aXZlOiAiQWN0aXZlIHVzZXJzIiwKICAgICAgICAgICAgcmVzcG9uc2VzOiAiUmVzcG9uc2VzIiwKICAgICAgICAgICAgbGFzdEFjdGl2aXR5OiAiTGFzdCBhY3Rpdml0eSIKICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCBBR0VOVF9IVUJfVFlQRVMgPSBbInVzZXJzIiwgImFnZW50cyIsICJjb21iaW5lZCJdOwogICAgICAgICAgY29uc3QgYWdlbnRIdWJEYXRhc2V0Q29uZmlnID0gewogICAgICAgICAgICB1c2VyczogewogICAgICAgICAgICAgIHJlcXVpcmVkRmllbGRzOiB7CiAgICAgICAgICAgICAgICB1c2VybmFtZTogWyJVc2VybmFtZSIsICJVc2VyIHByaW5jaXBhbCBuYW1lIiwgIlVQTiIsICJVc2VyIl0sCiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogWyJEaXNwbGF5IG5hbWUiLCAiTmFtZSIsICJGdWxsIG5hbWUiXSwKICAgICAgICAgICAgICAgIGFnZW50Q291bnQ6IFsiTnVtYmVyIG9mIGFnZW50cyB1c2VkIiwgIkFnZW50cyB1c2VkIiwgIkFnZW50IGNvdW50Il0sCiAgICAgICAgICAgICAgICByZXNwb25zZXM6IFsiQWdlbnQgcmVzcG9uc2VzIHJlY2VpdmVkIiwgIkFnZW50IHJlc3BvbnNlcyIsICJSZXNwb25zZXMgcmVjZWl2ZWQiXSwKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eTogIkxhc3QgYWN0aXZpdHkgZGF0ZSAoVVRDKSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNvbHVtbnM6IFsKICAgICAgICAgICAgICAgIHsga2V5OiAidXNlcm5hbWUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAiZGlzcGxheU5hbWUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAiYWdlbnRDb3VudCIsIHR5cGU6ICJudW1iZXIiIH0sCiAgICAgICAgICAgICAgICB7IGtleTogInJlc3BvbnNlcyIsIHR5cGU6ICJudW1iZXIiIH0sCiAgICAgICAgICAgICAgICB7IGtleTogImxhc3RBY3Rpdml0eSIsIHR5cGU6ICJkYXRlIiB9CiAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICBmaWx0ZXJLZXlzOiBbInVzZXJuYW1lIiwgImRpc3BsYXlOYW1lIl0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYWdlbnRzOiB7CiAgICAgICAgICAgICAgcmVxdWlyZWRGaWVsZHM6IHsKICAgICAgICAgICAgICAgIGFnZW50SWQ6IFsiQWdlbnQgSUQiLCAiQWdlbnRJRCJdLAogICAgICAgICAgICAgICAgYWdlbnROYW1lOiBbIkFnZW50IG5hbWUiLCAiQWdlbnQiXSwKICAgICAgICAgICAgICAgIGNyZWF0b3JUeXBlOiBbIkNyZWF0b3IgdHlwZSIsICJDcmVhdG9yVHlwZSJdLAogICAgICAgICAgICAgICAgYWN0aXZlTGljZW5zZWQ6IFsiQWN0aXZlIHVzZXJzIChsaWNlbnNlZCkiLCAiTGljZW5zZWQgYWN0aXZlIHVzZXJzIl0sCiAgICAgICAgICAgICAgICBhY3RpdmVVbmxpY2Vuc2VkOiBbIkFjdGl2ZSB1c2VycyAodW5saWNlbnNlZCkiLCAiVW5saWNlbnNlZCBhY3RpdmUgdXNlcnMiXSwKICAgICAgICAgICAgICAgIHJlc3BvbnNlczogWyJSZXNwb25zZXMgc2VudCB0byB1c2VycyIsICJSZXNwb25zZXMgc2VudCIsICJSZXNwb25zZXMiXSwKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eTogIkxhc3QgYWN0aXZpdHkgZGF0ZSAoVVRDKSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNvbHVtbnM6IFsKICAgICAgICAgICAgICAgIHsga2V5OiAiYWdlbnRJZCIsIHR5cGU6ICJ0ZXh0IiB9LAogICAgICAgICAgICAgICAgeyBrZXk6ICJhZ2VudE5hbWUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAiY3JlYXRvclR5cGUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAiYWN0aXZlTGljZW5zZWQiLCB0eXBlOiAibnVtYmVyIiB9LAogICAgICAgICAgICAgICAgeyBrZXk6ICJhY3RpdmVVbmxpY2Vuc2VkIiwgdHlwZTogIm51bWJlciIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAicmVzcG9uc2VzIiwgdHlwZTogIm51bWJlciIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAibGFzdEFjdGl2aXR5IiwgdHlwZTogImRhdGUiIH0KICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIGZpbHRlcktleXM6IFsiYWdlbnRJZCIsICJhZ2VudE5hbWUiLCAiY3JlYXRvclR5cGUiXQogICAgICAgICAgICB9LAogICAgICAgICAgICBjb21iaW5lZDogewogICAgICAgICAgICAgIHJlcXVpcmVkRmllbGRzOiB7CiAgICAgICAgICAgICAgICBhZ2VudElkOiBbIkFnZW50IElEIiwgIkFnZW50SUQiXSwKICAgICAgICAgICAgICAgIGFnZW50TmFtZTogWyJBZ2VudCBuYW1lIiwgIkFnZW50Il0sCiAgICAgICAgICAgICAgICBjcmVhdG9yVHlwZTogWyJDcmVhdG9yIHR5cGUiLCAiQ3JlYXRvclR5cGUiXSwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBbIlVzZXJuYW1lIiwgIlVzZXIgcHJpbmNpcGFsIG5hbWUiLCAiVVBOIiwgIlVzZXIiXSwKICAgICAgICAgICAgICAgIHJlc3BvbnNlczogWyJSZXNwb25zZXMgc2VudCB0byB1c2VycyIsICJSZXNwb25zZXMgc2VudCIsICJSZXNwb25zZXMiXSwKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eTogIkxhc3QgYWN0aXZpdHkgZGF0ZSAoVVRDKSIKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGNvbHVtbnM6IFsKICAgICAgICAgICAgICAgIHsga2V5OiAiYWdlbnRJZCIsIHR5cGU6ICJ0ZXh0IiB9LAogICAgICAgICAgICAgICAgeyBrZXk6ICJhZ2VudE5hbWUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAiY3JlYXRvclR5cGUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAidXNlcm5hbWUiLCB0eXBlOiAidGV4dCIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAicmVzcG9uc2VzIiwgdHlwZTogIm51bWJlciIgfSwKICAgICAgICAgICAgICAgIHsga2V5OiAibGFzdEFjdGl2aXR5IiwgdHlwZTogImRhdGUiIH0KICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgIGZpbHRlcktleXM6IFsiYWdlbnRJZCIsICJhZ2VudE5hbWUiLCAiY3JlYXRvclR5cGUiLCAidXNlcm5hbWUiXQogICAgICAgICAgICB9CiAgICAgICAgICB9OwogICAgICAgICAgY29uc3QgYWdlbnRIdWJUeXBlTGFiZWxzID0gewogICAgICAgICAgICB1c2VyczogIlVzZXJzIENTViIsCiAgICAgICAgICAgIGFnZW50czogIkFnZW50cyBDU1YiLAogICAgICAgICAgICBjb21iaW5lZDogIlVzZXJzICYgYWdlbnRzIENTViIKICAgICAgICAgIH07CiAgICAgIA0KICAgICAgICAgIGNvbnN0IE1PTlRIX05BTUVfVE9fSU5ERVggPSB7DQogICAgICAgICAgICBqYW46IDAsDQogICAgICAgICAgICBmZWI6IDEsDQogICAgICAgICAgICBtYXI6IDIsDQogICAgICAgICAgICBhcHI6IDMsDQogICAgICAgICAgICBtYXk6IDQsDQogICAgICAgICAgICBqdW46IDUsDQogICAgICAgICAgICBqdWw6IDYsDQogICAgICAgICAgICBhdWc6IDcsDQogICAgICAgICAgICBzZXA6IDgsDQogICAgICAgICAgICBvY3Q6IDksDQogICAgICAgICAgICBub3Y6IDEwLA0KICAgICAgICAgICAgZGVjOiAxMQ0KICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICBjb25zdCBhY3RpdmVEYXlzQ29uZmlnID0gew0KICAgICAgICAgICAgd29yZDogew0KICAgICAgICAgICAgICBsYWJlbDogIldvcmQiLA0KICAgICAgICAgICAgICBkYXlGaWVsZDogImRheXNBY3RpdmVXb3JkIiwNCiAgICAgICAgICAgICAgcHJvbXB0RmllbGRzOiBbImRvY3VtZW50U3VtbWFyaWVzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB0ZWFtczogew0KICAgICAgICAgICAgICBsYWJlbDogIlRlYW1zIiwNCiAgICAgICAgICAgICAgZGF5RmllbGQ6ICJkYXlzQWN0aXZlVGVhbXMiLA0KICAgICAgICAgICAgICBwcm9tcHRGaWVsZHM6IFsibWVldGluZ1JlY2FwIiwgIm1lZXRpbmdTdW1tYXJpZXNUb3RhbCIsICJjaGF0Q29tcG9zZSIsICJjaGF0U3VtbWFyaWVzIiwgImNoYXRDb252ZXJzYXRpb25zIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvdXRsb29rOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiT3V0bG9vayIsDQogICAgICAgICAgICAgIGRheUZpZWxkOiAiZGF5c0FjdGl2ZU91dGxvb2siLA0KICAgICAgICAgICAgICBwcm9tcHRGaWVsZHM6IFsiZW1haWxEcmFmdHMiLCAiZW1haWxTdW1tYXJpZXMiLCAiZW1haWxDb2FjaGluZyJdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgcG93ZXJwb2ludDogew0KICAgICAgICAgICAgICBsYWJlbDogIlBvd2VyUG9pbnQiLA0KICAgICAgICAgICAgICBkYXlGaWVsZDogImRheXNBY3RpdmVQb3dlclBvaW50IiwNCiAgICAgICAgICAgICAgcHJvbXB0RmllbGRzOiBbInByZXNlbnRhdGlvbkNyZWF0ZWQiXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGV4Y2VsOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiRXhjZWwiLA0KICAgICAgICAgICAgICBkYXlGaWVsZDogImRheXNBY3RpdmVFeGNlbCIsDQogICAgICAgICAgICAgIHByb21wdEZpZWxkczogWyJleGNlbEFuYWx5c2lzIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvbmVub3RlOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiT25lTm90ZSIsDQogICAgICAgICAgICAgIGRheUZpZWxkOiAiZGF5c0FjdGl2ZU9uZU5vdGUiLA0KICAgICAgICAgICAgICBwcm9tcHRGaWVsZHM6IFtdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgbG9vcDogew0KICAgICAgICAgICAgICBsYWJlbDogIkxvb3AiLA0KICAgICAgICAgICAgICBkYXlGaWVsZDogImRheXNBY3RpdmVMb29wIiwNCiAgICAgICAgICAgICAgcHJvbXB0RmllbGRzOiBbXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRXb3JrOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiQ29waWxvdCBjaGF0ICh3b3JrKSIsDQogICAgICAgICAgICAgIGRheUZpZWxkOiAiZGF5c0FjdGl2ZUNoYXRXb3JrIiwNCiAgICAgICAgICAgICAgcHJvbXB0RmllbGRzOiBbImNoYXRQcm9tcHRzV29yayIsICJjaGF0UHJvbXB0c1RlYW1zIl0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBjaGF0V2ViOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiQ29waWxvdCBDaGF0ICh3ZWIpIiwNCiAgICAgICAgICAgICAgZGF5RmllbGQ6ICJkYXlzQWN0aXZlQ2hhdFdlYiIsDQogICAgICAgICAgICAgIHByb21wdEZpZWxkczogWyJjaGF0UHJvbXB0c1dlYiJdDQogICAgICAgICAgICB9DQogICAgICAgICAgfTsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGFkb3B0aW9uQXBwQ29uZmlnID0gew0KICAgICAgICAgICAgdGVhbXM6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJUZWFtcyIsDQogICAgICAgICAgICAgIGNvbG9yOiAiIzYyNjRBNyIsDQogICAgICAgICAgICAgIGluZGljYXRvcnM6IFsiZGF5c0FjdGl2ZVRlYW1zIiwgIm1lZXRpbmdSZWNhcCIsICJtZWV0aW5nU3VtbWFyaWVzVG90YWwiLCAibWVldGluZ0hvdXJzIiwgImNoYXRDb21wb3NlIiwgImNoYXRTdW1tYXJpZXMiLCAiY2hhdENvbnZlcnNhdGlvbnMiLCAiY2hhdFByb21wdHNUZWFtcyJdLA0KICAgICAgICAgICAgICBmZWF0dXJlczogWw0KICAgICAgICAgICAgICAgIHsga2V5OiAiaW50ZWxsaWdlbnQtcmVjYXAiLCBsYWJlbDogIkludGVsbGlnZW50IHJlY2FwIiwgbWV0cmljczogWyJtZWV0aW5nUmVjYXAiXSB9LA0KICAgICAgICAgICAgICAgIHsga2V5OiAic3VtbWFyaXplLW1lZXRpbmdzIiwgbGFiZWw6ICJTdW1tYXJpemUgbWVldGluZ3MiLCBtZXRyaWNzOiBbIm1lZXRpbmdTdW1tYXJpZXNUb3RhbCJdIH0sDQogICAgICAgICAgICAgICAgeyBrZXk6ICJtZWV0aW5nLWhvdXJzIiwgbGFiZWw6ICJNZWV0aW5nIGhvdXJzIHN1bW1hcml6ZWQiLCBtZXRyaWNzOiBbIm1lZXRpbmdIb3VycyJdIH0sDQogICAgICAgICAgICAgICAgeyBrZXk6ICJjb21wb3NlLWNoYXQiLCBsYWJlbDogIkNvbXBvc2UgY2hhdCBtZXNzYWdlcyIsIG1ldHJpY3M6IFsiY2hhdENvbXBvc2UiXSB9LA0KICAgICAgICAgICAgICAgIHsga2V5OiAiY2hhdC1zdW1tYXJpZXMiLCBsYWJlbDogIlN1bW1hcml6ZSBjaGF0cyAmIGNvbnZlcnNhdGlvbnMiLCBtZXRyaWNzOiBbImNoYXRTdW1tYXJpZXMiLCAiY2hhdENvbnZlcnNhdGlvbnMiXSB9LA0KICAgICAgICAgICAgICAgIHsga2V5OiAiY2hhdC1wcm9tcHRzLXRlYW1zIiwgbGFiZWw6ICJDb3BpbG90IENoYXQgaW4gVGVhbXMiLCBtZXRyaWNzOiBbImNoYXRQcm9tcHRzVGVhbXMiXSB9DQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBvdXRsb29rOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiT3V0bG9vayIsDQogICAgICAgICAgICAgIGNvbG9yOiAiIzAwNzhENCIsDQogICAgICAgICAgICAgIGluZGljYXRvcnM6IFsiZGF5c0FjdGl2ZU91dGxvb2siLCAiZW1haWxEcmFmdHMiLCAiZW1haWxTdW1tYXJpZXMiLCAiZW1haWxDb2FjaGluZyJdLA0KICAgICAgICAgICAgICBmZWF0dXJlczogWw0KICAgICAgICAgICAgICAgIHsga2V5OiAiZW1haWwtZHJhZnRzIiwgbGFiZWw6ICJHZW5lcmF0ZSBlbWFpbCBkcmFmdHMiLCBtZXRyaWNzOiBbImVtYWlsRHJhZnRzIl0gfSwNCiAgICAgICAgICAgICAgICB7IGtleTogImVtYWlsLWNvYWNoaW5nIiwgbGFiZWw6ICJFbWFpbCBjb2FjaGluZyIsIG1ldHJpY3M6IFsiZW1haWxDb2FjaGluZyJdIH0sDQogICAgICAgICAgICAgICAgeyBrZXk6ICJlbWFpbC1zdW1tYXJpZXMiLCBsYWJlbDogIlN1bW1hcml6ZSBlbWFpbCB0aHJlYWRzIiwgbWV0cmljczogWyJlbWFpbFN1bW1hcmllcyJdIH0NCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHdvcmQ6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJXb3JkIiwNCiAgICAgICAgICAgICAgY29sb3I6ICIjMkI1NzlBIiwNCiAgICAgICAgICAgICAgaW5kaWNhdG9yczogWyJkYXlzQWN0aXZlV29yZCIsICJkb2N1bWVudFN1bW1hcmllcyJdLA0KICAgICAgICAgICAgICBmZWF0dXJlczogWw0KICAgICAgICAgICAgICAgIHsga2V5OiAiZG9jdW1lbnQtc3VtbWFyaWVzIiwgbGFiZWw6ICJTdW1tYXJpemUgZG9jdW1lbnRzIiwgbWV0cmljczogWyJkb2N1bWVudFN1bW1hcmllcyJdIH0NCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHBvd2VycG9pbnQ6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJQb3dlclBvaW50IiwNCiAgICAgICAgICAgICAgY29sb3I6ICIjRDI0NzI2IiwNCiAgICAgICAgICAgICAgaW5kaWNhdG9yczogWyJkYXlzQWN0aXZlUG93ZXJQb2ludCIsICJwcmVzZW50YXRpb25DcmVhdGVkIl0sDQogICAgICAgICAgICAgIGZlYXR1cmVzOiBbDQogICAgICAgICAgICAgICAgeyBrZXk6ICJjcmVhdGUtcHJlc2VudGF0aW9ucyIsIGxhYmVsOiAiQ3JlYXRlIHByZXNlbnRhdGlvbnMiLCBtZXRyaWNzOiBbInByZXNlbnRhdGlvbkNyZWF0ZWQiXSB9DQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBleGNlbDogew0KICAgICAgICAgICAgICBsYWJlbDogIkV4Y2VsIiwNCiAgICAgICAgICAgICAgY29sb3I6ICIjMjE3MzQ2IiwNCiAgICAgICAgICAgICAgaW5kaWNhdG9yczogWyJkYXlzQWN0aXZlRXhjZWwiLCAiZXhjZWxBbmFseXNpcyJdLA0KICAgICAgICAgICAgICBmZWF0dXJlczogWw0KICAgICAgICAgICAgICAgIHsga2V5OiAiZXhjZWwtYW5hbHlzaXMiLCBsYWJlbDogIkFuYWx5emUgZGF0YSIsIG1ldHJpY3M6IFsiZXhjZWxBbmFseXNpcyJdIH0NCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIG9uZW5vdGU6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJPbmVOb3RlIiwNCiAgICAgICAgICAgICAgY29sb3I6ICIjODAzOTdCIiwNCiAgICAgICAgICAgICAgaW5kaWNhdG9yczogWyJkYXlzQWN0aXZlT25lTm90ZSJdLA0KICAgICAgICAgICAgICBmZWF0dXJlczogW10NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBsb29wOiB7DQogICAgICAgICAgICAgIGxhYmVsOiAiTG9vcCIsDQogICAgICAgICAgICAgIGNvbG9yOiAiIzkzMzdGNCIsDQogICAgICAgICAgICAgIGluZGljYXRvcnM6IFsiZGF5c0FjdGl2ZUxvb3AiXSwNCiAgICAgICAgICAgICAgZmVhdHVyZXM6IFtdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgY2hhdFdvcms6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJDb3BpbG90IENoYXQgKHdvcmspIiwNCiAgICAgICAgICAgICAgY29sb3I6ICIjMEY2Q0JEIiwNCiAgICAgICAgICAgICAgaW5kaWNhdG9yczogWyJkYXlzQWN0aXZlQ2hhdFdvcmsiLCAiY2hhdFByb21wdHNXb3JrIl0sDQogICAgICAgICAgICAgIGZlYXR1cmVzOiBbDQogICAgICAgICAgICAgICAgeyBrZXk6ICJjaGF0LXByb21wdHMtd29yayIsIGxhYmVsOiAiUHJvbXB0cyBzdWJtaXR0ZWQiLCBtZXRyaWNzOiBbImNoYXRQcm9tcHRzV29yayJdIH0NCiAgICAgICAgICAgICAgXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIGNoYXRXZWI6IHsNCiAgICAgICAgICAgICAgbGFiZWw6ICJDb3BpbG90IENoYXQgKHdlYikiLA0KICAgICAgICAgICAgICBjb2xvcjogIiMxMDdDMTAiLA0KICAgICAgICAgICAgICBpbmRpY2F0b3JzOiBbImRheXNBY3RpdmVDaGF0V2ViIiwgImNoYXRQcm9tcHRzV2ViIl0sDQogICAgICAgICAgICAgIGZlYXR1cmVzOiBbDQogICAgICAgICAgICAgICAgeyBrZXk6ICJjaGF0LXByb21wdHMtd2ViIiwgbGFiZWw6ICJQcm9tcHRzIHN1Ym1pdHRlZCIsIG1ldHJpY3M6IFsiY2hhdFByb21wdHNXZWIiXSB9DQogICAgICAgICAgICAgIF0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KICAgICAgDQogICAgICAgICAgY29uc3QgY2hhcnRTZXJpZXNEZWZpbml0aW9ucyA9IFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgaWQ6ICJ0b3RhbCIsDQogICAgICAgICAgICAgIGxhYmVsOiBtZXRyaWMgPT4gKG1ldHJpYyA9PT0gImhvdXJzIiA/ICJBc3Npc3RlZCBob3VycyIgOiAiVG90YWwgYWN0aW9ucyIpLA0KICAgICAgICAgICAgICBnZXRWYWx1ZTogcGVyaW9kID0+IChzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIiA/IHBlcmlvZC5hc3Npc3RlZEhvdXJzIDogcGVyaW9kLnRvdGFsQWN0aW9ucyksDQogICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAicmdiYSgwLCAxMTAsIDAsIDAuOSkiLA0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJyZ2JhKDAsIDExMCwgMCwgMC4xOCkiLA0KICAgICAgICAgICAgICBmaWxsOiAib3JpZ2luIiwNCiAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDMsDQogICAgICAgICAgICAgIHBvaW50UmFkaXVzOiA0LA0KICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA2LA0KICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICBwb2ludEJvcmRlckNvbG9yOiAicmdiYSgwLCAxMTAsIDAsIDAuOSkiLA0KICAgICAgICAgICAgICBwb2ludEJvcmRlcldpZHRoOiAyLA0KICAgICAgICAgICAgICB0ZW5zaW9uOiAwLjMyLA0KICAgICAgICAgICAgICB0b2dnbGFibGU6IGZhbHNlDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBpZDogImVuYWJsZWQtdXNlcnMiLA0KICAgICAgICAgICAgICBsYWJlbDogKCkgPT4gIkVuYWJsZWQgdXNlcnMiLA0KICAgICAgICAgICAgICBtZXRyaWNzOiBbImFjdGlvbnMiXSwNCiAgICAgICAgICAgICAgZ2V0VmFsdWU6IHBlcmlvZCA9PiBwZXJpb2QuZW5hYmxlZFVzZXJzQ291bnQgfHwgMCwNCiAgICAgICAgICAgICAgc3VwcG9ydHNBdmVyYWdlOiBmYWxzZSwNCiAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICJyZ2JhKDE0OCwgMTYzLCAxODQsIDAuOTUpIiwNCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAicmdiYSgxNDgsIDE2MywgMTg0LCAwLjE4KSIsDQogICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLA0KICAgICAgICAgICAgICBwb2ludFJhZGl1czogMiwNCiAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogNSwNCiAgICAgICAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgdGVuc2lvbjogMC4yLA0KICAgICAgICAgICAgICBmaWxsOiBmYWxzZSwNCiAgICAgICAgICAgICAgdG9nZ2xhYmxlOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZDogIm1lZXRpbmdzIiwKICAgICAgICAgICAgICBsYWJlbDogKCkgPT4gY2F0ZWdvcnlMYWJlbHMubWVldGluZ3MsCiAgICAgICAgICAgICAgZ2V0VmFsdWU6IHBlcmlvZCA9PiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAwIDogZ2V0Q2F0ZWdvcnlUb3RhbFZhbHVlKHBlcmlvZD8uY2F0ZWdvcmllcz8ubWVldGluZ3MpKSwKICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInJnYmEoOSwgMTE0LCAxMzYsIDAuODUpIiwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsCiAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDMsCiAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogNSwNCiAgICAgICAgICAgICAgdGVuc2lvbjogMC4yNCwNCiAgICAgICAgICAgICAgdG9nZ2xhYmxlOiB0cnVlLA0KICAgICAgICAgICAgICBkZWZhdWx0VmlzaWJsZTogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZDogImVtYWlscyIsCiAgICAgICAgICAgICAgbGFiZWw6ICgpID0+IGNhdGVnb3J5TGFiZWxzLmVtYWlscywKICAgICAgICAgICAgICBnZXRWYWx1ZTogcGVyaW9kID0+IChzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIiA/IDAgOiBnZXRDYXRlZ29yeVRvdGFsVmFsdWUocGVyaW9kPy5jYXRlZ29yaWVzPy5lbWFpbHMpKSwKICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInJnYmEoODEsIDcwLCAyMTQsIDAuODUpIiwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJ0cmFuc3BhcmVudCIsCiAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsCiAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDMsCiAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogNSwNCiAgICAgICAgICAgICAgdGVuc2lvbjogMC4yNCwNCiAgICAgICAgICAgICAgdG9nZ2xhYmxlOiB0cnVlLA0KICAgICAgICAgICAgICBkZWZhdWx0VmlzaWJsZTogdHJ1ZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZDogImNoYXRzIiwKICAgICAgICAgICAgICBsYWJlbDogKCkgPT4gY2F0ZWdvcnlMYWJlbHMuY2hhdHMsCiAgICAgICAgICAgICAgZ2V0VmFsdWU6IHBlcmlvZCA9PiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAwIDogZ2V0Q2F0ZWdvcnlUb3RhbFZhbHVlKHBlcmlvZD8uY2F0ZWdvcmllcz8uY2hhdHMpKSwKICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInJnYmEoNTgsIDEzMiwgMTkzLCAwLjg1KSIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAidHJhbnNwYXJlbnQiLAogICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLAogICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAzLAogICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IDUsDQogICAgICAgICAgICAgIHRlbnNpb246IDAuMjQsDQogICAgICAgICAgICAgIHRvZ2dsYWJsZTogdHJ1ZSwNCiAgICAgICAgICAgICAgZGVmYXVsdFZpc2libGU6IHRydWUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgaWQ6ICJkb2N1bWVudHMiLAogICAgICAgICAgICAgIGxhYmVsOiAoKSA9PiBjYXRlZ29yeUxhYmVscy5kb2N1bWVudHMsCiAgICAgICAgICAgICAgZ2V0VmFsdWU6IHBlcmlvZCA9PiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAwIDogZ2V0Q2F0ZWdvcnlUb3RhbFZhbHVlKHBlcmlvZD8uY2F0ZWdvcmllcz8uZG9jdW1lbnRzKSksCiAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICJyZ2JhKDI0NiwgMTg5LCAyNCwgMC44NSkiLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50IiwKICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMiwKICAgICAgICAgICAgICBwb2ludFJhZGl1czogMywKICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA1LA0KICAgICAgICAgICAgICB0ZW5zaW9uOiAwLjI0LA0KICAgICAgICAgICAgICB0b2dnbGFibGU6IHRydWUsDQogICAgICAgICAgICAgIGRlZmF1bHRWaXNpYmxlOiB0cnVlDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBpZDogImNvcGlsb3QtY2hhdC13b3JrIiwNCiAgICAgICAgICAgICAgbGFiZWw6ICgpID0+IGNhdGVnb3J5TGFiZWxzWyJjb3BpbG90LWNoYXQtd29yayJdLA0KICAgICAgICAgICAgICBnZXRWYWx1ZTogcGVyaW9kID0+IChzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIiA/IDAgOiAoKHBlcmlvZC5jYXRlZ29yaWVzICYmIHBlcmlvZC5jYXRlZ29yaWVzWyJjb3BpbG90LWNoYXQiXSAmJiBwZXJpb2QuY2F0ZWdvcmllc1siY29waWxvdC1jaGF0Il0ucHJpbWFyeSkgfHwgMCkpLA0KICAgICAgICAgICAgICBib3JkZXJDb2xvcjogInJnYmEoMCwgMTM4LCAwLCAwLjc1KSIsDQogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50IiwNCiAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIsDQogICAgICAgICAgICAgIHBvaW50UmFkaXVzOiAzLA0KICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA1LA0KICAgICAgICAgICAgICB0ZW5zaW9uOiAwLjI0LA0KICAgICAgICAgICAgICB0b2dnbGFibGU6IHRydWUsDQogICAgICAgICAgICAgIGRlZmF1bHRWaXNpYmxlOiB0cnVlDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICBpZDogImNvcGlsb3QtY2hhdC13ZWIiLA0KICAgICAgICAgICAgICBsYWJlbDogKCkgPT4gY2F0ZWdvcnlMYWJlbHNbImNvcGlsb3QtY2hhdC13ZWIiXSwNCiAgICAgICAgICAgICAgZ2V0VmFsdWU6IHBlcmlvZCA9PiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAwIDogKChwZXJpb2QuY2F0ZWdvcmllcyAmJiBwZXJpb2QuY2F0ZWdvcmllc1siY29waWxvdC1jaGF0Il0gJiYgcGVyaW9kLmNhdGVnb3JpZXNbImNvcGlsb3QtY2hhdCJdLnNlY29uZGFyeSAmJiBwZXJpb2QuY2F0ZWdvcmllc1siY29waWxvdC1jaGF0Il0uc2Vjb25kYXJ5WzBdKSB8fCAwKSksDQogICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAicmdiYSgwLCAxMzgsIDAsIDAuNSkiLA0KICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJ0cmFuc3BhcmVudCIsDQogICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAyLA0KICAgICAgICAgICAgICBwb2ludFJhZGl1czogMywNCiAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogNSwNCiAgICAgICAgICAgICAgdGVuc2lvbjogMC4yNCwNCiAgICAgICAgICAgICAgYm9yZGVyRGFzaDogWzYsIDRdLA0KICAgICAgICAgICAgICB0b2dnbGFibGU6IHRydWUsDQogICAgICAgICAgICAgIGRlZmF1bHRWaXNpYmxlOiB0cnVlDQogICAgICAgICAgICB9DQogICAgICAgICAgXTsNCiAgICAgICAgICBjb25zdCB0b2dnbGFibGVTZXJpZXNJZHMgPSBjaGFydFNlcmllc0RlZmluaXRpb25zLmZpbHRlcihkZWYgPT4gZGVmLnRvZ2dsYWJsZSkubWFwKGRlZiA9PiBkZWYuaWQpOw0KICAgICAgICAgIGNvbnN0IGRlZmF1bHRDYXRlZ29yeVNlbGVjdGlvbiA9IG5ldyBTZXQodG9nZ2xhYmxlU2VyaWVzSWRzKTsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IHRyZW5kU2VyaWVzSWRzID0gY2hhcnRTZXJpZXNEZWZpbml0aW9ucy5tYXAoZGVmID0+IGRlZi5pZCk7DQogICAgICANCiAgICAgICAgICBjb25zdCBmYWxsYmFja1RyZW5kUGFsZXR0ZSA9IHsNCiAgICAgICAgICAgIHRvdGFsOiAnIzAwNkUwMCcsDQogICAgICAgICAgICBtZWV0aW5nczogJyMwOTcyODgnLA0KICAgICAgICAgICAgZW1haWxzOiAnIzUxNDZENicsDQogICAgICAgICAgICBjaGF0czogJyMzQTg0QzEnLA0KICAgICAgICAgICAgZG9jdW1lbnRzOiAnI0Y2QkQxOCcsDQogICAgICAgICAgICAnY29waWxvdC1jaGF0LXdvcmsnOiAnIzAwOEEwMCcsDQogICAgICAgICAgICAnY29waWxvdC1jaGF0LXdlYic6ICcjNUZCRjc1JywNCiAgICAgICAgICAgICdlbmFibGVkLXVzZXJzJzogJyM5NEEzQUYnDQogICAgICAgICAgfTsNCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHNhbml0aXplSGV4Q29sb3IodmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgIGlmICghL14jP1swLTlhLWZBLUZdezZ9JC8udGVzdCh0cmltbWVkKSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB0cmltbWVkLnN0YXJ0c1dpdGgoJyMnKSA/IHRyaW1tZWQgOiBgIyR7dHJpbW1lZH1gOw0KICAgICAgICAgICAgcmV0dXJuIGAjJHtub3JtYWxpemVkLnNsaWNlKDEpLnRvVXBwZXJDYXNlKCl9YDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBoZXhUb1JnYihoZXgpIHsNCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBzYW5pdGl6ZUhleENvbG9yKGhleCk7DQogICAgICAgICAgICBpZiAoIW5vcm1hbGl6ZWQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE51bWJlci5wYXJzZUludChub3JtYWxpemVkLnNsaWNlKDEpLCAxNik7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICByOiAodmFsdWUgPj4gMTYpICYgMjU1LA0KICAgICAgICAgICAgICBnOiAodmFsdWUgPj4gOCkgJiAyNTUsDQogICAgICAgICAgICAgIGI6IHZhbHVlICYgMjU1DQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJnYlRvSGV4KHIsIGcsIGIpIHsNCiAgICAgICAgICAgIGNvbnN0IHRvSGV4ID0gY29tcG9uZW50ID0+IGNvbXBvbmVudC50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKTsNCiAgICAgICAgICAgIHJldHVybiBgIyR7dG9IZXgocil9JHt0b0hleChnKX0ke3RvSGV4KGIpfWAudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjb2xvclN0cmluZ1RvSGV4KGNvbG9yKSB7DQogICAgICAgICAgICBpZiAoIWNvbG9yKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvbG9yLnN0YXJ0c1dpdGgoJyMnKSkgew0KICAgICAgICAgICAgICByZXR1cm4gc2FuaXRpemVIZXhDb2xvcihjb2xvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBtYXRjaCA9IGNvbG9yLm1hdGNoKC9yZ2JhP1woKFteKV0rKVwpL2kpOw0KICAgICAgICAgICAgaWYgKCFtYXRjaCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gbWF0Y2hbMV0uc3BsaXQoJywnKS5tYXAocGFydCA9PiBOdW1iZXIucGFyc2VGbG9hdChwYXJ0LnRyaW0oKSkpOw0KICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA8IDMgfHwgcGFydHMuc2xpY2UoMCwgMykuc29tZShwYXJ0ID0+ICFOdW1iZXIuaXNGaW5pdGUocGFydCkpKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgW3IsIGcsIGJdID0gcGFydHM7DQogICAgICAgICAgICByZXR1cm4gcmdiVG9IZXgoTWF0aC5yb3VuZChyKSwgTWF0aC5yb3VuZChnKSwgTWF0aC5yb3VuZChiKSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gaGV4VG9SZ2JhKGhleCwgYWxwaGEpIHsNCiAgICAgICAgICAgIGNvbnN0IHJnYiA9IGhleFRvUmdiKGhleCk7DQogICAgICAgICAgICBpZiAoIXJnYikgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGNsYW1wZWQgPSBNYXRoLm1pbihNYXRoLm1heChhbHBoYSwgMCksIDEpOw0KICAgICAgICAgICAgcmV0dXJuIGByZ2JhKCR7cmdiLnJ9LCAke3JnYi5nfSwgJHtyZ2IuYn0sICR7Y2xhbXBlZH0pYDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBidWlsZEdyYWRpZW50Q29sb3JzKGNvdW50LCBzdGFydEhleCwgZW5kSGV4KSB7DQogICAgICAgICAgICBjb25zdCBzdGFydCA9IGhleFRvUmdiKHN0YXJ0SGV4KTsNCiAgICAgICAgICAgIGNvbnN0IGVuZCA9IGhleFRvUmdiKGVuZEhleCk7DQogICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQgfHwgY291bnQgPD0gMCkgew0KICAgICAgICAgICAgICByZXR1cm4gW107DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY291bnQgPT09IDEpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFtyZ2JUb0hleChzdGFydC5yLCBzdGFydC5nLCBzdGFydC5iKV07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBbXTsNCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjb3VudDsgaW5kZXggKz0gMSkgew0KICAgICAgICAgICAgICBjb25zdCB0ID0gaW5kZXggLyAoY291bnQgLSAxKTsNCiAgICAgICAgICAgICAgY29uc3QgciA9IE1hdGgucm91bmQoc3RhcnQuciArIChlbmQuciAtIHN0YXJ0LnIpICogdCk7DQogICAgICAgICAgICAgIGNvbnN0IGcgPSBNYXRoLnJvdW5kKHN0YXJ0LmcgKyAoZW5kLmcgLSBzdGFydC5nKSAqIHQpOw0KICAgICAgICAgICAgICBjb25zdCBiID0gTWF0aC5yb3VuZChzdGFydC5iICsgKGVuZC5iIC0gc3RhcnQuYikgKiB0KTsNCiAgICAgICAgICAgICAgY29sb3JzLnB1c2gocmdiVG9IZXgociwgZywgYikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGNvbG9yczsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBnZXRDc3NWYXJpYWJsZVZhbHVlKHZhcmlhYmxlTmFtZSwgZmFsbGJhY2sgPSAiIikgew0KICAgICAgICAgICAgaWYgKCF2YXJpYWJsZU5hbWUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbGxiYWNrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgY29uc3Qgc3R5bGVzID0gZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOw0KICAgICAgICAgICAgICBpZiAoIXN0eWxlcykgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxsYmFjazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHN0eWxlcy5nZXRQcm9wZXJ0eVZhbHVlKHZhcmlhYmxlTmFtZSk7DQogICAgICAgICAgICAgIGlmICghdmFsdWUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKTsNCiAgICAgICAgICAgICAgcmV0dXJuIHRyaW1tZWQgfHwgZmFsbGJhY2s7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdEVuYWJsZWRMaWNlbnNlc0NvbG9ycygpIHsNCiAgICAgICAgICAgIGNvbnN0IHByaW1hcnkgPSBjb2xvclN0cmluZ1RvSGV4KGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tZ3JlZW4tNjAwIiwgIiMwMDhBMDAiKSkgfHwgIiMwMDhBMDAiOw0KICAgICAgICAgICAgY29uc3Qgc2Vjb25kYXJ5ID0gY29sb3JTdHJpbmdUb0hleChnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyZWVuLTUwMCIsICIjMTNBNDU1IikpIHx8IHByaW1hcnk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICBzdGFydDogcHJpbWFyeSwNCiAgICAgICAgICAgICAgZW5kOiBzZWNvbmRhcnksDQogICAgICAgICAgICAgIGdyYWRpZW50OiBmYWxzZSwNCiAgICAgICAgICAgICAgaXNDdXN0b206IGZhbHNlDQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRoZW1lVG9nZ2xlVUkoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS50aGVtZVRvZ2dsZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBpc0RhcmsgPSBzdGF0ZS50aGVtZSA9PT0gImRhcmsiOw0KICAgICAgICAgICAgZG9tLnRoZW1lVG9nZ2xlLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgU3RyaW5nKGlzRGFyaykpOw0KICAgICAgICAgICAgZG9tLnRoZW1lVG9nZ2xlLnRleHRDb250ZW50ID0gaXNEYXJrID8gIkRpc2FibGUgZGFyayBtb2RlIiA6ICJFbmFibGUgZGFyayBtb2RlIjsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwZXJzaXN0VGhlbWVQcmVmZXJlbmNlKHRoZW1lKSB7DQogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVEhFTUVfU1RPUkFHRV9LRVksIHRoZW1lKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHN0b3JlIHRoZW1lIHByZWZlcmVuY2UiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gbG9hZFN0b3JlZFRoZW1lUHJlZmVyZW5jZSgpIHsNCiAgICAgICAgICAgIGlmICghd2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGNvbnN0IHN0b3JlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFRIRU1FX1NUT1JBR0VfS0VZKTsNCiAgICAgICAgICAgICAgaWYgKHN0b3JlZCA9PT0gImRhcmsiIHx8IHN0b3JlZCA9PT0gImxpZ2h0Iikgew0KICAgICAgICAgICAgICAgIHJldHVybiBzdG9yZWQ7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgc3RvcmVkIHRoZW1lIHByZWZlcmVuY2UiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBhcHBseVRoZW1lKHRoZW1lLCB7IHBlcnNpc3QgPSB0cnVlIH0gPSB7fSkgew0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IHRoZW1lID09PSAiZGFyayIgPyAiZGFyayIgOiAibGlnaHQiOw0KICAgICAgICAgICAgc3RhdGUudGhlbWUgPSBub3JtYWxpemVkOw0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKCJpcy1kYXJrIiwgbm9ybWFsaXplZCA9PT0gImRhcmsiKTsNCiAgICAgICAgICAgIHVwZGF0ZVRoZW1lVG9nZ2xlVUkoKTsNCiAgICAgICAgICAgIGFwcGx5Q2hhcnRUaGVtZVN0eWxlcygpOw0KICAgICAgICAgICAgcmVmcmVzaFRyZW5kQ29sb3JzKCk7DQogICAgICAgICAgICBpZiAocGVyc2lzdCkgew0KICAgICAgICAgICAgICBwZXJzaXN0VGhlbWVQcmVmZXJlbmNlKG5vcm1hbGl6ZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoIShzdGF0ZS5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uIGluc3RhbmNlb2YgU2V0KSkgew0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jYXRlZ29yeVNlbGVjdGlvbiA9IG5ldyBTZXQoZGVmYXVsdENhdGVnb3J5U2VsZWN0aW9uKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBjb25zdCB0b2dnbGVUb0NhdGVnb3J5TWFwID0gewogICAgICAgICAgICBtZWV0aW5nczogIm1lZXRpbmdzIiwKICAgICAgICAgICAgZW1haWxzOiAiZW1haWxzIiwKICAgICAgICAgICAgY2hhdHM6ICJjaGF0cyIsCiAgICAgICAgICAgIGRvY3VtZW50czogImRvY3VtZW50cyIsCiAgICAgICAgICAgICJjb3BpbG90LWNoYXQtd29yayI6ICJjb3BpbG90LWNoYXQiLAogICAgICAgICAgICAiY29waWxvdC1jaGF0LXdlYiI6ICJjb3BpbG90LWNoYXQiCiAgICAgICAgICB9OwoKICAgICAgICAgIGNvbnN0IGNhcGFiaWxpdHlGaWVsZE1hcCA9IHsKICAgICAgICAgICAgbWVldGluZ3M6IFsKICAgICAgICAgICAgICAibWVldGluZ1JlY2FwIiwKICAgICAgICAgICAgICAibWVldGluZ1N1bW1hcmllc1RvdGFsIiwKICAgICAgICAgICAgICAibWVldGluZ1N1bW1hcmllc0FjdGlvbnMiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGVtYWlsczogWwogICAgICAgICAgICAgICJlbWFpbERyYWZ0cyIsCiAgICAgICAgICAgICAgImVtYWlsU3VtbWFyaWVzIiwKICAgICAgICAgICAgICAiZW1haWxDb2FjaGluZyIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgY2hhdHM6IFsKICAgICAgICAgICAgICAidGVhbXNBY3Rpb25zIiwKICAgICAgICAgICAgICAiY2hhdENvbXBvc2UiLAogICAgICAgICAgICAgICJjaGF0U3VtbWFyaWVzIiwKICAgICAgICAgICAgICAiY2hhdENvbnZlcnNhdGlvbnMiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGRvY3VtZW50czogWwogICAgICAgICAgICAgICJ3b3JkQWN0aW9ucyIsCiAgICAgICAgICAgICAgImRvY3VtZW50U3VtbWFyaWVzIiwKICAgICAgICAgICAgICAicHJlc2VudGF0aW9uQ3JlYXRlZCIsCiAgICAgICAgICAgICAgImV4Y2VsQW5hbHlzaXMiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJjb3BpbG90LWNoYXQtd29yayI6IFsKICAgICAgICAgICAgICAiY2hhdFByb21wdHNXb3JrIiwKICAgICAgICAgICAgICAiY2hhdFByb21wdHNUZWFtcyIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNvcGlsb3QtY2hhdC13ZWIiOiBbCiAgICAgICAgICAgICAgImNoYXRQcm9tcHRzV2ViIgogICAgICAgICAgICBdCiAgICAgICAgICB9OwoKICAgICAgICAgIGNvbnN0IGhvdXJDYXRlZ29yeUtleXMgPSBPYmplY3Qua2V5cyhjYXRlZ29yeUhvdXJGaWVsZE1hcCk7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0Q2FwYWJpbGl0eUZpZWxkcyhpZCkgewogICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBjYXBhYmlsaXR5RmllbGRNYXBbaWRdOwogICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShmaWVsZHMpID8gZmllbGRzIDogW107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0QWN0aXZlQ2F0ZWdvcnlTZWxlY3Rpb24oKSB7CiAgICAgICAgICAgIGlmIChzdGF0ZS5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uIGluc3RhbmNlb2YgU2V0ICYmIHN0YXRlLmZpbHRlcnMuY2F0ZWdvcnlTZWxlY3Rpb24uc2l6ZSkgewogICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0Q2F0ZWdvcnlTZWxlY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2xvbmVBY3RpdmVDYXRlZ29yeVNlbGVjdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBTZXQoZ2V0QWN0aXZlQ2F0ZWdvcnlTZWxlY3Rpb24oKSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gYnVpbGRTZWxlY3Rpb25Db250ZXh0KHNlbGVjdGlvblNldCkgewogICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBzZWxlY3Rpb25TZXQgaW5zdGFuY2VvZiBTZXQgJiYgc2VsZWN0aW9uU2V0LnNpemUgPyBzZWxlY3Rpb25TZXQgOiBkZWZhdWx0Q2F0ZWdvcnlTZWxlY3Rpb247CiAgICAgICAgICAgIGNvbnN0IGhpZGRlblNlbGVjdGlvbiA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgZGVmYXVsdENhdGVnb3J5U2VsZWN0aW9uLmZvckVhY2goaWQgPT4gewogICAgICAgICAgICAgIGlmICghc2VsZWN0aW9uLmhhcyhpZCkpIHsKICAgICAgICAgICAgICAgIGhpZGRlblNlbGVjdGlvbi5hZGQoaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGhpZGRlbkNhcGFiaWxpdHlGaWVsZHMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIGNvbnN0IGhpZGRlbkhvdXJDYXRlZ29yaWVzID0gbmV3IFNldCgpOwoKICAgICAgICAgICAgc2VsZWN0aW9uLmZvckVhY2goaWQgPT4gewogICAgICAgICAgICAgIGNvbnN0IGJhc2VDYXRlZ29yeSA9IHRvZ2dsZVRvQ2F0ZWdvcnlNYXBbaWRdIHx8IGlkOwogICAgICAgICAgICAgIGlmIChiYXNlQ2F0ZWdvcnkpIHsKICAgICAgICAgICAgICAgIGNhdGVnb3JpZXMuYWRkKGJhc2VDYXRlZ29yeSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGhpZGRlblNlbGVjdGlvbi5mb3JFYWNoKGlkID0+IHsKICAgICAgICAgICAgICBjb25zdCBiYXNlQ2F0ZWdvcnkgPSB0b2dnbGVUb0NhdGVnb3J5TWFwW2lkXSB8fCBpZDsKICAgICAgICAgICAgICBpZiAoYmFzZUNhdGVnb3J5KSB7CiAgICAgICAgICAgICAgICBpZiAoaG91ckNhdGVnb3J5S2V5cy5pbmNsdWRlcyhiYXNlQ2F0ZWdvcnkpKSB7CiAgICAgICAgICAgICAgICAgIGhpZGRlbkhvdXJDYXRlZ29yaWVzLmFkZChiYXNlQ2F0ZWdvcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBnZXRDYXBhYmlsaXR5RmllbGRzKGlkKS5mb3JFYWNoKGZpZWxkID0+IGhpZGRlbkNhcGFiaWxpdHlGaWVsZHMuYWRkKGZpZWxkKSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBzZWxlY3Rpb24sCiAgICAgICAgICAgICAgY2F0ZWdvcmllcywKICAgICAgICAgICAgICBoaWRkZW5DYXBhYmlsaXR5RmllbGRzLAogICAgICAgICAgICAgIGhpZGRlbkhvdXJDYXRlZ29yaWVzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNDYXRlZ29yeVNlbGVjdGVkRm9yRGlzcGxheShrZXksIHNlbGVjdGlvblNldCkgewogICAgICAgICAgICBjb25zdCBzZXQgPSBzZWxlY3Rpb25TZXQgaW5zdGFuY2VvZiBTZXQgJiYgc2VsZWN0aW9uU2V0LnNpemUgPyBzZWxlY3Rpb25TZXQgOiBkZWZhdWx0Q2F0ZWdvcnlTZWxlY3Rpb247CiAgICAgICAgICAgIGlmIChrZXkgPT09ICJjb3BpbG90LWNoYXQiKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHNldC5oYXMoImNvcGlsb3QtY2hhdCIpIHx8IHNldC5oYXMoImNvcGlsb3QtY2hhdC13b3JrIikgfHwgc2V0LmhhcygiY29waWxvdC1jaGF0LXdlYiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzZXQuaGFzKGtleSk7CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGdldFVzYWdlVGhyZXNob2xkU3RhcnRzKCkgew0KICAgICAgICAgICAgY29uc3QgdGhyZXNob2xkcyA9IHN0YXRlLnVzYWdlVGhyZXNob2xkcyB8fCB7fTsNCiAgICAgICAgICAgIGxldCBtaWRkbGUgPSBOdW1iZXIuaXNGaW5pdGUodGhyZXNob2xkcy5taWRkbGUpID8gTWF0aC5yb3VuZCh0aHJlc2hvbGRzLm1pZGRsZSkgOiBERUZBVUxUX1VTQUdFX1RIUkVTSE9MRF9NSURETEU7DQogICAgICAgICAgICBsZXQgaGlnaCA9IE51bWJlci5pc0Zpbml0ZSh0aHJlc2hvbGRzLmhpZ2gpID8gTWF0aC5yb3VuZCh0aHJlc2hvbGRzLmhpZ2gpIDogREVGQVVMVF9VU0FHRV9USFJFU0hPTERfSElHSDsNCiAgICAgICAgICAgIG1pZGRsZSA9IE1hdGgubWF4KDIsIG1pZGRsZSk7DQogICAgICAgICAgICBoaWdoID0gTWF0aC5tYXgobWlkZGxlICsgMSwgaGlnaCk7DQogICAgICAgICAgICByZXR1cm4geyBtaWRkbGUsIGhpZ2ggfTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBmb3JtYXRVc2FnZUJ1Y2tldExhYmVsKG1pbiwgbWF4KSB7DQogICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRNaW4gPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KG1pbik7DQogICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShtYXgpIHx8IG1heCA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKSB7DQogICAgICAgICAgICAgIHJldHVybiBgJHtmb3JtYXR0ZWRNaW59KyBhY3Rpb25zYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZE1heCA9IG51bWJlckZvcm1hdHRlci5mb3JtYXQobWF4KTsNCiAgICAgICAgICAgIGlmIChtaW4gPT09IG1heCkgew0KICAgICAgICAgICAgICByZXR1cm4gYCR7Zm9ybWF0dGVkTWlufSBhY3Rpb24ke21pbiA9PT0gMSA/ICIiIDogInMifWA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYCR7Zm9ybWF0dGVkTWlufSB0byAke2Zvcm1hdHRlZE1heH0gYWN0aW9uc2A7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gYnVpbGRVc2FnZUZyZXF1ZW5jeUJ1Y2tldHMoKSB7DQogICAgICAgICAgICBjb25zdCB7IG1pZGRsZSwgaGlnaCB9ID0gZ2V0VXNhZ2VUaHJlc2hvbGRTdGFydHMoKTsNCiAgICAgICAgICAgIGNvbnN0IGxvd01pbiA9IDE7DQogICAgICAgICAgICBjb25zdCBsb3dNYXggPSBNYXRoLm1heChsb3dNaW4sIG1pZGRsZSAtIDEpOw0KICAgICAgICAgICAgY29uc3QgbWlkTWluID0gbWlkZGxlOw0KICAgICAgICAgICAgY29uc3QgbWlkTWF4ID0gTWF0aC5tYXgobWlkTWluLCBoaWdoIC0gMSk7DQogICAgICAgICAgICBjb25zdCBoaWdoTWluID0gaGlnaDsNCiAgICAgICAgICAgIHJldHVybiBbDQogICAgICAgICAgICAgIHsgaWQ6ICJsb3ciLCBtaW46IGxvd01pbiwgbWF4OiBsb3dNYXgsIGxhYmVsOiBmb3JtYXRVc2FnZUJ1Y2tldExhYmVsKGxvd01pbiwgbG93TWF4KSB9LA0KICAgICAgICAgICAgICB7IGlkOiAibWlkIiwgbWluOiBtaWRNaW4sIG1heDogbWlkTWF4LCBsYWJlbDogZm9ybWF0VXNhZ2VCdWNrZXRMYWJlbChtaWRNaW4sIG1pZE1heCkgfSwNCiAgICAgICAgICAgICAgeyBpZDogImhpZ2giLCBtaW46IGhpZ2hNaW4sIG1heDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBsYWJlbDogZm9ybWF0VXNhZ2VCdWNrZXRMYWJlbChoaWdoTWluLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpIH0NCiAgICAgICAgICAgIF07DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplVXNhZ2VUaHJlc2hvbGRJbnB1dHMobWlkZGxlSW5wdXQsIGhpZ2hJbnB1dCkgew0KICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IGdldFVzYWdlVGhyZXNob2xkU3RhcnRzKCk7DQogICAgICAgICAgICBsZXQgbWlkZGxlID0gTnVtYmVyLnBhcnNlRmxvYXQobWlkZGxlSW5wdXQpOw0KICAgICAgICAgICAgbGV0IGhpZ2ggPSBOdW1iZXIucGFyc2VGbG9hdChoaWdoSW5wdXQpOw0KICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUobWlkZGxlKSkgew0KICAgICAgICAgICAgICBtaWRkbGUgPSBjdXJyZW50Lm1pZGRsZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKGhpZ2gpKSB7DQogICAgICAgICAgICAgIGhpZ2ggPSBjdXJyZW50LmhpZ2g7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtaWRkbGUgPSBNYXRoLm1heCgyLCBNYXRoLnJvdW5kKG1pZGRsZSkpOw0KICAgICAgICAgICAgaGlnaCA9IE1hdGgubWF4KG1pZGRsZSArIDEsIE1hdGgucm91bmQoaGlnaCkpOw0KICAgICAgICAgICAgcmV0dXJuIHsgbWlkZGxlLCBoaWdoIH07DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICANCiAgICAgICAgICBjb25zdCBzZXJpZXNUb2dnbGVCdXR0b25zID0gbmV3IE1hcCgpOw0KICAgICAgICAgIGNoYXJ0U2VyaWVzRGVmaW5pdGlvbnMuZm9yRWFjaChkZWYgPT4gew0KICAgICAgICAgICAgaWYgKGRlZi50b2dnbGFibGUpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2VyaWVzVmlzaWJpbGl0eVtkZWYuaWRdID0gZGVmLmRlZmF1bHRWaXNpYmxlICE9PSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGRvbSA9IHsNCiAgICAgICAgICAgIGRyb3Bab25lOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1kcm9wLXpvbmVdIiksDQogICAgICAgICAgICBmaWxlSW5wdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWZpbGUtaW5wdXRdIiksDQogICAgICAgICAgICB1cGxvYWRNZXRhOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11cGxvYWQtbWV0YV0iKSwNCiAgICAgICAgICAgIHVwbG9hZFN0YXR1czogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXBsb2FkLXN0YXR1c10iKSwNCiAgICAgICAgICAgIHVwbG9hZFByb2dyZXNzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11cGxvYWQtcHJvZ3Jlc3NdIiksDQogICAgICAgICAgICB1cGxvYWRQcm9ncmVzc0JhcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXBsb2FkLXByb2dyZXNzLWJhcl0iKSwNCiAgICAgICAgICAgIHVwbG9hZENhbmNlbDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXBsb2FkLWNhbmNlbF0iKSwNCiAgICAgICAgICAgIGRhdGFzZXRNZXNzYWdlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1kYXRhc2V0LW1lc3NhZ2VdIiksDQogICAgICAgICAgICBkYXRhc2V0TWV0YVdyYXBwZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWRhdGFzZXQtbWV0YV0iKSwNCiAgICAgICAgICAgIG1ldGFSZWNvcmRzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1tZXRhLXJlY29yZHNdIiksDQogICAgICAgICAgICBtZXRhVXNlcnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLW1ldGEtdXNlcnNdIiksDQogICAgICAgICAgICBtZXRhUmFuZ2U6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLW1ldGEtcmFuZ2VdIiksDQogICAgICAgICAgICBtZXRhT3JnczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtbWV0YS1vcmdzXSIpLA0KICAgICAgICAgICAgdGhlbWVUb2dnbGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXRoZW1lLXRvZ2dsZV0iKSwNCiAgICAgICAgICAgIG9yZ2FuaXphdGlvbkZpbHRlcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZmlsdGVyLW9yZ2FuaXphdGlvbl0iKSwNCiAgICAgICAgICAgIGNvdW50cnlGaWx0ZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWZpbHRlci1jb3VudHJ5XSIpLA0KICAgICAgICAgICAgdGltZWZyYW1lRmlsdGVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1maWx0ZXItdGltZWZyYW1lXSIpLA0KICAgICAgICAgICAgY3VzdG9tUmFuZ2VDb250YWluZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWN1c3RvbS1yYW5nZV0iKSwNCiAgICAgICAgICAgIGN1c3RvbVJhbmdlU3RhcnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWZpbHRlci1jdXN0b20tc3RhcnRdIiksDQogICAgICAgICAgICBjdXN0b21SYW5nZUVuZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZmlsdGVyLWN1c3RvbS1lbmRdIiksDQogICAgICAgICAgICBjdXN0b21SYW5nZUhpbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWN1c3RvbS1yYW5nZS1oaW50XSIpLA0KICAgICAgICAgICAgYWdncmVnYXRlRmlsdGVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1maWx0ZXItYWdncmVnYXRlXSIpLA0KICAgICAgICAgICAgbWV0cmljRmlsdGVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1maWx0ZXItbWV0cmljXSIpLA0KICAgICAgICAgICAgZ3JvdXBGaWx0ZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWZpbHRlci1ncm91cF0iKSwNCiAgICAgICAgICAgIHN1bW1hcnlBY3Rpb25zOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdW1tYXJ5LWFjdGlvbnNdIiksDQogICAgICAgICAgICBzdW1tYXJ5QWN0aW9uc05vdGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXN1bW1hcnktYWN0aW9ucy1ub3RlXSIpLA0KICAgICAgICAgICAgc3VtbWFyeUhvdXJzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdW1tYXJ5LWhvdXJzXSIpLA0KICAgICAgICAgICAgc3VtbWFyeUhvdXJzTm90ZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc3VtbWFyeS1ob3Vycy1ub3RlXSIpLA0KICAgICAgICAgICAgc3VtbWFyeVVzZXJzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdW1tYXJ5LXVzZXJzXSIpLAogICAgICAgICAgICBzdW1tYXJ5VXNlcnNOb3RlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdW1tYXJ5LXVzZXJzLW5vdGVdIiksCiAgICAgICAgICAgIHN1bW1hcnlMYXRlc3Q6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXN1bW1hcnktbGF0ZXN0XSIpLAogICAgICAgICAgICBzdW1tYXJ5TGF0ZXN0UGVyaW9kOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdW1tYXJ5LWxhdGVzdC1wZXJpb2RdIiksCiAgICAgICAgICAgIHN1bW1hcnlMYXRlc3RNZXRyaWM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXN1bW1hcnktbGF0ZXN0LW1ldHJpY10iKSwKICAgICAgICAgICAgc3VtbWFyeUxhdGVzdE5vdGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXN1bW1hcnktbGF0ZXN0LW5vdGVdIiksCiAgICAgICAgICAgIHRyZW5kQ2FwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdHJlbmQtY2FwdGlvbl0iKSwKICAgICAgICAgICAgdHJlbmRXaW5kb3c6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXRyZW5kLXdpbmRvd10iKSwNCiAgICAgICAgICAgIHRyZW5kRW1wdHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXRyZW5kLWVtcHR5XSIpLA0KICAgICAgICAgICAgc2VyaWVzTW9kZVRvZ2dsZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdG9nZ2xlLXNlcmllcy1tb2RlXSIpLA0KICAgICAgICAgICAgc2VyaWVzVG9nZ2xlR3JvdXA6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNlcmllcy10b2dnbGUtZ3JvdXBdIiksDQogICAgICAgICAgICB0cmVuZFZpZXdCdXR0b25zOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS10cmVuZC12aWV3XSIpLA0KICAgICAgICAgICAgc2VyaWVzSGludDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc2VyaWVzLWhpbnRdIiksDQogICAgICAgICAgICBleHBvcnRDb250cm9sczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZXhwb3J0LWNvbnRyb2xzXSIpLA0KICAgICAgICAgICAgZXhwb3J0VHJpZ2dlcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZXhwb3J0LXRyaWdnZXJdIiksDQogICAgICAgICAgICBleHBvcnRNZW51OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1leHBvcnQtbWVudV0iKSwKICAgICAgICAgICAgZXhwb3J0UERGOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1leHBvcnQtcGRmXSIpLAogICAgICAgICAgICBleHBvcnRQTkc6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWV4cG9ydC1wbmddIiksCiAgICAgICAgICAgIGV4cG9ydFZpZGVvOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1leHBvcnQtdmlkZW9dIiksCiAgICAgICAgICAgIGV4cG9ydEV4Y2VsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1leHBvcnQtZXhjZWxdIiksCiAgICAgICAgICAgIGV4cG9ydEV4Y2VsRnVsbDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZXhwb3J0LWV4Y2VsLWZ1bGxdIiksCiAgICAgICAgICAgIGV4cG9ydEhpbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWV4cG9ydC1oaW50XSIpLA0KICAgICAgICAgICAgZXhwb3J0SW5jbHVkZURldGFpbHM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWV4cG9ydC1pbmNsdWRlLWRldGFpbHNdIiksDQogICAgICAgICAgICBleHBvcnRJbmNsdWRlRGV0YWlsc1dyYXBwZXI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWV4cG9ydC1pbmNsdWRlLWRldGFpbHMtd3JhcHBlcl0iKSwNCiAgICAgICAgICAgIHRyZW5kQ29sb3JDb250cm9sczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdHJlbmQtY29sb3JzXSIpLA0KICAgICAgICAgICAgdHJlbmRDb2xvclN0YXJ0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS10cmVuZC1jb2xvci1zdGFydF0iKSwNCiAgICAgICAgICAgIHRyZW5kQ29sb3JFbmQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXRyZW5kLWNvbG9yLWVuZF0iKSwNCiAgICAgICAgICAgIGFwcGx5VHJlbmRDb2xvcnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFwcGx5LXRyZW5kLWNvbG9yc10iKSwNCiAgICAgICAgICAgIHJlc2V0VHJlbmRDb2xvcnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXJlc2V0LXRyZW5kLWNvbG9yc10iKSwNCiAgICAgICAgICAgIHRyZW5kQ29sb3JIaW50OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS10cmVuZC1jb2xvci1oaW50XSIpLA0KICAgICAgICAgICAgc3RvcmFnZUNvbnRyb2xzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zdG9yYWdlLWNvbnRyb2xzXSIpLA0KICAgICAgICAgICAgc3RvcmFnZUhpbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXN0b3JhZ2UtaGludF0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90Q29udHJvbHM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWNvbnRyb2xzXSIpLA0KICAgICAgICAgICAgc25hcHNob3RTYXZlQnV0dG9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1zYXZlXSIpLA0KICAgICAgICAgICAgc25hcHNob3RMb2FkQnV0dG9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1sb2FkXSIpLA0KICAgICAgICAgICAgc25hcHNob3RIaW50OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1oaW50XSIpLA0KICAgICAgICAgICAgc25hcHNob3RFeHBvcnREaWFsb2c6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWV4cG9ydC1kaWFsb2ddIiksDQogICAgICAgICAgICBzbmFwc2hvdEV4cG9ydEZvcm06IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWV4cG9ydC1mb3JtXSIpLA0KICAgICAgICAgICAgc25hcHNob3RQYXNzd29yZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtcGFzc3dvcmRdIiksDQogICAgICAgICAgICBzbmFwc2hvdFBhc3N3b3JkQ29uZmlybTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtcGFzc3dvcmQtY29uZmlybV0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90RXJyb3I6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWVycm9yXSIpLA0KICAgICAgICAgICAgc25hcHNob3RPdXRwdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LW91dHB1dF0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90T3V0cHV0VGV4dDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3Qtb3V0cHV0LXRleHRdIiksDQogICAgICAgICAgICBzbmFwc2hvdENvcHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWNvcHldIiksDQogICAgICAgICAgICBzbmFwc2hvdERvd25sb2FkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1kb3dubG9hZF0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90Q2FuY2VsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1jYW5jZWxdIiksDQogICAgICAgICAgICBzbmFwc2hvdEdlbmVyYXRlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1nZW5lcmF0ZV0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90SW1wb3J0RGlhbG9nOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1pbXBvcnQtZGlhbG9nXSIpLA0KICAgICAgICAgICAgc25hcHNob3RJbXBvcnRGb3JtOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zbmFwc2hvdC1pbXBvcnQtZm9ybV0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90SW1wb3J0VGV4dDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtaW1wb3J0LXRleHRdIiksDQogICAgICAgICAgICBzbmFwc2hvdEltcG9ydEZpbGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWltcG9ydC1maWxlXSIpLA0KICAgICAgICAgICAgc25hcHNob3RJbXBvcnRQYXNzd29yZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtaW1wb3J0LXBhc3N3b3JkXSIpLA0KICAgICAgICAgICAgc25hcHNob3RJbXBvcnRFcnJvcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtaW1wb3J0LWVycm9yXSIpLA0KICAgICAgICAgICAgc25hcHNob3RJbXBvcnRDYW5jZWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXNuYXBzaG90LWltcG9ydC1jYW5jZWxdIiksDQogICAgICAgICAgICBzbmFwc2hvdEltcG9ydFN1Ym1pdDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtaW1wb3J0LXN1Ym1pdF0iKSwNCiAgICAgICAgICAgIHNuYXBzaG90RXhwb3J0SHRtbDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtc25hcHNob3QtZXhwb3J0LWh0bWxdIiksDQogICAgICAgICAgICBjbGVhclN0b3JlZERhdGFzZXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWNsZWFyLXN0b3JhZ2VdIiksDQogICAgICAgICAgICBwZXJzaXN0Q29uc2VudDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtY29uc2VudC1wZXJzaXN0XSIpLA0KICAgICAgICAgICAgbG9hZFNhbXBsZUJ1dHRvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtbG9hZC1zYW1wbGVdIiksDQogICAgICAgICAgICBkaW1lbnNpb25DYXJkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1kaW1lbnNpb24tY2FyZF0iKSwNCiAgICAgICAgICAgIGRpbWVuc2lvbkNhcHRpb246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWRpbWVuc2lvbi1jYXB0aW9uXSIpLA0KICAgICAgICAgICAgZGltZW5zaW9uU2VsZWN0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1kaW1lbnNpb24tc2VsZWN0XSIpLA0KICAgICAgICAgICAgZGltZW5zaW9uVHlwZUJ1dHRvbnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWRpbWVuc2lvbi10eXBlLWJ1dHRvbl0iKSwNCiAgICAgICAgICAgIGRpbWVuc2lvbk1ldHJpY0J1dHRvbnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWRpbWVuc2lvbi1tZXRyaWMtYnV0dG9uXSIpLA0KICAgICAgICAgICAgZGltZW5zaW9uQ2hhcnRDYW52YXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWRpbWVuc2lvbi1jaGFydF0iKSwNCiAgICAgICAgICAgIGRpbWVuc2lvbkVtcHR5OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1kaW1lbnNpb24tZW1wdHldIiksDQogICAgICAgICAgICBkaW1lbnNpb25TdW1tYXJ5Qm9keTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZGltZW5zaW9uLXN1bW1hcnldIiksDQogICAgICAgICAgICBncm91cENhcHRpb246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWdyb3VwLWNhcHRpb25dIiksDQogICAgICAgICAgICBncm91cEJvZHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWdyb3VwLWJvZHldIiksDQogICAgICAgICAgICB2aWV3TW9yZUJ1dHRvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdmlldy1tb3JlXSIpLA0KICAgICAgICAgICAgdG9wVXNlcnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXRvcC11c2Vyc10iKSwNCiAgICAgICAgICAgIHRvcFVzZXJzVG9nZ2xlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS10b3AtdXNlcnMtdG9nZ2xlXSIpLA0KICAgICAgICAgICAgYWRvcHRpb25DYXJkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZG9wdGlvbi1jYXJkXSIpLA0KICAgICAgICAgICAgYWRvcHRpb25DYXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZG9wdGlvbi1jYXB0aW9uXSIpLA0KICAgICAgICAgICAgYWRvcHRpb25UYWJsZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWRvcHRpb24tdGFibGVdIiksDQogICAgICAgICAgICBhZG9wdGlvbkJvZHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFkb3B0aW9uLWJvZHldIiksDQogICAgICAgICAgICBhZG9wdGlvbkVtcHR5OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZG9wdGlvbi1lbXB0eV0iKSwNCiAgICAgICAgICAgIGFkb3B0aW9uVG90YWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFkb3B0aW9uLXRvdGFsXSIpLA0KICAgICAgICAgICAgYWRvcHRpb25Ub2dnbGU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFkb3B0aW9uLXRvZ2dsZV0iKSwNCiAgICAgICAgICAgIGFkb3B0aW9uRXhwb3J0Q3N2OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZG9wdGlvbi1leHBvcnQtY3N2XSIpLA0KICAgICAgICAgICAgdXNhZ2VDYXJkOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS1jYXJkXSIpLA0KICAgICAgICAgICAgdXNhZ2VDYXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS1jYXB0aW9uXSIpLA0KICAgICAgICAgICAgdXNhZ2VXaW5kb3c6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXVzYWdlLXdpbmRvd10iKSwNCiAgICAgICAgICAgIHVzYWdlVGhyZXNob2xkTWlkZGxlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS10aHJlc2hvbGQtbWlkZGxlXSIpLA0KICAgICAgICAgICAgdXNhZ2VUaHJlc2hvbGRIaWdoOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS10aHJlc2hvbGQtaGlnaF0iKSwNCiAgICAgICAgICAgIHVzYWdlTW9udGhDb250cm9sczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXNhZ2UtbW9udGgtY29udHJvbHNdIiksDQogICAgICAgICAgICB1c2FnZU1vbnRoR3JpZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXNhZ2UtbW9udGgtZ3JpZF0iKSwNCiAgICAgICAgICAgIHVzYWdlRW1wdHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXVzYWdlLWVtcHR5XSIpLA0KICAgICAgICAgICAgdXNhZ2VJbnRlbnNpdHlFeHBvcnRDc3Y6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXVzYWdlLWludGVuc2l0eS1leHBvcnQtY3N2XSIpLA0KICAgICAgICAgICAgdXNhZ2VUcmVuZENhcmQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXVzYWdlLXRyZW5kLWNhcmRdIiksDQogICAgICAgICAgICB1c2FnZVRyZW5kQ2FwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXNhZ2UtdHJlbmQtY2FwdGlvbl0iKSwNCiAgICAgICAgICAgIHVzYWdlVHJlbmRUb2dnbGVCdXR0b25zOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS11c2FnZS10cmVuZC1tb2RlXSIpLA0KICAgICAgICAgICAgdXNhZ2VUcmVuZEVtcHR5OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS10cmVuZC1lbXB0eV0iKSwNCiAgICAgICAgICAgIHVzYWdlVHJlbmRDYW52YXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXVzYWdlLXRyZW5kLWNoYXJ0XSIpLA0KICAgICAgICAgICAgdXNhZ2VUcmVuZFJlZ2lvbkNvbnRyb2xzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS10cmVuZC1yZWdpb24tY29udHJvbHNdIiksDQogICAgICAgICAgICB1c2FnZVRyZW5kRXhwb3J0UG5nOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS11c2FnZS1leHBvcnQtcG5nXSIpLA0KICAgICAgICAgICAgdXNhZ2VUcmVuZEV4cG9ydENzdjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtdXNhZ2UtZXhwb3J0LWNzdl0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0NhcmQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtY2FyZF0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0NhcHRpb246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtY2FwdGlvbl0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0NhbnZhczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1jaGFydF0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0VtcHR5OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWVtcHR5XSIpLA0KICAgICAgICAgICAgZW5hYmxlZExpY2Vuc2VzRXhwb3J0Q29udHJvbHM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtZXhwb3J0LWNvbnRyb2xzXSIpLA0KICAgICAgICAgICAgZW5hYmxlZExpY2Vuc2VzRXhwb3J0VHJpZ2dlcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtdHJpZ2dlcl0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtZXhwb3J0LW1lbnVdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNFeHBvcnRUcmFuc3BhcmVudDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtdHJhbnNwYXJlbnRdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNFeHBvcnRXaGl0ZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtd2hpdGVdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNFeHBvcnROb1ZhbHVlczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtbm8tdmFsdWVzXSIpLA0KICAgICAgICAgICAgZW5hYmxlZExpY2Vuc2VzQ29sb3JDb250cm9sczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9sc10iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhcnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtY29sb3Itc3RhcnRdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNDb2xvckVuZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1jb2xvci1lbmRdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNHcmFkaWVudFRvZ2dsZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtZW5hYmxlZC1saWNlbnNlcy1ncmFkaWVudF0iKSwNCiAgICAgICAgICAgIGVuYWJsZWRMaWNlbnNlc0FwcGx5OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWFwcGx5XSIpLA0KICAgICAgICAgICAgZW5hYmxlZExpY2Vuc2VzUmVzZXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWVuYWJsZWQtbGljZW5zZXMtcmVzZXRdIiksDQogICAgICAgICAgICBlbmFibGVkTGljZW5zZXNTaG93VmFsdWVzOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1lbmFibGVkLWxpY2Vuc2VzLXNob3ctdmFsdWVzXSIpLA0KICAgICAgICAgICAgcmV0dXJuaW5nQ2FyZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtcmV0dXJuaW5nLWNhcmRdIiksDQogICAgICAgICAgICByZXR1cm5pbmdDYXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1yZXR1cm5pbmctY2FwdGlvbl0iKSwNCiAgICAgICAgICAgIHJldHVybmluZ01ldHJpY0J1dHRvbnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXJldHVybmluZy1tZXRyaWMtYnV0dG9uXSIpLA0KICAgICAgICAgICAgcmV0dXJuaW5nSW50ZXJ2YWxCdXR0b25zOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1yZXR1cm5pbmctaW50ZXJ2YWxdIiksDQogICAgICAgICAgICByZXR1cm5pbmdFbXB0eTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtcmV0dXJuaW5nLWVtcHR5XSIpLA0KICAgICAgICAgICAgcmV0dXJuaW5nU3VtbWFyeTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtcmV0dXJuaW5nLXN1bW1hcnldIiksDQogICAgICAgICAgICByZXR1cm5pbmdSZWdpb25Db250cm9sczogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtcmV0dXJuaW5nLXJlZ2lvbi1jb250cm9sc10iKSwKICAgICAgICAgICAgcmV0dXJuaW5nRXhwb3J0UG5nOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1yZXR1cm5pbmctZXhwb3J0LXBuZ10iKSwKICAgICAgICAgICAgcmV0dXJuaW5nRXhwb3J0Q3N2OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1yZXR1cm5pbmctZXhwb3J0LWNzdl0iKSwKICAgICAgICAgICAgYWN0aXZlRGF5c0NhcmQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFjdGl2ZS1kYXlzLWNhcmRdIiksCiAgICAgICAgICAgIGFjdGl2ZURheXNDYXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hY3RpdmUtZGF5cy1jYXB0aW9uXSIpLAogICAgICAgICAgICBhY3RpdmVEYXlzR3JpZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWN0aXZlLWRheXMtZ3JpZF0iKSwKICAgICAgICAgICAgYWN0aXZlRGF5c1RvZ2dsZUJ1dHRvbnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWFjdGl2ZS1kYXlzLXZpZXddIiksCiAgICAgICAgICAgIGFnZW50SHViQ29udGFpbmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZ2VudC1odWJdIiksCiAgICAgICAgICAgIGFnZW50SHViUmVzZXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFnZW50LXJlc2V0XSIpLAogICAgICAgICAgICBhZ2VudEh1YlRhYnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFnZW50LXRhYnNdIiksCiAgICAgICAgICAgIGFnZW50SHViVGFiQnV0dG9uczogZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtYWdlbnQtdGFiXSIpLAogICAgICAgICAgICBhZ2VudEh1YlBhbmVsczogZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtYWdlbnQtcGFuZWxdIiksCiAgICAgICAgICAgIGFnZW50Q2FyZDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWdlbnQtY2FyZF0iKSwKICAgICAgICAgICAgYWdlbnRDYXB0aW9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZ2VudC1jYXB0aW9uXSIpLAogICAgICAgICAgICBhZ2VudFN0YXR1czogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWdlbnQtc3RhdHVzXSIpLAogICAgICAgICAgICBhZ2VudFRhYmxlV3JhcHBlcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWdlbnQtdGFibGUtd3JhcHBlcl0iKSwKICAgICAgICAgICAgYWdlbnRUYWJsZUJvZHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFnZW50LXRhYmxlLWJvZHldIiksCiAgICAgICAgICAgIGFnZW50RW1wdHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFnZW50LWVtcHR5XSIpLA0KICAgICAgICAgICAgYWdlbnRVcGxvYWRCdXR0b246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLWFnZW50LXVwbG9hZF0iKSwNCiAgICAgICAgICAgIGFnZW50RmlsZUlucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZ2VudC1maWxlLWlucHV0XSIpLA0KICAgICAgICAgICAgYWdlbnRWaWV3VG9nZ2xlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1hZ2VudC12aWV3LXRvZ2dsZV0iKSwNCiAgICAgICAgICAgIGFnZW50Vmlld0FsbDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiW2RhdGEtYWdlbnQtdmlldy1hbGxdIiksCiAgICAgICAgICAgIGFnZW50U29ydEJ1dHRvbnM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWFnZW50LXNvcnRdIiksCiAgICAgICAgICByZXNldEZpbHRlcnNCdXR0b246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIltkYXRhLXJlc2V0LWZpbHRlcnNdIiksCiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgYWdlbnRIdWJTZWN0aW9ucyA9IHt9OwogICAgICAgIEFHRU5UX0hVQl9UWVBFUy5mb3JFYWNoKHR5cGUgPT4gewogICAgICAgICAgY29uc3Qgc2VjdGlvbiA9IHsKICAgICAgICAgICAgZHJvcHpvbmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWFnZW50LWh1Yi1kcm9wem9uZT0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIHVwbG9hZEJ1dHRvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtYWdlbnQtaHViLXVwbG9hZD0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIGlucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1hZ2VudC1odWItaW5wdXQ9IiR7dHlwZX0iXWApLAogICAgICAgICAgICBzdGF0dXM6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWFnZW50LWh1Yi1zdGF0dXM9IiR7dHlwZX0iXWApLAogICAgICAgICAgICBtZXRhOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1hZ2VudC1odWItbWV0YT0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIHRhYmxlV3JhcHBlcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtYWdlbnQtaHViLXRhYmxlLXdyYXBwZXI9IiR7dHlwZX0iXWApLAogICAgICAgICAgICB0Ym9keTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtYWdlbnQtaHViLXRib2R5PSIke3R5cGV9Il1gKSwKICAgICAgICAgICAgZW1wdHk6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWFnZW50LWh1Yi1lbXB0eT0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIHBhbmVsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1hZ2VudC1wYW5lbD0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIGZpbHRlckJhcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtYWdlbnQtaHViLWZpbHRlci1iYXI9IiR7dHlwZX0iXWApLAogICAgICAgICAgICBmaWx0ZXJJbnB1dDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtYWdlbnQtaHViLWZpbHRlci1pbnB1dD0iJHt0eXBlfSJdYCksCiAgICAgICAgICAgIGZpbHRlckNsZWFyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1hZ2VudC1odWItZmlsdGVyLWNsZWFyPSIke3R5cGV9Il1gKSwKICAgICAgICAgICAgc29ydEJ1dHRvbnM6IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgW2RhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iJHt0eXBlfSJdYCkpCiAgICAgICAgICB9OwogICAgICAgICAgc2VjdGlvbi5kZWZhdWx0cyA9IHsKICAgICAgICAgICAgc3RhdHVzOiBzZWN0aW9uLnN0YXR1cyA/IHNlY3Rpb24uc3RhdHVzLnRleHRDb250ZW50IDogIiIsCiAgICAgICAgICAgIG1ldGE6IHNlY3Rpb24ubWV0YSA/IHNlY3Rpb24ubWV0YS50ZXh0Q29udGVudCA6ICIiLAogICAgICAgICAgICBlbXB0eTogc2VjdGlvbi5lbXB0eSA/IHNlY3Rpb24uZW1wdHkudGV4dENvbnRlbnQgOiAiIgogICAgICAgICAgfTsKICAgICAgICAgIGFnZW50SHViU2VjdGlvbnNbdHlwZV0gPSBzZWN0aW9uOwogICAgICAgIH0pOwoNCiAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20ucmV0dXJuaW5nRXhwb3J0UG5nLCBmYWxzZSk7DQogICAgICAgIHNldEJ1dHRvbkVuYWJsZWQoZG9tLnJldHVybmluZ0V4cG9ydENzdiwgZmFsc2UpOw0KICAgICAgICBzZXRCdXR0b25FbmFibGVkKGRvbS51c2FnZVRyZW5kRXhwb3J0UG5nLCBmYWxzZSk7DQogICAgICAgIHNldEJ1dHRvbkVuYWJsZWQoZG9tLnVzYWdlVHJlbmRFeHBvcnRDc3YsIGZhbHNlKTsNCiAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20udXNhZ2VJbnRlbnNpdHlFeHBvcnRDc3YsIGZhbHNlKTsNCiAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20uYWRvcHRpb25FeHBvcnRDc3YsIGZhbHNlKTsNCiAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20uc25hcHNob3RFeHBvcnRIdG1sLCBmYWxzZSk7DQoNCiAgICAgICAgY29uc3QgZmlsdGVyVG9nZ2xlVXBkYXRlcnMgPSBbDQogICAgICAgICAgc2V0dXBGaWx0ZXJUb2dnbGVHcm91cChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1maWx0ZXItdGltZWZyYW1lLWJ1dHRvbl0iKSwgZG9tLnRpbWVmcmFtZUZpbHRlciwgImZpbHRlclRpbWVmcmFtZUJ1dHRvbiIpLA0KICAgICAgICAgIHNldHVwRmlsdGVyVG9nZ2xlR3JvdXAoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtZmlsdGVyLWFnZ3JlZ2F0ZS1idXR0b25dIiksIGRvbS5hZ2dyZWdhdGVGaWx0ZXIsICJmaWx0ZXJBZ2dyZWdhdGVCdXR0b24iKSwNCiAgICAgICAgICBzZXR1cEZpbHRlclRvZ2dsZUdyb3VwKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLWZpbHRlci1tZXRyaWMtYnV0dG9uXSIpLCBkb20ubWV0cmljRmlsdGVyLCAiZmlsdGVyTWV0cmljQnV0dG9uIiksDQogICAgICAgICAgc2V0dXBGaWx0ZXJUb2dnbGVHcm91cChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1maWx0ZXItZ3JvdXAtYnV0dG9uXSIpLCBkb20uZ3JvdXBGaWx0ZXIsICJmaWx0ZXJHcm91cEJ1dHRvbiIpDQogICAgICAgIF0uZmlsdGVyKEJvb2xlYW4pOw0KDQogICAgICAgIHN5bmNNdWx0aVNlbGVjdChkb20ub3JnYW5pemF0aW9uRmlsdGVyLCBzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbik7DQogICAgICAgIHN5bmNNdWx0aVNlbGVjdChkb20uY291bnRyeUZpbHRlciwgc3RhdGUuZmlsdGVycy5jb3VudHJ5KTsNCg0KICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsNCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGVuc3VyZUVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhdGUoKSB7DQogICAgICAgICAgICBpZiAoIXN0YXRlLmVuYWJsZWRMaWNlbnNlc0NvbG9ycykgew0KICAgICAgICAgICAgICBzdGF0ZS5lbmFibGVkTGljZW5zZXNDb2xvcnMgPSBnZXREZWZhdWx0RW5hYmxlZExpY2Vuc2VzQ29sb3JzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gc3RhdGUuZW5hYmxlZExpY2Vuc2VzQ29sb3JzOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVFbmFibGVkTGljZW5zZXNDb2xvclN0YXRlKCkgew0KICAgICAgICAgICAgY29uc3QgZGVmYXVsdHMgPSBnZXREZWZhdWx0RW5hYmxlZExpY2Vuc2VzQ29sb3JzKCk7DQogICAgICAgICAgICBjb25zdCBzdG9yZWQgPSBlbnN1cmVFbmFibGVkTGljZW5zZXNDb2xvclN0YXRlKCk7DQogICAgICAgICAgICBjb25zdCBzdGFydCA9IHNhbml0aXplSGV4Q29sb3Ioc3RvcmVkLnN0YXJ0KSB8fCBkZWZhdWx0cy5zdGFydDsNCiAgICAgICAgICAgIGNvbnN0IHJhd0VuZCA9IHNhbml0aXplSGV4Q29sb3Ioc3RvcmVkLmVuZCkgfHwgZGVmYXVsdHMuZW5kOw0KICAgICAgICAgICAgY29uc3QgZ3JhZGllbnQgPSBCb29sZWFuKHN0b3JlZC5ncmFkaWVudCk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICBzdGFydCwNCiAgICAgICAgICAgICAgZW5kOiBncmFkaWVudCA/IHJhd0VuZCA6IHN0YXJ0LA0KICAgICAgICAgICAgICByYXdFbmQsDQogICAgICAgICAgICAgIGdyYWRpZW50LA0KICAgICAgICAgICAgICBpc0N1c3RvbTogQm9vbGVhbihzdG9yZWQuaXNDdXN0b20pDQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGdldEVuYWJsZWRMaWNlbnNlc0ZpbGwoY29udGV4dCkgew0KICAgICAgICAgICAgY29uc3QgY29sb3JzID0gcmVzb2x2ZUVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhdGUoKTsNCiAgICAgICAgICAgIGlmICghY29udGV4dCB8fCAhY29udGV4dC5jaGFydCB8fCAhY29udGV4dC5jaGFydC5jdHgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGhleFRvUmdiYShjb2xvcnMuc3RhcnQsIDAuOCkgfHwgY29sb3JzLnN0YXJ0Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgeyBjaGFydCB9ID0gY29udGV4dDsNCiAgICAgICAgICAgIGNvbnN0IGNoYXJ0QXJlYSA9IGNoYXJ0LmNoYXJ0QXJlYTsNCiAgICAgICAgICAgIGlmICghY2hhcnRBcmVhKSB7DQogICAgICAgICAgICAgIHJldHVybiBoZXhUb1JnYmEoY29sb3JzLnN0YXJ0LCAwLjgpIHx8IGNvbG9ycy5zdGFydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghY29sb3JzLmdyYWRpZW50KSB7DQogICAgICAgICAgICAgIGNoYXJ0LiRlbmFibGVkTGljZW5zZXNHcmFkaWVudCA9IG51bGw7DQogICAgICAgICAgICAgIHJldHVybiBoZXhUb1JnYmEoY29sb3JzLnN0YXJ0LCAwLjgpIHx8IGNvbG9ycy5zdGFydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoMSwgY2hhcnRBcmVhLnJpZ2h0IC0gY2hhcnRBcmVhLmxlZnQpOw0KICAgICAgICAgICAgY29uc3QgY2FjaGVLZXkgPSBgJHtjb2xvcnMuc3RhcnR9LSR7Y29sb3JzLnJhd0VuZH0tJHt3aWR0aH1gOw0KICAgICAgICAgICAgY29uc3QgY2FjaGVkID0gY2hhcnQuJGVuYWJsZWRMaWNlbnNlc0dyYWRpZW50Ow0KICAgICAgICAgICAgaWYgKGNhY2hlZCAmJiBjYWNoZWQua2V5ID09PSBjYWNoZUtleSkgew0KICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkLmdyYWRpZW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZ3JhZGllbnQgPSBjaGFydC5jdHguY3JlYXRlTGluZWFyR3JhZGllbnQoY2hhcnRBcmVhLmxlZnQsIGNoYXJ0QXJlYS50b3AsIGNoYXJ0QXJlYS5yaWdodCwgY2hhcnRBcmVhLnRvcCk7DQogICAgICAgICAgICBjb25zdCBzdGFydENvbG9yID0gaGV4VG9SZ2JhKGNvbG9ycy5zdGFydCwgMC45KSB8fCBjb2xvcnMuc3RhcnQ7DQogICAgICAgICAgICBjb25zdCBlbmRDb2xvciA9IGhleFRvUmdiYShjb2xvcnMucmF3RW5kLCAwLjkpIHx8IGNvbG9ycy5yYXdFbmQ7DQogICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCwgc3RhcnRDb2xvcik7DQogICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgZW5kQ29sb3IpOw0KICAgICAgICAgICAgY2hhcnQuJGVuYWJsZWRMaWNlbnNlc0dyYWRpZW50ID0geyBrZXk6IGNhY2hlS2V5LCBncmFkaWVudCB9Ow0KICAgICAgICAgICAgcmV0dXJuIGdyYWRpZW50Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGdldEVuYWJsZWRMaWNlbnNlc0JvcmRlckNvbG9yKCkgew0KICAgICAgICAgICAgY29uc3QgY29sb3JzID0gcmVzb2x2ZUVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhdGUoKTsNCiAgICAgICAgICAgIHJldHVybiBoZXhUb1JnYmEoY29sb3JzLnN0YXJ0LCAxKSB8fCBjb2xvcnMuc3RhcnQ7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gY2xlYXJFbmFibGVkTGljZW5zZXNHcmFkaWVudENhY2hlKCkgew0KICAgICAgICAgICAgaWYgKHN0YXRlLmNoYXJ0cy5lbmFibGVkTGljZW5zZXMpIHsNCiAgICAgICAgICAgICAgc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcy4kZW5hYmxlZExpY2Vuc2VzR3JhZGllbnQgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUVuYWJsZWRMaWNlbnNlc0NvbG9ySW5wdXRzKCkgew0KICAgICAgICAgICAgY29uc3QgY29sb3JzID0gcmVzb2x2ZUVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhdGUoKTsNCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzQ29sb3JTdGFydCkgew0KICAgICAgICAgICAgICBkb20uZW5hYmxlZExpY2Vuc2VzQ29sb3JTdGFydC52YWx1ZSA9IGNvbG9ycy5zdGFydDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzQ29sb3JFbmQpIHsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0NvbG9yRW5kLnZhbHVlID0gY29sb3JzLnJhd0VuZDsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0NvbG9yRW5kLmRpc2FibGVkID0gIWNvbG9ycy5ncmFkaWVudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzR3JhZGllbnRUb2dnbGUpIHsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0dyYWRpZW50VG9nZ2xlLmNoZWNrZWQgPSBjb2xvcnMuZ3JhZGllbnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLmVuYWJsZWRMaWNlbnNlc1Nob3dWYWx1ZXMpIHsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc1Nob3dWYWx1ZXMuY2hlY2tlZCA9IHN0YXRlLnNob3dFbmFibGVkTGljZW5zZUxhYmVscyAhPT0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gYXBwbHlFbmFibGVkTGljZW5zZXNDb2xvclNlbGVjdGlvbigpIHsNCiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRzID0gZ2V0RGVmYXVsdEVuYWJsZWRMaWNlbnNlc0NvbG9ycygpOw0KICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBzYW5pdGl6ZUhleENvbG9yKGRvbS5lbmFibGVkTGljZW5zZXNDb2xvclN0YXJ0Py52YWx1ZSkgfHwgZGVmYXVsdHMuc3RhcnQ7DQogICAgICAgICAgICBjb25zdCBlbmRJbnB1dCA9IHNhbml0aXplSGV4Q29sb3IoZG9tLmVuYWJsZWRMaWNlbnNlc0NvbG9yRW5kPy52YWx1ZSkgfHwgZGVmYXVsdHMuZW5kOw0KICAgICAgICAgICAgY29uc3QgZ3JhZGllbnQgPSBCb29sZWFuKGRvbS5lbmFibGVkTGljZW5zZXNHcmFkaWVudFRvZ2dsZT8uY2hlY2tlZCk7DQogICAgICAgICAgICBzdGF0ZS5lbmFibGVkTGljZW5zZXNDb2xvcnMgPSB7DQogICAgICAgICAgICAgIHN0YXJ0LA0KICAgICAgICAgICAgICBlbmQ6IGVuZElucHV0LA0KICAgICAgICAgICAgICBncmFkaWVudCwNCiAgICAgICAgICAgICAgaXNDdXN0b206IHRydWUNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB1cGRhdGVFbmFibGVkTGljZW5zZXNDb2xvcklucHV0cygpOw0KICAgICAgICAgICAgY2xlYXJFbmFibGVkTGljZW5zZXNHcmFkaWVudENhY2hlKCk7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcykgew0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMuZW5hYmxlZExpY2Vuc2VzLnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0RW5hYmxlZExpY2Vuc2VzQ29sb3JzKCkgew0KICAgICAgICAgICAgY29uc3QgZGVmYXVsdHMgPSBnZXREZWZhdWx0RW5hYmxlZExpY2Vuc2VzQ29sb3JzKCk7DQogICAgICAgICAgICBzdGF0ZS5lbmFibGVkTGljZW5zZXNDb2xvcnMgPSB7DQogICAgICAgICAgICAgIC4uLmRlZmF1bHRzLA0KICAgICAgICAgICAgICBpc0N1c3RvbTogZmFsc2UNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB1cGRhdGVFbmFibGVkTGljZW5zZXNDb2xvcklucHV0cygpOw0KICAgICAgICAgICAgY2xlYXJFbmFibGVkTGljZW5zZXNHcmFkaWVudENhY2hlKCk7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcykgew0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMuZW5hYmxlZExpY2Vuc2VzLnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJlZnJlc2hFbmFibGVkTGljZW5zZXNUaGVtZUNvbG9ycygpIHsNCiAgICAgICAgICAgIGNvbnN0IGNvbG9ycyA9IGVuc3VyZUVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhdGUoKTsNCiAgICAgICAgICAgIGlmIChjb2xvcnMuaXNDdXN0b20pIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZGVmYXVsdHMgPSBnZXREZWZhdWx0RW5hYmxlZExpY2Vuc2VzQ29sb3JzKCk7DQogICAgICAgICAgICBzdGF0ZS5lbmFibGVkTGljZW5zZXNDb2xvcnMgPSB7DQogICAgICAgICAgICAgIC4uLmRlZmF1bHRzLA0KICAgICAgICAgICAgICBpc0N1c3RvbTogZmFsc2UNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB1cGRhdGVFbmFibGVkTGljZW5zZXNDb2xvcklucHV0cygpOw0KICAgICAgICAgICAgY2xlYXJFbmFibGVkTGljZW5zZXNHcmFkaWVudENhY2hlKCk7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcykgew0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMuZW5hYmxlZExpY2Vuc2VzLnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGNvbnN0IGFjdGl2ZURheUtleXMgPSBPYmplY3Qua2V5cyhhY3RpdmVEYXlzQ29uZmlnKTsNCiAgICAgICAgICBjb25zdCBhY3RpdmVEYXlzRWxlbWVudHMgPSBhY3RpdmVEYXlLZXlzLnJlZHVjZSgoYWNjdW11bGF0b3IsIGtleSwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHZhbHVlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWFjdGl2ZS1kYXlzLXZhbHVlPSIke2tleX0iXWApOw0KICAgICAgICAgICAgaWYgKHZhbHVlRWxlbWVudCkgew0KICAgICAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gew0KICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZUVsZW1lbnQsDQogICAgICAgICAgICAgICAgaXRlbTogdmFsdWVFbGVtZW50LmNsb3Nlc3QoIi5hY3RpdmUtZGF5cy1pdGVtIiksDQogICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7DQogICAgICAgICAgfSwge30pOw0KICAgICAgDQogICAgICAgICAgY29uc3QgZGVmYXVsdFRyZW5kUGFsZXR0ZSA9IHRyZW5kU2VyaWVzSWRzLm1hcCgoaWQsIGluZGV4KSA9PiB7DQogICAgICAgICAgICBjb25zdCBkZXJpdmVkID0gY29sb3JTdHJpbmdUb0hleChjaGFydFNlcmllc0RlZmluaXRpb25zW2luZGV4XS5ib3JkZXJDb2xvcik7DQogICAgICAgICAgICByZXR1cm4gc2FuaXRpemVIZXhDb2xvcihkZXJpdmVkKSB8fCBmYWxsYmFja1RyZW5kUGFsZXR0ZVtpZF0gfHwgJyMwMDZFMDAnOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGNvbnN0IERFRkFVTFRfVFJFTkRfU1RBUlRfQ09MT1IgPSBzYW5pdGl6ZUhleENvbG9yKGRlZmF1bHRUcmVuZFBhbGV0dGVbMF0pIHx8ICcjMDA2RTAwJzsNCiAgICAgICAgICBjb25zdCBERUZBVUxUX1RSRU5EX0VORF9DT0xPUiA9IHNhbml0aXplSGV4Q29sb3IoZGVmYXVsdFRyZW5kUGFsZXR0ZVtkZWZhdWx0VHJlbmRQYWxldHRlLmxlbmd0aCAtIDFdKSB8fCAnIzE0QUEyNCc7DQogICAgICAgICAgY29uc3QgREVGQVVMVF9VU0FHRV9USFJFU0hPTERfTUlERExFID0gMTc7DQogICAgICAgICAgY29uc3QgREVGQVVMVF9VU0FHRV9USFJFU0hPTERfSElHSCA9IDM1Ow0KICAgICAgICAgIGNvbnN0IFRSRU5EX0NPTE9SX1NUT1JBR0VfS0VZID0gJ2NvcGlsb3RUcmVuZEdyYWRpZW50JzsNCiAgICAgICAgICBjb25zdCBEQVRBX1NUT1JBR0VfS0VZID0gJ2NvcGlsb3REYXNoYm9hcmREYXRhc2V0JzsKICAgICAgICAgIGNvbnN0IERBVEFfU1RPUkFHRV9NRVRBX0tFWSA9ICdjb3BpbG90RGFzaGJvYXJkRGF0YXNldE1ldGEnOwogICAgICAgICAgY29uc3QgQUdFTlRfREFUQV9TVE9SQUdFX0tFWSA9ICdjb3BpbG90QWdlbnREYXRhc2V0JzsKICAgICAgICAgIGNvbnN0IEFHRU5UX0RBVEFfU1RPUkFHRV9NRVRBX0tFWSA9ICdjb3BpbG90QWdlbnREYXRhc2V0TWV0YSc7CiAgICAgICAgICBjb25zdCBBR0VOVF9IVUJfU1RPUkFHRV9LRVkgPSAnY29waWxvdEFnZW50SHViRGF0YXNldHMnOwogICAgICAgICAgY29uc3QgREFUQV9QRVJTSVNURU5DRV9LRVkgPSAnY29waWxvdERhc2hib2FyZFBlcnNpc3RlbmNlJzsKICAgICAgICAgIGNvbnN0IERBVEFfQ09OU0VOVF9LRVkgPSAnY29waWxvdFBlcnNpc3RDb25zZW50JzsKICAgICAgICAgIGNvbnN0IEZJTFRFUl9QUkVGRVJFTkNFU19LRVkgPSAnY29waWxvdEZpbHRlclByZWZzJzsKICAgICAgICAgIGNvbnN0IE1BWF9EQVRBU0VUX0ZJTEVfU0laRSA9IDIwMCAqIDEwMjQgKiAxMDI0OwogICAgICAgICAgY29uc3QgREFUQVNFVF9DQUNIRV9MSU1JVF9CWVRFUyA9IDEyMCAqIDEwMjQgKiAxMDI0OyAvLyBLZWVwIGNhY2hlIGxpbWl0IGxvd2VyIHRoYW4gdXBsb2FkIGxpbWl0IHRvIGF2b2lkIHJlcGVhdGVkIHN0b3JhZ2UgZmFpbHVyZXMuCiAgICAgICAgICBjb25zdCBDU1ZfQUNDRVBURURfTUlNRV9UWVBFUyA9IG5ldyBTZXQoWyJ0ZXh0L2NzdiIsICJhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwiXSk7DQogICAgICAgICAgY29uc3QgU0FNUExFX0RBVEFTRVRfVVJMID0gInNhbXBsZXMvY29waWxvdC1zYW1wbGUuY3N2IjsKICAgICAgICAgIGNvbnN0IFNBTVBMRV9EQVRBU0VUX0lOTElORSA9IGBQZXJzb25JZCxPcmdhbml6YXRpb24sQ291bnRyeU9yUmVnaW9uLERvbWFpbixNZXRyaWNEYXRlLFRvdGFsIEFjdGl2ZSBDb3BpbG90IEFjdGlvbnMgVGFrZW4sQ29waWxvdCBhc3Npc3RlZCBob3VycyxNZWV0aW5ncyByZWNhcHBlZCBieSBDb3BpbG90LEdlbmVyYXRlIGVtYWlsIGRyYWZ0IGFjdGlvbnMgdGFrZW4gdXNpbmcgQ29waWxvdCxDb21wb3NlIGNoYXQgYWN0aW9ucyB0YWtlbiB1c2luZyBDb3BpbG90IGluIFRlYW1zLE1lZXRpbmcgaG91cnMgcmVjYXBwZWQgYnkgQ29waWxvdCxDb3BpbG90IEVuYWJsZWQgVXNlcgpVU1ItMDAxLENvbnRvc28gU2FsZXMsRGVubWFyayxzYWxlcy5jb250b3NvLDIwMjQtMTAtMDYsMTgwLDQyLjUsMTgsNDUsNTIsNjgsMQpVU1ItMDAyLENvbnRvc28gU2FsZXMsRGVubWFyayxzYWxlcy5jb250b3NvLDIwMjQtMTEtMDMsMjIwLDUxLjEsMjQsNTgsNjQsNzIsMQpVU1ItMDAzLEZhYnJpa2FtIEZpbmFuY2UsTm9yd2F5LGZpbmFuY2UuZmFicmlrYW0sMjAyNC0xMS0xMCwzMDUsNjMuOCwzMiw3MCw4OCw5NCwxClVTUi0wMDQsRmFicmlrYW0gRmluYW5jZSxOb3J3YXksZmluYW5jZS5mYWJyaWthbSwyMDI0LTEyLTA4LDI3Niw1NC4yLDI4LDY0LDc5LDkwLDEKVVNSLTAwNSxXb29kZ3JvdmUgUmV0YWlsLFN3ZWRlbixyZXRhaWwud29vZGdyb3ZlLDIwMjQtMTItMTUsMTQ4LDM4LjcsMTIsNDEsNTUsNDgsMQpVU1ItMDA2LFdvb2Rncm92ZSBSZXRhaWwsU3dlZGVuLHJldGFpbC53b29kZ3JvdmUsMjAyNS0wMS0wNSwzMTIsNzIuNCwzNiw4Miw5NCwxMTAsMQpVU1ItMDA3LE5vcnRod2luZCBPcHMsRmlubGFuZCxvcHMubm9ydGh3aW5kLDIwMjUtMDEtMTksMTk2LDQ3LjMsMjAsNTMsNjEsNjYsMQpVU1ItMDA4LE5vcnRod2luZCBPcHMsRmlubGFuZCxvcHMubm9ydGh3aW5kLDIwMjUtMDItMDIsMjU0LDU4LjksMjcsNjksODMsOTIsMWA7CiAgICAgICAgICBjb25zdCBDU1ZfREVMSU1JVEVSX0NBTkRJREFURVMgPSBbIjsiLCAiLCIsICJcdCIsICJ8Il07DQogICAgICAgICAgY29uc3QgVEhFTUVfU1RPUkFHRV9LRVkgPSAnY29waWxvdERhc2hib2FyZFRoZW1lJzsNCiAgICAgICAgICBjb25zdCBERUZBVUxUX0FET1BUSU9OX0NPTE9SID0gJyMwMDhBMDAnOw0KICAgICAgICAgIGNvbnN0IERBVEFfREJfTkFNRSA9ICdjb3BpbG90RGFzaGJvYXJkREInOw0KICAgICAgICAgIGNvbnN0IERBVEFfREJfU1RPUkUgPSAnZGF0YXNldHMnOwogICAgICAgICAgY29uc3QgREFUQV9EQl9BR0VOVF9TVE9SRSA9ICdhZ2VudERhdGFzZXRzJzsKICAgICAgICAgIGNvbnN0IERBVEFfREJfQUdFTlRfSFVCX1NUT1JFID0gJ2FnZW50SHViRGF0YXNldHMnOwogICAgICAgICAgY29uc3QgREFUQV9EQl9WRVJTSU9OID0gMzsKICAgICAgICAgIGNvbnN0IERBVEFfREJfS0VZID0gJ2xhdGVzdCc7CiAgICAgICAgICBjb25zdCBEQVRBX0RCX0FHRU5UX0tFWSA9ICdsYXRlc3RBZ2VudHMnOwogICAgICAgICAgY29uc3QgREFUQV9EQl9BR0VOVF9IVUJfS0VZID0gJ2xhdGVzdEFnZW50SHViJzsKICAgICAgICAgIGNvbnN0IERBVEFfREJfU1VQUE9SVEVEID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgJ2luZGV4ZWREQicgaW4gd2luZG93OwogICAgICAgICAgbGV0IHBlbmRpbmdEYlJlc2V0ID0gbnVsbDsKCiAgICAgICAgICBmdW5jdGlvbiBpc1ZlcnNpb25FcnJvcihlcnJvcikgewogICAgICAgICAgICByZXR1cm4gQm9vbGVhbihlcnJvciAmJiBlcnJvci5uYW1lID09PSAiVmVyc2lvbkVycm9yIik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVzZXREYXRhc2V0RGF0YWJhc2UoKSB7CiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBlbmRpbmdEYlJlc2V0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHBlbmRpbmdEYlJlc2V0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBlbmRpbmdEYlJlc2V0ID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbGV0ZVJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoREFUQV9EQl9OQU1FKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsaXplID0gKCkgPT4gewogICAgICAgICAgICAgICAgICBwZW5kaW5nRGJSZXNldCA9IG51bGw7CiAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uc3VjY2VzcyA9IGZpbmFsaXplOwogICAgICAgICAgICAgICAgZGVsZXRlUmVxdWVzdC5vbmVycm9yID0gZmluYWxpemU7CiAgICAgICAgICAgICAgICBkZWxldGVSZXF1ZXN0Lm9uYmxvY2tlZCA9IGZpbmFsaXplOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byByZXNldCBkYXRhc2V0IGRhdGFiYXNlIiwgZXJyb3IpOwogICAgICAgICAgICAgICAgcGVuZGluZ0RiUmVzZXQgPSBudWxsOwogICAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBwZW5kaW5nRGJSZXNldDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBvcGVuRGF0YXNldERhdGFiYXNlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkluZGV4ZWREQiBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlci4iKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCByZXF1ZXN0OwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oREFUQV9EQl9OQU1FLCBEQVRBX0RCX1ZFUlNJT04pOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNWZXJzaW9uRXJyb3IoZXJyb3IpKSB7CiAgICAgICAgICAgICAgICAgIHJlc2V0RGF0YXNldERhdGFiYXNlKCkudGhlbigoKSA9PiBvcGVuRGF0YXNldERhdGFiYXNlKCkudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmVxdWVzdC5vbmVycm9yID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSByZXF1ZXN0LmVycm9yOwogICAgICAgICAgICAgICAgaWYgKGlzVmVyc2lvbkVycm9yKGVycm9yKSkgewogICAgICAgICAgICAgICAgICByZXNldERhdGFzZXREYXRhYmFzZSgpLnRoZW4oKCkgPT4gb3BlbkRhdGFzZXREYXRhYmFzZSgpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVqZWN0KSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvciB8fCBuZXcgRXJyb3IoIlVuYWJsZSB0byBvcGVuIGRhdGFzZXQgZGF0YWJhc2UuIikpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmVxdWVzdC5vbnVwZ3JhZGVuZWVkZWQgPSBldmVudCA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgZGIgPSBldmVudC50YXJnZXQucmVzdWx0Ow0KICAgICAgICAgICAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhEQVRBX0RCX1NUT1JFKSkgew0KICAgICAgICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoREFUQV9EQl9TVE9SRSwgeyBrZXlQYXRoOiAiaWQiIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoREFUQV9EQl9BR0VOVF9TVE9SRSkpIHsKICAgICAgICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoREFUQV9EQl9BR0VOVF9TVE9SRSwgeyBrZXlQYXRoOiAiaWQiIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKERBVEFfREJfQUdFTlRfSFVCX1NUT1JFKSkgewogICAgICAgICAgICAgICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZShEQVRBX0RCX0FHRU5UX0hVQl9TVE9SRSwgeyBrZXlQYXRoOiAiaWQiIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzYXZlRGF0YXNldFRvSW5kZXhlZERCKGNzdlRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgaWYgKCFEQVRBX0RCX1NVUFBPUlRFRCkgew0KICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJJbmRleGVkREIgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXIuIikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG9wZW5EYXRhc2V0RGF0YWJhc2UoKS50aGVuKGRiID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihEQVRBX0RCX1NUT1JFLCAicmVhZHdyaXRlIik7DQogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9TVE9SRSk7DQogICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHsNCiAgICAgICAgICAgICAgICBpZDogREFUQV9EQl9LRVksDQogICAgICAgICAgICAgICAgY3N2OiBuZXcgQmxvYihbY3N2VGV4dF0sIHsgdHlwZTogInRleHQvY3N2IiB9KSwNCiAgICAgICAgICAgICAgICBtZXRhOiB7DQogICAgICAgICAgICAgICAgICAuLi5tZXRhLA0KICAgICAgICAgICAgICAgICAgc2F2ZWRBdDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgc3RvcmUucHV0KHJlY29yZCk7DQogICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKHJlY29yZC5tZXRhKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25lcnJvciA9IGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHRyYW5zYWN0aW9uLmVycm9yIHx8IGV2ZW50LnRhcmdldC5lcnJvcjsNCiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvciB8fCBuZXcgRXJyb3IoIlVuYWJsZSB0byBzdG9yZSBkYXRhc2V0LiIpKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzYXZlQWdlbnREYXRhc2V0VG9JbmRleGVkREIoY3N2VGV4dCwgbWV0YSA9IHt9KSB7CiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCJJbmRleGVkREIgaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXIuIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvcGVuRGF0YXNldERhdGFiYXNlKCkudGhlbihkYiA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihEQVRBX0RCX0FHRU5UX1NUT1JFLCAicmVhZHdyaXRlIik7DQogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9BR0VOVF9TVE9SRSk7DQogICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHsNCiAgICAgICAgICAgICAgICBpZDogREFUQV9EQl9BR0VOVF9LRVksDQogICAgICAgICAgICAgICAgY3N2OiBuZXcgQmxvYihbY3N2VGV4dF0sIHsgdHlwZTogInRleHQvY3N2IiB9KSwNCiAgICAgICAgICAgICAgICBtZXRhOiB7DQogICAgICAgICAgICAgICAgICAuLi5tZXRhLA0KICAgICAgICAgICAgICAgICAgc2F2ZWRBdDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgc3RvcmUucHV0KHJlY29yZCk7DQogICAgICAgICAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKHJlY29yZC5tZXRhKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25lcnJvciA9IGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHRyYW5zYWN0aW9uLmVycm9yIHx8IGV2ZW50LnRhcmdldC5lcnJvcjsNCiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvciB8fCBuZXcgRXJyb3IoIlVuYWJsZSB0byBzdG9yZSBhZ2VudCBkYXRhc2V0LiIpKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBsb2FkRGF0YXNldEZyb21JbmRleGVkREIoKSB7DQogICAgICAgICAgICBpZiAoIURBVEFfREJfU1VQUE9SVEVEKSB7DQogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXN0YXRlLnBlcnNpc3REYXRhc2V0cykgew0KICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG9wZW5EYXRhc2V0RGF0YWJhc2UoKS50aGVuKGRiID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihEQVRBX0RCX1NUT1JFLCAicmVhZG9ubHkiKTsNCiAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShEQVRBX0RCX1NUT1JFKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHN0b3JlLmdldChEQVRBX0RCX0tFWSk7DQogICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHJlcXVlc3QuZXJyb3IgfHwgbmV3IEVycm9yKCJVbmFibGUgdG8gcmVhZCBzdG9yZWQgZGF0YXNldC4iKTsNCiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHJlcXVlc3QucmVzdWx0Ow0KICAgICAgICAgICAgICAgIGlmICghcmVjb3JkKSB7DQogICAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgeyBjc3YsIG1ldGEgfSA9IHJlY29yZDsNCiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbGl6ZSA9IGNzdlRleHQgPT4gew0KICAgICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgIHJlc29sdmUoeyBjc3Y6IGNzdlRleHQsIG1ldGE6IG1ldGEgfHwge30gfSk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBpZiAoY3N2IGluc3RhbmNlb2YgQmxvYikgew0KICAgICAgICAgICAgICAgICAgY3N2LnRleHQoKS50aGVuKGZpbmFsaXplKS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjc3YgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgICBmaW5hbGl6ZShjc3YpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBmaW5hbGl6ZSgiIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfSkpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGxvYWRBZ2VudERhdGFzZXRGcm9tSW5kZXhlZERCKCkgewogICAgICAgICAgICBpZiAoIURBVEFfREJfU1VQUE9SVEVEKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3BlbkRhdGFzZXREYXRhYmFzZSgpLnRoZW4oZGIgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oREFUQV9EQl9BR0VOVF9TVE9SRSwgInJlYWRvbmx5Iik7DQogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9BR0VOVF9TVE9SRSk7DQogICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXQoREFUQV9EQl9BR0VOVF9LRVkpOw0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSByZXF1ZXN0LmVycm9yIHx8IG5ldyBFcnJvcigiVW5hYmxlIHRvIHJlYWQgc3RvcmVkIGFnZW50IGRhdGFzZXQuIik7DQogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCByZWNvcmQgPSByZXF1ZXN0LnJlc3VsdDsNCiAgICAgICAgICAgICAgICBpZiAoIXJlY29yZCkgew0KICAgICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IHsgY3N2LCBtZXRhIH0gPSByZWNvcmQ7DQogICAgICAgICAgICAgICAgY29uc3QgZmluYWxpemUgPSBjc3ZUZXh0ID0+IHsNCiAgICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgICByZXNvbHZlKHsgY3N2OiBjc3ZUZXh0LCBtZXRhOiBtZXRhIHx8IHt9IH0pOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgaWYgKGNzdiBpbnN0YW5jZW9mIEJsb2IpIHsNCiAgICAgICAgICAgICAgICAgIGNzdi50ZXh0KCkudGhlbihmaW5hbGl6ZSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY3N2ID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgICAgZmluYWxpemUoY3N2KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgZmluYWxpemUoIiIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBkZWxldGVEYXRhc2V0RnJvbUluZGV4ZWREQigpIHsNCiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG9wZW5EYXRhc2V0RGF0YWJhc2UoKS50aGVuKGRiID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihEQVRBX0RCX1NUT1JFLCAicmVhZHdyaXRlIik7DQogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9TVE9SRSk7DQogICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5kZWxldGUoREFUQV9EQl9LRVkpOw0KICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSByZXF1ZXN0LmVycm9yIHx8IG5ldyBFcnJvcigiVW5hYmxlIHRvIGRlbGV0ZSBzdG9yZWQgZGF0YXNldC4iKTsNCiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOw0KICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgcmVzb2x2ZSgpOw0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfSkpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUFnZW50RGF0YXNldEZyb21JbmRleGVkREIoKSB7CiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wZW5EYXRhc2V0RGF0YWJhc2UoKS50aGVuKGRiID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKERBVEFfREJfQUdFTlRfU1RPUkUsICJyZWFkd3JpdGUiKTsNCiAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShEQVRBX0RCX0FHRU5UX1NUT1JFKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHN0b3JlLmRlbGV0ZShEQVRBX0RCX0FHRU5UX0tFWSk7DQogICAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHJlcXVlc3QuZXJyb3IgfHwgbmV3IEVycm9yKCJVbmFibGUgdG8gZGVsZXRlIHN0b3JlZCBhZ2VudCBkYXRhc2V0LiIpOw0KICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7DQogICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICByZXNvbHZlKCk7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9KSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgY29uc3QgdHJlbmRDb2xvck1hcCA9IG5ldyBNYXAodHJlbmRTZXJpZXNJZHMubWFwKChpZCwgaW5kZXgpID0+IFtpZCwgZGVmYXVsdFRyZW5kUGFsZXR0ZVtpbmRleF0gfHwgZmFsbGJhY2tUcmVuZFBhbGV0dGVbaWRdIHx8IERFRkFVTFRfVFJFTkRfU1RBUlRfQ09MT1JdKSk7DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBnZXRUcmVuZENvbG9yKGRlZmluaXRpb25JZCkgew0KICAgICAgICAgICAgcmV0dXJuIHRyZW5kQ29sb3JNYXAuZ2V0KGRlZmluaXRpb25JZCkgfHwgZmFsbGJhY2tUcmVuZFBhbGV0dGVbZGVmaW5pdGlvbklkXSB8fCBERUZBVUxUX1RSRU5EX1NUQVJUX0NPTE9SOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGFwcGx5VHJlbmRDb2xvclRvRGF0YXNldChkYXRhc2V0LCBkZWZpbml0aW9uSWQpIHsNCiAgICAgICAgICAgIGlmICghZGF0YXNldCkgew0KICAgICAgICAgICAgICByZXR1cm4gZGF0YXNldDsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKGRlZmluaXRpb25JZCA9PT0gJ3RvdGFsJykgew0KICAgICAgICAgICAgICBjb25zdCBjaGFydCA9IHN0YXRlLmNoYXJ0cy50cmVuZDsNCiAgICAgICAgICAgICAgY29uc3QgY3R4ID0gY2hhcnQ/LmN0eCB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJlbmRDaGFydCcpPy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgICBjb25zdCBzdGFydEhleCA9IHNhbml0aXplSGV4Q29sb3Ioc3RhdGUudHJlbmRDb2xvclByZWZlcmVuY2U/LnN0YXJ0KSB8fCBERUZBVUxUX1RSRU5EX1NUQVJUX0NPTE9SOw0KICAgICAgICAgICAgICBjb25zdCBlbmRIZXggPSBzYW5pdGl6ZUhleENvbG9yKHN0YXRlLnRyZW5kQ29sb3JQcmVmZXJlbmNlPy5lbmQpIHx8IERFRkFVTFRfVFJFTkRfRU5EX0NPTE9SOw0KICAgICAgICAgICAgICBpZiAoY3R4KSB7DQogICAgICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBjaGFydD8uY2hhcnRBcmVhID8gTWF0aC5tYXgoMSwgY2hhcnQuY2hhcnRBcmVhLnJpZ2h0IC0gY2hhcnQuY2hhcnRBcmVhLmxlZnQpIDogKGNoYXJ0Py53aWR0aCB8fCBjdHguY2FudmFzLndpZHRoIHx8IGN0eC5jYW52YXMuY2xpZW50V2lkdGggfHwgMSk7DQogICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gY2hhcnQ/LmNoYXJ0QXJlYSA/IE1hdGgubWF4KDEsIGNoYXJ0LmNoYXJ0QXJlYS5ib3R0b20gLSBjaGFydC5jaGFydEFyZWEudG9wKSA6IChjaGFydD8uaGVpZ2h0IHx8IGN0eC5jYW52YXMuaGVpZ2h0IHx8IGN0eC5jYW52YXMuY2xpZW50SGVpZ2h0IHx8IDEpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVHcmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCB3aWR0aCwgMCk7DQogICAgICAgICAgICAgICAgbGluZUdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCBzdGFydEhleCk7DQogICAgICAgICAgICAgICAgbGluZUdyYWRpZW50LmFkZENvbG9yU3RvcCgxLCBlbmRIZXgpOw0KICAgICAgICAgICAgICAgIGRhdGFzZXQuYm9yZGVyQ29sb3IgPSBsaW5lR3JhZGllbnQ7DQogICAgICAgICAgICAgICAgZGF0YXNldC5wb2ludEJvcmRlckNvbG9yID0gZW5kSGV4Ow0KICAgICAgICAgICAgICAgIGRhdGFzZXQucG9pbnRIb3ZlckJvcmRlckNvbG9yID0gZW5kSGV4Ow0KICAgICAgICAgICAgICAgIGRhdGFzZXQucG9pbnRIb3ZlckJhY2tncm91bmRDb2xvciA9IGVuZEhleDsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IGZpbGxHcmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RmlsbCA9IGhleFRvUmdiYShzdGFydEhleCwgMC4yKSB8fCBzdGFydEhleDsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRGaWxsID0gaGV4VG9SZ2JhKGVuZEhleCwgMC4wNSkgfHwgZW5kSGV4Ow0KICAgICAgICAgICAgICAgIGZpbGxHcmFkaWVudC5hZGRDb2xvclN0b3AoMCwgc3RhcnRGaWxsKTsNCiAgICAgICAgICAgICAgICBmaWxsR3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIGVuZEZpbGwpOw0KICAgICAgICAgICAgICAgIGRhdGFzZXQuYmFja2dyb3VuZENvbG9yID0gZmlsbEdyYWRpZW50Ow0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGRhdGFzZXQuYm9yZGVyQ29sb3IgPSBlbmRIZXg7DQogICAgICAgICAgICAgICAgZGF0YXNldC5wb2ludEJvcmRlckNvbG9yID0gZW5kSGV4Ow0KICAgICAgICAgICAgICAgIGRhdGFzZXQucG9pbnRIb3ZlckJvcmRlckNvbG9yID0gZW5kSGV4Ow0KICAgICAgICAgICAgICAgIGRhdGFzZXQucG9pbnRIb3ZlckJhY2tncm91bmRDb2xvciA9IGVuZEhleDsNCiAgICAgICAgICAgICAgICBkYXRhc2V0LmJhY2tncm91bmRDb2xvciA9IGhleFRvUmdiYShlbmRIZXgsIDAuMTgpIHx8IGVuZEhleDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBkYXRhc2V0LnBvaW50QmFja2dyb3VuZENvbG9yID0gJyNmZmZmZmYnOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgY29uc3QgcGFsZXR0ZUhleCA9IGdldFRyZW5kQ29sb3IoZGVmaW5pdGlvbklkKTsNCiAgICAgICAgICAgICAgZGF0YXNldC5ib3JkZXJDb2xvciA9IHBhbGV0dGVIZXg7DQogICAgICAgICAgICAgIGRhdGFzZXQuYmFja2dyb3VuZENvbG9yID0gJ3RyYW5zcGFyZW50JzsNCiAgICAgICAgICAgICAgZGF0YXNldC5wb2ludEJhY2tncm91bmRDb2xvciA9IGRhdGFzZXQucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPz8gJyNmZmZmZmYnOw0KICAgICAgICAgICAgICBkYXRhc2V0LnBvaW50Qm9yZGVyQ29sb3IgPSBwYWxldHRlSGV4Ow0KICAgICAgICAgICAgICBkYXRhc2V0LnBvaW50SG92ZXJCb3JkZXJDb2xvciA9IHBhbGV0dGVIZXg7DQogICAgICAgICAgICAgIGRhdGFzZXQucG9pbnRIb3ZlckJhY2tncm91bmRDb2xvciA9IHBhbGV0dGVIZXg7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZGF0YXNldDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBnZXRQZXJpb2RVc2VyQ291bnQocGVyaW9kKSB7DQogICAgICAgICAgICBpZiAoIXBlcmlvZCkgew0KICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUocGVyaW9kLnVzZXJDb3VudCkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHBlcmlvZC51c2VyQ291bnQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAocGVyaW9kLnVzZXJzIGluc3RhbmNlb2YgU2V0KSB7DQogICAgICAgICAgICAgIHJldHVybiBwZXJpb2QudXNlcnMuc2l6ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGFkanVzdFRyZW5kVmFsdWVGb3JWaWV3KHJhd1ZhbHVlLCBwZXJpb2QsIGRlZmluaXRpb24pIHsNCiAgICAgICAgICAgIGNvbnN0IG51bWVyaWMgPSBOdW1iZXIuaXNGaW5pdGUocmF3VmFsdWUpID8gcmF3VmFsdWUgOiAwOw0KICAgICAgICAgICAgaWYgKHN0YXRlLnRyZW5kVmlldyA9PT0gImF2ZXJhZ2UiICYmICghZGVmaW5pdGlvbiB8fCBkZWZpbml0aW9uLnN1cHBvcnRzQXZlcmFnZSAhPT0gZmFsc2UpKSB7DQogICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gZ2V0UGVyaW9kVXNlckNvdW50KHBlcmlvZCk7DQogICAgICAgICAgICAgIGlmICghY291bnQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gbnVtZXJpYyAvIGNvdW50Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG51bWVyaWM7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplVHJlbmRWYWx1ZSh2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSB7DQogICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKE1hdGguYWJzKHZhbHVlKSA8IDFlLTQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gdmFsdWU7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gZm9ybWF0VHJlbmRGaXhlZCh2YWx1ZSwgZGlnaXRzKSB7DQogICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh2YWx1ZSkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuICIwIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBOdW1iZXIodmFsdWUudG9GaXhlZChkaWdpdHMpKS50b1N0cmluZygpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGZvcm1hdFRyZW5kQXhpc1RpY2sodmFsdWUpIHsNCiAgICAgICAgICAgIGNvbnN0IG51bWVyaWMgPSBub3JtYWxpemVUcmVuZFZhbHVlKHZhbHVlKTsNCiAgICAgICAgICAgIGlmIChzdGF0ZS50cmVuZFZpZXcgPT09ICJhdmVyYWdlIikgew0KICAgICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBhYnMgPSBNYXRoLmFicyhudW1lcmljKTsNCiAgICAgICAgICAgICAgICBpZiAoYWJzID49IDEwKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0VHJlbmRGaXhlZChudW1lcmljLCAxKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgYWJzID49IDEgPyAyIDogMyk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgYWJzID0gTWF0aC5hYnMobnVtZXJpYyk7DQogICAgICAgICAgICAgIGlmIChhYnMgPj0gMTAwMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQobnVtZXJpYykpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChhYnMgPj0gMTAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgMCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGFicyA+PSAxKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgYWJzID49IDEwID8gMSA6IDIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJldHVybiBmb3JtYXRUcmVuZEZpeGVkKG51bWVyaWMsIDMpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiKSB7DQogICAgICAgICAgICAgIHJldHVybiBob3Vyc0Zvcm1hdHRlci5mb3JtYXQobnVtZXJpYyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChudW1lcmljKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBmb3JtYXRUcmVuZFRvb2x0aXBWYWx1ZSh2YWx1ZSkgew0KICAgICAgICAgICAgY29uc3QgbnVtZXJpYyA9IG5vcm1hbGl6ZVRyZW5kVmFsdWUodmFsdWUpOw0KICAgICAgICAgICAgaWYgKHN0YXRlLnRyZW5kVmlldyA9PT0gImF2ZXJhZ2UiKSB7DQogICAgICAgICAgICAgIGlmIChzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIikgew0KICAgICAgICAgICAgICAgIGNvbnN0IGFicyA9IE1hdGguYWJzKG51bWVyaWMpOw0KICAgICAgICAgICAgICAgIGlmIChhYnMgPj0gMTApIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBmb3JtYXRUcmVuZEZpeGVkKG51bWVyaWMsIDEpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0VHJlbmRGaXhlZChudW1lcmljLCBhYnMgPj0gMSA/IDIgOiAzKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBhYnMgPSBNYXRoLmFicyhudW1lcmljKTsNCiAgICAgICAgICAgICAgaWYgKGFicyA+PSAxMDAwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZChudW1lcmljKSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGFicyA+PSAxMDApIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0VHJlbmRGaXhlZChudW1lcmljLCAwKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoYWJzID49IDEwKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgMSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGFicyA+PSAxKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgMik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdFRyZW5kRml4ZWQobnVtZXJpYywgMyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGhvdXJzRm9ybWF0dGVyLmZvcm1hdChudW1lcmljKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQobnVtZXJpYykpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGdldFRyZW5kVW5pdExhYmVsKCkgew0KICAgICAgICAgICAgY29uc3QgbWV0cmljSXNIb3VycyA9IHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiOw0KICAgICAgICAgICAgaWYgKHN0YXRlLnRyZW5kVmlldyA9PT0gImF2ZXJhZ2UiKSB7DQogICAgICAgICAgICAgIHJldHVybiBtZXRyaWNJc0hvdXJzID8gImhvdXJzIHBlciB1c2VyIiA6ICJhY3Rpb25zIHBlciB1c2VyIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBtZXRyaWNJc0hvdXJzID8gImhvdXJzIiA6ICJhY3Rpb25zIjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVUcmVuZENoYXJ0T3B0aW9ucygpIHsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsDQogICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLA0KICAgICAgICAgICAgICBsYXlvdXQ6IHsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiB7DQogICAgICAgICAgICAgICAgICB0b3A6IDEyLA0KICAgICAgICAgICAgICAgICAgYm90dG9tOiAxOCwNCiAgICAgICAgICAgICAgICAgIGxlZnQ6IDgsDQogICAgICAgICAgICAgICAgICByaWdodDogMTINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHNjYWxlczogew0KICAgICAgICAgICAgICAgIHg6IHsNCiAgICAgICAgICAgICAgICAgIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgIHRpY2tzOiB7DQogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAidmFyKC0tZ3JleS02MDApIiwNCiAgICAgICAgICAgICAgICAgICAgbWF4Um90YXRpb246IDAsDQogICAgICAgICAgICAgICAgICAgIGF1dG9Ta2lwOiB0cnVlDQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICB5OiB7DQogICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgIGdyaWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICJyZ2JhKDE1MywgMjA4LCAxNTMsIDAuMTgpIiwNCiAgICAgICAgICAgICAgICAgICAgZHJhd0JvcmRlcjogZmFsc2UNCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB0aWNrczogew0KICAgICAgICAgICAgICAgICAgICBjb2xvcjogInZhcigtLWdyZXktNjAwKSIsDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB2YWx1ZSA9PiBmb3JtYXRUcmVuZEF4aXNUaWNrKHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgcGx1Z2luczogew0KICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LA0KICAgICAgICAgICAgICAgIHRvb2x0aXA6IHsNCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInJnYmEoMzEsIDM1LCAzNywgMC45MikiLA0KICAgICAgICAgICAgICAgICAgdGl0bGVDb2xvcjogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgICAgYm9keUNvbG9yOiAiI2ZmZmZmZiIsDQogICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMiwNCiAgICAgICAgICAgICAgICAgIGNvcm5lclJhZGl1czogMTAsDQogICAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3JzOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczogew0KICAgICAgICAgICAgICAgICAgICBsYWJlbDogY29udGV4dCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YXNldExhYmVsID0gY29udGV4dC5kYXRhc2V0ICYmIGNvbnRleHQuZGF0YXNldC5sYWJlbCA/IGNvbnRleHQuZGF0YXNldC5sYWJlbCA6ICJWYWx1ZSI7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUoY29udGV4dC5wYXJzZWQueSkgPyBjb250ZXh0LnBhcnNlZC55IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdFRyZW5kVG9vbHRpcFZhbHVlKHZhbHVlKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bml0ID0gZ2V0VHJlbmRVbml0TGFiZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7ZGF0YXNldExhYmVsfTogJHtmb3JtYXR0ZWRWYWx1ZX0gJHt1bml0fWA7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIGFmdGVyQm9keTogY29udGV4dHMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS50cmVuZFZpZXcgIT09ICJhdmVyYWdlIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoY29udGV4dHMpIHx8ICFjb250ZXh0cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjb250ZXh0c1swXT8uZGF0YUluZGV4Ow0KICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcmlvZHMgPSBBcnJheS5pc0FycmF5KHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcykgPyBzdGF0ZS5sYXRlc3RUcmVuZFBlcmlvZHMgOiBbXTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJpb2QgPSBwZXJpb2RzW2luZGV4XTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBlcmlvZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmFibGVkID0gTnVtYmVyLmlzRmluaXRlKHBlcmlvZC5lbmFibGVkVXNlcnNDb3VudCkgPyBwZXJpb2QuZW5hYmxlZFVzZXJzQ291bnQgOiAwOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbYEVuYWJsZWQgdXNlcnM6ICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChlbmFibGVkKX1gXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgaW50ZXJhY3Rpb246IHsNCiAgICAgICAgICAgICAgICBtb2RlOiAiaW5kZXgiLA0KICAgICAgICAgICAgICAgIGludGVyc2VjdDogZmFsc2UNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBjb25zdCB0cmVuZEN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0cmVuZENoYXJ0IikuZ2V0Q29udGV4dCgiMmQiKTsNCiAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQgPSBuZXcgQ2hhcnQodHJlbmRDdHgsIHsNCiAgICAgICAgICAgIHR5cGU6ICJsaW5lIiwNCiAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgbGFiZWxzOiBbXSwNCiAgICAgICAgICAgICAgZGF0YXNldHM6IFtdDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgb3B0aW9uczogY3JlYXRlVHJlbmRDaGFydE9wdGlvbnMoKQ0KICAgICAgICAgIH0pOw0KICAgICAgDQogICAgICAgICAgY29uc3QgdXNhZ2VUcmVuZEN0eCA9IGRvbS51c2FnZVRyZW5kQ2FudmFzPy5nZXRDb250ZXh0KCIyZCIpOw0KICAgICAgICAgIGlmICh1c2FnZVRyZW5kQ3R4KSB7DQogICAgICAgICAgICBjb25zdCBheGlzVGlja0NvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS10ZXh0LW11dGVkIiwgIiM0RDU3NUQiKTsNCiAgICAgICAgICAgIGNvbnN0IGF4aXNHcmlkQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyaWQtY29sb3IiLCAicmdiYSgxNTMsIDIwOCwgMTUzLCAwLjE4KSIpOw0KICAgICAgICAgICAgY29uc3QgZnJlcXVlbnRDb2xvciA9IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tZ3JlZW4tNjAwIiwgIiMwMDhBMDAiKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbnRDb2xvciA9IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tYmx1ZS01MDAiLCAiIzNBODRDMSIpOw0KICAgICAgICAgICAgc3RhdGUuY2hhcnRzLnVzYWdlVHJlbmQgPSBuZXcgQ2hhcnQodXNhZ2VUcmVuZEN0eCwgew0KICAgICAgICAgICAgICB0eXBlOiAibGluZSIsDQogICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLA0KICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBbDQogICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiRnJlcXVlbnQgdXNhZ2UiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGZyZXF1ZW50Q29sb3IsDQogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaGV4VG9SZ2JhKGNvbG9yU3RyaW5nVG9IZXgoZnJlcXVlbnRDb2xvcikgfHwgIiMwMDhBMDAiLCAwLjEyKSB8fCAicmdiYSgwLDEzOCwwLDAuMTIpIiwNCiAgICAgICAgICAgICAgICAgICAgdGVuc2lvbjogMC4yOCwNCiAgICAgICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDQsDQogICAgICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IDYsDQogICAgICAgICAgICAgICAgICAgIGZpbGw6IGZhbHNlDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkNvbnNpc3RlbnQgdXNhZ2UiLA0KICAgICAgICAgICAgICAgICAgICBkYXRhOiBbXSwNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGNvbnNpc3RlbnRDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBoZXhUb1JnYmEoY29sb3JTdHJpbmdUb0hleChjb25zaXN0ZW50Q29sb3IpIHx8ICIjM0E4NEMxIiwgMC4xMikgfHwgInJnYmEoNTgsMTMyLDE5MywwLjEyKSIsDQogICAgICAgICAgICAgICAgICAgIHRlbnNpb246IDAuMjgsDQogICAgICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiA0LA0KICAgICAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA2LA0KICAgICAgICAgICAgICAgICAgICBmaWxsOiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgb3B0aW9uczogew0KICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsDQogICAgICAgICAgICAgICAgc2NhbGVzOiB7DQogICAgICAgICAgICAgICAgICB4OiB7DQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsgY29sb3I6IGF4aXNUaWNrQ29sb3IgfQ0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgIHk6IHsNCiAgICAgICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYXhpc0dyaWRDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICBkcmF3Qm9yZGVyOiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB0aWNrczogew0KICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBheGlzVGlja0NvbG9yLA0KICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7DQogICAgICAgICAgICAgICAgICBsZWdlbmQ6IHsNCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AiDQogICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgdG9vbHRpcDogew0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJyZ2JhKDMxLCAzNSwgMzcsIDAuOTIpIiwNCiAgICAgICAgICAgICAgICAgICAgdGl0bGVDb2xvcjogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgICAgICBib2R5Q29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTIsDQogICAgICAgICAgICAgICAgICAgIGNvcm5lclJhZGl1czogMTAsDQogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xvcnM6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczogew0KICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBjb250ZXh0ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBzdGF0ZS51c2FnZVRyZW5kTW9kZSB8fCAibnVtYmVyIjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyLmlzRmluaXRlKGNvbnRleHQucGFyc2VkLnkpID8gY29udGV4dC5wYXJzZWQueSA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gInBlcmNlbnRhZ2UiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtjb250ZXh0LmRhdGFzZXQubGFiZWx9OiAke3ZhbHVlLnRvRml4ZWQoMSl9JWA7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7Y29udGV4dC5kYXRhc2V0LmxhYmVsfTogJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKX0gdXNlcnNgOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgaW50ZXJhY3Rpb246IHsNCiAgICAgICAgICAgICAgICAgIG1vZGU6ICJpbmRleCIsDQogICAgICAgICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUFnZW50VXNhZ2VUZXh0KGNzdlRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBjc3ZUZXh0ICE9PSAic3RyaW5nIiB8fCAhY3N2VGV4dC50cmltKCkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5hZ2VudEVtcHR5KSB7DQogICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBQYXBhLnBhcnNlKGNzdlRleHQsIHsNCiAgICAgICAgICAgICAgaGVhZGVyOiB0cnVlLA0KICAgICAgICAgICAgICBza2lwRW1wdHlMaW5lczogdHJ1ZSwNCiAgICAgICAgICAgICAgY29tcGxldGU6IHJlc3VsdHMgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZWRGaWVsZHMsIG1pc3NpbmdDb2x1bW5zIH0gPSByZXNvbHZlQWdlbnRGaWVsZE1hcHBpbmcocmVzdWx0cz8ubWV0YT8uZmllbGRzKTsNCiAgICAgICAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudFVzYWdlQ2FyZChbXSk7DQogICAgICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudCA9IGBTYXZlZCBhZ2VudCBkYXRhc2V0IGlzIG1pc3NpbmcgcmVxdWlyZWQgY29sdW1uczogJHttaXNzaW5nQ29sdW1ucy5qb2luKCIsICIpfS5gOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudEVtcHR5KSB7DQogICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS50ZXh0Q29udGVudCA9ICJTYXZlZCBhZ2VudCBkYXRhc2V0IGlzIGluY29tcGxldGUuIjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgeyByb3dzLCBza2lwcGVkIH0gPSBidWlsZEFnZW50Um93cyhyZXN1bHRzLmRhdGEsIHJlc29sdmVkRmllbGRzKTsNCiAgICAgICAgICAgICAgICBjb25zdCBhcHBsaWVkID0gaW5nZXN0QWdlbnRVc2FnZVJvd3Mocm93cywgew0KICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogbWV0YS5uYW1lIHx8IG1ldGEuc291cmNlTmFtZSwNCiAgICAgICAgICAgICAgICAgIHNpemU6IG1ldGEuc2l6ZSwNCiAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogbWV0YS5sYXN0TW9kaWZpZWQsDQogICAgICAgICAgICAgICAgICBzYXZlZEF0OiBtZXRhLnNhdmVkQXQNCiAgICAgICAgICAgICAgICB9LCBza2lwcGVkKTsNCiAgICAgICAgICAgICAgICBpZiAoYXBwbGllZCAmJiByb3dzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgcmVtZW1iZXJMYXN0QWdlbnREYXRhc2V0KGNzdlRleHQsIHsNCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbWV0YS5uYW1lIHx8IG1ldGEuc291cmNlTmFtZSwNCiAgICAgICAgICAgICAgICAgICAgc2l6ZTogbWV0YS5zaXplLA0KICAgICAgICAgICAgICAgICAgICByb3dzOiByb3dzLmxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBtZXRhLmxhc3RNb2RpZmllZCwNCiAgICAgICAgICAgICAgICAgICAgc2F2ZWRBdDogbWV0YS5zYXZlZEF0DQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGVycm9yOiBlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGVycm9yICYmIGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlIDogIlVua25vd24gZXJyb3IiOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlNhdmVkIGFnZW50IENTViBwYXJzZSBmYWlsZWQiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgdXBkYXRlQWdlbnRVc2FnZUNhcmQoW10pOw0KICAgICAgICAgICAgICAgIGlmIChkb20uYWdlbnRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudCA9IGBTYXZlZCBhZ2VudCBkYXRhc2V0IGNvdWxkIG5vdCBiZSBwYXJzZWQgKCR7bWVzc2FnZX0pLmA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICAgICAgZG9tLmFnZW50RW1wdHkuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS50ZXh0Q29udGVudCA9ICJVbmFibGUgdG8gcmVzdG9yZSB0aGUgYWdlbnQgdXNhZ2UgZGF0YXNldC4iOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgY29uc3QgZW5hYmxlZExpY2Vuc2VzVmFsdWVQbHVnaW4gPSB7DQogICAgICAgICAgICBpZDogImVuYWJsZWRMaWNlbnNlc1ZhbHVlUGx1Z2luIiwNCiAgICAgICAgICAgIGFmdGVyRGF0YXNldHNEcmF3KGNoYXJ0KSB7DQogICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCBkYXRhIH0gPSBjaGFydDsNCiAgICAgICAgICAgICAgaWYgKCFjdHggfHwgIWRhdGEgfHwgIWRhdGEuZGF0YXNldHMgfHwgIWRhdGEuZGF0YXNldHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IG1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YSgwKTsNCiAgICAgICAgICAgICAgaWYgKCFtZXRhIHx8ICFtZXRhLmRhdGEpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHN0YXRlLnNob3dFbmFibGVkTGljZW5zZUxhYmVscyA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY3R4LnNhdmUoKTsNCiAgICAgICAgICAgICAgY3R4LmZvbnQgPSBgNjAwIDEycHggIkludGVyIiwgIkludGVyIHZhciIsIHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgIlNlZ29lIFVJIiwgc2Fucy1zZXJpZmA7DQogICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLXRleHQtYm9keSIsICIjMWYyMzI1Iik7DQogICAgICAgICAgICAgIGN0eC50ZXh0QWxpZ24gPSAiY2VudGVyIjsNCiAgICAgICAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICJib3R0b20iOw0KICAgICAgICAgICAgICBtZXRhLmRhdGEuZm9yRWFjaCgoZWxlbWVudCwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQgfHwgdHlwZW9mIGVsZW1lbnQueCAhPT0gIm51bWJlciIgfHwgdHlwZW9mIGVsZW1lbnQueSAhPT0gIm51bWJlciIpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhLmRhdGFzZXRzWzBdPy5kYXRhPy5baW5kZXhdOw0KICAgICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWQgPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQodmFsdWUpKTsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQoZm9ybWF0dGVkLCBlbGVtZW50LngsIGVsZW1lbnQueSAtIDgpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9Ow0KICAgICAgDQogICAgICAgICAgY29uc3QgZW5hYmxlZExpY2Vuc2VzQ3R4ID0gZG9tLmVuYWJsZWRMaWNlbnNlc0NhbnZhcz8uZ2V0Q29udGV4dCgiMmQiKTsNCiAgICAgICAgICBpZiAoZW5hYmxlZExpY2Vuc2VzQ3R4KSB7DQogICAgICAgICAgICBjb25zdCBheGlzVGlja0NvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS10ZXh0LW11dGVkIiwgIiM0RDU3NUQiKTsNCiAgICAgICAgICAgIGNvbnN0IGF4aXNHcmlkQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyaWQtY29sb3IiLCAicmdiYSgxNTMsIDIwOCwgMTUzLCAwLjE4KSIpOw0KICAgICAgICAgICAgc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcyA9IG5ldyBDaGFydChlbmFibGVkTGljZW5zZXNDdHgsIHsNCiAgICAgICAgICAgICAgdHlwZTogImJhciIsDQogICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLA0KICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBbew0KICAgICAgICAgICAgICAgICAgbGFiZWw6ICJFbmFibGVkIHVzZXJzIiwNCiAgICAgICAgICAgICAgICAgIGRhdGE6IFtdLA0KICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBjb250ZXh0ID0+IGdldEVuYWJsZWRMaWNlbnNlc0ZpbGwoY29udGV4dCksDQogICAgICAgICAgICAgICAgICBob3ZlckJhY2tncm91bmRDb2xvcjogY29udGV4dCA9PiBnZXRFbmFibGVkTGljZW5zZXNGaWxsKGNvbnRleHQpLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGNvbnRleHQgPT4gZ2V0RW5hYmxlZExpY2Vuc2VzQm9yZGVyQ29sb3IoKSwNCiAgICAgICAgICAgICAgICAgIGhvdmVyQm9yZGVyQ29sb3I6IGNvbnRleHQgPT4gZ2V0RW5hYmxlZExpY2Vuc2VzQm9yZGVyQ29sb3IoKSwNCiAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiAxLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiA4LA0KICAgICAgICAgICAgICAgICAgYm9yZGVyU2tpcHBlZDogZmFsc2UsDQogICAgICAgICAgICAgICAgICBtYXhCYXJUaGlja25lc3M6IDQ2DQogICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgb3B0aW9uczogew0KICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsDQogICAgICAgICAgICAgICAgc2NhbGVzOiB7DQogICAgICAgICAgICAgICAgICB4OiB7DQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsgY29sb3I6IGF4aXNUaWNrQ29sb3IgfQ0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgIHk6IHsNCiAgICAgICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsDQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYXhpc0dyaWRDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICBkcmF3Qm9yZGVyOiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB0aWNrczogew0KICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBheGlzVGlja0NvbG9yLA0KICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7DQogICAgICAgICAgICAgICAgICBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAicmdiYSgzMSwgMzUsIDM3LCAwLjkyKSIsDQogICAgICAgICAgICAgICAgICAgIHRpdGxlQ29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgICAgYm9keUNvbG9yOiAiI2ZmZmZmZiIsDQogICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwLA0KICAgICAgICAgICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDEwLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3JzOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7DQogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNvbnRleHQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUoY29udGV4dC5wYXJzZWQueSkgPyBjb250ZXh0LnBhcnNlZC55IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKX0gZW5hYmxlZCB1c2Vyc2A7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBwbHVnaW5zOiBbZW5hYmxlZExpY2Vuc2VzVmFsdWVQbHVnaW5dDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHVwZGF0ZUVuYWJsZWRMaWNlbnNlc0NvbG9ySW5wdXRzKCk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgY29uc3QgcmV0dXJuaW5nVXNlcnNDdHggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbZGF0YS1yZXR1cm5pbmctY2hhcnRdIik/LmdldENvbnRleHQoIjJkIik7DQogICAgICAgICAgaWYgKHJldHVybmluZ1VzZXJzQ3R4KSB7DQogICAgICAgICAgICBjb25zdCBheGlzVGlja0NvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS10ZXh0LW11dGVkIiwgIiM0RDU3NUQiKTsNCiAgICAgICAgICAgIGNvbnN0IGF4aXNHcmlkQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyaWQtY29sb3IiLCAicmdiYSgxNTMsIDIwOCwgMTUzLCAwLjE4KSIpOw0KICAgICAgICAgICAgY29uc3QgbGluZUNvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS1ibHVlLTUwMCIsICIjM0E4NEMxIik7DQogICAgICAgICAgICBjb25zdCBmaWxsQ29sb3IgPSBoZXhUb1JnYmEoY29sb3JTdHJpbmdUb0hleChsaW5lQ29sb3IpIHx8ICIjM0E4NEMxIiwgMC4xNSkgfHwgInJnYmEoNTgsIDEzMiwgMTkzLCAwLjE1KSI7DQogICAgICAgICAgICBzdGF0ZS5jaGFydHMucmV0dXJuaW5nVXNlcnMgPSBuZXcgQ2hhcnQocmV0dXJuaW5nVXNlcnNDdHgsIHsNCiAgICAgICAgICAgICAgdHlwZTogImxpbmUiLA0KICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICAgICAgICAgICAgbGFiZWxzOiBbXSwNCiAgICAgICAgICAgICAgICBkYXRhc2V0czogW3sNCiAgICAgICAgICAgICAgICAgIGxhYmVsOiAiUmV0dXJuaW5nIHVzZXJzIiwNCiAgICAgICAgICAgICAgICAgIGRhdGE6IFtdLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGxpbmVDb2xvciwNCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogZmlsbENvbG9yLA0KICAgICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IDQsDQogICAgICAgICAgICAgICAgICBwb2ludEhvdmVyUmFkaXVzOiA2LA0KICAgICAgICAgICAgICAgICAgcG9pbnRCYWNrZ3JvdW5kQ29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgIHRlbnNpb246IDAuMjQsDQogICAgICAgICAgICAgICAgICBmaWxsOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIG9wdGlvbnM6IHsNCiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLA0KICAgICAgICAgICAgICAgIHNjYWxlczogew0KICAgICAgICAgICAgICAgICAgeDogew0KICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sDQogICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7IGNvbG9yOiBheGlzVGlja0NvbG9yIH0NCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB5OiB7DQogICAgICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBncmlkOiB7DQogICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGF4aXNHcmlkQ29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgZHJhd0JvcmRlcjogZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYXhpc1RpY2tDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogdmFsdWUgPT4gc3RhdGUucmV0dXJuaW5nTWV0cmljID09PSAicGVyY2VudGFnZSINCiAgICAgICAgICAgICAgICAgICAgICAgID8gYCR7TnVtYmVyKHZhbHVlKS50b0ZpeGVkKDApfSVgDQogICAgICAgICAgICAgICAgICAgICAgICA6IG51bWJlckZvcm1hdHRlci5mb3JtYXQodmFsdWUpDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHBsdWdpbnM6IHsNCiAgICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LA0KICAgICAgICAgICAgICAgICAgdG9vbHRpcDogew0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICJyZ2JhKDMxLCAzNSwgMzcsIDAuOTIpIiwNCiAgICAgICAgICAgICAgICAgICAgdGl0bGVDb2xvcjogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgICAgICBib2R5Q29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMTAsDQogICAgICAgICAgICAgICAgICAgIGNvcm5lclJhZGl1czogMTAsDQogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlDb2xvcnM6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogY29udGV4dCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE51bWJlci5pc0Zpbml0ZShjb250ZXh0LnBhcnNlZC55KSA/IGNvbnRleHQucGFyc2VkLnkgOiAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnJldHVybmluZ01ldHJpYyA9PT0gInBlcmNlbnRhZ2UiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHt2YWx1ZS50b0ZpeGVkKDEpfSUgcmV0dXJuaW5nYDsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKX0gcmV0dXJuaW5nIHVzZXJzYDsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGludGVyYWN0aW9uOiB7DQogICAgICAgICAgICAgICAgICBtb2RlOiAiaW5kZXgiLA0KICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgYXBwbHlDaGFydFRoZW1lU3R5bGVzKCk7DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBhcHBseUNoYXJ0VGhlbWVTdHlsZXMoKSB7DQogICAgICAgICAgICBjb25zdCBheGlzVGlja0NvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS10ZXh0LW11dGVkIiwgIiM0RDU3NUQiKTsNCiAgICAgICAgICAgIGNvbnN0IGF4aXNHcmlkQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyaWQtY29sb3IiLCAicmdiYSgxNTMsIDIwOCwgMTUzLCAwLjE4KSIpOw0KICAgICAgICAgICAgcmVmcmVzaEVuYWJsZWRMaWNlbnNlc1RoZW1lQ29sb3JzKCk7DQogICAgICAgICAgICBjb25zdCBjaGFydHMgPSBbDQogICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy50cmVuZCwNCiAgICAgICAgICAgICAgLi4uc3RhdGUuY2hhcnRzLnVzYWdlRnJlcXVlbmN5LnZhbHVlcygpLA0KICAgICAgICAgICAgICAuLi5zdGF0ZS5jaGFydHMudXNhZ2VDb25zaXN0ZW5jeS52YWx1ZXMoKSwNCiAgICAgICAgICAgICAgc3RhdGUuY2hhcnRzLnVzYWdlVHJlbmQsDQogICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy5yZXR1cm5pbmdVc2VycywNCiAgICAgICAgICAgICAgc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlcw0KICAgICAgICAgICAgXTsNCiAgICAgICAgICAgIGNoYXJ0cy5mb3JFYWNoKGNoYXJ0ID0+IHsNCiAgICAgICAgICAgICAgaWYgKCFjaGFydCB8fCAhY2hhcnQub3B0aW9ucyB8fCAhY2hhcnQub3B0aW9ucy5zY2FsZXMpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgeyBzY2FsZXMgfSA9IGNoYXJ0Lm9wdGlvbnM7DQogICAgICAgICAgICAgIGlmIChzY2FsZXMueCAmJiBzY2FsZXMueC50aWNrcykgew0KICAgICAgICAgICAgICAgIHNjYWxlcy54LnRpY2tzLmNvbG9yID0gYXhpc1RpY2tDb2xvcjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoc2NhbGVzLnkgJiYgc2NhbGVzLnkudGlja3MpIHsNCiAgICAgICAgICAgICAgICBzY2FsZXMueS50aWNrcy5jb2xvciA9IGF4aXNUaWNrQ29sb3I7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHNjYWxlcy54ICYmIHNjYWxlcy54LmdyaWQgJiYgdHlwZW9mIHNjYWxlcy54LmdyaWQuY29sb3IgIT09ICJ1bmRlZmluZWQiICYmIHNjYWxlcy54LmdyaWQuZGlzcGxheSAhPT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICBzY2FsZXMueC5ncmlkLmNvbG9yID0gYXhpc0dyaWRDb2xvcjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoc2NhbGVzLnkgJiYgc2NhbGVzLnkuZ3JpZCkgew0KICAgICAgICAgICAgICAgIHNjYWxlcy55LmdyaWQuY29sb3IgPSBheGlzR3JpZENvbG9yOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNoYXJ0LnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gc2V0VHJlbmRDb2xvcklucHV0cyhzdGFydEhleCwgZW5kSGV4KSB7DQogICAgICAgICAgICBpZiAoZG9tLnRyZW5kQ29sb3JTdGFydCkgew0KICAgICAgICAgICAgICBkb20udHJlbmRDb2xvclN0YXJ0LnZhbHVlID0gc2FuaXRpemVIZXhDb2xvcihzdGFydEhleCkgfHwgREVGQVVMVF9UUkVORF9TVEFSVF9DT0xPUjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20udHJlbmRDb2xvckVuZCkgew0KICAgICAgICAgICAgICBkb20udHJlbmRDb2xvckVuZC52YWx1ZSA9IHNhbml0aXplSGV4Q29sb3IoZW5kSGV4KSB8fCBERUZBVUxUX1RSRU5EX0VORF9DT0xPUjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwZXJzaXN0VHJlbmRHcmFkaWVudChzdGFydEhleCwgZW5kSGV4KSB7DQogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVFJFTkRfQ09MT1JfU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHsgc3RhcnQ6IHN0YXJ0SGV4LCBlbmQ6IGVuZEhleCB9KSk7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IHRyZW5kIGNvbG9ycyIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjbGVhclN0b3JlZFRyZW5kR3JhZGllbnQoKSB7DQogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oVFJFTkRfQ09MT1JfU1RPUkFHRV9LRVkpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gY2xlYXIgc3RvcmVkIHRyZW5kIGNvbG9ycyIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiByZWZyZXNoVHJlbmRDb2xvcnMoKSB7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLnRyZW5kICYmIEFycmF5LmlzQXJyYXkoc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzKSAmJiBzdGF0ZS5sYXRlc3RUcmVuZFBlcmlvZHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHVwZGF0ZVRyZW5kQ2hhcnQoc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzZXRUcmVuZENvbG9yQ29udHJvbHNWaXNpYmlsaXR5KGlzVmlzaWJsZSkgew0KICAgICAgICAgICAgaWYgKGRvbS50cmVuZENvbG9yQ29udHJvbHMpIHsNCiAgICAgICAgICAgICAgZG9tLnRyZW5kQ29sb3JDb250cm9scy5oaWRkZW4gPSAhaXNWaXNpYmxlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGFwcGx5VHJlbmRHcmFkaWVudChzdGFydEhleCwgZW5kSGV4LCB7IHBlcnNpc3QgPSB0cnVlIH0gPSB7fSkgew0KICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBzYW5pdGl6ZUhleENvbG9yKHN0YXJ0SGV4KTsNCiAgICAgICAgICAgIGNvbnN0IGVuZCA9IHNhbml0aXplSGV4Q29sb3IoZW5kSGV4KTsNCiAgICAgICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQtaGV4Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdGF0ZS50cmVuZENvbG9yUHJlZmVyZW5jZSA9IHsgc3RhcnQsIGVuZCB9Ow0KICAgICAgICAgICAgc2V0VHJlbmRDb2xvcklucHV0cyhzdGFydCwgZW5kKTsNCiAgICAgICAgICAgIGlmIChwZXJzaXN0KSB7DQogICAgICAgICAgICAgIHBlcnNpc3RUcmVuZEdyYWRpZW50KHN0YXJ0LCBlbmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVmcmVzaFRyZW5kQ29sb3JzKCk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gcmVzZXRUcmVuZEdyYWRpZW50KHsgcGVyc2lzdCA9IHRydWUgfSA9IHt9KSB7DQogICAgICAgICAgICBzdGF0ZS50cmVuZENvbG9yUHJlZmVyZW5jZSA9IHsgc3RhcnQ6IG51bGwsIGVuZDogbnVsbCB9Ow0KICAgICAgICAgICAgc2V0VHJlbmRDb2xvcklucHV0cyhERUZBVUxUX1RSRU5EX1NUQVJUX0NPTE9SLCBERUZBVUxUX1RSRU5EX0VORF9DT0xPUik7DQogICAgICAgICAgICBpZiAocGVyc2lzdCkgew0KICAgICAgICAgICAgICBjbGVhclN0b3JlZFRyZW5kR3JhZGllbnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlZnJlc2hUcmVuZENvbG9ycygpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGxvYWRTdG9yZWRUcmVuZEdyYWRpZW50KCkgew0KICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7DQogICAgICAgICAgICAgIHJlc2V0VHJlbmRHcmFkaWVudCh7IHBlcnNpc3Q6IGZhbHNlIH0pOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBjb25zdCByYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUUkVORF9DT0xPUl9TVE9SQUdFX0tFWSk7DQogICAgICAgICAgICAgIGlmICghcmF3KSB7DQogICAgICAgICAgICAgICAgcmVzZXRUcmVuZEdyYWRpZW50KHsgcGVyc2lzdDogZmFsc2UgfSk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UocmF3KTsNCiAgICAgICAgICAgICAgY29uc3Qgc3RhcnQgPSBzYW5pdGl6ZUhleENvbG9yKHBhcnNlZD8uc3RhcnQpOw0KICAgICAgICAgICAgICBjb25zdCBlbmQgPSBzYW5pdGl6ZUhleENvbG9yKHBhcnNlZD8uZW5kKTsNCiAgICAgICAgICAgICAgaWYgKHN0YXJ0ICYmIGVuZCkgew0KICAgICAgICAgICAgICAgIGFwcGx5VHJlbmRHcmFkaWVudChzdGFydCwgZW5kLCB7IHBlcnNpc3Q6IGZhbHNlIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gbG9hZCBzdG9yZWQgdHJlbmQgY29sb3JzIiwgZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVzZXRUcmVuZEdyYWRpZW50KHsgcGVyc2lzdDogZmFsc2UgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS50cmVuZENvbG9ySGludCAmJiAhd2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgZG9tLnRyZW5kQ29sb3JIaW50LnRleHRDb250ZW50ID0gIkNvbG9yIGNob2ljZXMgcmVzZXQgd2hlbiB5b3UgcmVmcmVzaCB0aGlzIGJyb3dzZXIuIjsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmFwcGx5VHJlbmRDb2xvcnMpIHsNCiAgICAgICAgICAgIGRvbS5hcHBseVRyZW5kQ29sb3JzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGFwcGx5VHJlbmRHcmFkaWVudChkb20udHJlbmRDb2xvclN0YXJ0Py52YWx1ZSB8fCBERUZBVUxUX1RSRU5EX1NUQVJUX0NPTE9SLCBkb20udHJlbmRDb2xvckVuZD8udmFsdWUgfHwgREVGQVVMVF9UUkVORF9FTkRfQ09MT1IpOw0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1VuYWJsZSB0byB1cGRhdGUgdHJlbmQgY29sb3JzJywgZXJyb3IpOw0KICAgICAgICAgICAgICAgIGFsZXJ0KCdDb3VsZCBub3QgdXBkYXRlIGNvbG9ycy4gUGxlYXNlIGNob29zZSB2YWxpZCBoZXggY29sb3JzLicpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLnJlc2V0VHJlbmRDb2xvcnMpIHsNCiAgICAgICAgICAgIGRvbS5yZXNldFRyZW5kQ29sb3JzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KICAgICAgICAgICAgICByZXNldFRyZW5kR3JhZGllbnQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIHNldFRyZW5kQ29sb3JJbnB1dHMoREVGQVVMVF9UUkVORF9TVEFSVF9DT0xPUiwgREVGQVVMVF9UUkVORF9FTkRfQ09MT1IpOw0KICAgICAgICAgIGxvYWRQZXJzaXN0ZW5jZVByZWZlcmVuY2UoKTsNCiAgICAgICAgICBjb25zdCBzdG9yZWRUaGVtZSA9IGxvYWRTdG9yZWRUaGVtZVByZWZlcmVuY2UoKTsNCiAgICAgICAgICBpZiAoc3RvcmVkVGhlbWUpIHsNCiAgICAgICAgICAgIGFwcGx5VGhlbWUoc3RvcmVkVGhlbWUsIHsgcGVyc2lzdDogZmFsc2UgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGFwcGx5VGhlbWUoc3RhdGUudGhlbWUsIHsgcGVyc2lzdDogZmFsc2UgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGxvYWRTdG9yZWRUcmVuZEdyYWRpZW50KCk7DQogICAgICAgICAgbG9hZFN0b3JlZERhdGFzZXRGcm9tRGV2aWNlKCk7CiAgICAgICAgICBsb2FkU3RvcmVkQWdlbnREYXRhc2V0RnJvbURldmljZSgpOwogICAgICAgICAgbG9hZFN0b3JlZEFnZW50SHViRGF0YXNldHNGcm9tRGV2aWNlKCk7CiAgICAgICAgICBpZiAod2luZG93Ll9fQ09QSUxPVF9FTUJFRF9PUFRJT05TX18pIHsNCiAgICAgICAgICAgIGJvb3RzdHJhcEVtYmVkZGVkU25hcHNob3Qod2luZG93Ll9fQ09QSUxPVF9FTUJFRF9PUFRJT05TX18pOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGluaXRpYWxpemVTZXJpZXNUb2dnbGVzKCk7DQogICAgICAgICAgdXBkYXRlU2VyaWVzVG9nZ2xlU3RhdGUoKTsNCiAgICAgICAgICB1cGRhdGVDdXN0b21SYW5nZVZpc2liaWxpdHkoKTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uc2VyaWVzTW9kZVRvZ2dsZSkgew0KICAgICAgICAgICAgZG9tLnNlcmllc01vZGVUb2dnbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIHN0YXRlLnNlcmllc0RldGFpbE1vZGUgPSBzdGF0ZS5zZXJpZXNEZXRhaWxNb2RlID09PSAibm9uZSIgPyAicmVzcGVjdCIgOiAibm9uZSI7DQogICAgICAgICAgICAgIHVwZGF0ZVNlcmllc0RldGFpbE1vZGVCdXR0b24oKTsNCiAgICAgICAgICAgICAgdXBkYXRlRXhwb3J0RGV0YWlsT3B0aW9uKCk7DQogICAgICAgICAgICAgIHJlbmRlckRhc2hib2FyZCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS50aGVtZVRvZ2dsZSkgew0KICAgICAgICAgICAgZG9tLnRoZW1lVG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBuZXh0VGhlbWUgPSBzdGF0ZS50aGVtZSA9PT0gImRhcmsiID8gImxpZ2h0IiA6ICJkYXJrIjsNCiAgICAgICAgICAgICAgYXBwbHlUaGVtZShuZXh0VGhlbWUpOw0KICAgICAgICAgICAgICByZW5kZXJEYXNoYm9hcmQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGRvbS5maWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXMgfHwgW107DQogICAgICAgICAgICBjb25zdCBmaWxlID0gZmlsZXNbMF07DQogICAgICAgICAgICBpZiAoZmlsZSkgew0KICAgICAgICAgICAgICBoYW5kbGVGaWxlKGZpbGUpOw0KICAgICAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20udXBsb2FkQ2FuY2VsKSB7DQogICAgICAgICAgICBkb20udXBsb2FkQ2FuY2VsLmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIGRvbS51cGxvYWRDYW5jZWwuc2V0QXR0cmlidXRlKCJhcmlhLWRpc2FibGVkIiwgInRydWUiKTsNCiAgICAgICAgICAgIGRvbS51cGxvYWRDYW5jZWwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBldmVudCA9PiB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIGNhbmNlbEFjdGl2ZVBhcnNlKHsgc2lsZW50OiBmYWxzZSB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20ubG9hZFNhbXBsZUJ1dHRvbikgew0KICAgICAgICAgICAgZG9tLmxvYWRTYW1wbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBldmVudCA9PiB7DQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgIGxvYWRTYW1wbGVEYXRhc2V0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLnJlc2V0RmlsdGVyc0J1dHRvbikgew0KICAgICAgICAgICAgZG9tLnJlc2V0RmlsdGVyc0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgcmVzZXRGaWx0ZXJzVG9EZWZhdWx0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLnBlcnNpc3RDb25zZW50KSB7CiAgICAgICAgICAgIGRvbS5wZXJzaXN0Q29uc2VudC5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgZW5hYmxlZCA9IEJvb2xlYW4oZG9tLnBlcnNpc3RDb25zZW50LmNoZWNrZWQpOwogICAgICAgICAgICAgIHN0YXRlLnBlcnNpc3REYXRhc2V0cyA9IGVuYWJsZWQ7CiAgICAgICAgICAgICAgcGVyc2lzdFBlcnNpc3RlbmNlUHJlZmVyZW5jZShlbmFibGVkKTsKICAgICAgICAgICAgICBpZiAoIWVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGNsZWFyU3RvcmVkRGF0YXNldCh7IHF1aWV0OiB0cnVlLCBrZWVwUnVudGltZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gV2hlbiBwZXJzaXN0ZW5jZSBpcyB0b2dnbGVkIGJhY2sgb24sIGltbWVkaWF0ZWx5IGh5ZHJhdGUgZnJvbSBhbnkgZXhpc3RpbmcgY2FjaGUgc28gdXNlcnMgZG8gbm90IG5lZWQgdG8gcmUtdXBsb2FkIGxhcmdlIENTVnMuCiAgICAgICAgICAgICAgICBpZiAobGFzdFBhcnNlZENzdlRleHQpIHsKICAgICAgICAgICAgICAgICAgcGVyc2lzdERhdGFzZXQobGFzdFBhcnNlZENzdlRleHQsIGxhc3RQYXJzZWRDc3ZNZXRhIHx8IHt9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGxvYWRTdG9yZWREYXRhc2V0RnJvbURldmljZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxhc3RQYXJzZWRBZ2VudENzdlRleHQpIHsKICAgICAgICAgICAgICAgICAgcGVyc2lzdEFnZW50RGF0YXNldChsYXN0UGFyc2VkQWdlbnRDc3ZUZXh0LCBsYXN0UGFyc2VkQWdlbnRNZXRhIHx8IHt9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGxvYWRTdG9yZWRBZ2VudERhdGFzZXRGcm9tRGV2aWNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBoYXNBZ2VudEh1YkRhdGEgPSBBR0VOVF9IVUJfVFlQRVMuc29tZSh0eXBlID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHN0YXRlLmFnZW50SHViPy5kYXRhc2V0cz8uW3R5cGVdOwogICAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhc2V0Py5yb3dzKSAmJiBkYXRhc2V0LnJvd3MubGVuZ3RoOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpZiAoaGFzQWdlbnRIdWJEYXRhKSB7CiAgICAgICAgICAgICAgICAgIHBlcnNpc3RBZ2VudEh1YlNuYXBzaG90KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBsb2FkU3RvcmVkQWdlbnRIdWJEYXRhc2V0c0Zyb21EZXZpY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBkb20uZHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCBldmVudCA9PiB7DQogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICAgICAgZG9tLmRyb3Bab25lLmNsYXNzTGlzdC5hZGQoImlzLWRyYWdvdmVyIik7DQogICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICBkb20uZHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ2xlYXZlIiwgKCkgPT4gew0KICAgICAgICAgICAgZG9tLmRyb3Bab25lLmNsYXNzTGlzdC5yZW1vdmUoImlzLWRyYWdvdmVyIik7DQogICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICBkb20uZHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcigiZHJvcCIsIGV2ZW50ID0+IHsKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZG9tLmRyb3Bab25lLmNsYXNzTGlzdC5yZW1vdmUoImlzLWRyYWdvdmVyIik7CiAgICAgICAgICAgIGNvbnN0IHRyYW5zZmVyRmlsZXMgPSAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlcykgfHwgW107CiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB0cmFuc2ZlckZpbGVzWzBdOwogICAgICAgICAgICBpZiAoZmlsZSkgewogICAgICAgICAgICAgIGhhbmRsZUZpbGUoZmlsZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgaW5pdGlhbGl6ZUFnZW50SHViKCk7CiAgICAgICAgICBkb20ub3JnYW5pemF0aW9uRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9ucyA9IGV4dHJhY3RNdWx0aVNlbGVjdFZhbHVlcyhkb20ub3JnYW5pemF0aW9uRmlsdGVyKTsKICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5vcmdhbml6YXRpb24gPSBuZXcgU2V0KHNlbGVjdGlvbnMpOwogICAgICAgICAgICBzeW5jTXVsdGlTZWxlY3QoZG9tLm9yZ2FuaXphdGlvbkZpbHRlciwgc3RhdGUuZmlsdGVycy5vcmdhbml6YXRpb24pOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGRvbS5jb3VudHJ5RmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbnMgPSBleHRyYWN0TXVsdGlTZWxlY3RWYWx1ZXMoZG9tLmNvdW50cnlGaWx0ZXIpOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jb3VudHJ5ID0gbmV3IFNldChzZWxlY3Rpb25zKTsNCiAgICAgICAgICAgIHN5bmNNdWx0aVNlbGVjdChkb20uY291bnRyeUZpbHRlciwgc3RhdGUuZmlsdGVycy5jb3VudHJ5KTsNCiAgICAgICAgICAgIHJlbmRlckRhc2hib2FyZCgpOw0KICAgICAgICAgICAgcGVyc2lzdEZpbHRlclByZWZlcmVuY2VzKCk7DQogICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICBkb20udGltZWZyYW1lRmlsdGVyLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMudGltZWZyYW1lID0gZG9tLnRpbWVmcmFtZUZpbHRlci52YWx1ZTsNCiAgICAgICAgICAgIGlmIChzdGF0ZS5maWx0ZXJzLnRpbWVmcmFtZSA9PT0gImN1c3RvbSIpIHsNCiAgICAgICAgICAgICAgZW5zdXJlQ3VzdG9tUmFuZ2VEZWZhdWx0cygpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21SYW5nZUludmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUN1c3RvbVJhbmdlVmlzaWJpbGl0eSgpOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uY3VzdG9tUmFuZ2VTdGFydCkgew0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gew0KICAgICAgICAgICAgICBoYW5kbGVDdXN0b21SYW5nZUNoYW5nZSgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5jdXN0b21SYW5nZUVuZCkgew0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsNCiAgICAgICAgICAgICAgaGFuZGxlQ3VzdG9tUmFuZ2VDaGFuZ2UoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGRvbS5hZ2dyZWdhdGVGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gew0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGUgPSBkb20uYWdncmVnYXRlRmlsdGVyLnZhbHVlOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9KTsNCg0KICAgICAgICAgIGRvbS5tZXRyaWNGaWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gew0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5tZXRyaWMgPSBkb20ubWV0cmljRmlsdGVyLnZhbHVlOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20udHJlbmRWaWV3QnV0dG9ucyAmJiBkb20udHJlbmRWaWV3QnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGRvbS50cmVuZFZpZXdCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBidXR0b24uZGF0YXNldC50cmVuZFZpZXcgPT09ICJhdmVyYWdlIiA/ICJhdmVyYWdlIiA6ICJ0b3RhbCI7DQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnRyZW5kVmlldyA9PT0gdmlldykgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdGF0ZS50cmVuZFZpZXcgPSB2aWV3Ow0KICAgICAgICAgICAgICAgIHVwZGF0ZVRyZW5kVmlld1RvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICAgICAgY29uc3QgcGVyaW9kcyA9IEFycmF5LmlzQXJyYXkoc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzKSA/IHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA6IFtdOw0KICAgICAgICAgICAgICAgIGlmIChwZXJpb2RzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgdXBkYXRlVHJlbmRDYXB0aW9uVGV4dCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB1cGRhdGVUcmVuZENoYXJ0KHBlcmlvZHMpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGNvbnN0IGhhbmRsZVVzYWdlVGhyZXNob2xkQ2hhbmdlID0gKCkgPT4gew0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZVVzYWdlVGhyZXNob2xkSW5wdXRzKA0KICAgICAgICAgICAgICBkb20udXNhZ2VUaHJlc2hvbGRNaWRkbGUgPyBkb20udXNhZ2VUaHJlc2hvbGRNaWRkbGUudmFsdWUgOiB1bmRlZmluZWQsDQogICAgICAgICAgICAgIGRvbS51c2FnZVRocmVzaG9sZEhpZ2ggPyBkb20udXNhZ2VUaHJlc2hvbGRIaWdoLnZhbHVlIDogdW5kZWZpbmVkDQogICAgICAgICAgICApOw0KICAgICAgICAgICAgc3RhdGUudXNhZ2VUaHJlc2hvbGRzID0gbm9ybWFsaXplZDsNCiAgICAgICAgICAgIHN5bmNVc2FnZVRocmVzaG9sZElucHV0cygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgfTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20udXNhZ2VUaHJlc2hvbGRNaWRkbGUpIHsNCiAgICAgICAgICAgIGRvbS51c2FnZVRocmVzaG9sZE1pZGRsZS5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCBoYW5kbGVVc2FnZVRocmVzaG9sZENoYW5nZSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS51c2FnZVRocmVzaG9sZEhpZ2gpIHsNCiAgICAgICAgICAgIGRvbS51c2FnZVRocmVzaG9sZEhpZ2guYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgaGFuZGxlVXNhZ2VUaHJlc2hvbGRDaGFuZ2UpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20ucmV0dXJuaW5nTWV0cmljKSB7DQogICAgICAgICAgICBkb20ucmV0dXJuaW5nTWV0cmljLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsICgpID0+IHsNCiAgICAgICAgICAgICAgc3RhdGUucmV0dXJuaW5nTWV0cmljID0gZG9tLnJldHVybmluZ01ldHJpYy52YWx1ZSB8fCAidG90YWwiOw0KICAgICAgICAgICAgICByZW5kZXJEYXNoYm9hcmQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGRvbS5ncm91cEZpbHRlci5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7DQogICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmdyb3VwID0gZG9tLmdyb3VwRmlsdGVyLnZhbHVlOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgIGlmIChkb20udXNhZ2VUcmVuZFRvZ2dsZUJ1dHRvbnMgJiYgZG9tLnVzYWdlVHJlbmRUb2dnbGVCdXR0b25zLmxlbmd0aCkgew0KICAgICAgICAgICAgZG9tLnVzYWdlVHJlbmRUb2dnbGVCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG1vZGUgPSBidXR0b24uZGF0YXNldC51c2FnZVRyZW5kTW9kZSA9PT0gInBlcmNlbnRhZ2UiID8gInBlcmNlbnRhZ2UiIDogIm51bWJlciI7DQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnVzYWdlVHJlbmRNb2RlID09PSBtb2RlKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0YXRlLnVzYWdlVHJlbmRNb2RlID0gbW9kZTsNCiAgICAgICAgICAgICAgICB1cGRhdGVVc2FnZVRyZW5kVG9nZ2xlU3RhdGUoKTsNCiAgICAgICAgICAgICAgICB1cGRhdGVVc2FnZVRyZW5kQ2hhcnQoc3RhdGUubGF0ZXN0VXNhZ2VNb250aHMpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20ucmV0dXJuaW5nTWV0cmljQnV0dG9ucyAmJiBkb20ucmV0dXJuaW5nTWV0cmljQnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdNZXRyaWNCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG1ldHJpYyA9IGJ1dHRvbi5kYXRhc2V0LnJldHVybmluZ01ldHJpY0J1dHRvbiA9PT0gInBlcmNlbnRhZ2UiID8gInBlcmNlbnRhZ2UiIDogInRvdGFsIjsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUucmV0dXJuaW5nTWV0cmljID09PSBtZXRyaWMpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RhdGUucmV0dXJuaW5nTWV0cmljID0gbWV0cmljOw0KICAgICAgICAgICAgICAgIHVwZGF0ZVJldHVybmluZ01ldHJpY1RvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5yZXR1cm5pbmdJbnRlcnZhbEJ1dHRvbnMgJiYgZG9tLnJldHVybmluZ0ludGVydmFsQnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdJbnRlcnZhbEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBidXR0b24uZGF0YXNldC5yZXR1cm5pbmdJbnRlcnZhbCA9PT0gIm1vbnRobHkiID8gIm1vbnRobHkiIDogIndlZWtseSI7DQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLnJldHVybmluZ0ludGVydmFsID09PSBpbnRlcnZhbCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCA9IGludGVydmFsOw0KICAgICAgICAgICAgICAgIHVwZGF0ZVJldHVybmluZ0ludGVydmFsVG9nZ2xlU3RhdGUoKTsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubGF0ZXN0UmV0dXJuaW5nQWdncmVnYXRlcykgew0KICAgICAgICAgICAgICAgICAgdXBkYXRlUmV0dXJuaW5nVXNlcnMoc3RhdGUubGF0ZXN0UmV0dXJuaW5nQWdncmVnYXRlcyk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHVwZGF0ZVJldHVybmluZ1VzZXJzKG51bGwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBkb20udmlld01vcmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICBpZiAoIXN0YXRlLmxhdGVzdEdyb3VwRGF0YSB8fCAhQXJyYXkuaXNBcnJheShzdGF0ZS5sYXRlc3RHcm91cERhdGEuZ3JvdXBzKSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdGF0ZS5ncm91cHNFeHBhbmRlZCA9ICFzdGF0ZS5ncm91cHNFeHBhbmRlZDsNCiAgICAgICAgICAgIHVwZGF0ZUdyb3VwVGFibGUoc3RhdGUubGF0ZXN0R3JvdXBEYXRhLmdyb3Vwcywgc3RhdGUubGF0ZXN0R3JvdXBEYXRhLnRvdGFsTWV0cmljVmFsdWUgfHwgMCk7DQogICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLnRvcFVzZXJzVG9nZ2xlKSB7DQogICAgICAgICAgICBkb20udG9wVXNlcnNUb2dnbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZS5sYXRlc3RUb3BVc2VycykpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc3RhdGUudG9wVXNlcnNFeHBhbmRlZCA9ICFzdGF0ZS50b3BVc2Vyc0V4cGFuZGVkOw0KICAgICAgICAgICAgICBidWlsZFRvcFVzZXJzTGlzdChzdGF0ZS5sYXRlc3RUb3BVc2Vycyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmFkb3B0aW9uVG9nZ2xlKSB7DQogICAgICAgICAgICBkb20uYWRvcHRpb25Ub2dnbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGlmICghc3RhdGUubGF0ZXN0QWRvcHRpb24pIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc3RhdGUuYWRvcHRpb25TaG93RGV0YWlscyA9ICFzdGF0ZS5hZG9wdGlvblNob3dEZXRhaWxzOw0KICAgICAgICAgICAgICB1cGRhdGVBZG9wdGlvbkJ5QXBwKHN0YXRlLmxhdGVzdEFkb3B0aW9uKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uYWN0aXZlRGF5c1RvZ2dsZUJ1dHRvbnMgJiYgZG9tLmFjdGl2ZURheXNUb2dnbGVCdXR0b25zLmxlbmd0aCkgew0KICAgICAgICAgICAgZG9tLmFjdGl2ZURheXNUb2dnbGVCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBidXR0b24uZGF0YXNldC5hY3RpdmVEYXlzVmlldyA9PT0gInByb21wdHMiID8gInByb21wdHMiIDogInVzZXJzIjsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuYWN0aXZlRGF5c1ZpZXcgPT09IHZpZXcpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RhdGUuYWN0aXZlRGF5c1ZpZXcgPSB2aWV3Ow0KICAgICAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZURheXNUb2dnbGVTdGF0ZSgpOw0KICAgICAgICAgICAgICAgIHVwZGF0ZUFjdGl2ZURheXNDYXJkKHN0YXRlLmxhdGVzdEFjdGl2ZURheXMpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uYWdlbnRVcGxvYWRCdXR0b24gJiYgZG9tLmFnZW50RmlsZUlucHV0KSB7DQogICAgICAgICAgICBkb20uYWdlbnRVcGxvYWRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGRvbS5hZ2VudEZpbGVJbnB1dC5jbGljaygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBkb20uYWdlbnRGaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgICBoYW5kbGVBZ2VudEZpbGVTZWxlY3Rpb24oZXZlbnQpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5hZ2VudFZpZXdUb2dnbGUpIHsNCiAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gQXJyYXkuaXNBcnJheShzdGF0ZS5hZ2VudFVzYWdlUm93cykgPyBzdGF0ZS5hZ2VudFVzYWdlUm93cy5sZW5ndGggOiAwOw0KICAgICAgICAgICAgICBpZiAoIXRvdGFsKSB7DQogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSA1Ow0KICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKHN0YXRlLmFnZW50VXNhZ2VSb3dzKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoc3RhdGUuYWdlbnREaXNwbGF5TGltaXQpIHx8IHN0YXRlLmFnZW50RGlzcGxheUxpbWl0ID49IHRvdGFsKSB7DQogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSA1Ow0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNvbnN0IGluY3JlbWVudCA9IDUwOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRMaW1pdCA9IChzdGF0ZS5hZ2VudERpc3BsYXlMaW1pdCB8fCA1KSArIGluY3JlbWVudDsNCiAgICAgICAgICAgICAgICBzdGF0ZS5hZ2VudERpc3BsYXlMaW1pdCA9IE1hdGgubWluKHRvdGFsLCBuZXh0TGltaXQpOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5hZ2VudERpc3BsYXlMaW1pdCA+PSB0b3RhbCkgew0KICAgICAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSB0b3RhbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRVc2FnZUNhcmQoc3RhdGUuYWdlbnRVc2FnZVJvd3MpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5hZ2VudFZpZXdBbGwpIHsNCiAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdBbGwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gQXJyYXkuaXNBcnJheShzdGF0ZS5hZ2VudFVzYWdlUm93cykgPyBzdGF0ZS5hZ2VudFVzYWdlUm93cy5sZW5ndGggOiAwOw0KICAgICAgICAgICAgICBpZiAoIXRvdGFsKSB7DQogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSA1Ow0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHN0YXRlLmFnZW50RGlzcGxheUxpbWl0ID0gSW5maW5pdHk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRVc2FnZUNhcmQoc3RhdGUuYWdlbnRVc2FnZVJvd3MpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5hZ2VudFNvcnRCdXR0b25zICYmIGRvbS5hZ2VudFNvcnRCdXR0b25zLmxlbmd0aCkgew0KICAgICAgICAgICAgZG9tLmFnZW50U29ydEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gYnV0dG9uLmRhdGFzZXQuYWdlbnRTb3J0Ow0KICAgICAgICAgICAgICAgIGlmICghY29sdW1uKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBzdGF0ZS5hZ2VudFNvcnQgfHwgeyBjb2x1bW46ICJyZXNwb25zZXMiLCBkaXJlY3Rpb246ICJkZXNjIiB9Ow0KICAgICAgICAgICAgICAgIGxldCBkaXJlY3Rpb247DQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuY29sdW1uID09PSBjb2x1bW4pIHsNCiAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGN1cnJlbnQuZGlyZWN0aW9uID09PSAiYXNjIiA/ICJkZXNjIiA6ICJhc2MiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBjb2x1bW4gPT09ICJuYW1lIiB8fCBjb2x1bW4gPT09ICJjcmVhdG9yVHlwZSIgPyAiYXNjIiA6ICJkZXNjIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnRTb3J0ID0geyBjb2x1bW4sIGRpcmVjdGlvbiB9Ow0KICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKHN0YXRlLmFnZW50VXNhZ2VSb3dzKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmNsZWFyU3RvcmVkRGF0YXNldCkgew0KICAgICAgICAgICAgZG9tLmNsZWFyU3RvcmVkRGF0YXNldC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsNCiAgICAgICAgICAgICAgY2xlYXJTdG9yZWREYXRhc2V0KCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmV4cG9ydFRyaWdnZXIgJiYgZG9tLmV4cG9ydE1lbnUpIHsNCiAgICAgICAgICAgIGRvbS5leHBvcnRUcmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgdG9nZ2xlRXhwb3J0TWVudSgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBkb20uZXhwb3J0TWVudS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmV4cG9ydEluY2x1ZGVEZXRhaWxzKSB7DQogICAgICAgICAgICBkb20uZXhwb3J0SW5jbHVkZURldGFpbHMuY2hlY2tlZCA9IHN0YXRlLmV4cG9ydFByZWZlcmVuY2VzLmluY2x1ZGVEZXRhaWxzICE9PSBmYWxzZTsNCiAgICAgICAgICAgIGRvbS5leHBvcnRJbmNsdWRlRGV0YWlscy5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7DQogICAgICAgICAgICAgIHN0YXRlLmV4cG9ydFByZWZlcmVuY2VzLmluY2x1ZGVEZXRhaWxzID0gZG9tLmV4cG9ydEluY2x1ZGVEZXRhaWxzLmNoZWNrZWQ7DQogICAgICAgICAgICAgIHVwZGF0ZUV4cG9ydERldGFpbE9wdGlvbigpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHVwZGF0ZUV4cG9ydERldGFpbE9wdGlvbigpOw0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5leHBvcnRQREYpIHsNCiAgICAgICAgICAgIGRvbS5leHBvcnRQREYuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGV4cG9ydERhc2hib2FyZFRvUERGKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmV4cG9ydFBORykgew0KICAgICAgICAgICAgZG9tLmV4cG9ydFBORy5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgZXhwb3J0Q2hhcnRBc1BORygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5leHBvcnRWaWRlbykgew0KICAgICAgICAgICAgZG9tLmV4cG9ydFZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICBleHBvcnRDaGFydEFuaW1hdGlvbigpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5leHBvcnRFeGNlbCkgewogICAgICAgICAgICBkb20uZXhwb3J0RXhjZWwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgICAgZXhwb3J0VHJlbmRUb3RhbHNUb0V4Y2VsKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkb20uZXhwb3J0RXhjZWxGdWxsKSB7CiAgICAgICAgICAgIGRvbS5leHBvcnRFeGNlbEZ1bGwuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgICAgZXhwb3J0RnVsbFJlcG9ydFRvRXhjZWwoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydFRyaWdnZXIgJiYgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUpIHsNCiAgICAgICAgICAgIGRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnRUcmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgICAgdG9nZ2xlRW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudSgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsNCiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBpZiAoZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydFRyYW5zcGFyZW50KSB7DQogICAgICAgICAgICBkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0VHJhbnNwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgIGV4cG9ydEVuYWJsZWRMaWNlbnNlc0NoYXJ0KHsgYmFja2dyb3VuZENvbG9yOiBudWxsLCBmaWxlU3VmZml4OiAidHJhbnNwYXJlbnQiIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnRXaGl0ZSkgew0KICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydFdoaXRlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICBleHBvcnRFbmFibGVkTGljZW5zZXNDaGFydCh7IGJhY2tncm91bmRDb2xvcjogIiNGRkZGRkYiLCBmaWxlU3VmZml4OiAid2hpdGUtYmciIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnROb1ZhbHVlcykgew0KICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydE5vVmFsdWVzLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICBleHBvcnRFbmFibGVkTGljZW5zZXNDaGFydCh7IGluY2x1ZGVWYWx1ZXM6IGZhbHNlLCBmaWxlU3VmZml4OiAibm8tdmFsdWVzIiB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzQXBwbHkpIHsNCiAgICAgICAgICAgIGRvbS5lbmFibGVkTGljZW5zZXNBcHBseS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgYXBwbHlFbmFibGVkTGljZW5zZXNDb2xvclNlbGVjdGlvbigpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5lbmFibGVkTGljZW5zZXNSZXNldCkgew0KICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc1Jlc2V0LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICByZXNldEVuYWJsZWRMaWNlbnNlc0NvbG9ycygpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgaWYgKGRvbS5lbmFibGVkTGljZW5zZXNHcmFkaWVudFRvZ2dsZSAmJiBkb20uZW5hYmxlZExpY2Vuc2VzQ29sb3JFbmQpIHsNCiAgICAgICAgICAgIGRvbS5lbmFibGVkTGljZW5zZXNHcmFkaWVudFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCJjaGFuZ2UiLCAoKSA9PiB7DQogICAgICAgICAgICAgIGRvbS5lbmFibGVkTGljZW5zZXNDb2xvckVuZC5kaXNhYmxlZCA9ICFkb20uZW5hYmxlZExpY2Vuc2VzR3JhZGllbnRUb2dnbGUuY2hlY2tlZDsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzU2hvd1ZhbHVlcykgew0KICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc1Nob3dWYWx1ZXMuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKCkgPT4gew0KICAgICAgICAgICAgICBzdGF0ZS5zaG93RW5hYmxlZExpY2Vuc2VMYWJlbHMgPSBkb20uZW5hYmxlZExpY2Vuc2VzU2hvd1ZhbHVlcy5jaGVja2VkOw0KICAgICAgICAgICAgICB1cGRhdGVFbmFibGVkTGljZW5zZXNDaGFydChzdGF0ZS5sYXRlc3RFbmFibGVkVGltZWxpbmUpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHVwZGF0ZUVuYWJsZWRMaWNlbnNlc0NvbG9ySW5wdXRzKCk7DQoNCiAgICAgICAgICBzZXR1cFNuYXBzaG90Q29udHJvbHMoKTsNCiAgICAgIA0KICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgaWYgKGRvbS5leHBvcnRDb250cm9scyAmJiBkb20uZXhwb3J0TWVudSAmJiAhZG9tLmV4cG9ydE1lbnUuaGlkZGVuICYmICFkb20uZXhwb3J0Q29udHJvbHMuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkgew0KICAgICAgICAgICAgICBjbG9zZUV4cG9ydE1lbnUoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0Q29udHJvbHMgJiYgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUgJiYgIWRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnRNZW51LmhpZGRlbiAmJiAhZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydENvbnRyb2xzLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHsNCiAgICAgICAgICAgICAgY2xvc2VFbmFibGVkTGljZW5zZXNFeHBvcnRNZW51KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gIkVzY2FwZSIpIHsNCiAgICAgICAgICAgICAgY2xvc2VFeHBvcnRNZW51KCk7DQogICAgICAgICAgICAgIGNsb3NlRW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgDQogICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdG9yZWREYXRhc2V0Q29udHJvbHMobWV0YSkgew0KICAgICAgICAgICAgaWYgKCFkb20uc3RvcmFnZUNvbnRyb2xzKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGNvbnNlbnRHaXZlbiA9IEJvb2xlYW4oc3RhdGUucGVyc2lzdERhdGFzZXRzKTsNCiAgICAgICAgICAgIGlmIChkb20ucGVyc2lzdENvbnNlbnQpIHsNCiAgICAgICAgICAgICAgZG9tLnBlcnNpc3RDb25zZW50LmNoZWNrZWQgPSBjb25zZW50R2l2ZW47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLmNsZWFyU3RvcmVkRGF0YXNldCkgew0KICAgICAgICAgICAgICBkb20uY2xlYXJTdG9yZWREYXRhc2V0LmhpZGRlbiA9ICFjb25zZW50R2l2ZW4gfHwgIW1ldGE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnN0b3JhZ2VIaW50KSB7DQogICAgICAgICAgICAgIGlmICghY29uc2VudEdpdmVuKSB7DQogICAgICAgICAgICAgICAgZG9tLnN0b3JhZ2VIaW50LnRleHRDb250ZW50ID0gIkRhdGFzZXRzIHN0YXkgaW4gdGhpcyBzZXNzaW9uIG9ubHkuIE9wdCBpbiBhYm92ZSB0byBrZWVwIHRoZW0gb24gdGhpcyBkZXZpY2UuIjsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRhKSB7DQogICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBbXTsNCiAgICAgICAgICAgICAgICBpZiAobWV0YS5uYW1lKSB7DQogICAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKHNob3J0ZW5MYWJlbChtZXRhLm5hbWUsIDM2KSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IHJvd3NWYWx1ZSA9IE51bWJlcihtZXRhLnJvd3MpOw0KICAgICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUocm93c1ZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgcGFydHMucHVzaChgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHJvd3NWYWx1ZSl9IHJvd3NgKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKG1ldGEuc2F2ZWRBdCkgew0KICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2F2ZWREYXRlID0gbmV3IERhdGUobWV0YS5zYXZlZEF0KTsNCiAgICAgICAgICAgICAgICAgICAgcGFydHMucHVzaChgc2F2ZWQgJHtmb3JtYXRTaG9ydERhdGUoc2F2ZWREYXRlKX1gKTsNCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBwYXJzaW5nIGlzc3Vlcw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBkb20uc3RvcmFnZUhpbnQudGV4dENvbnRlbnQgPSBwYXJ0cy5sZW5ndGgNCiAgICAgICAgICAgICAgICAgID8gcGFydHMuam9pbigiIMK3ICIpDQogICAgICAgICAgICAgICAgICA6ICJBIGRhdGFzZXQgaXMgc3RvcmVkIG9uIHRoaXMgZGV2aWNlLiI7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZG9tLnN0b3JhZ2VIaW50LnRleHRDb250ZW50ID0gIk5vIGRhdGFzZXQgaXMgY3VycmVudGx5IHNhdmVkIG9uIHRoaXMgZGV2aWNlLiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTbmFwc2hvdENvbnRyb2xzQXZhaWxhYmlsaXR5KCkgew0KICAgICAgICAgICAgaWYgKCFkb20uc25hcHNob3RDb250cm9scykgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBoYXNEYXRhc2V0ID0gQm9vbGVhbihzdGF0ZS5yb3dzICYmIHN0YXRlLnJvd3MubGVuZ3RoICYmIGxhc3RQYXJzZWRDc3ZUZXh0KTsNCiAgICAgICAgICAgIGNvbnN0IGhpbnQgPSBkb20uc25hcHNob3RIaW50Ow0KICAgICAgICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGRvbS5zbmFwc2hvdFNhdmVCdXR0b247DQogICAgICAgICAgICBjb25zdCBsb2FkQnV0dG9uID0gZG9tLnNuYXBzaG90TG9hZEJ1dHRvbjsNCiAgICAgICAgICAgIGlmICghc3VwcG9ydHNTbmFwc2hvdEVuY3J5cHRpb24gfHwgIXN1cHBvcnRzRGlhbG9nRWxlbWVudCkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RDb250cm9scy5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgaWYgKGhpbnQpIHsNCiAgICAgICAgICAgICAgICBoaW50LnRleHRDb250ZW50ID0gc3VwcG9ydHNTbmFwc2hvdEVuY3J5cHRpb24NCiAgICAgICAgICAgICAgICAgID8gIlNlY3VyZSBzbmFwc2hvdHMgcmVxdWlyZSBkaWFsb2cgc3VwcG9ydCBpbiB0aGlzIGJyb3dzZXIuIFVwZGF0ZSB0byB0aGUgbGF0ZXN0IHZlcnNpb24uIg0KICAgICAgICAgICAgICAgICAgOiAiU2VjdXJlIHNuYXBzaG90cyBuZWVkIGEgbW9kZXJuIGJyb3dzZXIgb3ZlciBIVFRQUy4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChzYXZlQnV0dG9uKSB7DQogICAgICAgICAgICAgICAgc2F2ZUJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGxvYWRCdXR0b24pIHsNCiAgICAgICAgICAgICAgICBsb2FkQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20uc25hcHNob3RDb250cm9scy5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgIGlmIChzYXZlQnV0dG9uKSB7DQogICAgICAgICAgICAgIHNhdmVCdXR0b24uZGlzYWJsZWQgPSAhaGFzRGF0YXNldDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChsb2FkQnV0dG9uKSB7DQogICAgICAgICAgICAgIGxvYWRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChoaW50KSB7DQogICAgICAgICAgICAgIGhpbnQudGV4dENvbnRlbnQgPSBoYXNEYXRhc2V0DQogICAgICAgICAgICAgICAgPyAiRW5jcnlwdGVkIHNuYXBzaG90cyBsZXQgdHJ1c3RlZCBjb2xsZWFndWVzIHJlcHJvZHVjZSB0aGlzIHZpZXcgd2l0aG91dCBzZW5kaW5nIHJhdyBmaWxlcy4iDQogICAgICAgICAgICAgICAgOiAiTG9hZCBhIGRhdGFzZXQgYmVmb3JlIGNyZWF0aW5nIGFuIGVuY3J5cHRlZCBzbmFwc2hvdC4iOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHNldHVwU25hcHNob3RDb250cm9scygpIHsNCiAgICAgICAgICAgIGlmICghZG9tLnNuYXBzaG90Q29udHJvbHMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdXBkYXRlU25hcHNob3RDb250cm9sc0F2YWlsYWJpbGl0eSgpOw0KICAgICAgICAgICAgaWYgKCFzdXBwb3J0c1NuYXBzaG90RW5jcnlwdGlvbiB8fCAhc3VwcG9ydHNEaWFsb2dFbGVtZW50KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RTYXZlQnV0dG9uKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdFNhdmVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5yb3dzLmxlbmd0aCB8fCAhbGFzdFBhcnNlZENzdlRleHQpIHsNCiAgICAgICAgICAgICAgICAgIHVwZGF0ZVNuYXBzaG90Q29udHJvbHNBdmFpbGFiaWxpdHkoKTsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgb3BlblNuYXBzaG90RXhwb3J0RGlhbG9nKCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdExvYWRCdXR0b24pIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90TG9hZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgICBvcGVuU25hcHNob3RJbXBvcnREaWFsb2coKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90RXhwb3J0Rm9ybSkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RFeHBvcnRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoInN1Ym1pdCIsIGhhbmRsZVNuYXBzaG90RXhwb3J0U3VibWl0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RDYW5jZWwpIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90Q2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNsb3NlU25hcHNob3RFeHBvcnREaWFsb2coKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90RXhwb3J0RGlhbG9nKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEV4cG9ydERpYWxvZy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsICgpID0+IHsNCiAgICAgICAgICAgICAgICByZXNldFNuYXBzaG90RXhwb3J0RGlhbG9nKCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBkb20uc25hcHNob3RFeHBvcnREaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY2FuY2VsIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgY2xvc2VTbmFwc2hvdEV4cG9ydERpYWxvZygpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RDb3B5KSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdENvcHkuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaGFuZGxlU25hcHNob3RDb3B5KCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdERvd25sb2FkKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdERvd25sb2FkLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGhhbmRsZVNuYXBzaG90RG93bmxvYWQoKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90RXhwb3J0SHRtbCkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RFeHBvcnRIdG1sLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGhhbmRsZVNuYXBzaG90QnVuZGxlRG93bmxvYWQoKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0Rm9ybSkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoInN1Ym1pdCIsIGhhbmRsZVNuYXBzaG90SW1wb3J0U3VibWl0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRDYW5jZWwpIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0Q2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNsb3NlU25hcHNob3RJbXBvcnREaWFsb2coKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0RGlhbG9nKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydERpYWxvZy5hZGRFdmVudExpc3RlbmVyKCJjbG9zZSIsICgpID0+IHsNCiAgICAgICAgICAgICAgICByZXNldFNuYXBzaG90SW1wb3J0RGlhbG9nKCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnREaWFsb2cuYWRkRXZlbnRMaXN0ZW5lcigiY2FuY2VsIiwgZXZlbnQgPT4gew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICAgICAgY2xvc2VTbmFwc2hvdEltcG9ydERpYWxvZygpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRGaWxlKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydEZpbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgaGFuZGxlU25hcHNob3RJbXBvcnRGaWxlU2VsZWN0aW9uKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBvcGVuU25hcHNob3RFeHBvcnREaWFsb2coKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5zbmFwc2hvdEV4cG9ydERpYWxvZyB8fCB0eXBlb2YgZG9tLnNuYXBzaG90RXhwb3J0RGlhbG9nLnNob3dNb2RhbCAhPT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlNuYXBzaG90IGV4cG9ydCBkaWFsb2cgaXMgdW5hdmFpbGFibGUgaW4gdGhpcyBicm93c2VyLiIpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXNldFNuYXBzaG90RXhwb3J0RGlhbG9nKCk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RFeHBvcnREaWFsb2cuc2hvd01vZGFsKCk7DQogICAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RQYXNzd29yZCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdFBhc3N3b3JkLmZvY3VzKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIG9wZW4gc25hcHNob3QgZGlhbG9nIiwgZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlU25hcHNob3RFeHBvcnREaWFsb2coKSB7DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90RXhwb3J0RGlhbG9nICYmIGRvbS5zbmFwc2hvdEV4cG9ydERpYWxvZy5vcGVuKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEV4cG9ydERpYWxvZy5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0U25hcHNob3RFeHBvcnREaWFsb2coKSB7DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90UGFzc3dvcmQpIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90UGFzc3dvcmQudmFsdWUgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RQYXNzd29yZENvbmZpcm0pIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90UGFzc3dvcmRDb25maXJtLnZhbHVlID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90T3V0cHV0VGV4dCkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RPdXRwdXRUZXh0LnZhbHVlID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90T3V0cHV0KSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdE91dHB1dC5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsICIiKTsNCiAgICAgICAgICAgIGxhdGVzdFNuYXBzaG90RXhwb3J0ID0gIiI7DQogICAgICAgICAgICBjbGVhclNuYXBzaG90Q29weUZlZWRiYWNrKCk7DQogICAgICAgICAgICByZXZva2VTbmFwc2hvdERvd25sb2FkVXJsKCk7DQogICAgICAgICAgICBzZXRCdXR0b25FbmFibGVkKGRvbS5zbmFwc2hvdEV4cG9ydEh0bWwsIGZhbHNlKTsNCiAgICAgICAgICAgIHVwZGF0ZVNuYXBzaG90Q29udHJvbHNBdmFpbGFiaWxpdHkoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBjbGVhclNuYXBzaG90Q29weUZlZWRiYWNrKCkgew0KICAgICAgICAgICAgaWYgKHNuYXBzaG90Q29weVRpbWVvdXQpIHsNCiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHNuYXBzaG90Q29weVRpbWVvdXQpOw0KICAgICAgICAgICAgICBzbmFwc2hvdENvcHlUaW1lb3V0ID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RDb3B5KSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdENvcHkudGV4dENvbnRlbnQgPSAiQ29weSB0byBjbGlwYm9hcmQiOw0KICAgICAgICAgICAgICBkb20uc25hcHNob3RDb3B5LmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gc2V0U25hcHNob3ROb3RpY2UodGFyZ2V0LCBtZXNzYWdlLCB0b25lID0gImluZm8iKSB7DQogICAgICAgICAgICBpZiAoIXRhcmdldCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobWVzc2FnZSkgew0KICAgICAgICAgICAgICB0YXJnZXQudGV4dENvbnRlbnQgPSBtZXNzYWdlOw0KICAgICAgICAgICAgICB0YXJnZXQuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgIGlmICh0b25lKSB7DQogICAgICAgICAgICAgICAgdGFyZ2V0LmRhdGFzZXQudG9uZSA9IHRvbmU7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZGVsZXRlIHRhcmdldC5kYXRhc2V0LnRvbmU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRhcmdldC50ZXh0Q29udGVudCA9ICIiOw0KICAgICAgICAgICAgICB0YXJnZXQuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgZGVsZXRlIHRhcmdldC5kYXRhc2V0LnRvbmU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZW5jb2RlU25hcHNob3RUZXh0KHRleHQsIHsgbGFiZWwgfSA9IHt9KSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIHRleHQgIT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIHJldHVybiB7IGVuY29kaW5nOiAidGV4dCIsIGRhdGE6ICIiLCBvcmlnaW5hbFNpemU6IDAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsU2l6ZSA9IHRleHQubGVuZ3RoOw0KICAgICAgICAgICAgaWYgKCFvcmlnaW5hbFNpemUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsgZW5jb2Rpbmc6ICJ0ZXh0IiwgZGF0YTogIiIsIG9yaWdpbmFsU2l6ZTogMCB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZm9yY2VDb21wcmVzc2lvbiA9IG9yaWdpbmFsU2l6ZSA+IFNOQVBTSE9UX1VOQ09NUFJFU1NFRF9MSU1JVDsNCiAgICAgICAgICAgIGxldCB0ZXh0Qnl0ZXMgPSBudWxsOw0KICAgICAgICAgICAgY29uc3QgZW5zdXJlVGV4dEJ5dGVzID0gKCkgPT4gew0KICAgICAgICAgICAgICBpZiAoIXRleHRCeXRlcykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsNCiAgICAgICAgICAgICAgICB0ZXh0Qnl0ZXMgPSBlbmNvZGVyLmVuY29kZSh0ZXh0KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gdGV4dEJ5dGVzOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgY29uc3QgdHJ5UGFrb0NvbXByZXNzaW9uID0gKCkgPT4gew0KICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5wYWtvIHx8IHR5cGVvZiB3aW5kb3cucGFrby5nemlwICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBieXRlcyA9IGVuc3VyZVRleHRCeXRlcygpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRCeXRlcyA9IHdpbmRvdy5wYWtvLmd6aXAoYnl0ZXMpOw0KICAgICAgICAgICAgICAgIGlmICghY29tcHJlc3NlZEJ5dGVzIHx8ICFjb21wcmVzc2VkQnl0ZXMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFmb3JjZUNvbXByZXNzaW9uICYmIGNvbXByZXNzZWRCeXRlcy5sZW5ndGggPj0gb3JpZ2luYWxTaXplKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgIGVuY29kaW5nOiAiZ3ppcC1iYXNlNjQiLA0KICAgICAgICAgICAgICAgICAgZGF0YTogYnVmZmVyVG9CYXNlNjQoY29tcHJlc3NlZEJ5dGVzKSwNCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsU2l6ZSwNCiAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRTaXplOiBjb21wcmVzc2VkQnl0ZXMubGVuZ3RoDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuYWJsZSB0byBjb21wcmVzcyBzbmFwc2hvdCAke2xhYmVsIHx8ICJkYXRhc2V0In0gd2l0aCBwYWtvYCwgZXJyb3IpOw0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCB0cnlGZmxhdGVDb21wcmVzc2lvbiA9ICgpID0+IHsNCiAgICAgICAgICAgICAgaWYgKCF3aW5kb3cuZmZsYXRlIHx8IHR5cGVvZiB3aW5kb3cuZmZsYXRlLmd6aXBTeW5jICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBieXRlcyA9IGVuc3VyZVRleHRCeXRlcygpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRCeXRlcyA9IHdpbmRvdy5mZmxhdGUuZ3ppcFN5bmMoYnl0ZXMpOw0KICAgICAgICAgICAgICAgIGlmICghY29tcHJlc3NlZEJ5dGVzIHx8ICFjb21wcmVzc2VkQnl0ZXMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFmb3JjZUNvbXByZXNzaW9uICYmIGNvbXByZXNzZWRCeXRlcy5sZW5ndGggPj0gb3JpZ2luYWxTaXplKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgIGVuY29kaW5nOiAiZ3ppcC1iYXNlNjQiLA0KICAgICAgICAgICAgICAgICAgZGF0YTogYnVmZmVyVG9CYXNlNjQoY29tcHJlc3NlZEJ5dGVzKSwNCiAgICAgICAgICAgICAgICAgIG9yaWdpbmFsU2l6ZSwNCiAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRTaXplOiBjb21wcmVzc2VkQnl0ZXMubGVuZ3RoDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuYWJsZSB0byBjb21wcmVzcyBzbmFwc2hvdCAke2xhYmVsIHx8ICJkYXRhc2V0In0gd2l0aCBmZmxhdGVgLCBlcnJvcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IHRyeUNvbXByZXNzaW9uU3RyZWFtID0gYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICBpZiAodHlwZW9mIENvbXByZXNzaW9uU3RyZWFtICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdHJlYW0gPSBuZXcgQ29tcHJlc3Npb25TdHJlYW0oImd6aXAiKTsNCiAgICAgICAgICAgICAgICBjb25zdCB3cml0ZXIgPSBzdHJlYW0ud3JpdGFibGUuZ2V0V3JpdGVyKCk7DQogICAgICAgICAgICAgICAgYXdhaXQgd3JpdGVyLndyaXRlKGVuc3VyZVRleHRCeXRlcygpKTsNCiAgICAgICAgICAgICAgICBhd2FpdCB3cml0ZXIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IG5ldyBSZXNwb25zZShzdHJlYW0ucmVhZGFibGUpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRCdWZmZXIgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRCeXRlcyA9IG5ldyBVaW50OEFycmF5KGNvbXByZXNzZWRCdWZmZXIpOw0KICAgICAgICAgICAgICAgIGlmICghZm9yY2VDb21wcmVzc2lvbiAmJiBjb21wcmVzc2VkQnl0ZXMubGVuZ3RoID49IG9yaWdpbmFsU2l6ZSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICBlbmNvZGluZzogImd6aXAtYmFzZTY0IiwNCiAgICAgICAgICAgICAgICAgIGRhdGE6IGJ1ZmZlclRvQmFzZTY0KGNvbXByZXNzZWRCeXRlcyksDQogICAgICAgICAgICAgICAgICBvcmlnaW5hbFNpemUsDQogICAgICAgICAgICAgICAgICBjb21wcmVzc2VkU2l6ZTogY29tcHJlc3NlZEJ5dGVzLmxlbmd0aA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmFibGUgdG8gY29tcHJlc3Mgc25hcHNob3QgJHtsYWJlbCB8fCAiZGF0YXNldCJ9IHdpdGggQ29tcHJlc3Npb25TdHJlYW1gLCBlcnJvcik7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRWaWFGZmxhdGUgPSB0cnlGZmxhdGVDb21wcmVzc2lvbigpOw0KICAgICAgICAgICAgaWYgKGNvbXByZXNzZWRWaWFGZmxhdGUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGNvbXByZXNzZWRWaWFGZmxhdGU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IGNvbXByZXNzZWRWaWFQYWtvID0gdHJ5UGFrb0NvbXByZXNzaW9uKCk7DQogICAgICAgICAgICBpZiAoY29tcHJlc3NlZFZpYVBha28pIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGNvbXByZXNzZWRWaWFQYWtvOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCBjb21wcmVzc2VkVmlhU3RyZWFtID0gYXdhaXQgdHJ5Q29tcHJlc3Npb25TdHJlYW0oKTsNCiAgICAgICAgICAgIGlmIChjb21wcmVzc2VkVmlhU3RyZWFtKSB7DQogICAgICAgICAgICAgIHJldHVybiBjb21wcmVzc2VkVmlhU3RyZWFtOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4geyBlbmNvZGluZzogInRleHQiLCBkYXRhOiB0ZXh0LCBvcmlnaW5hbFNpemUgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBkZWNvZGVTbmFwc2hvdFNlY3Rpb24oc2VjdGlvbiwgeyBsYWJlbCB9ID0ge30pIHsNCiAgICAgICAgICAgIGlmICghc2VjdGlvbiB8fCB0eXBlb2Ygc2VjdGlvbiAhPT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTbmFwc2hvdCBpcyBtaXNzaW5nICR7bGFiZWwgfHwgImRhdGFzZXQifSBjb250ZW50LmApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZW5jb2RpbmcgPSBzZWN0aW9uLmVuY29kaW5nIHx8ICJ0ZXh0IjsNCiAgICAgICAgICAgIGlmIChlbmNvZGluZyA9PT0gInRleHQiKSB7DQogICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VjdGlvbi5kYXRhICE9PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgU25hcHNob3QgJHtsYWJlbCB8fCAiZGF0YXNldCJ9IGRhdGEgaXMgaW52YWxpZC5gKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7IC4uLnNlY3Rpb24sIGNzdlRleHQ6IHNlY3Rpb24uZGF0YSB9Ow0KICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0LmRhdGE7DQogICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZW5jb2RpbmcgPT09ICJnemlwLWJhc2U2NCIpIHsNCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWN0aW9uLmRhdGEgIT09ICJzdHJpbmciIHx8ICFzZWN0aW9uLmRhdGEubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTbmFwc2hvdCAke2xhYmVsIHx8ICJkYXRhc2V0In0gZGF0YSBpcyBlbXB0eS5gKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBieXRlcyA9IGJhc2U2NFRvVWludDhBcnJheShzZWN0aW9uLmRhdGEpOw0KICAgICAgICAgICAgICBjb25zdCBmaW5hbGl6ZVNlY3Rpb24gPSBjc3ZUZXh0ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7IC4uLnNlY3Rpb24sIGNzdlRleHQgfTsNCiAgICAgICAgICAgICAgICBkZWxldGUgcmVzdWx0LmRhdGE7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgaWYgKHdpbmRvdy5mZmxhdGUgJiYgdHlwZW9mIHdpbmRvdy5mZmxhdGUuZ3VuemlwU3luYyA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBjb25zdCBkZWNvbXByZXNzZWQgPSB3aW5kb3cuZmZsYXRlLmd1bnppcFN5bmMoYnl0ZXMpOw0KICAgICAgICAgICAgICAgICAgaWYgKGRlY29tcHJlc3NlZCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmluYWxpemVTZWN0aW9uKGRlY29kZXIuZGVjb2RlKGRlY29tcHJlc3NlZCkpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuYWJsZSB0byBkZWNvbXByZXNzIHNuYXBzaG90ICR7bGFiZWwgfHwgImRhdGFzZXQifSB3aXRoIGZmbGF0ZWAsIGVycm9yKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHdpbmRvdy5wYWtvICYmIHR5cGVvZiB3aW5kb3cucGFrby51bmd6aXAgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgZGVjb21wcmVzc2VkID0gd2luZG93LnBha28udW5nemlwKGJ5dGVzKTsNCiAgICAgICAgICAgICAgICAgIGlmIChkZWNvbXByZXNzZWQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsaXplU2VjdGlvbihkZWNvZGVyLmRlY29kZShkZWNvbXByZXNzZWQpKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmFibGUgdG8gZGVjb21wcmVzcyBzbmFwc2hvdCAke2xhYmVsIHx8ICJkYXRhc2V0In0gd2l0aCBwYWtvYCwgZXJyb3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAodHlwZW9mIERlY29tcHJlc3Npb25TdHJlYW0gPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyZWFtID0gbmV3IERlY29tcHJlc3Npb25TdHJlYW0oImd6aXAiKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdyaXRlciA9IHN0cmVhbS53cml0YWJsZS5nZXRXcml0ZXIoKTsNCiAgICAgICAgICAgICAgICAgIGF3YWl0IHdyaXRlci53cml0ZShieXRlcyk7DQogICAgICAgICAgICAgICAgICBhd2FpdCB3cml0ZXIuY2xvc2UoKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gbmV3IFJlc3BvbnNlKHN0cmVhbS5yZWFkYWJsZSk7DQogICAgICAgICAgICAgICAgICBjb25zdCBjc3ZUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbmFsaXplU2VjdGlvbihjc3ZUZXh0KTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbmFibGUgdG8gZGVjb21wcmVzcyBzbmFwc2hvdCAke2xhYmVsIHx8ICJkYXRhc2V0In0gd2l0aCBEZWNvbXByZXNzaW9uU3RyZWFtYCwgZXJyb3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoaXMgYnJvd3NlciBjYW5ub3Qgb3BlbiBjb21wcmVzc2VkIHNuYXBzaG90cy4gVHJ5IHRoZSBsYXRlc3QgdmVyc2lvbiBvZiBDaHJvbWUsIEVkZ2UsIG9yIGFub3RoZXIgQ2hyb21pdW0tYmFzZWQgYnJvd3Nlci4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgc25hcHNob3QgZW5jb2Rpbmc6ICR7ZW5jb2Rpbmd9YCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU25hcHNob3RFeHBvcnRTdWJtaXQoZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBpZiAoIXN1cHBvcnRzU25hcHNob3RFbmNyeXB0aW9uIHx8ICFzdXBwb3J0c0RpYWxvZ0VsZW1lbnQpIHsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsICJTZWN1cmUgc25hcHNob3RzIGFyZSBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlci4iLCAiZXJyb3IiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5yb3dzLmxlbmd0aCB8fCAhbGFzdFBhcnNlZENzdlRleHQpIHsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsICJMb2FkIGEgZGF0YXNldCBiZWZvcmUgY3JlYXRpbmcgYSBzbmFwc2hvdC4iLCAiZXJyb3IiKTsNCiAgICAgICAgICAgICAgdXBkYXRlU25hcHNob3RDb250cm9sc0F2YWlsYWJpbGl0eSgpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBwYXNzd29yZEZpZWxkID0gZG9tLnNuYXBzaG90UGFzc3dvcmQ7DQogICAgICAgICAgICBjb25zdCBjb25maXJtRmllbGQgPSBkb20uc25hcHNob3RQYXNzd29yZENvbmZpcm07DQogICAgICAgICAgICBjb25zdCBwYXNzd29yZCA9IHBhc3N3b3JkRmllbGQgPyBwYXNzd29yZEZpZWxkLnZhbHVlIHx8ICIiIDogIiI7DQogICAgICAgICAgICBjb25zdCBjb25maXJtID0gY29uZmlybUZpZWxkID8gY29uZmlybUZpZWxkLnZhbHVlIHx8ICIiIDogIiI7DQogICAgICAgICAgICBpZiAoIXBhc3N3b3JkKSB7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiRW50ZXIgYSBwYXNzd29yZC4iLCAiZXJyb3IiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHBhc3N3b3JkICE9PSBjb25maXJtKSB7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiUGFzc3dvcmQgYW5kIGNvbmZpcm1hdGlvbiBkbyBub3QgbWF0Y2guIiwgImVycm9yIik7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiIik7DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90R2VuZXJhdGUpIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90R2VuZXJhdGUuZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICBkb20uc25hcHNob3RHZW5lcmF0ZS5kYXRhc2V0Lm9yaWdpbmFsTGFiZWwgPSBkb20uc25hcHNob3RHZW5lcmF0ZS50ZXh0Q29udGVudCB8fCAiIjsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90R2VuZXJhdGUudGV4dENvbnRlbnQgPSAiR2VuZXJhdGluZ+KApiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RFcnJvciwgIkVuY3J5cHRpbmcgc25hcHNob3TigKYgVGhpcyBtYXkgdGFrZSB1cCB0byBhIG1pbnV0ZSBmb3IgbGFyZ2UgZGF0YXNldHMuIiwgImluZm8iKTsNCiAgICAgICAgICAgICAgY29uc3Qgc25hcHNob3RTdHJpbmcgPSBhd2FpdCBnZW5lcmF0ZUVuY3J5cHRlZFNuYXBzaG90KHBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgbGF0ZXN0U25hcHNob3RFeHBvcnQgPSBzbmFwc2hvdFN0cmluZzsNCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdE91dHB1dFRleHQpIHsNCiAgICAgICAgICAgICAgICBkb20uc25hcHNob3RPdXRwdXRUZXh0LnZhbHVlID0gc25hcHNob3RTdHJpbmc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdE91dHB1dCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdE91dHB1dC5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RFcnJvciwgIlNuYXBzaG90IHJlYWR5LiBDb3B5IG9yIGRvd25sb2FkIGJlbG93LiIsICJzdWNjZXNzIik7DQogICAgICAgICAgICAgIHNldEJ1dHRvbkVuYWJsZWQoZG9tLnNuYXBzaG90RXhwb3J0SHRtbCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGlmIChwYXNzd29yZEZpZWxkKSB7DQogICAgICAgICAgICAgICAgcGFzc3dvcmRGaWVsZC52YWx1ZSA9ICIiOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChjb25maXJtRmllbGQpIHsNCiAgICAgICAgICAgICAgICBjb25maXJtRmllbGQudmFsdWUgPSAiIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB1cGRhdGVTbmFwc2hvdENvbnRyb2xzQXZhaWxhYmlsaXR5KCk7DQogICAgICAgICAgICAgIGNsZWFyU25hcHNob3RDb3B5RmVlZGJhY2soKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6ICJVbmFibGUgdG8gY3JlYXRlIHNuYXBzaG90LiI7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCBtZXNzYWdlLCAiZXJyb3IiKTsNCiAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RHZW5lcmF0ZSkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEdlbmVyYXRlLmRpc2FibGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBkb20uc25hcHNob3RHZW5lcmF0ZS5kYXRhc2V0Lm9yaWdpbmFsTGFiZWwgfHwgIkdlbmVyYXRlIHNuYXBzaG90IjsNCiAgICAgICAgICAgICAgICBkb20uc25hcHNob3RHZW5lcmF0ZS50ZXh0Q29udGVudCA9IGxhYmVsOw0KICAgICAgICAgICAgICAgIGRlbGV0ZSBkb20uc25hcHNob3RHZW5lcmF0ZS5kYXRhc2V0Lm9yaWdpbmFsTGFiZWw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBzZXJpYWxpemVGaWx0ZXJzRm9yU25hcHNob3QoKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICBvcmdhbml6YXRpb246IEFycmF5LmZyb20oc3RhdGUuZmlsdGVycy5vcmdhbml6YXRpb24gfHwgW10pLA0KICAgICAgICAgICAgICBjb3VudHJ5OiBBcnJheS5mcm9tKHN0YXRlLmZpbHRlcnMuY291bnRyeSB8fCBbXSksDQogICAgICAgICAgICAgIHRpbWVmcmFtZTogc3RhdGUuZmlsdGVycy50aW1lZnJhbWUsDQogICAgICAgICAgICAgIGN1c3RvbVN0YXJ0OiBzdGF0ZS5maWx0ZXJzLmN1c3RvbVN0YXJ0ID8gdG9EYXRlSW5wdXRWYWx1ZShzdGF0ZS5maWx0ZXJzLmN1c3RvbVN0YXJ0KSA6IG51bGwsDQogICAgICAgICAgICAgIGN1c3RvbUVuZDogc3RhdGUuZmlsdGVycy5jdXN0b21FbmQgPyB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmZpbHRlcnMuY3VzdG9tRW5kKSA6IG51bGwsDQogICAgICAgICAgICAgIGFnZ3JlZ2F0ZTogc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGUsDQogICAgICAgICAgICAgIG1ldHJpYzogc3RhdGUuZmlsdGVycy5tZXRyaWMsDQogICAgICAgICAgICAgIGdyb3VwOiBzdGF0ZS5maWx0ZXJzLmdyb3VwLA0KICAgICAgICAgICAgICBjYXRlZ29yeVNlbGVjdGlvbjogQXJyYXkuZnJvbShzdGF0ZS5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uIHx8IFtdKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBidWlsZERhdGFzZXRTbmFwc2hvdFNlY3Rpb24oKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIGxhc3RQYXJzZWRDc3ZUZXh0ICE9PSAic3RyaW5nIiB8fCAhbGFzdFBhcnNlZENzdlRleHQubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IGF3YWl0IGVuY29kZVNuYXBzaG90VGV4dChsYXN0UGFyc2VkQ3N2VGV4dCwgeyBsYWJlbDogImRhdGFzZXQiIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgLi4uZW5jb2RlZCwNCiAgICAgICAgICAgICAgbWV0YTogbGFzdFBhcnNlZENzdk1ldGEgPyB7IC4uLmxhc3RQYXJzZWRDc3ZNZXRhIH0gOiBudWxsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGJ1aWxkQWdlbnRTbmFwc2hvdFNlY3Rpb24oKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIGxhc3RQYXJzZWRBZ2VudENzdlRleHQgIT09ICJzdHJpbmciIHx8ICFsYXN0UGFyc2VkQWdlbnRDc3ZUZXh0Lmxlbmd0aCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGVuY29kZWQgPSBhd2FpdCBlbmNvZGVTbmFwc2hvdFRleHQobGFzdFBhcnNlZEFnZW50Q3N2VGV4dCwgeyBsYWJlbDogImFnZW50IGRhdGFzZXQiIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgLi4uZW5jb2RlZCwNCiAgICAgICAgICAgICAgbWV0YTogbGFzdFBhcnNlZEFnZW50TWV0YSA/IHsgLi4ubGFzdFBhcnNlZEFnZW50TWV0YSB9IDogbnVsbA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBidWlsZFNuYXBzaG90UGF5bG9hZCgpIHsNCiAgICAgICAgICAgIGNvbnN0IGRhdGFzZXRTZWN0aW9uID0gYXdhaXQgYnVpbGREYXRhc2V0U25hcHNob3RTZWN0aW9uKCk7DQogICAgICAgICAgICBpZiAoIWRhdGFzZXRTZWN0aW9uIHx8ICFkYXRhc2V0U2VjdGlvbi5kYXRhIHx8ICFkYXRhc2V0U2VjdGlvbi5kYXRhLmxlbmd0aCkgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNuYXBzaG90IHBheWxvYWQgaXMgbWlzc2luZyB0aGUgZGF0YXNldC4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGFnZW50U2VjdGlvbiA9IGF3YWl0IGJ1aWxkQWdlbnRTbmFwc2hvdFNlY3Rpb24oKTsNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgIHZlcnNpb246IFNOQVBTSE9UX1ZFUlNJT04sDQogICAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgICBkYXRhc2V0OiBkYXRhc2V0U2VjdGlvbiwNCiAgICAgICAgICAgICAgYWdlbnREYXRhc2V0OiBhZ2VudFNlY3Rpb24sDQogICAgICAgICAgICAgIGZpbHRlcnM6IHNlcmlhbGl6ZUZpbHRlcnNGb3JTbmFwc2hvdCgpLA0KICAgICAgICAgICAgICB0aGVtZTogc3RhdGUudGhlbWUsDQogICAgICAgICAgICAgIHRyZW5kVmlldzogc3RhdGUudHJlbmRWaWV3LA0KICAgICAgICAgICAgICBzZXJpZXNWaXNpYmlsaXR5OiB7IC4uLnN0YXRlLnNlcmllc1Zpc2liaWxpdHkgfSwNCiAgICAgICAgICAgICAgc2VyaWVzRGV0YWlsTW9kZTogc3RhdGUuc2VyaWVzRGV0YWlsTW9kZSwNCiAgICAgICAgICAgICAgcmV0dXJuaW5nTWV0cmljOiBzdGF0ZS5yZXR1cm5pbmdNZXRyaWMsDQogICAgICAgICAgICAgIHJldHVybmluZ0ludGVydmFsOiBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCwNCiAgICAgICAgICAgICAgYWN0aXZlRGF5c1ZpZXc6IHN0YXRlLmFjdGl2ZURheXNWaWV3LA0KICAgICAgICAgICAgICB1c2FnZVRyZW5kTW9kZTogc3RhdGUudXNhZ2VUcmVuZE1vZGUsDQogICAgICAgICAgICAgIHVzYWdlVHJlbmRSZWdpb246IHN0YXRlLnVzYWdlVHJlbmRSZWdpb24sDQogICAgICAgICAgICAgIHVzYWdlTW9udGhTZWxlY3Rpb246IEFycmF5LmlzQXJyYXkoc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbikgPyBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uLm1hcChTdHJpbmcpIDogW10sDQogICAgICAgICAgICAgIHJldHVybmluZ1JlZ2lvbjogc3RhdGUucmV0dXJuaW5nUmVnaW9uLA0KICAgICAgICAgICAgICB1c2FnZVRocmVzaG9sZHM6IHsNCiAgICAgICAgICAgICAgICBtaWRkbGU6IE51bWJlcihzdGF0ZS51c2FnZVRocmVzaG9sZHM/Lm1pZGRsZSkgfHwgMCwNCiAgICAgICAgICAgICAgICBoaWdoOiBOdW1iZXIoc3RhdGUudXNhZ2VUaHJlc2hvbGRzPy5oaWdoKSB8fCAwDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGV4cG9ydFByZWZlcmVuY2VzOiB7DQogICAgICAgICAgICAgICAgaW5jbHVkZURldGFpbHM6IHN0YXRlLmV4cG9ydFByZWZlcmVuY2VzPy5pbmNsdWRlRGV0YWlscyAhPT0gZmFsc2UNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgdHJlbmRDb2xvclByZWZlcmVuY2U6IHsNCiAgICAgICAgICAgICAgICBzdGFydDogc3RhdGUudHJlbmRDb2xvclByZWZlcmVuY2U/LnN0YXJ0IHx8IG51bGwsDQogICAgICAgICAgICAgICAgZW5kOiBzdGF0ZS50cmVuZENvbG9yUHJlZmVyZW5jZT8uZW5kIHx8IG51bGwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgZGltZW5zaW9uU2VsZWN0aW9uOiB7DQogICAgICAgICAgICAgICAgZGltZW5zaW9uOiBzdGF0ZS5kaW1lbnNpb25TZWxlY3Rpb24/LmRpbWVuc2lvbiB8fCAiY291bnRyeSIsDQogICAgICAgICAgICAgICAgbWV0cmljOiBzdGF0ZS5kaW1lbnNpb25TZWxlY3Rpb24/Lm1ldHJpYyB8fCAiYWN0aW9ucyIsDQogICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHsNCiAgICAgICAgICAgICAgICAgIGNvdW50cnk6IEFycmF5LmZyb20oc3RhdGUuZGltZW5zaW9uU2VsZWN0aW9uPy5zZWxlY3RlZD8uY291bnRyeSB8fCBbXSksDQogICAgICAgICAgICAgICAgICBvcmdhbml6YXRpb246IEFycmF5LmZyb20oc3RhdGUuZGltZW5zaW9uU2VsZWN0aW9uPy5zZWxlY3RlZD8ub3JnYW5pemF0aW9uIHx8IFtdKQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgYWRvcHRpb25TaG93RGV0YWlsczogQm9vbGVhbihzdGF0ZS5hZG9wdGlvblNob3dEZXRhaWxzKSwNCiAgICAgICAgICAgICAgZ3JvdXBzRXhwYW5kZWQ6IEJvb2xlYW4oc3RhdGUuZ3JvdXBzRXhwYW5kZWQpLA0KICAgICAgICAgICAgICB0b3BVc2Vyc0V4cGFuZGVkOiBCb29sZWFuKHN0YXRlLnRvcFVzZXJzRXhwYW5kZWQpLA0KICAgICAgICAgICAgICBhZ2VudERpc3BsYXlMaW1pdDogTnVtYmVyLmlzRmluaXRlKHN0YXRlLmFnZW50RGlzcGxheUxpbWl0KSA/IHN0YXRlLmFnZW50RGlzcGxheUxpbWl0IDogNQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUVuY3J5cHRlZFNuYXBzaG90KHBhc3N3b3JkKSB7DQogICAgICAgICAgICBpZiAoIXN1cHBvcnRzU25hcHNob3RFbmNyeXB0aW9uKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU2VjdXJlIHNuYXBzaG90cyBhcmUgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGVudmlyb25tZW50LiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IGJ1aWxkU25hcHNob3RQYXlsb2FkKCk7DQogICAgICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7DQogICAgICAgICAgICBjb25zdCBwYXlsb2FkQnl0ZXMgPSBlbmNvZGVyLmVuY29kZShKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7DQogICAgICAgICAgICBjb25zdCBzYWx0ID0gd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMTYpKTsNCiAgICAgICAgICAgIGNvbnN0IGl2ID0gd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMTIpKTsNCiAgICAgICAgICAgIGNvbnN0IHBhc3N3b3JkQnl0ZXMgPSBlbmNvZGVyLmVuY29kZShwYXNzd29yZCk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBjb25zdCBrZXlNYXRlcmlhbCA9IGF3YWl0IHdpbmRvdy5jcnlwdG8uc3VidGxlLmltcG9ydEtleSgNCiAgICAgICAgICAgICAgICAicmF3IiwNCiAgICAgICAgICAgICAgICBwYXNzd29yZEJ5dGVzLA0KICAgICAgICAgICAgICAgIHsgbmFtZTogIlBCS0RGMiIgfSwNCiAgICAgICAgICAgICAgICBmYWxzZSwNCiAgICAgICAgICAgICAgICBbImRlcml2ZUtleSJdDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgIGNvbnN0IGtleSA9IGF3YWl0IHdpbmRvdy5jcnlwdG8uc3VidGxlLmRlcml2ZUtleSgNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICBuYW1lOiAiUEJLREYyIiwNCiAgICAgICAgICAgICAgICAgIHNhbHQsDQogICAgICAgICAgICAgICAgICBpdGVyYXRpb25zOiBTTkFQU0hPVF9LREZfSVRFUkFUSU9OUywNCiAgICAgICAgICAgICAgICAgIGhhc2g6ICJTSEEtMjU2Ig0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAga2V5TWF0ZXJpYWwsDQogICAgICAgICAgICAgICAgeyBuYW1lOiAiQUVTLUdDTSIsIGxlbmd0aDogMjU2IH0sDQogICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgWyJlbmNyeXB0Il0NCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgY29uc3QgY2lwaGVydGV4dEJ1ZmZlciA9IGF3YWl0IHdpbmRvdy5jcnlwdG8uc3VidGxlLmVuY3J5cHQoDQogICAgICAgICAgICAgICAgeyBuYW1lOiAiQUVTLUdDTSIsIGl2IH0sDQogICAgICAgICAgICAgICAga2V5LA0KICAgICAgICAgICAgICAgIHBheWxvYWRCeXRlcw0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBjb25zdCBlbnZlbG9wZSA9IHsNCiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBTTkFQU0hPVF9WRVJTSU9OLA0KICAgICAgICAgICAgICAgIGFsZ29yaXRobTogIkFFUy1HQ00iLA0KICAgICAgICAgICAgICAgIGtkZjogew0KICAgICAgICAgICAgICAgICAgbmFtZTogIlBCS0RGMiIsDQogICAgICAgICAgICAgICAgICBoYXNoOiAiU0hBLTI1NiIsDQogICAgICAgICAgICAgICAgICBpdGVyYXRpb25zOiBTTkFQU0hPVF9LREZfSVRFUkFUSU9OUywNCiAgICAgICAgICAgICAgICAgIHNhbHQ6IGJ1ZmZlclRvQmFzZTY0VXJsKHNhbHQpDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBpdjogYnVmZmVyVG9CYXNlNjRVcmwoaXYpLA0KICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IGJ1ZmZlclRvQmFzZTY0VXJsKG5ldyBVaW50OEFycmF5KGNpcGhlcnRleHRCdWZmZXIpKQ0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICBwYXlsb2FkQnl0ZXMuZmlsbCgwKTsNCiAgICAgICAgICAgICAgcGFzc3dvcmRCeXRlcy5maWxsKDApOw0KICAgICAgICAgICAgICByZXR1cm4gYnVpbGRDb21wYWN0U25hcHNob3RTdHJpbmcoZW52ZWxvcGUpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgcGF5bG9hZEJ5dGVzLmZpbGwoMCk7DQogICAgICAgICAgICAgIHBhc3N3b3JkQnl0ZXMuZmlsbCgwKTsNCiAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gYnVmZmVyVG9CYXNlNjQoaW5wdXQpIHsNCiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gaW5wdXQgaW5zdGFuY2VvZiBVaW50OEFycmF5ID8gaW5wdXQgOiBuZXcgVWludDhBcnJheShpbnB1dCk7DQogICAgICAgICAgICBjb25zdCBjaHVua1NpemUgPSAweDgwMDA7DQogICAgICAgICAgICBjb25zdCBjaHVua3MgPSBbXTsNCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBieXRlcy5sZW5ndGg7IGluZGV4ICs9IGNodW5rU2l6ZSkgew0KICAgICAgICAgICAgICBjb25zdCBjaHVuayA9IGJ5dGVzLnN1YmFycmF5KGluZGV4LCBpbmRleCArIGNodW5rU2l6ZSk7DQogICAgICAgICAgICAgIGNodW5rcy5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uY2h1bmspKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB3aW5kb3cuYnRvYShjaHVua3Muam9pbigiIikpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGJ1ZmZlclRvQmFzZTY0VXJsKGlucHV0KSB7DQogICAgICAgICAgICByZXR1cm4gYnVmZmVyVG9CYXNlNjQoaW5wdXQpLnJlcGxhY2UoL1wrL2csICItIikucmVwbGFjZSgvXC8vZywgIl8iKS5yZXBsYWNlKC89KyQvZywgIiIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHNhbml0aXplU25hcHNob3RTZWdtZW50KHZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm4gU3RyaW5nKHZhbHVlIHx8ICIiKS5yZXBsYWNlKC9bXHJcblxzXS9nLCAiIik7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gYnVpbGRDb21wYWN0U25hcHNob3RTdHJpbmcoZW52ZWxvcGUpIHsNCiAgICAgICAgICAgIGNvbnN0IHZlcnNpb25TZWdtZW50ID0gYHYke051bWJlcihlbnZlbG9wZT8udmVyc2lvbikgfHwgU05BUFNIT1RfVkVSU0lPTn1gOw0KICAgICAgICAgICAgY29uc3QgaXRlcmF0aW9ucyA9IE51bWJlcihlbnZlbG9wZT8ua2RmPy5pdGVyYXRpb25zKSB8fCBTTkFQU0hPVF9LREZfSVRFUkFUSU9OUzsNCiAgICAgICAgICAgIGNvbnN0IHNhbHRTZWdtZW50ID0gc2FuaXRpemVTbmFwc2hvdFNlZ21lbnQoZW52ZWxvcGU/LmtkZj8uc2FsdCk7DQogICAgICAgICAgICBjb25zdCBpdlNlZ21lbnQgPSBzYW5pdGl6ZVNuYXBzaG90U2VnbWVudChlbnZlbG9wZT8uaXYpOw0KICAgICAgICAgICAgY29uc3QgY2lwaGVydGV4dFNlZ21lbnQgPSBzYW5pdGl6ZVNuYXBzaG90U2VnbWVudChlbnZlbG9wZT8uY2lwaGVydGV4dCk7DQogICAgICAgICAgICBpZiAoIXNhbHRTZWdtZW50IHx8ICFpdlNlZ21lbnQgfHwgIWNpcGhlcnRleHRTZWdtZW50KSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU25hcHNob3QgZW5jcnlwdGlvbiBvdXRwdXQgaXMgaW5jb21wbGV0ZS4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBbU05BUFNIT1RfUFJFRklYLCB2ZXJzaW9uU2VnbWVudCwgYGske2l0ZXJhdGlvbnN9YCwgc2FsdFNlZ21lbnQsIGl2U2VnbWVudCwgY2lwaGVydGV4dFNlZ21lbnRdLmpvaW4oIi4iKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiB0cmlnZ2VyRmlsZURvd25sb2FkKHVybCwgZmlsZW5hbWUpIHsNCiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7DQogICAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7DQogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gZmlsZW5hbWU7DQogICAgICAgICAgICBsaW5rLnJlbCA9ICJub29wZW5lciI7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOw0KICAgICAgICAgICAgbGluay5jbGljaygpOw0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBkb3dubG9hZFRleHRGaWxlKGNvbnRlbnQsIGZpbGVuYW1lLCBtaW1lVHlwZSA9ICJ0ZXh0L3BsYWluIikgew0KICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjb250ZW50XSwgeyB0eXBlOiBtaW1lVHlwZSB9KTsNCiAgICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgICB0cmlnZ2VyRmlsZURvd25sb2FkKHVybCwgZmlsZW5hbWUpOw0KICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpLCAxMjAwKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBkb3dubG9hZEJpbmFyeUZpbGUoZGF0YSwgZmlsZW5hbWUsIG1pbWVUeXBlID0gImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSIpIHsNCiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBkYXRhIGluc3RhbmNlb2YgQmxvYiA/IGRhdGEgOiBuZXcgQmxvYihbZGF0YV0sIHsgdHlwZTogbWltZVR5cGUgfSk7DQogICAgICAgICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOw0KICAgICAgICAgICAgdHJpZ2dlckZpbGVEb3dubG9hZCh1cmwsIGZpbGVuYW1lKTsNCiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IFVSTC5yZXZva2VPYmplY3RVUkwodXJsKSwgMTIwMCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgY29uc3QgQ1JDMzJfVEFCTEUgPSAoKCkgPT4gew0KICAgICAgICAgICAgY29uc3QgdGFibGUgPSBuZXcgVWludDMyQXJyYXkoMjU2KTsNCiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCAyNTY7IGluZGV4ICs9IDEpIHsNCiAgICAgICAgICAgICAgbGV0IHZhbHVlID0gaW5kZXg7DQogICAgICAgICAgICAgIGZvciAobGV0IGJpdCA9IDA7IGJpdCA8IDg7IGJpdCArPSAxKSB7DQogICAgICAgICAgICAgICAgdmFsdWUgPSAodmFsdWUgJiAxKSA/ICgweEVEQjg4MzIwIF4gKHZhbHVlID4+PiAxKSkgOiAodmFsdWUgPj4+IDEpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRhYmxlW2luZGV4XSA9IHZhbHVlID4+PiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRhYmxlOw0KICAgICAgICAgIH0pKCk7DQoNCiAgICAgICAgICBmdW5jdGlvbiBjcmMzMihieXRlcykgew0KICAgICAgICAgICAgbGV0IGNyYyA9IDB4RkZGRkZGRkY7DQogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYnl0ZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7DQogICAgICAgICAgICAgIGNyYyA9IENSQzMyX1RBQkxFWyhjcmMgXiBieXRlc1tpbmRleF0pICYgMHhGRl0gXiAoY3JjID4+PiA4KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiAoY3JjIF4gMHhGRkZGRkZGRikgPj4+IDA7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gZ2V0TXNEb3NEYXRlVGltZShkYXRlID0gbmV3IERhdGUoKSkgew0KICAgICAgICAgICAgY29uc3QgeWVhciA9IE1hdGgubWF4KDE5ODAsIGRhdGUuZ2V0VVRDRnVsbFllYXIoKSk7DQogICAgICAgICAgICBjb25zdCBtb250aCA9IGRhdGUuZ2V0VVRDTW9udGgoKSArIDE7DQogICAgICAgICAgICBjb25zdCBkYXkgPSBkYXRlLmdldFVUQ0RhdGUoKTsNCiAgICAgICAgICAgIGNvbnN0IGhvdXJzID0gZGF0ZS5nZXRVVENIb3VycygpOw0KICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0VVRDTWludXRlcygpOw0KICAgICAgICAgICAgY29uc3Qgc2Vjb25kcyA9IE1hdGguZmxvb3IoZGF0ZS5nZXRVVENTZWNvbmRzKCkgLyAyKTsNCiAgICAgICAgICAgIGNvbnN0IGRvc0RhdGUgPSAoKHllYXIgLSAxOTgwKSA8PCA5KSB8IChtb250aCA8PCA1KSB8IGRheTsNCiAgICAgICAgICAgIGNvbnN0IGRvc1RpbWUgPSAoaG91cnMgPDwgMTEpIHwgKG1pbnV0ZXMgPDwgNSkgfCBzZWNvbmRzOw0KICAgICAgICAgICAgcmV0dXJuIHsgZGF0ZTogZG9zRGF0ZSAmIDB4RkZGRiwgdGltZTogZG9zVGltZSAmIDB4RkZGRiB9Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGNvbmNhdFVpbnQ4QXJyYXlzKHBhcnRzKSB7DQogICAgICAgICAgICBjb25zdCB0b3RhbCA9IHBhcnRzLnJlZHVjZSgoc3VtLCBwYXJ0KSA9PiBzdW0gKyBwYXJ0Lmxlbmd0aCwgMCk7DQogICAgICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheSh0b3RhbCk7DQogICAgICAgICAgICBsZXQgb2Zmc2V0ID0gMDsNCiAgICAgICAgICAgIHBhcnRzLmZvckVhY2gocGFydCA9PiB7DQogICAgICAgICAgICAgIHJlc3VsdC5zZXQocGFydCwgb2Zmc2V0KTsNCiAgICAgICAgICAgICAgb2Zmc2V0ICs9IHBhcnQubGVuZ3RoOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVppcEFyY2hpdmUoZmlsZXMpIHsNCiAgICAgICAgICAgIGNvbnN0IGVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTsNCiAgICAgICAgICAgIGNvbnN0IGxvY2FsUGFydHMgPSBbXTsNCiAgICAgICAgICAgIGNvbnN0IGNlbnRyYWxQYXJ0cyA9IFtdOw0KICAgICAgICAgICAgbGV0IG9mZnNldCA9IDA7DQogICAgICAgICAgICBjb25zdCBmaWxlRW50cmllcyA9IGZpbGVzLm1hcChmaWxlID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgbmFtZUJ5dGVzID0gZW5jb2Rlci5lbmNvZGUoZmlsZS5uYW1lKTsNCiAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZpbGUuZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgPyBmaWxlLmRhdGEgOiBlbmNvZGVyLmVuY29kZShTdHJpbmcoZmlsZS5kYXRhKSk7DQogICAgICAgICAgICAgIGNvbnN0IGNyYyA9IGNyYzMyKGRhdGEpOw0KICAgICAgICAgICAgICBjb25zdCB7IGRhdGUsIHRpbWUgfSA9IGdldE1zRG9zRGF0ZVRpbWUoZmlsZS5tb2RpZmllZCBpbnN0YW5jZW9mIERhdGUgPyBmaWxlLm1vZGlmaWVkIDogbmV3IERhdGUoKSk7DQogICAgICAgICAgICAgIHJldHVybiB7IG5hbWU6IGZpbGUubmFtZSwgbmFtZUJ5dGVzLCBkYXRhLCBjcmMsIGRhdGUsIHRpbWUgfTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBmaWxlRW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgbG9jYWxIZWFkZXIgPSBuZXcgVWludDhBcnJheSgzMCArIGVudHJ5Lm5hbWVCeXRlcy5sZW5ndGgpOw0KICAgICAgICAgICAgICBjb25zdCBsb2NhbFZpZXcgPSBuZXcgRGF0YVZpZXcobG9jYWxIZWFkZXIuYnVmZmVyKTsNCiAgICAgICAgICAgICAgbG9jYWxWaWV3LnNldFVpbnQzMigwLCAweDA0MDM0QjUwLCB0cnVlKTsNCiAgICAgICAgICAgICAgbG9jYWxWaWV3LnNldFVpbnQxNig0LCAyMCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGxvY2FsVmlldy5zZXRVaW50MTYoNiwgMCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGxvY2FsVmlldy5zZXRVaW50MTYoOCwgMCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGxvY2FsVmlldy5zZXRVaW50MTYoMTAsIGVudHJ5LnRpbWUsIHRydWUpOw0KICAgICAgICAgICAgICBsb2NhbFZpZXcuc2V0VWludDE2KDEyLCBlbnRyeS5kYXRlLCB0cnVlKTsNCiAgICAgICAgICAgICAgbG9jYWxWaWV3LnNldFVpbnQzMigxNCwgZW50cnkuY3JjLCB0cnVlKTsNCiAgICAgICAgICAgICAgbG9jYWxWaWV3LnNldFVpbnQzMigxOCwgZW50cnkuZGF0YS5sZW5ndGgsIHRydWUpOw0KICAgICAgICAgICAgICBsb2NhbFZpZXcuc2V0VWludDMyKDIyLCBlbnRyeS5kYXRhLmxlbmd0aCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGxvY2FsVmlldy5zZXRVaW50MTYoMjYsIGVudHJ5Lm5hbWVCeXRlcy5sZW5ndGgsIHRydWUpOw0KICAgICAgICAgICAgICBsb2NhbFZpZXcuc2V0VWludDE2KDI4LCAwLCB0cnVlKTsNCiAgICAgICAgICAgICAgbG9jYWxIZWFkZXIuc2V0KGVudHJ5Lm5hbWVCeXRlcywgMzApOw0KDQogICAgICAgICAgICAgIGxvY2FsUGFydHMucHVzaChsb2NhbEhlYWRlciwgZW50cnkuZGF0YSk7DQoNCiAgICAgICAgICAgICAgY29uc3QgY2VudHJhbEhlYWRlciA9IG5ldyBVaW50OEFycmF5KDQ2ICsgZW50cnkubmFtZUJ5dGVzLmxlbmd0aCk7DQogICAgICAgICAgICAgIGNvbnN0IGNlbnRyYWxWaWV3ID0gbmV3IERhdGFWaWV3KGNlbnRyYWxIZWFkZXIuYnVmZmVyKTsNCiAgICAgICAgICAgICAgY2VudHJhbFZpZXcuc2V0VWludDMyKDAsIDB4MDIwMTRCNTAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoNCwgMjAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoNiwgMjAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoOCwgMCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxWaWV3LnNldFVpbnQxNigxMCwgMCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxWaWV3LnNldFVpbnQxNigxMiwgZW50cnkudGltZSwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxWaWV3LnNldFVpbnQxNigxNCwgZW50cnkuZGF0ZSwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxWaWV3LnNldFVpbnQzMigxNiwgZW50cnkuY3JjLCB0cnVlKTsNCiAgICAgICAgICAgICAgY2VudHJhbFZpZXcuc2V0VWludDMyKDIwLCBlbnRyeS5kYXRhLmxlbmd0aCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxWaWV3LnNldFVpbnQzMigyNCwgZW50cnkuZGF0YS5sZW5ndGgsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoMjgsIGVudHJ5Lm5hbWVCeXRlcy5sZW5ndGgsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoMzAsIDAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoMzIsIDAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoMzQsIDAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MTYoMzYsIDAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MzIoMzgsIDAsIHRydWUpOw0KICAgICAgICAgICAgICBjZW50cmFsVmlldy5zZXRVaW50MzIoNDIsIG9mZnNldCwgdHJ1ZSk7DQogICAgICAgICAgICAgIGNlbnRyYWxIZWFkZXIuc2V0KGVudHJ5Lm5hbWVCeXRlcywgNDYpOw0KICAgICAgICAgICAgICBjZW50cmFsUGFydHMucHVzaChjZW50cmFsSGVhZGVyKTsNCg0KICAgICAgICAgICAgICBvZmZzZXQgKz0gbG9jYWxIZWFkZXIubGVuZ3RoICsgZW50cnkuZGF0YS5sZW5ndGg7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29uc3QgY2VudHJhbFNpemUgPSBjZW50cmFsUGFydHMucmVkdWNlKChzdW0sIHBhcnQpID0+IHN1bSArIHBhcnQubGVuZ3RoLCAwKTsNCiAgICAgICAgICAgIGNvbnN0IGxvY2FsU2l6ZSA9IGxvY2FsUGFydHMucmVkdWNlKChzdW0sIHBhcnQpID0+IHN1bSArIHBhcnQubGVuZ3RoLCAwKTsNCg0KICAgICAgICAgICAgY29uc3QgZW5kUmVjb3JkID0gbmV3IFVpbnQ4QXJyYXkoMjIpOw0KICAgICAgICAgICAgY29uc3QgZW5kVmlldyA9IG5ldyBEYXRhVmlldyhlbmRSZWNvcmQuYnVmZmVyKTsNCiAgICAgICAgICAgIGVuZFZpZXcuc2V0VWludDMyKDAsIDB4MDYwNTRCNTAsIHRydWUpOw0KICAgICAgICAgICAgZW5kVmlldy5zZXRVaW50MTYoNCwgMCwgdHJ1ZSk7DQogICAgICAgICAgICBlbmRWaWV3LnNldFVpbnQxNig2LCAwLCB0cnVlKTsNCiAgICAgICAgICAgIGVuZFZpZXcuc2V0VWludDE2KDgsIGZpbGVFbnRyaWVzLmxlbmd0aCwgdHJ1ZSk7DQogICAgICAgICAgICBlbmRWaWV3LnNldFVpbnQxNigxMCwgZmlsZUVudHJpZXMubGVuZ3RoLCB0cnVlKTsNCiAgICAgICAgICAgIGVuZFZpZXcuc2V0VWludDMyKDEyLCBjZW50cmFsU2l6ZSwgdHJ1ZSk7DQogICAgICAgICAgICBlbmRWaWV3LnNldFVpbnQzMigxNiwgbG9jYWxTaXplLCB0cnVlKTsNCiAgICAgICAgICAgIGVuZFZpZXcuc2V0VWludDE2KDIwLCAwLCB0cnVlKTsNCg0KICAgICAgICAgICAgY29uc3QgYXJjaGl2ZVBhcnRzID0gWy4uLmxvY2FsUGFydHMsIC4uLmNlbnRyYWxQYXJ0cywgZW5kUmVjb3JkXTsNCiAgICAgICAgICAgIHJldHVybiBjb25jYXRVaW50OEFycmF5cyhhcmNoaXZlUGFydHMpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGVzY2FwZUNzdlZhbHVlKHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBzdHJpbmdWYWx1ZSA9IFN0cmluZyh2YWx1ZSk7DQogICAgICAgICAgICBpZiAoL1siXHJcbixdLy50ZXN0KHN0cmluZ1ZhbHVlKSkgew0KICAgICAgICAgICAgICByZXR1cm4gYCIke3N0cmluZ1ZhbHVlLnJlcGxhY2UoLyIvZywgJyIiJyl9ImA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gc3RyaW5nVmFsdWU7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gZG93bmxvYWRDc3YoZmlsZW5hbWUsIGhlYWRlcnMsIHJvd3MpIHsNCiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyb3dzKSB8fCAhcm93cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbGluZXMgPSBbXTsNCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGhlYWRlcnMpICYmIGhlYWRlcnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIGxpbmVzLnB1c2goaGVhZGVycy5tYXAoZXNjYXBlQ3N2VmFsdWUpLmpvaW4oIiwiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByb3dzLmZvckVhY2gocm93ID0+IHsNCiAgICAgICAgICAgICAgbGluZXMucHVzaChyb3cubWFwKGVzY2FwZUNzdlZhbHVlKS5qb2luKCIsIikpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBkb3dubG9hZFRleHRGaWxlKGxpbmVzLmpvaW4oIlxyXG4iKSwgZmlsZW5hbWUsICJ0ZXh0L2NzdiIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHNldEJ1dHRvbkVuYWJsZWQoYnV0dG9uLCBlbmFibGVkKSB7DQogICAgICAgICAgICBpZiAoIWJ1dHRvbikgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBidXR0b24uZGlzYWJsZWQgPSAhZW5hYmxlZDsNCiAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1kaXNhYmxlZCIsICFlbmFibGVkKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBkb3dubG9hZENoYXJ0SW1hZ2UoY2hhcnQsIGZpbGVuYW1lKSB7DQogICAgICAgICAgICBpZiAoIWNoYXJ0IHx8ICFjaGFydC5jYW52YXMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbGFiZWxzID0gY2hhcnQuZGF0YSAmJiBBcnJheS5pc0FycmF5KGNoYXJ0LmRhdGEubGFiZWxzKSA/IGNoYXJ0LmRhdGEubGFiZWxzIDogW107DQogICAgICAgICAgICBpZiAoIWxhYmVscy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc291cmNlQ2FudmFzID0gY2hhcnQuY2FudmFzOw0KICAgICAgICAgICAgY29uc3QgZXhwb3J0Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7DQogICAgICAgICAgICBleHBvcnRDYW52YXMud2lkdGggPSBzb3VyY2VDYW52YXMud2lkdGg7DQogICAgICAgICAgICBleHBvcnRDYW52YXMuaGVpZ2h0ID0gc291cmNlQ2FudmFzLmhlaWdodDsNCiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQgPSBleHBvcnRDYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsNCiAgICAgICAgICAgIGNvbnN0IGJhY2tncm91bmRDb2xvciA9IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tY2FyZC1zdXJmYWNlIiwgIiNmZmZmZmYiKSB8fCAiI2ZmZmZmZiI7DQogICAgICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGJhY2tncm91bmRDb2xvcjsNCiAgICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgZXhwb3J0Q2FudmFzLndpZHRoLCBleHBvcnRDYW52YXMuaGVpZ2h0KTsNCiAgICAgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHNvdXJjZUNhbnZhcywgMCwgMCk7DQogICAgICAgICAgICBjb25zdCBkYXRhVXJsID0gZXhwb3J0Q2FudmFzLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIik7DQogICAgICAgICAgICB0cmlnZ2VyRmlsZURvd25sb2FkKGRhdGFVcmwsIGZpbGVuYW1lKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBjb2xsZWN0VXNhZ2VJbnRlbnNpdHlSb3dzKCkgew0KICAgICAgICAgICAgY29uc3QgbW9udGhzID0gQXJyYXkuaXNBcnJheShzdGF0ZS5sYXRlc3RVc2FnZU1vbnRocykgPyBzdGF0ZS5sYXRlc3RVc2FnZU1vbnRocyA6IFtdOw0KICAgICAgICAgICAgaWYgKCFtb250aHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHJldHVybiBbXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24gJiYgc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5sZW5ndGgNCiAgICAgICAgICAgICAgPyBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uDQogICAgICAgICAgICAgIDogbW9udGhzLm1hcChlbnRyeSA9PiBlbnRyeS5rZXkpOw0KICAgICAgICAgICAgY29uc3QgbW9udGhNYXAgPSBuZXcgTWFwKG1vbnRocy5tYXAoZW50cnkgPT4gW2VudHJ5LmtleSwgZW50cnldKSk7DQogICAgICAgICAgICBjb25zdCByb3dzID0gW107DQogICAgICAgICAgICBzZWxlY3Rpb24uZm9yRWFjaChrZXkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBlbnRyeSA9IG1vbnRoTWFwLmdldChrZXkpOw0KICAgICAgICAgICAgICBpZiAoIWVudHJ5KSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJvd3MucHVzaCh7DQogICAgICAgICAgICAgICAga2V5LA0KICAgICAgICAgICAgICAgIGxhYmVsOiBlbnRyeS5sYWJlbCB8fCBrZXkgfHwgIiIsDQogICAgICAgICAgICAgICAgdG90YWxVc2VyczogTnVtYmVyLmlzRmluaXRlKGVudHJ5LnRvdGFsVXNlcnMpID8gZW50cnkudG90YWxVc2VycyA6IDAsDQogICAgICAgICAgICAgICAgZnJlcXVlbnRVc2VyczogTnVtYmVyLmlzRmluaXRlKGVudHJ5LnBvd2VyVXNlcnMpID8gZW50cnkucG93ZXJVc2VycyA6IDAsDQogICAgICAgICAgICAgICAgZnJlcXVlbnRTaGFyZTogTnVtYmVyLmlzRmluaXRlKGVudHJ5LnBvd2VyU2hhcmUpID8gZW50cnkucG93ZXJTaGFyZSA6IG51bGwsDQogICAgICAgICAgICAgICAgY29uc2lzdGVudFVzZXJzOiBOdW1iZXIuaXNGaW5pdGUoZW50cnkuY29uc2lzdGVudFVzZXJzKSA/IGVudHJ5LmNvbnNpc3RlbnRVc2VycyA6IDAsDQogICAgICAgICAgICAgICAgY29uc2lzdGVudFNoYXJlOiBOdW1iZXIuaXNGaW5pdGUoZW50cnkuY29uc2lzdGVudFNoYXJlKSA/IGVudHJ5LmNvbnNpc3RlbnRTaGFyZSA6IG51bGwsDQogICAgICAgICAgICAgICAgcmFuZ2U6IGVudHJ5LndlZWtSYW5nZUxhYmVsIHx8IGVudHJ5Lm1vbnRoUmFuZ2VMYWJlbCB8fCAiIg0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHJvd3M7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVXNhZ2VJbnRlbnNpdHlFeHBvcnRBdmFpbGFiaWxpdHkoKSB7DQogICAgICAgICAgICBjb25zdCByb3dzID0gY29sbGVjdFVzYWdlSW50ZW5zaXR5Um93cygpOw0KICAgICAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20udXNhZ2VJbnRlbnNpdHlFeHBvcnRDc3YsIHJvd3MubGVuZ3RoID4gMCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hUZXh0QXNzZXQocGF0aCkgew0KICAgICAgICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChwYXRoLCBkb2N1bWVudC5iYXNlVVJJKS5ocmVmOw0KICAgICAgICAgICAgY29uc3QgbG9hZGVycyA9IFsNCiAgICAgICAgICAgICAgYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7IGNhY2hlOiAibm8tc3RvcmUiIH0pOw0KICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsNCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCAke3Jlc3BvbnNlLnN0YXR1c31gKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTsNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgKCkgPT4NCiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCiAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIkdFVCIsIHVybCwgdHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCJ0ZXh0L3BsYWluIik7DQogICAgICAgICAgICAgICAgICAgIHhoci5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDAgfHwgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDApKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZVRleHQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKGBYSFIgJHt4aHIuc3RhdHVzIHx8ICJsb2NhbCJ9YCkpOw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICB4aHIub25lcnJvciA9ICgpID0+IHJlamVjdChuZXcgRXJyb3IoIlhIUiBuZXR3b3JrIGVycm9yIikpOw0KICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZCgpOw0KICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KSwNCiAgICAgICAgICAgICAgKCkgPT4NCiAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgICAgICAgICAgICAgICBjb25zdCBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTsNCiAgICAgICAgICAgICAgICAgIGlmcmFtZS5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7DQogICAgICAgICAgICAgICAgICBpZnJhbWUuc3R5bGUud2lkdGggPSAiMCI7DQogICAgICAgICAgICAgICAgICBpZnJhbWUuc3R5bGUuaGVpZ2h0ID0gIjAiOw0KICAgICAgICAgICAgICAgICAgaWZyYW1lLnN0eWxlLmJvcmRlciA9ICIwIjsNCiAgICAgICAgICAgICAgICAgIGlmcmFtZS5zdHlsZS5jbGlwUGF0aCA9ICJpbnNldCg1MCUpIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGlmIChpZnJhbWUucGFyZW50Tm9kZSkgew0KICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGlmcmFtZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICBpZnJhbWUub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGlmcmFtZS5jb250ZW50RG9jdW1lbnQ7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9DQogICAgICAgICAgICAgICAgICAgICAgICAoZG9jICYmIGRvYy5ib2R5ICYmIGRvYy5ib2R5LnRleHRDb250ZW50KSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgKGRvYyAmJiBkb2MuZG9jdW1lbnRFbGVtZW50ICYmIGRvYy5kb2N1bWVudEVsZW1lbnQudGV4dENvbnRlbnQpIHx8DQogICAgICAgICAgICAgICAgICAgICAgICAiIjsNCiAgICAgICAgICAgICAgICAgICAgICBjbGVhbnVwKCk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHRleHQgJiYgdGV4dC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkVtcHR5IHJlc3BvbnNlIikpOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjbGVhbnVwKCk7DQogICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgIGlmcmFtZS5vbmVycm9yID0gKCkgPT4gew0KICAgICAgICAgICAgICAgICAgICBjbGVhbnVwKCk7DQogICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIklmcmFtZSBsb2FkIGVycm9yIikpOw0KICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgIGlmcmFtZS5zcmMgPSB1cmw7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7DQogICAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIF07DQogICAgICAgICAgICBsZXQgbGFzdEVycm9yID0gbnVsbDsNCiAgICAgICAgICAgIGZvciAoY29uc3QgbG9hZGVyIG9mIGxvYWRlcnMpIHsNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgbG9hZGVyKCk7DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgbGFzdEVycm9yID0gZXJyb3I7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHJlYWQgJHt1cmx9OiAke2xhc3RFcnJvciA/IGxhc3RFcnJvci5tZXNzYWdlIDogInVua25vd24gZXJyb3IifWApOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGJ1aWxkU2hhcmVQb2ludFJlYWRtZSh7IGZpbGVuYW1lIH0pIHsNCiAgICAgICAgICAgIHJldHVybiBbDQogICAgICAgICAgICAgICIjIENvcGlsb3QgRGFzaGJvYXJkIFNoYXJlUG9pbnQgQnVuZGxlIiwNCiAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICJUaGFuayB5b3UgZm9yIGdlbmVyYXRpbmcgYSBTaGFyZVBvaW50LXJlYWR5IHBhY2thZ2UgZnJvbSB0aGUgQ29waWxvdCBJbXBhY3QgRGFzaGJvYXJkLiIsDQogICAgICAgICAgICAgICIiLA0KICAgICAgICAgICAgICAiIyMgQ29udGVudHMiLA0KICAgICAgICAgICAgICAiLSBgaW5kZXguaHRtbGAgLSBzdGFuZGFsb25lIGRhc2hib2FyZCB0aGF0IHByb21wdHMgZm9yIHRoZSBlbmNyeXB0ZWQgc25hcHNob3QgcGFzc3dvcmQuIiwNCiAgICAgICAgICAgICAgIi0gYGFzc2V0cy9gIC0gc3VwcG9ydGluZyBDU1MgYW5kIEphdmFTY3JpcHQgZmlsZXMgKGlkZW50aWNhbCB0byB5b3VyIGxvY2FsIGRhc2hib2FyZCkuIiwNCiAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICIjIyBQdWJsaXNoIHRvIFNoYXJlUG9pbnQgKE1vZGVybiBzaXRlcykiLA0KICAgICAgICAgICAgICAiMS4gVXBsb2FkIHRoZSBlbnRpcmUgZm9sZGVyIHRvIGEgZG9jdW1lbnQgbGlicmFyeSAoZS5nLiwgYFNpdGUgQXNzZXRzL0NvcGlsb3REYXNoYm9hcmRgKS4iLA0KICAgICAgICAgICAgICAiMi4gQ29weSB0aGUgVVJMIHRvIGBpbmRleC5odG1sYCBvbmNlIHRoZSB1cGxvYWQgY29tcGxldGVzLiIsDQogICAgICAgICAgICAgICIzLiBBZGQgYSBuZXcgcGFnZSBvciBlZGl0IGFuIGV4aXN0aW5nIG9uZSwgdGhlbiBpbnNlcnQgYW4gKipFbWJlZCoqIHdlYiBwYXJ0LiIsDQogICAgICAgICAgICAgICI0LiBQYXN0ZSB0aGUgYGluZGV4Lmh0bWxgIFVSTCBhbmQgc2F2ZS9wdWJsaXNoIHRoZSBwYWdlLiIsDQogICAgICAgICAgICAgICI1LiBXaGVuIGNvbGxlYWd1ZXMgb3BlbiB0aGUgcGFnZSwgdGhleSdsbCBiZSBwcm9tcHRlZCBmb3IgdGhlIHNuYXBzaG90IHBhc3N3b3JkIHlvdSBzaGFyZWQuIiwNCiAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgICIjIyBUaXBzIiwNCiAgICAgICAgICAgICAgIi0gS2VlcCB0aGUgcGFzc3dvcmQgcHJpdmF0ZTsgaXQgZGVjcnlwdHMgdGhlIGRhdGFzZXQgaW5zaWRlIHRoZSBicm93c2VyIG9ubHkuIiwNCiAgICAgICAgICAgICAgIi0gRm9yIGJlc3QgcmVzdWx0cywgZW5zdXJlIENoYXJ0LmpzIGFuZCBvdGhlciBDRE4gZG9tYWlucyBhcmUgYWxsb3dlZCBieSB5b3VyIHRlbmFudCBDU1AuIiwNCiAgICAgICAgICAgICAgIi0gSWYgeW91IHByZWZlciBob3N0aW5nIG91dHNpZGUgU2hhcmVQb2ludCwgdXBsb2FkIHRoZSBzYW1lIGJ1bmRsZSB0byBhbnkgaW50ZXJuYWwgc3RhdGljIGhvc3QuIiwNCiAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgIGBCdW5kbGUgZ2VuZXJhdGVkOiAke2ZpbGVuYW1lfWAsDQogICAgICAgICAgICAgICIiDQogICAgICAgICAgICBdLmpvaW4oIlxyXG4iKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBkZWNvZGVCYXNlNjRUb1N0cmluZyhiYXNlNjQpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgYmFzZTY0ICE9PSAic3RyaW5nIiB8fCAhYmFzZTY0LnRyaW0oKSkgew0KICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBieXRlcyA9IGJhc2U2NFRvVWludDhBcnJheShiYXNlNjQpOw0KICAgICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOw0KICAgICAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGJ5dGVzKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVTaGFyZVBvaW50QmFzZTY0KHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSB2YWx1ZS50cmltKCk7DQogICAgICAgICAgICByZXR1cm4gdHJpbW1lZCA/IHRyaW1tZWQgOiBudWxsOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGdldFNoYXJlUG9pbnRCYXNlNjQoa2luZCkgew0KICAgICAgICAgICAgY29uc3QgYWxpYXNNYXAgPSB7DQogICAgICAgICAgICAgIGNzczogImNzcyIsDQogICAgICAgICAgICAgIGpzOiAianMiLA0KICAgICAgICAgICAgICBodG1sOiAiaHRtbCIsDQogICAgICAgICAgICAgIHZlbmRvckZmbGF0ZTogInZlbmRvckZmbGF0ZSINCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBjb25zdCBwcm9wZXJ0eU1hcCA9IHsNCiAgICAgICAgICAgICAgY3NzOiAiU0hBUkVQT0lOVF9DU1NfQkFTRTY0IiwNCiAgICAgICAgICAgICAganM6ICJTSEFSRVBPSU5UX0pTX0JBU0U2NCIsDQogICAgICAgICAgICAgIGh0bWw6ICJTSEFSRVBPSU5UX0hUTUxfQkFTRTY0IiwNCiAgICAgICAgICAgICAgdmVuZG9yRmZsYXRlOiAiU0hBUkVQT0lOVF9WRU5ET1JfRkZMQVRFX0JBU0U2NCINCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpZiAoc2hhcmVQb2ludEdsb2JhbCkgew0KICAgICAgICAgICAgICBjb25zdCByZWdpc3RyeSA9IHNoYXJlUG9pbnRHbG9iYWwuX19DT1BJTE9UX1NIQVJFUE9JTlRfQVNTRVRTX187DQogICAgICAgICAgICAgIGNvbnN0IGFsaWFzID0gYWxpYXNNYXBba2luZF07DQogICAgICAgICAgICAgIGlmIChyZWdpc3RyeSAmJiBhbGlhcykgew0KICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRSZWdpc3RyeVZhbHVlID0gbm9ybWFsaXplU2hhcmVQb2ludEJhc2U2NChyZWdpc3RyeVthbGlhc10pOw0KICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkUmVnaXN0cnlWYWx1ZSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZWRSZWdpc3RyeVZhbHVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBwcm9wZXJ0eSA9IHByb3BlcnR5TWFwW2tpbmRdOw0KICAgICAgICAgICAgICBpZiAocHJvcGVydHkgJiYgcHJvcGVydHkgaW4gc2hhcmVQb2ludEdsb2JhbCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRHbG9iYWxWYWx1ZSA9IG5vcm1hbGl6ZVNoYXJlUG9pbnRCYXNlNjQoc2hhcmVQb2ludEdsb2JhbFtwcm9wZXJ0eV0pOw0KICAgICAgICAgICAgICAgIGlmIChub3JtYWxpemVkR2xvYmFsVmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVkR2xvYmFsVmFsdWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBpZiAoa2luZCA9PT0gImNzcyIgJiYgdHlwZW9mIFNIQVJFUE9JTlRfQ1NTX0JBU0U2NCA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplU2hhcmVQb2ludEJhc2U2NChTSEFSRVBPSU5UX0NTU19CQVNFNjQpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChraW5kID09PSAianMiICYmIHR5cGVvZiBTSEFSRVBPSU5UX0pTX0JBU0U2NCA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplU2hhcmVQb2ludEJhc2U2NChTSEFSRVBPSU5UX0pTX0JBU0U2NCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGtpbmQgPT09ICJodG1sIiAmJiB0eXBlb2YgU0hBUkVQT0lOVF9IVE1MX0JBU0U2NCA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbm9ybWFsaXplU2hhcmVQb2ludEJhc2U2NChTSEFSRVBPSU5UX0hUTUxfQkFTRTY0KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoa2luZCA9PT0gInZlbmRvckZmbGF0ZSIgJiYgdHlwZW9mIFNIQVJFUE9JTlRfVkVORE9SX0ZGTEFURV9CQVNFNjQgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVNoYXJlUG9pbnRCYXNlNjQoU0hBUkVQT0lOVF9WRU5ET1JfRkZMQVRFX0JBU0U2NCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIC8vIElnbm9yZSBSZWZlcmVuY2VFcnJvciB3aGVuIGJpbmRpbmdzIGFyZSB1bmF2YWlsYWJsZTsgd2UnbGwgcmV0dXJuIG51bGwgYmVsb3cuDQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiByZWFkU3R5bGVzaGVldFRleHQodGFyZ2V0UGF0aCkgew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0VXJsID0gbmV3IFVSTCh0YXJnZXRQYXRoLCBkb2N1bWVudC5iYXNlVVJJKS5ocmVmOw0KICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNoZWV0IG9mIEFycmF5LmZyb20oZG9jdW1lbnQuc3R5bGVTaGVldHMgfHwgW10pKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaHJlZiA9IHNoZWV0ICYmIHNoZWV0LmhyZWYgPyBuZXcgVVJMKHNoZWV0LmhyZWYsIGRvY3VtZW50LmJhc2VVUkkpLmhyZWYgOiBudWxsOw0KICAgICAgICAgICAgICAgIGlmICghaHJlZiB8fCBocmVmICE9PSB0YXJnZXRVcmwpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBydWxlcyA9IHNoZWV0LmNzc1J1bGVzIHx8IHNoZWV0LnJ1bGVzOw0KICAgICAgICAgICAgICAgIGlmICghcnVsZXMpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShydWxlcykNCiAgICAgICAgICAgICAgICAgIC5tYXAocnVsZSA9PiBydWxlICYmIHJ1bGUuY3NzVGV4dCA/IHJ1bGUuY3NzVGV4dCA6ICIiKQ0KICAgICAgICAgICAgICAgICAgLmpvaW4oIlxuIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgc3R5bGVzaGVldCBydWxlcyBmb3IgU2hhcmVQb2ludCBidW5kbGUiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlQXNzZXRCeXRlcyhiYXNlNjRWYWx1ZSwgcGF0aCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBiYXNlNjRWYWx1ZSA9PT0gInN0cmluZyIgJiYgYmFzZTY0VmFsdWUudHJpbSgpKSB7DQogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYmFzZTY0VG9VaW50OEFycmF5KGJhc2U2NFZhbHVlKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmV0Y2hUZXh0QXNzZXQocGF0aCkNCiAgICAgICAgICAgICAgLnRoZW4odGV4dCA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpOw0KICAgICAgICAgICAgICAgIHJldHVybiBlbmNvZGVyLmVuY29kZSh0ZXh0KTsNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICBpZiAocGF0aC5lbmRzV2l0aCgiLmNzcyIpKSB7DQogICAgICAgICAgICAgICAgICBjb25zdCBzdHlsZXNoZWV0VGV4dCA9IHJlYWRTdHlsZXNoZWV0VGV4dChwYXRoKTsNCiAgICAgICAgICAgICAgICAgIGlmIChzdHlsZXNoZWV0VGV4dCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbmNvZGVyLmVuY29kZShzdHlsZXNoZWV0VGV4dCk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHRocm93IGVycm9yOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBleHBvcnRTbmFwc2hvdEJ1bmRsZShzbmFwc2hvdFN0cmluZykgewogICAgICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICAgICAgICAgIGNvbnN0IGJ1bmRsZU5hbWUgPSBgY29waWxvdC1kYXNoYm9hcmQtc2hhcmVwb2ludC0ke0RhdGUubm93KCl9LnppcGA7CiAgICAgICAgICAgIGNvbnN0IGVtYmVkT3B0aW9ucyA9IHsNCiAgICAgICAgICAgICAgc25hcHNob3Q6IHNuYXBzaG90U3RyaW5nLA0KICAgICAgICAgICAgICBzbmFwc2hvdFZlcnNpb246IFNOQVBTSE9UX1ZFUlNJT04sDQogICAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLA0KICAgICAgICAgICAgICBtZXNzYWdlOiAiRW50ZXIgdGhlIHNuYXBzaG90IHBhc3N3b3JkIHRvIHVubG9jayB0aGlzIGRhc2hib2FyZC4iDQogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBob29rID0gJzxzY3JpcHQgZGVmZXIgc3JjPSJhc3NldHMvdmVuZG9yL2ZmbGF0ZS5taW4uanMiPjwvc2NyaXB0Pic7CiAgICAgICAgICAgIGNvbnN0IGVtYmVkU2NyaXB0VGFnID0gJzxzY3JpcHQgZGVmZXIgc3JjPSJhc3NldHMvZW1iZWQtb3B0aW9ucy5qcyI+PC9zY3JpcHQ+JzsKICAgICAgICAgICAgbGV0IGh0bWxTb3VyY2U7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaHRtbFNvdXJjZSA9IGF3YWl0IGZldGNoVGV4dEFzc2V0KCJjb3BpbG90LWRhc2hib2FyZC5odG1sIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gcmVhZCBjb3BpbG90LWRhc2hib2FyZC5odG1sLCBmYWxsaW5nIGJhY2sgdG8gbGl2ZSBET00iLCBlcnJvcik7CiAgICAgICAgICAgICAgaHRtbFNvdXJjZSA9ICI8IURPQ1RZUEUgaHRtbD5cbiIgKyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZEh0bWwgPSBodG1sU291cmNlDQogICAgICAgICAgICAgIC5yZXBsYWNlKC9ccyo8c2NyaXB0IGRlZmVyIHNyYz0iYXNzZXRzXC9zaGFyZXBvaW50LXN0YXRpYy1hc3NldHNcLmpzIj48XC9zY3JpcHQ+XHMqL2dpLCAiIikNCiAgICAgICAgICAgICAgLnJlcGxhY2UoL1xzKjxzY3JpcHQgZGVmZXIgc3JjPSJhc3NldHNcL3ZlbmRvclwvZmZsYXRlLWJhc2U2NFwuanMiPjxcL3NjcmlwdD5ccyovZ2ksICIiKTsKICAgICAgICAgICAgY29uc3QgYnVuZGxlSHRtbCA9IHNhbml0aXplZEh0bWwuaW5jbHVkZXMoaG9vaykKICAgICAgICAgICAgICA/IHNhbml0aXplZEh0bWwucmVwbGFjZShob29rLCBgJHtlbWJlZFNjcmlwdFRhZ31cbiAgJHtob29rfWApCiAgICAgICAgICAgICAgOiBzYW5pdGl6ZWRIdG1sLnJlcGxhY2UoIjwvaGVhZD4iLCBgICAke2VtYmVkU2NyaXB0VGFnfVxuPC9oZWFkPmApOwogICAgICAgICAgICBjb25zdCBbY3NzQnl0ZXMsIGpzQnl0ZXMsIHZlbmRvckJ5dGVzXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgICAgICByZXNvbHZlQXNzZXRCeXRlcyhudWxsLCAiYXNzZXRzL2NvcGlsb3QtZGFzaGJvYXJkLmNzcyIpLAogICAgICAgICAgICAgIHJlc29sdmVBc3NldEJ5dGVzKG51bGwsICJhc3NldHMvY29waWxvdC1kYXNoYm9hcmQuanMiKSwKICAgICAgICAgICAgICByZXNvbHZlQXNzZXRCeXRlcyhudWxsLCAiYXNzZXRzL3ZlbmRvci9mZmxhdGUubWluLmpzIikKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gWw0KICAgICAgICAgICAgICB7IG5hbWU6ICJpbmRleC5odG1sIiwgZGF0YTogZW5jb2Rlci5lbmNvZGUoYnVuZGxlSHRtbCkgfSwNCiAgICAgICAgICAgICAgeyBuYW1lOiAiYXNzZXRzL2NvcGlsb3QtZGFzaGJvYXJkLmNzcyIsIGRhdGE6IGNzc0J5dGVzIH0sDQogICAgICAgICAgICAgIHsgbmFtZTogImFzc2V0cy9jb3BpbG90LWRhc2hib2FyZC5qcyIsIGRhdGE6IGpzQnl0ZXMgfSwNCiAgICAgICAgICAgICAgeyBuYW1lOiAiYXNzZXRzL3ZlbmRvci9mZmxhdGUubWluLmpzIiwgZGF0YTogdmVuZG9yQnl0ZXMgfSwNCiAgICAgICAgICAgICAgeyBuYW1lOiAiYXNzZXRzL2VtYmVkLW9wdGlvbnMuanMiLCBkYXRhOiBlbmNvZGVyLmVuY29kZShgd2luZG93Ll9fQ09QSUxPVF9FTUJFRF9PUFRJT05TX18gPSAke0pTT04uc3RyaW5naWZ5KGVtYmVkT3B0aW9ucyl9O2ApIH0sDQogICAgICAgICAgICAgIHsgbmFtZTogIlJFQURNRS1zaGFyZXBvaW50Lm1kIiwgZGF0YTogZW5jb2Rlci5lbmNvZGUoYnVpbGRTaGFyZVBvaW50UmVhZG1lKHsgZmlsZW5hbWU6IGJ1bmRsZU5hbWUgfSkpIH0NCiAgICAgICAgICAgIF07DQogICAgICAgICAgICBjb25zdCBhcmNoaXZlID0gY3JlYXRlWmlwQXJjaGl2ZShmaWxlcyk7DQogICAgICAgICAgICBkb3dubG9hZEJpbmFyeUZpbGUoYXJjaGl2ZSwgYnVuZGxlTmFtZSwgImFwcGxpY2F0aW9uL3ppcCIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGJhc2U2NFRvVWludDhBcnJheShiYXNlNjQpIHsNCiAgICAgICAgICAgIGNvbnN0IHNhbml0aXplZCA9IFN0cmluZyhiYXNlNjQgfHwgIiIpLnJlcGxhY2UoL1tcclxuXHNdL2csICIiKS5yZXBsYWNlKC8tL2csICIrIikucmVwbGFjZSgvXy9nLCAiLyIpOw0KICAgICAgICAgICAgaWYgKCFzYW5pdGl6ZWQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcGFkTGVuZ3RoID0gc2FuaXRpemVkLmxlbmd0aCAlIDQ7DQogICAgICAgICAgICBjb25zdCBwYWRkZWQgPSBwYWRMZW5ndGggPyBzYW5pdGl6ZWQgKyAiPSIucmVwZWF0KDQgLSBwYWRMZW5ndGgpIDogc2FuaXRpemVkOw0KICAgICAgICAgICAgY29uc3QgYmluYXJ5ID0gd2luZG93LmF0b2IocGFkZGVkKTsNCiAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5Lmxlbmd0aCk7DQogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgYmluYXJ5Lmxlbmd0aDsgaW5kZXggKz0gMSkgew0KICAgICAgICAgICAgICBieXRlc1tpbmRleF0gPSBiaW5hcnkuY2hhckNvZGVBdChpbmRleCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYnl0ZXM7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gYnVpbGRTbmFwc2hvdEZpbGVuYW1lKCkgew0KICAgICAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsNCiAgICAgICAgICAgIGNvbnN0IHBhZCA9IHZhbHVlID0+IFN0cmluZyh2YWx1ZSkucGFkU3RhcnQoMiwgIjAiKTsNCiAgICAgICAgICAgIHJldHVybiBgJHtTTkFQU0hPVF9GSUxFX0JBU0VOQU1FfS0ke25vdy5nZXRVVENGdWxsWWVhcigpfSR7cGFkKG5vdy5nZXRVVENNb250aCgpICsgMSl9JHtwYWQobm93LmdldFVUQ0RhdGUoKSl9LSR7cGFkKG5vdy5nZXRVVENIb3VycygpKX0ke3BhZChub3cuZ2V0VVRDTWludXRlcygpKX0ke3BhZChub3cuZ2V0VVRDU2Vjb25kcygpKX0ke1NOQVBTSE9UX0ZJTEVfRVhURU5TSU9OfWA7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gcmV2b2tlU25hcHNob3REb3dubG9hZFVybCgpIHsNCiAgICAgICAgICAgIGlmIChzbmFwc2hvdERvd25sb2FkVXJsKSB7DQogICAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoc25hcHNob3REb3dubG9hZFVybCk7DQogICAgICAgICAgICAgIHNuYXBzaG90RG93bmxvYWRVcmwgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNuYXBzaG90Q29weSgpIHsNCiAgICAgICAgICAgIGlmICghbGF0ZXN0U25hcHNob3RFeHBvcnQpIHsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsICJHZW5lcmF0ZSBhIHNuYXBzaG90IGJlZm9yZSBjb3B5aW5nLiIsICJlcnJvciIpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBpZiAobmF2aWdhdG9yLmNsaXBib2FyZCAmJiB0eXBlb2YgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChsYXRlc3RTbmFwc2hvdEV4cG9ydCk7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9tLnNuYXBzaG90T3V0cHV0VGV4dCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdE91dHB1dFRleHQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICBkb20uc25hcHNob3RPdXRwdXRUZXh0LnNlbGVjdCgpOw0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7DQogICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90T3V0cHV0VGV4dC5zZXRTZWxlY3Rpb25SYW5nZSgwLCAwKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNsaXBib2FyZCBBUEkgaXMgdW5hdmFpbGFibGUuIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdENvcHkpIHsNCiAgICAgICAgICAgICAgICBkb20uc25hcHNob3RDb3B5LnRleHRDb250ZW50ID0gIkNvcGllZCEiOw0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdENvcHkuZGlzYWJsZWQgPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChzbmFwc2hvdENvcHlUaW1lb3V0KSB7DQogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHNuYXBzaG90Q29weVRpbWVvdXQpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHNuYXBzaG90Q29weVRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgY2xlYXJTbmFwc2hvdENvcHlGZWVkYmFjaygpOw0KICAgICAgICAgICAgICB9LCAxODAwKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGNvcHkgc25hcHNob3QiLCBlcnJvcik7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiVW5hYmxlIHRvIGNvcHkgYXV0b21hdGljYWxseS4gU2VsZWN0IGFuZCBjb3B5IHRoZSBzbmFwc2hvdCB0ZXh0IG1hbnVhbGx5LiIsICJlcnJvciIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVNuYXBzaG90RG93bmxvYWQoKSB7DQogICAgICAgICAgICBpZiAoIWxhdGVzdFNuYXBzaG90RXhwb3J0KSB7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiR2VuZXJhdGUgYSBzbmFwc2hvdCBiZWZvcmUgZG93bmxvYWRpbmcuIiwgImVycm9yIik7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldm9rZVNuYXBzaG90RG93bmxvYWRVcmwoKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbbGF0ZXN0U25hcHNob3RFeHBvcnRdLCB7IHR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiB9KTsNCiAgICAgICAgICAgICAgc25hcHNob3REb3dubG9hZFVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7DQogICAgICAgICAgICAgIGxpbmsuaHJlZiA9IHNuYXBzaG90RG93bmxvYWRVcmw7DQogICAgICAgICAgICAgIGxpbmsuZG93bmxvYWQgPSBidWlsZFNuYXBzaG90RmlsZW5hbWUoKTsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsNCiAgICAgICAgICAgICAgbGluay5jbGljaygpOw0KICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspOw0KICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgICAgcmV2b2tlU25hcHNob3REb3dubG9hZFVybCgpOw0KICAgICAgICAgICAgICB9LCAxNTAwKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGRvd25sb2FkIHNuYXBzaG90IiwgZXJyb3IpOw0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RFcnJvciwgIlVuYWJsZSB0byBkb3dubG9hZCBzbmFwc2hvdC4gQ29weSB0aGUgdGV4dCBpbnN0ZWFkLiIsICJlcnJvciIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNuYXBzaG90QnVuZGxlRG93bmxvYWQoKSB7DQogICAgICAgICAgICBpZiAoIWxhdGVzdFNuYXBzaG90RXhwb3J0KSB7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiR2VuZXJhdGUgYSBzbmFwc2hvdCBiZWZvcmUgY3JlYXRpbmcgYSBTaGFyZVBvaW50IGJ1bmRsZS4iLCAiZXJyb3IiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsICJQcmVwYXJpbmcgU2hhcmVQb2ludCBidW5kbGXigKYiLCAiaW5mbyIpOw0KICAgICAgICAgICAgICBhd2FpdCBleHBvcnRTbmFwc2hvdEJ1bmRsZShsYXRlc3RTbmFwc2hvdEV4cG9ydCk7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEVycm9yLCAiQnVuZGxlIHJlYWR5LiBVcGxvYWQgdGhlIFpJUCB0byB5b3VyIGludGVybmFsIHNpdGUuIiwgInN1Y2Nlc3MiKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlVuYWJsZSB0byBidWlsZCBTaGFyZVBvaW50IGJ1bmRsZSIsIGVycm9yKTsNCiAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGVycm9yICYmIGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlIDogIlVuYWJsZSB0byBjcmVhdGUgU2hhcmVQb2ludCBidW5kbGUuIjsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90RXJyb3IsIG1lc3NhZ2UsICJlcnJvciIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIG9wZW5TbmFwc2hvdEltcG9ydERpYWxvZygpIHsNCiAgICAgICAgICAgIGlmICghZG9tLnNuYXBzaG90SW1wb3J0RGlhbG9nIHx8IHR5cGVvZiBkb20uc25hcHNob3RJbXBvcnREaWFsb2cuc2hvd01vZGFsICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiU25hcHNob3QgaW1wb3J0IGRpYWxvZyBpcyB1bmF2YWlsYWJsZSBpbiB0aGlzIGJyb3dzZXIuIik7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJlc2V0U25hcHNob3RJbXBvcnREaWFsb2coKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydERpYWxvZy5zaG93TW9kYWwoKTsNCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdEltcG9ydFBhc3N3b3JkKSB7DQogICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0UGFzc3dvcmQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gb3BlbiBzbmFwc2hvdCBpbXBvcnQgZGlhbG9nIiwgZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlU25hcHNob3RJbXBvcnREaWFsb2coKSB7DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0RGlhbG9nICYmIGRvbS5zbmFwc2hvdEltcG9ydERpYWxvZy5vcGVuKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydERpYWxvZy5jbG9zZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0U25hcHNob3RJbXBvcnREaWFsb2coKSB7DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0VGV4dCkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnRUZXh0LnZhbHVlID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0UGFzc3dvcmQpIHsNCiAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0UGFzc3dvcmQudmFsdWUgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRGaWxlKSB7DQogICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydEZpbGUudmFsdWUgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yLCAiIik7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU25hcHNob3RJbXBvcnRTdWJtaXQoZXZlbnQpIHsNCiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBpZiAoIXN1cHBvcnRzU25hcHNob3RFbmNyeXB0aW9uIHx8ICFzdXBwb3J0c0RpYWxvZ0VsZW1lbnQpIHsNCiAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90SW1wb3J0RXJyb3IsICJTZWN1cmUgc25hcHNob3RzIGFyZSBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlci4iLCAiZXJyb3IiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRvbS5zbmFwc2hvdEltcG9ydFRleHQgPyBkb20uc25hcHNob3RJbXBvcnRUZXh0LnZhbHVlLnRyaW0oKSA6ICIiOw0KICAgICAgICAgICAgY29uc3QgcGFzc3dvcmRJbnB1dCA9IGRvbS5zbmFwc2hvdEltcG9ydFBhc3N3b3JkID8gZG9tLnNuYXBzaG90SW1wb3J0UGFzc3dvcmQudmFsdWUgOiAiIjsNCiAgICAgICAgICAgIGlmICghdGV4dCkgew0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RJbXBvcnRFcnJvciwgIlBhc3RlIHRoZSBzbmFwc2hvdCB0ZXh0IG9yIGNob29zZSBhIHNuYXBzaG90IGZpbGUuIiwgImVycm9yIik7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghcGFzc3dvcmRJbnB1dCkgew0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RJbXBvcnRFcnJvciwgIkVudGVyIHRoZSBzaGFyZWQgcGFzc3dvcmQuIiwgImVycm9yIik7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yLCAiIik7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0U3VibWl0KSB7DQogICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0U3VibWl0LmRpc2FibGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnRTdWJtaXQuZGF0YXNldC5vcmlnaW5hbExhYmVsID0gZG9tLnNuYXBzaG90SW1wb3J0U3VibWl0LnRleHRDb250ZW50IHx8ICIiOw0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydFN1Ym1pdC50ZXh0Q29udGVudCA9ICJEZWNyeXB0aW5n4oCmIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RJbXBvcnRFcnJvciwgIkRlY3J5cHRpbmcgc25hcHNob3TigKYiLCAiaW5mbyIpOw0KICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gYXdhaXQgZGVjcnlwdFNuYXBzaG90RW52ZWxvcGUodGV4dCwgcGFzc3dvcmRJbnB1dCk7DQogICAgICAgICAgICAgIHBlbmRpbmdTbmFwc2hvdFBheWxvYWQgPSBwYXlsb2FkOw0KICAgICAgICAgICAgICBjbG9zZVNuYXBzaG90SW1wb3J0RGlhbG9nKCk7DQogICAgICAgICAgICAgIGlmIChkb20udXBsb2FkU3RhdHVzKSB7DQogICAgICAgICAgICAgICAgZG9tLnVwbG9hZFN0YXR1cy50ZXh0Q29udGVudCA9ICJEZWNyeXB0aW5nIHNuYXBzaG90IGFuZCBsb2FkaW5nIGRhdGFzZXQuLi4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHBhcnNlQ3N2VGV4dENvbnRlbnQocGF5bG9hZC5kYXRhc2V0LmNzdlRleHQsIHsNCiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBwYXlsb2FkLmRhdGFzZXQubWV0YT8ubmFtZSB8fCAiU25hcHNob3QgZGF0YXNldCIsDQogICAgICAgICAgICAgICAgc291cmNlU2l6ZTogcGF5bG9hZC5kYXRhc2V0Lm1ldGE/LnNpemUsDQogICAgICAgICAgICAgICAgc2F2ZWRNZXRhOiBwYXlsb2FkLmRhdGFzZXQubWV0YSA/IHsgLi4ucGF5bG9hZC5kYXRhc2V0Lm1ldGEgfSA6IHVuZGVmaW5lZA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6ICJVbmFibGUgdG8gbG9hZCBzbmFwc2hvdC4gQ2hlY2sgdGhlIHBhc3N3b3JkIGFuZCBzbmFwc2hvdCB0ZXh0LiI7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yLCBtZXNzYWdlLCAiZXJyb3IiKTsNCiAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRQYXNzd29yZCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydFBhc3N3b3JkLnZhbHVlID0gIiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdEltcG9ydFN1Ym1pdCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydFN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZG9tLnNuYXBzaG90SW1wb3J0U3VibWl0LmRhdGFzZXQub3JpZ2luYWxMYWJlbCB8fCAiTG9hZCBzbmFwc2hvdCI7DQogICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0U3VibWl0LnRleHRDb250ZW50ID0gbGFiZWw7DQogICAgICAgICAgICAgICAgZGVsZXRlIGRvbS5zbmFwc2hvdEltcG9ydFN1Ym1pdC5kYXRhc2V0Lm9yaWdpbmFsTGFiZWw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVTbmFwc2hvdEltcG9ydEZpbGVTZWxlY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBldmVudD8udGFyZ2V0Py5maWxlcyAmJiBldmVudC50YXJnZXQuZmlsZXNbMF07DQogICAgICAgICAgICBpZiAoIWZpbGUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBsb2FkRXZlbnQgPT4gew0KICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBsb2FkRXZlbnQ/LnRhcmdldD8ucmVzdWx0Ow0KICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0VGV4dCkgew0KICAgICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0VGV4dC52YWx1ZSA9IHJlc3VsdDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGRlY29kZXIuZGVjb2RlKHJlc3VsdCk7DQogICAgICAgICAgICAgICAgICBpZiAoZG9tLnNuYXBzaG90SW1wb3J0VGV4dCkgew0KICAgICAgICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnRUZXh0LnZhbHVlID0gdGV4dDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gZGVjb2RlIHNuYXBzaG90IGZpbGUiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICBzZXRTbmFwc2hvdE5vdGljZShkb20uc25hcHNob3RJbXBvcnRFcnJvciwgIlVuYWJsZSB0byBkZWNvZGUgdGhlIHNlbGVjdGVkIGZpbGUuIiwgImVycm9yIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yLCAiIik7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVhZGVyLm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgIHNldFNuYXBzaG90Tm90aWNlKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yLCAiVW5hYmxlIHRvIHJlYWQgdGhlIHNlbGVjdGVkIGZpbGUuIiwgImVycm9yIik7DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGVjcnlwdFNuYXBzaG90RW52ZWxvcGUocmF3SW5wdXQsIHBhc3N3b3JkKSB7DQogICAgICAgICAgICBpZiAoIXN1cHBvcnRzU25hcHNob3RFbmNyeXB0aW9uKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU2VjdXJlIHNuYXBzaG90cyBhcmUgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGVudmlyb25tZW50LiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGV0IGVudmVsb3BlOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgZW52ZWxvcGUgPSBub3JtYWxpemVTbmFwc2hvdEVudmVsb3BlKHJhd0lucHV0KTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU25hcHNob3QgdGV4dCBpcyBub3QgdmFsaWQgSlNPTiBvciByZWNvZ25pemVkIGZvcm1hdC4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghZW52ZWxvcGUgfHwgdHlwZW9mIGVudmVsb3BlICE9PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNuYXBzaG90IHN0cnVjdHVyZSBpcyBpbnZhbGlkLiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFlbnZlbG9wZS5jaXBoZXJ0ZXh0IHx8ICFlbnZlbG9wZS5pdiB8fCAhZW52ZWxvcGUua2RmIHx8ICFlbnZlbG9wZS5rZGYuc2FsdCkgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNuYXBzaG90IGlzIG1pc3NpbmcgZW5jcnlwdGlvbiBtZXRhZGF0YS4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdGlvbnMgPSBOdW1iZXIoZW52ZWxvcGUua2RmLml0ZXJhdGlvbnMpIHx8IFNOQVBTSE9UX0tERl9JVEVSQVRJT05TOw0KICAgICAgICAgICAgY29uc3Qgc2FsdEJ5dGVzID0gYmFzZTY0VG9VaW50OEFycmF5KFN0cmluZyhlbnZlbG9wZS5rZGYuc2FsdCkpOw0KICAgICAgICAgICAgY29uc3QgaXZCeXRlcyA9IGJhc2U2NFRvVWludDhBcnJheShTdHJpbmcoZW52ZWxvcGUuaXYpKTsNCiAgICAgICAgICAgIGNvbnN0IGNpcGhlckJ5dGVzID0gYmFzZTY0VG9VaW50OEFycmF5KFN0cmluZyhlbnZlbG9wZS5jaXBoZXJ0ZXh0KSk7DQogICAgICAgICAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7DQogICAgICAgICAgICBjb25zdCBwYXNzd29yZEJ5dGVzID0gZW5jb2Rlci5lbmNvZGUocGFzc3dvcmQpOw0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgY29uc3Qga2V5TWF0ZXJpYWwgPSBhd2FpdCB3aW5kb3cuY3J5cHRvLnN1YnRsZS5pbXBvcnRLZXkoDQogICAgICAgICAgICAgICAgInJhdyIsDQogICAgICAgICAgICAgICAgcGFzc3dvcmRCeXRlcywNCiAgICAgICAgICAgICAgICB7IG5hbWU6ICJQQktERjIiIH0sDQogICAgICAgICAgICAgICAgZmFsc2UsDQogICAgICAgICAgICAgICAgWyJkZXJpdmVLZXkiXQ0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBjb25zdCBrZXkgPSBhd2FpdCB3aW5kb3cuY3J5cHRvLnN1YnRsZS5kZXJpdmVLZXkoDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgbmFtZTogIlBCS0RGMiIsDQogICAgICAgICAgICAgICAgICBzYWx0OiBzYWx0Qnl0ZXMsDQogICAgICAgICAgICAgICAgICBpdGVyYXRpb25zLA0KICAgICAgICAgICAgICAgICAgaGFzaDogIlNIQS0yNTYiDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBrZXlNYXRlcmlhbCwNCiAgICAgICAgICAgICAgICB7IG5hbWU6ICJBRVMtR0NNIiwgbGVuZ3RoOiAyNTYgfSwNCiAgICAgICAgICAgICAgICBmYWxzZSwNCiAgICAgICAgICAgICAgICBbImRlY3J5cHQiXQ0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBjb25zdCBkZWNyeXB0ZWRCdWZmZXIgPSBhd2FpdCB3aW5kb3cuY3J5cHRvLnN1YnRsZS5kZWNyeXB0KA0KICAgICAgICAgICAgICAgIHsgbmFtZTogIkFFUy1HQ00iLCBpdjogaXZCeXRlcyB9LA0KICAgICAgICAgICAgICAgIGtleSwNCiAgICAgICAgICAgICAgICBjaXBoZXJCeXRlcw0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7DQogICAgICAgICAgICAgIGNvbnN0IHBheWxvYWRKc29uID0gZGVjb2Rlci5kZWNvZGUoZGVjcnlwdGVkQnVmZmVyKTsNCiAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UocGF5bG9hZEpzb24pOw0KICAgICAgICAgICAgICBpZiAoIXBheWxvYWQgfHwgdHlwZW9mIHBheWxvYWQgIT09ICJvYmplY3QiKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJTbmFwc2hvdCBwYXlsb2FkIGlzIGVtcHR5LiIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHBheWxvYWQuZGF0YXNldCA9IGF3YWl0IGRlY29kZVNuYXBzaG90U2VjdGlvbihwYXlsb2FkLmRhdGFzZXQsIHsgbGFiZWw6ICJkYXRhc2V0IiB9KTsNCiAgICAgICAgICAgICAgaWYgKCFwYXlsb2FkLmRhdGFzZXQgfHwgdHlwZW9mIHBheWxvYWQuZGF0YXNldC5jc3ZUZXh0ICE9PSAic3RyaW5nIiB8fCAhcGF5bG9hZC5kYXRhc2V0LmNzdlRleHQudHJpbSgpKSB7DQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJTbmFwc2hvdCBwYXlsb2FkIGRvZXMgbm90IGNvbnRhaW4gYSBkYXRhc2V0LiIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChwYXlsb2FkLmFnZW50RGF0YXNldCkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBwYXlsb2FkLmFnZW50RGF0YXNldCA9IGF3YWl0IGRlY29kZVNuYXBzaG90U2VjdGlvbihwYXlsb2FkLmFnZW50RGF0YXNldCwgeyBsYWJlbDogImFnZW50IGRhdGFzZXQiIH0pOw0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGFnZW50RXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGRlY29kZSBhZ2VudCBkYXRhc2V0IHNuYXBzaG90IiwgYWdlbnRFcnJvcik7DQogICAgICAgICAgICAgICAgICBwYXlsb2FkLmFnZW50RGF0YXNldCA9IG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJldHVybiBwYXlsb2FkOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgaWYgKGVycm9yICYmIChlcnJvci5uYW1lID09PSAiT3BlcmF0aW9uRXJyb3IiIHx8IGVycm9yLm5hbWUgPT09ICJET01FeGNlcHRpb24iKSkgew0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU25hcHNob3QgY291bGQgbm90IGJlIGRlY3J5cHRlZC4gVGhlIHBhc3N3b3JkIG1pZ2h0IGJlIGluY29ycmVjdC4iKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IgJiYgZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UgOiAiVW5hYmxlIHRvIGRlY3J5cHQgc25hcHNob3QuIik7DQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICBwYXNzd29yZEJ5dGVzLmZpbGwoMCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplU25hcHNob3RFbnZlbG9wZShyYXcpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgcmF3ICE9PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlNuYXBzaG90IHRleHQgbXVzdCBiZSBhIHN0cmluZy4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSByYXcudHJpbSgpOw0KICAgICAgICAgICAgaWYgKCF0cmltbWVkKSB7DQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiU25hcHNob3QgdGV4dCBpcyBlbXB0eS4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSB0cmltbWVkLnJlcGxhY2UoL1tcclxuXHNdKy9nLCAiIik7DQogICAgICAgICAgICBjb25zdCBjb21wYWN0UGF0dGVybiA9IG5ldyBSZWdFeHAoYF4ke1NOQVBTSE9UX1BSRUZJWH1cXC52KFxcZCspXFwuayhcXGQrKVxcLihbXlxcLl0rKVxcLihbXlxcLl0rKVxcLihbXlxcLl0rKSRgKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbXBhY3RNYXRjaCA9IG5vcm1hbGl6ZWQubWF0Y2goY29tcGFjdFBhdHRlcm4pOw0KICAgICAgICAgICAgaWYgKGNvbXBhY3RNYXRjaCkgew0KICAgICAgICAgICAgICBjb25zdCBbLCB2ZXJzaW9uU2VnbWVudCwgaXRlcmF0aW9uc1NlZ21lbnQsIHNhbHRTZWdtZW50LCBpdlNlZ21lbnQsIGNpcGhlclNlZ21lbnRdID0gY29tcGFjdE1hdGNoOw0KICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIHZlcnNpb246IE51bWJlcih2ZXJzaW9uU2VnbWVudCkgfHwgU05BUFNIT1RfVkVSU0lPTiwNCiAgICAgICAgICAgICAgICBhbGdvcml0aG06ICJBRVMtR0NNIiwNCiAgICAgICAgICAgICAgICBrZGY6IHsNCiAgICAgICAgICAgICAgICAgIG5hbWU6ICJQQktERjIiLA0KICAgICAgICAgICAgICAgICAgaGFzaDogIlNIQS0yNTYiLA0KICAgICAgICAgICAgICAgICAgaXRlcmF0aW9uczogTnVtYmVyKGl0ZXJhdGlvbnNTZWdtZW50KSB8fCBTTkFQU0hPVF9LREZfSVRFUkFUSU9OUywNCiAgICAgICAgICAgICAgICAgIHNhbHQ6IHNhbml0aXplU25hcHNob3RTZWdtZW50KHNhbHRTZWdtZW50KQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgaXY6IHNhbml0aXplU25hcHNob3RTZWdtZW50KGl2U2VnbWVudCksDQogICAgICAgICAgICAgICAgY2lwaGVydGV4dDogc2FuaXRpemVTbmFwc2hvdFNlZ21lbnQoY2lwaGVyU2VnbWVudCkNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGxlZ2FjeVBhdHRlcm4gPSBuZXcgUmVnRXhwKGBeJHtTTkFQU0hPVF9QUkVGSVh9XFwudihcXGQrKVxcLiguKykkYCk7DQogICAgICAgICAgICBjb25zdCBsZWdhY3lNYXRjaCA9IG5vcm1hbGl6ZWQubWF0Y2gobGVnYWN5UGF0dGVybik7DQogICAgICAgICAgICBpZiAobGVnYWN5TWF0Y2gpIHsNCiAgICAgICAgICAgICAgY29uc3QgYmFzZTY0UGF5bG9hZCA9IHNhbml0aXplU25hcHNob3RTZWdtZW50KGxlZ2FjeU1hdGNoWzJdKTsNCiAgICAgICAgICAgICAgY29uc3QgYnl0ZXMgPSBiYXNlNjRUb1VpbnQ4QXJyYXkoYmFzZTY0UGF5bG9hZCk7DQogICAgICAgICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsNCiAgICAgICAgICAgICAgY29uc3QganNvbiA9IGRlY29kZXIuZGVjb2RlKGJ5dGVzKTsNCiAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSh0cmltbWVkKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBhcHBseVNuYXBzaG90U3RhdGUoc25hcHNob3QpIHsNCiAgICAgICAgICAgIGlmICghc25hcHNob3QgfHwgdHlwZW9mIHNuYXBzaG90ICE9PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmaWx0ZXJQcmVmZXJlbmNlc0FwcGxpZWQgPSB0cnVlOw0KICAgICAgICAgICAgbGV0IGZpbHRlcnNBcHBsaWVkID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoc25hcHNob3QuZmlsdGVycyAmJiB0eXBlb2Ygc25hcHNob3QuZmlsdGVycyA9PT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSB7DQogICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uOiBBcnJheS5pc0FycmF5KHNuYXBzaG90LmZpbHRlcnMub3JnYW5pemF0aW9uKSA/IHNuYXBzaG90LmZpbHRlcnMub3JnYW5pemF0aW9uIDogW10sDQogICAgICAgICAgICAgICAgY291bnRyeTogQXJyYXkuaXNBcnJheShzbmFwc2hvdC5maWx0ZXJzLmNvdW50cnkpID8gc25hcHNob3QuZmlsdGVycy5jb3VudHJ5IDogW10sDQogICAgICAgICAgICAgICAgdGltZWZyYW1lOiBzbmFwc2hvdC5maWx0ZXJzLnRpbWVmcmFtZSwNCiAgICAgICAgICAgICAgICBjdXN0b21TdGFydDogc25hcHNob3QuZmlsdGVycy5jdXN0b21TdGFydCB8fCBudWxsLA0KICAgICAgICAgICAgICAgIGN1c3RvbUVuZDogc25hcHNob3QuZmlsdGVycy5jdXN0b21FbmQgfHwgbnVsbCwNCiAgICAgICAgICAgICAgICBhZ2dyZWdhdGU6IHNuYXBzaG90LmZpbHRlcnMuYWdncmVnYXRlLA0KICAgICAgICAgICAgICAgIG1ldHJpYzogc25hcHNob3QuZmlsdGVycy5tZXRyaWMsDQogICAgICAgICAgICAgICAgZ3JvdXA6IHNuYXBzaG90LmZpbHRlcnMuZ3JvdXANCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgZmlsdGVyc0FwcGxpZWQgPSBhcHBseVN0b3JlZEZpbHRlclByZWZlcmVuY2VzKHByZWZlcmVuY2VzKTsNCiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc25hcHNob3QuZmlsdGVycy5jYXRlZ29yeVNlbGVjdGlvbikpIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uID0gbmV3IFNldChzbmFwc2hvdC5maWx0ZXJzLmNhdGVnb3J5U2VsZWN0aW9uKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCEoc3RhdGUuZmlsdGVycy5jYXRlZ29yeVNlbGVjdGlvbiBpbnN0YW5jZW9mIFNldCkpIHsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jYXRlZ29yeVNlbGVjdGlvbiA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHNuYXBzaG90LnRoZW1lKSB7DQogICAgICAgICAgICAgIGFwcGx5VGhlbWUoc25hcHNob3QudGhlbWUsIHsgcGVyc2lzdDogZmFsc2UgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc25hcHNob3QudHJlbmRWaWV3ID09PSAiYXZlcmFnZSIgfHwgc25hcHNob3QudHJlbmRWaWV3ID09PSAidG90YWwiKSB7DQogICAgICAgICAgICAgIHN0YXRlLnRyZW5kVmlldyA9IHNuYXBzaG90LnRyZW5kVmlldzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5zZXJpZXNWaXNpYmlsaXR5ICYmIHR5cGVvZiBzbmFwc2hvdC5zZXJpZXNWaXNpYmlsaXR5ID09PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICBzdGF0ZS5zZXJpZXNWaXNpYmlsaXR5ID0geyAuLi5zbmFwc2hvdC5zZXJpZXNWaXNpYmlsaXR5IH07DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBzdGF0ZS5zZXJpZXNWaXNpYmlsaXR5ID0ge307DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc25hcHNob3Quc2VyaWVzRGV0YWlsTW9kZSAmJiAoc25hcHNob3Quc2VyaWVzRGV0YWlsTW9kZSA9PT0gInJlc3BlY3QiIHx8IHNuYXBzaG90LnNlcmllc0RldGFpbE1vZGUgPT09ICJhbGwiIHx8IHNuYXBzaG90LnNlcmllc0RldGFpbE1vZGUgPT09ICJub25lIikpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2VyaWVzRGV0YWlsTW9kZSA9IHNuYXBzaG90LnNlcmllc0RldGFpbE1vZGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc25hcHNob3QucmV0dXJuaW5nTWV0cmljID09PSAicGVyY2VudGFnZSIgfHwgc25hcHNob3QucmV0dXJuaW5nTWV0cmljID09PSAidG90YWwiKSB7DQogICAgICAgICAgICAgIHN0YXRlLnJldHVybmluZ01ldHJpYyA9IHNuYXBzaG90LnJldHVybmluZ01ldHJpYzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5yZXR1cm5pbmdJbnRlcnZhbCA9PT0gIm1vbnRobHkiIHx8IHNuYXBzaG90LnJldHVybmluZ0ludGVydmFsID09PSAid2Vla2x5Iikgew0KICAgICAgICAgICAgICBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCA9IHNuYXBzaG90LnJldHVybmluZ0ludGVydmFsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHNuYXBzaG90LmFjdGl2ZURheXNWaWV3ID09PSAicHJvbXB0cyIgfHwgc25hcHNob3QuYWN0aXZlRGF5c1ZpZXcgPT09ICJ1c2VycyIpIHsNCiAgICAgICAgICAgICAgc3RhdGUuYWN0aXZlRGF5c1ZpZXcgPSBzbmFwc2hvdC5hY3RpdmVEYXlzVmlldzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzbmFwc2hvdC51c2FnZVRyZW5kTW9kZSA9PT0gInBlcmNlbnRhZ2UiIHx8IHNuYXBzaG90LnVzYWdlVHJlbmRNb2RlID09PSAibnVtYmVyIikgew0KICAgICAgICAgICAgICBzdGF0ZS51c2FnZVRyZW5kTW9kZSA9IHNuYXBzaG90LnVzYWdlVHJlbmRNb2RlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBzbmFwc2hvdC51c2FnZVRyZW5kUmVnaW9uID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICBzdGF0ZS51c2FnZVRyZW5kUmVnaW9uID0gc25hcHNob3QudXNhZ2VUcmVuZFJlZ2lvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2Ygc25hcHNob3QucmV0dXJuaW5nUmVnaW9uID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICBzdGF0ZS5yZXR1cm5pbmdSZWdpb24gPSBzbmFwc2hvdC5yZXR1cm5pbmdSZWdpb247DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzbmFwc2hvdC51c2FnZU1vbnRoU2VsZWN0aW9uKSkgew0KICAgICAgICAgICAgICBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uID0gc25hcHNob3QudXNhZ2VNb250aFNlbGVjdGlvbi5tYXAoU3RyaW5nKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzbmFwc2hvdC51c2FnZVRocmVzaG9sZHMgJiYgdHlwZW9mIHNuYXBzaG90LnVzYWdlVGhyZXNob2xkcyA9PT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgY29uc3QgbWlkZGxlID0gTnVtYmVyKHNuYXBzaG90LnVzYWdlVGhyZXNob2xkcy5taWRkbGUpOw0KICAgICAgICAgICAgICBjb25zdCBoaWdoID0gTnVtYmVyKHNuYXBzaG90LnVzYWdlVGhyZXNob2xkcy5oaWdoKTsNCiAgICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShtaWRkbGUpKSB7DQogICAgICAgICAgICAgICAgc3RhdGUudXNhZ2VUaHJlc2hvbGRzLm1pZGRsZSA9IG1pZGRsZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGhpZ2gpKSB7DQogICAgICAgICAgICAgICAgc3RhdGUudXNhZ2VUaHJlc2hvbGRzLmhpZ2ggPSBoaWdoOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc25hcHNob3QuZXhwb3J0UHJlZmVyZW5jZXMgJiYgdHlwZW9mIHNuYXBzaG90LmV4cG9ydFByZWZlcmVuY2VzID09PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICBzdGF0ZS5leHBvcnRQcmVmZXJlbmNlcyA9IHsNCiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5leHBvcnRQcmVmZXJlbmNlcywNCiAgICAgICAgICAgICAgICBpbmNsdWRlRGV0YWlsczogc25hcHNob3QuZXhwb3J0UHJlZmVyZW5jZXMuaW5jbHVkZURldGFpbHMgIT09IGZhbHNlDQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc25hcHNob3QudHJlbmRDb2xvclByZWZlcmVuY2UgJiYgdHlwZW9mIHNuYXBzaG90LnRyZW5kQ29sb3JQcmVmZXJlbmNlID09PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICBzdGF0ZS50cmVuZENvbG9yUHJlZmVyZW5jZSA9IHsNCiAgICAgICAgICAgICAgICBzdGFydDogc25hcHNob3QudHJlbmRDb2xvclByZWZlcmVuY2Uuc3RhcnQgfHwgbnVsbCwNCiAgICAgICAgICAgICAgICBlbmQ6IHNuYXBzaG90LnRyZW5kQ29sb3JQcmVmZXJlbmNlLmVuZCB8fCBudWxsDQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIHJlZnJlc2hUcmVuZENvbG9ycygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHNuYXBzaG90LmRpbWVuc2lvblNlbGVjdGlvbiAmJiB0eXBlb2Ygc25hcHNob3QuZGltZW5zaW9uU2VsZWN0aW9uID09PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICBjb25zdCBkaW1lbnNpb24gPSBzbmFwc2hvdC5kaW1lbnNpb25TZWxlY3Rpb24uZGltZW5zaW9uOw0KICAgICAgICAgICAgICBjb25zdCBtZXRyaWMgPSBzbmFwc2hvdC5kaW1lbnNpb25TZWxlY3Rpb24ubWV0cmljOw0KICAgICAgICAgICAgICBpZiAoZGltZW5zaW9uID09PSAib3JnYW5pemF0aW9uIiB8fCBkaW1lbnNpb24gPT09ICJjb3VudHJ5Iikgew0KICAgICAgICAgICAgICAgIHN0YXRlLmRpbWVuc2lvblNlbGVjdGlvbi5kaW1lbnNpb24gPSBkaW1lbnNpb247DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXRyaWMgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgc3RhdGUuZGltZW5zaW9uU2VsZWN0aW9uLm1ldHJpYyA9IG1ldHJpYzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoc25hcHNob3QuZGltZW5zaW9uU2VsZWN0aW9uLnNlbGVjdGVkICYmIHR5cGVvZiBzbmFwc2hvdC5kaW1lbnNpb25TZWxlY3Rpb24uc2VsZWN0ZWQgPT09ICJvYmplY3QiKSB7DQogICAgICAgICAgICAgICAgc3RhdGUuZGltZW5zaW9uU2VsZWN0aW9uLnNlbGVjdGVkID0gew0KICAgICAgICAgICAgICAgICAgY291bnRyeTogbmV3IFNldChBcnJheS5pc0FycmF5KHNuYXBzaG90LmRpbWVuc2lvblNlbGVjdGlvbi5zZWxlY3RlZC5jb3VudHJ5KSA/IHNuYXBzaG90LmRpbWVuc2lvblNlbGVjdGlvbi5zZWxlY3RlZC5jb3VudHJ5IDogW10pLA0KICAgICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uOiBuZXcgU2V0KEFycmF5LmlzQXJyYXkoc25hcHNob3QuZGltZW5zaW9uU2VsZWN0aW9uLnNlbGVjdGVkLm9yZ2FuaXphdGlvbikgPyBzbmFwc2hvdC5kaW1lbnNpb25TZWxlY3Rpb24uc2VsZWN0ZWQub3JnYW5pemF0aW9uIDogW10pDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBzbmFwc2hvdC5hZG9wdGlvblNob3dEZXRhaWxzID09PSAiYm9vbGVhbiIpIHsNCiAgICAgICAgICAgICAgc3RhdGUuYWRvcHRpb25TaG93RGV0YWlscyA9IHNuYXBzaG90LmFkb3B0aW9uU2hvd0RldGFpbHM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIHNuYXBzaG90Lmdyb3Vwc0V4cGFuZGVkID09PSAiYm9vbGVhbiIpIHsNCiAgICAgICAgICAgICAgc3RhdGUuZ3JvdXBzRXhwYW5kZWQgPSBzbmFwc2hvdC5ncm91cHNFeHBhbmRlZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2Ygc25hcHNob3QudG9wVXNlcnNFeHBhbmRlZCA9PT0gImJvb2xlYW4iKSB7DQogICAgICAgICAgICAgIHN0YXRlLnRvcFVzZXJzRXhwYW5kZWQgPSBzbmFwc2hvdC50b3BVc2Vyc0V4cGFuZGVkOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShzbmFwc2hvdC5hZ2VudERpc3BsYXlMaW1pdCkpIHsNCiAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSBzbmFwc2hvdC5hZ2VudERpc3BsYXlMaW1pdDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVuc3VyZUN1c3RvbVJhbmdlRGVmYXVsdHMoKTsNCiAgICAgICAgICAgIHN5bmNDdXN0b21SYW5nZUlucHV0cygpOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KDQogICAgICAgICAgICBpZiAoc25hcHNob3QuYWdlbnREYXRhc2V0ICYmIHNuYXBzaG90LmFnZW50RGF0YXNldC5jc3ZUZXh0KSB7DQogICAgICAgICAgICAgIHBhcnNlQWdlbnRVc2FnZVRleHQoc25hcHNob3QuYWdlbnREYXRhc2V0LmNzdlRleHQsIHNuYXBzaG90LmFnZW50RGF0YXNldC5tZXRhIHx8IHt9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHN0YXRlLmFnZW50VXNhZ2VSb3dzID0gW107DQogICAgICAgICAgICAgIHN0YXRlLmFnZW50VXNhZ2VNZXRhID0gbnVsbDsNCiAgICAgICAgICAgICAgY2xlYXJSZW1lbWJlcmVkQWdlbnREYXRhc2V0KCk7DQogICAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKFtdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJzQXBwbGllZDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBsb2FkUGVyc2lzdGVuY2VQcmVmZXJlbmNlKCkgewogICAgICAgICAgICBsZXQgY29uc2VudCA9IGZhbHNlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShEQVRBX0NPTlNFTlRfS0VZKTsKICAgICAgICAgICAgICAgIGlmIChzdG9yZWQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY29uc2VudCA9IHN0b3JlZCA9PT0gInRydWUiOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgY29uc3QgbGVnYWN5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oREFUQV9QRVJTSVNURU5DRV9LRVkpOwogICAgICAgICAgICAgICAgICBjb25zZW50ID0gbGVnYWN5ID09PSAidHJ1ZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgY2FjaGluZyBwcmVmZXJlbmNlIiwgZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLnBlcnNpc3REYXRhc2V0cyA9IGNvbnNlbnQ7CiAgICAgICAgICAgIGlmIChkb20ucGVyc2lzdENvbnNlbnQpIHsKICAgICAgICAgICAgICBkb20ucGVyc2lzdENvbnNlbnQuY2hlY2tlZCA9IGNvbnNlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gcGVyc2lzdFBlcnNpc3RlbmNlUHJlZmVyZW5jZShlbmFibGVkKSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKERBVEFfQ09OU0VOVF9LRVksIFN0cmluZyhCb29sZWFuKGVuYWJsZWQpKSk7DQogICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oREFUQV9QRVJTSVNURU5DRV9LRVkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IGNhY2hpbmcgcHJlZmVyZW5jZSIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzdG9yZURhdGFzZXRNZXRhKG1ldGEpIHsNCiAgICAgICAgICAgIGlmICghd2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShEQVRBX1NUT1JBR0VfTUVUQV9LRVksIEpTT04uc3RyaW5naWZ5KG1ldGEpKTsNCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIHN0b3JlIGRhdGFzZXQgbWV0YWRhdGEnLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gc3RvcmVBZ2VudERhdGFzZXRNZXRhKG1ldGEpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQUdFTlRfREFUQV9TVE9SQUdFX01FVEFfS0VZLCBKU09OLnN0cmluZ2lmeShtZXRhKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdVbmFibGUgdG8gc3RvcmUgYWdlbnQgZGF0YXNldCBtZXRhZGF0YScsIGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGJ1aWxkQWdlbnRIdWJTbmFwc2hvdCgpIHsKICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSB7fTsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5hZ2VudEh1YiB8fCAhc3RhdGUuYWdlbnRIdWIuZGF0YXNldHMpIHsKICAgICAgICAgICAgICByZXR1cm4gc25hcHNob3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQUdFTlRfSFVCX1RZUEVTLmZvckVhY2godHlwZSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHN0YXRlLmFnZW50SHViLmRhdGFzZXRzW3R5cGVdOwogICAgICAgICAgICAgIGlmICghZGF0YXNldCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCByb3dzID0gQXJyYXkuaXNBcnJheShkYXRhc2V0LnJvd3MpCiAgICAgICAgICAgICAgICA/IGRhdGFzZXQucm93cy5tYXAoc2VyaWFsaXplQWdlbnRIdWJSb3cpCiAgICAgICAgICAgICAgICA6IFtdOwogICAgICAgICAgICAgIHNuYXBzaG90W3R5cGVdID0gewogICAgICAgICAgICAgICAgcm93cywKICAgICAgICAgICAgICAgIG1ldGE6IGRhdGFzZXQubWV0YSB8fCBudWxsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBzbmFwc2hvdDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXJpYWxpemVBZ2VudEh1YlJvdyhyb3cpIHsKICAgICAgICAgICAgY29uc3QgY29weSA9IHsgLi4ucm93IH07CiAgICAgICAgICAgIGlmIChyb3cubGFzdEFjdGl2aXR5IGluc3RhbmNlb2YgRGF0ZSAmJiAhTnVtYmVyLmlzTmFOKHJvdy5sYXN0QWN0aXZpdHkuZ2V0VGltZSgpKSkgewogICAgICAgICAgICAgIGNvcHkubGFzdEFjdGl2aXR5ID0gcm93Lmxhc3RBY3Rpdml0eS50b0lTT1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3B5OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXplQWdlbnRIdWJSb3cocm93KSB7CiAgICAgICAgICAgIGNvbnN0IGNvcHkgPSB7IC4uLnJvdyB9OwogICAgICAgICAgICBpZiAodHlwZW9mIHJvdy5sYXN0QWN0aXZpdHkgPT09ICJzdHJpbmciICYmIHJvdy5sYXN0QWN0aXZpdHkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gbmV3IERhdGUocm93Lmxhc3RBY3Rpdml0eSk7CiAgICAgICAgICAgICAgY29weS5sYXN0QWN0aXZpdHkgPSBOdW1iZXIuaXNOYU4ocGFyc2VkLmdldFRpbWUoKSkgPyBudWxsIDogcGFyc2VkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3B5OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHBlcnNpc3RBZ2VudEh1YlNuYXBzaG90KHNuYXBzaG90T3ZlcnJpZGUpIHsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5wZXJzaXN0RGF0YXNldHMpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc25hcHNob3QgPSBzbmFwc2hvdE92ZXJyaWRlIHx8IGJ1aWxkQWdlbnRIdWJTbmFwc2hvdCgpOwogICAgICAgICAgICBpZiAoIXNuYXBzaG90IHx8IHR5cGVvZiBzbmFwc2hvdCAhPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaGFzQ29udGVudCA9IEFHRU5UX0hVQl9UWVBFUy5zb21lKHR5cGUgPT4gQXJyYXkuaXNBcnJheShzbmFwc2hvdFt0eXBlXT8ucm93cykgJiYgc25hcHNob3RbdHlwZV0ucm93cy5sZW5ndGgpOwogICAgICAgICAgICBpZiAoIWhhc0NvbnRlbnQpIHsKICAgICAgICAgICAgICBjbGVhclBlcnNpc3RlZEFnZW50SHViU25hcHNob3QoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGVyc2lzdFByb21pc2UgPSBEQVRBX0RCX1NVUFBPUlRFRAogICAgICAgICAgICAgID8gc2F2ZUFnZW50SHViU25hcHNob3RUb0luZGV4ZWREQihzbmFwc2hvdCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICghcGVyc2lzdEFnZW50SHViU25hcHNob3RUb0xvY2FsU3RvcmFnZShzbmFwc2hvdCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBtaXJyb3IgYWdlbnQgaHViIGRhdGFzZXRzIGluIGxvY2FsIHN0b3JhZ2UiKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IGFnZW50IGh1YiBkYXRhc2V0cyBpbiBJbmRleGVkREIiLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgIHJldHVybiBwZXJzaXN0QWdlbnRIdWJTbmFwc2hvdFRvTG9jYWxTdG9yYWdlKHNuYXBzaG90KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgOiBQcm9taXNlLnJlc29sdmUocGVyc2lzdEFnZW50SHViU25hcHNob3RUb0xvY2FsU3RvcmFnZShzbmFwc2hvdCkpOwogICAgICAgICAgICBwZXJzaXN0UHJvbWlzZS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IGFnZW50IGh1YiBkYXRhc2V0cyIsIGVycm9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7CiAgICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gIiBTYXZlZCBsb2NhbGx5LiI7CiAgICAgICAgICAgICAgaWYgKCFkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQuaW5jbHVkZXMoc3VmZml4KSkgewogICAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gYCR7ZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50fSR7c3VmZml4fWAudHJpbSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHBlcnNpc3RBZ2VudEh1YlNuYXBzaG90VG9Mb2NhbFN0b3JhZ2Uoc25hcHNob3QpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oQUdFTlRfSFVCX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeSh7IHZlcnNpb246IDEsIGRhdGFzZXRzOiBzbmFwc2hvdCB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gcGVyc2lzdCBhZ2VudCBodWIgZGF0YXNldHMgaW4gbG9jYWwgc3RvcmFnZSIsIGVycm9yKTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjbGVhclBlcnNpc3RlZEFnZW50SHViU25hcHNob3QoKSB7CiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKEFHRU5UX0hVQl9TVE9SQUdFX0tFWSk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGNsZWFyIHN0b3JlZCBhZ2VudCBodWIgZGF0YXNldHMiLCBlcnJvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlbGV0ZUFnZW50SHViU25hcHNob3RGcm9tSW5kZXhlZERCKCkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gZGVsZXRlIGFnZW50IGh1YiBkYXRhc2V0cyBmcm9tIEluZGV4ZWREQiIsIGVycm9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiByZW1lbWJlckxhc3REYXRhc2V0KGNzdlRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBjc3ZUZXh0ICE9PSAic3RyaW5nIiB8fCAhY3N2VGV4dC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc2l6ZUZyb21NZXRhID0gTnVtYmVyKG1ldGEuc2l6ZSk7DQogICAgICAgICAgICBjb25zdCBzb3VyY2VTaXplID0gTnVtYmVyKG1ldGEuc291cmNlU2l6ZSk7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkU2l6ZSA9IE51bWJlci5pc0Zpbml0ZShzaXplRnJvbU1ldGEpDQogICAgICAgICAgICAgID8gc2l6ZUZyb21NZXRhDQogICAgICAgICAgICAgIDogKE51bWJlci5pc0Zpbml0ZShzb3VyY2VTaXplKSA/IHNvdXJjZVNpemUgOiBjc3ZUZXh0Lmxlbmd0aCk7DQogICAgICAgICAgICBjb25zdCByb3dzVmFsdWUgPSBOdW1iZXIobWV0YS5yb3dzKTsNCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRSb3dzID0gTnVtYmVyLmlzRmluaXRlKHJvd3NWYWx1ZSkgPyByb3dzVmFsdWUgOiBudWxsOw0KICAgICAgICAgICAgY29uc3Qgc2F2ZWRBdFZhbHVlID0gTnVtYmVyKG1ldGEuc2F2ZWRBdCk7DQogICAgICAgICAgICBjb25zdCBzYXZlZE1ldGFTYXZlZEF0ID0gTnVtYmVyKG1ldGEuc2F2ZWRNZXRhICYmIG1ldGEuc2F2ZWRNZXRhLnNhdmVkQXQpOw0KICAgICAgICAgICAgbGFzdFBhcnNlZENzdlRleHQgPSBjc3ZUZXh0Ow0KICAgICAgICAgICAgbGFzdFBhcnNlZENzdk1ldGEgPSB7DQogICAgICAgICAgICAgIG5hbWU6IG1ldGEubmFtZSB8fCBtZXRhLnNvdXJjZU5hbWUgfHwgKG1ldGEuc2F2ZWRNZXRhICYmIG1ldGEuc2F2ZWRNZXRhLm5hbWUpIHx8ICJTYXZlZCBkYXRhc2V0IiwNCiAgICAgICAgICAgICAgc2l6ZTogbm9ybWFsaXplZFNpemUsDQogICAgICAgICAgICAgIHJvd3M6IG5vcm1hbGl6ZWRSb3dzLA0KICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IG1ldGEubGFzdE1vZGlmaWVkDQogICAgICAgICAgICAgICAgfHwgKG1ldGEuc2F2ZWRNZXRhICYmIG1ldGEuc2F2ZWRNZXRhLmxhc3RNb2RpZmllZCkNCiAgICAgICAgICAgICAgICB8fCBudWxsLA0KICAgICAgICAgICAgICBzYXZlZEF0OiBOdW1iZXIuaXNGaW5pdGUoc2F2ZWRBdFZhbHVlKQ0KICAgICAgICAgICAgICAgID8gc2F2ZWRBdFZhbHVlDQogICAgICAgICAgICAgICAgOiAoTnVtYmVyLmlzRmluaXRlKHNhdmVkTWV0YVNhdmVkQXQpID8gc2F2ZWRNZXRhU2F2ZWRBdCA6IG51bGwpDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgdXBkYXRlU25hcHNob3RDb250cm9sc0F2YWlsYWJpbGl0eSgpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHJlbWVtYmVyTGFzdEFnZW50RGF0YXNldChjc3ZUZXh0LCBtZXRhID0ge30pIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgY3N2VGV4dCAhPT0gInN0cmluZyIgfHwgIWNzdlRleHQubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHNpemVGcm9tTWV0YSA9IE51bWJlcihtZXRhLnNpemUpOw0KICAgICAgICAgICAgY29uc3Qgc291cmNlU2l6ZSA9IE51bWJlcihtZXRhLnNvdXJjZVNpemUpOw0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZFNpemUgPSBOdW1iZXIuaXNGaW5pdGUoc2l6ZUZyb21NZXRhKQ0KICAgICAgICAgICAgICA/IHNpemVGcm9tTWV0YQ0KICAgICAgICAgICAgICA6IChOdW1iZXIuaXNGaW5pdGUoc291cmNlU2l6ZSkgPyBzb3VyY2VTaXplIDogY3N2VGV4dC5sZW5ndGgpOw0KICAgICAgICAgICAgY29uc3Qgcm93c1ZhbHVlID0gTnVtYmVyKG1ldGEucm93cyk7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkUm93cyA9IE51bWJlci5pc0Zpbml0ZShyb3dzVmFsdWUpID8gcm93c1ZhbHVlIDogbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IHNhdmVkQXRWYWx1ZSA9IE51bWJlcihtZXRhLnNhdmVkQXQpOw0KICAgICAgICAgICAgY29uc3Qgc2F2ZWRNZXRhU2F2ZWRBdCA9IE51bWJlcihtZXRhLnNhdmVkTWV0YSAmJiBtZXRhLnNhdmVkTWV0YS5zYXZlZEF0KTsNCiAgICAgICAgICAgIGxhc3RQYXJzZWRBZ2VudENzdlRleHQgPSBjc3ZUZXh0Ow0KICAgICAgICAgICAgbGFzdFBhcnNlZEFnZW50TWV0YSA9IHsNCiAgICAgICAgICAgICAgbmFtZTogbWV0YS5uYW1lIHx8IG1ldGEuc291cmNlTmFtZSB8fCAobWV0YS5zYXZlZE1ldGEgJiYgbWV0YS5zYXZlZE1ldGEubmFtZSkgfHwgIkFnZW50IGRhdGFzZXQiLA0KICAgICAgICAgICAgICBzaXplOiBub3JtYWxpemVkU2l6ZSwNCiAgICAgICAgICAgICAgcm93czogbm9ybWFsaXplZFJvd3MsDQogICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogbWV0YS5sYXN0TW9kaWZpZWQNCiAgICAgICAgICAgICAgICB8fCAobWV0YS5zYXZlZE1ldGEgJiYgbWV0YS5zYXZlZE1ldGEubGFzdE1vZGlmaWVkKQ0KICAgICAgICAgICAgICAgIHx8IG51bGwsDQogICAgICAgICAgICAgIHNhdmVkQXQ6IE51bWJlci5pc0Zpbml0ZShzYXZlZEF0VmFsdWUpDQogICAgICAgICAgICAgICAgPyBzYXZlZEF0VmFsdWUNCiAgICAgICAgICAgICAgICA6IChOdW1iZXIuaXNGaW5pdGUoc2F2ZWRNZXRhU2F2ZWRBdCkgPyBzYXZlZE1ldGFTYXZlZEF0IDogbnVsbCkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB1cGRhdGVTbmFwc2hvdENvbnRyb2xzQXZhaWxhYmlsaXR5KCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gY2xlYXJSZW1lbWJlcmVkRGF0YXNldCgpIHsNCiAgICAgICAgICAgIGxhc3RQYXJzZWRDc3ZUZXh0ID0gbnVsbDsNCiAgICAgICAgICAgIGxhc3RQYXJzZWRDc3ZNZXRhID0gbnVsbDsNCiAgICAgICAgICAgIGJ1ZmZlcmVkQ3N2VGV4dCA9IG51bGw7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gY2xlYXJSZW1lbWJlcmVkQWdlbnREYXRhc2V0KCkgewogICAgICAgICAgICBsYXN0UGFyc2VkQWdlbnRDc3ZUZXh0ID0gbnVsbDsKICAgICAgICAgICAgbGFzdFBhcnNlZEFnZW50TWV0YSA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29tcHJlc3NEYXRhc2V0VGV4dChjc3ZUZXh0KSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgY3N2VGV4dCAhPT0gInN0cmluZyIgfHwgIWNzdlRleHQubGVuZ3RoIHx8ICF3aW5kb3cucGFrbyB8fCBjc3ZUZXh0Lmxlbmd0aCA8IDIwNDgpIHsKICAgICAgICAgICAgICByZXR1cm4geyBkYXRhOiBjc3ZUZXh0LCBlbmNvZGluZzogInBsYWluIiB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3QgZGVmbGF0ZWQgPSB3aW5kb3cucGFrby5kZWZsYXRlKGNzdlRleHQpOwogICAgICAgICAgICAgIGxldCBiaW5hcnkgPSAiIjsKICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZGVmbGF0ZWQubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShkZWZsYXRlZFtpbmRleF0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4geyBkYXRhOiBidG9hKGJpbmFyeSksIGVuY29kaW5nOiAiYmFzZTY0LWRlZmxhdGUiIH07CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gY29tcHJlc3MgZGF0YXNldCBmb3Igc3RvcmFnZSIsIGVycm9yKTsKICAgICAgICAgICAgICByZXR1cm4geyBkYXRhOiBjc3ZUZXh0LCBlbmNvZGluZzogInBsYWluIiB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGVjb21wcmVzc0RhdGFzZXRUZXh0KGRhdGEsIGVuY29kaW5nKSB7CiAgICAgICAgICAgIGlmIChlbmNvZGluZyAhPT0gImJhc2U2NC1kZWZsYXRlIiB8fCAhd2luZG93LnBha28gfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRhdGEgfHwgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCBiaW5hcnkgPSBhdG9iKGRhdGEpOwogICAgICAgICAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5Lmxlbmd0aCk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGJpbmFyeS5sZW5ndGg7IGluZGV4ICs9IDEpIHsKICAgICAgICAgICAgICAgIGJ5dGVzW2luZGV4XSA9IGJpbmFyeS5jaGFyQ29kZUF0KGluZGV4KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgaW5mbGF0ZWQgPSB3aW5kb3cucGFrby5pbmZsYXRlKGJ5dGVzKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIFRleHREZWNvZGVyICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShpbmZsYXRlZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCByZXN1bHQgPSAiIjsKICAgICAgICAgICAgICBpbmZsYXRlZC5mb3JFYWNoKGNvZGUgPT4gewogICAgICAgICAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBkZWNvbXByZXNzIHN0b3JlZCBkYXRhc2V0IiwgZXJyb3IpOwogICAgICAgICAgICAgIHJldHVybiBkYXRhIHx8ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcGVyc2lzdERhdGFzZXRUb0xvY2FsU3RvcmFnZShjc3ZUZXh0LCBub3JtYWxpemVkTWV0YSkgewogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCB7IGRhdGEsIGVuY29kaW5nIH0gPSBjb21wcmVzc0RhdGFzZXRUZXh0KGNzdlRleHQpOwogICAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiAyLAogICAgICAgICAgICAgICAgY3N2OiBkYXRhLAogICAgICAgICAgICAgICAgZW5jb2RpbmcsCiAgICAgICAgICAgICAgICBtZXRhOiBub3JtYWxpemVkTWV0YQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oREFUQV9TVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpOwogICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhub3JtYWxpemVkTWV0YSk7CiAgICAgICAgICAgICAgc3RvcmVEYXRhc2V0TWV0YShub3JtYWxpemVkTWV0YSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKHN0b3JhZ2VFcnJvcikgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHBlcnNpc3QgZGF0YXNldCBpbiBsb2NhbFN0b3JhZ2UiLCBzdG9yYWdlRXJyb3IpOwogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHBlcnNpc3REYXRhc2V0KGNzdlRleHQsIG1ldGEgPSB7fSkgewogICAgICAgICAgICBpZiAodHlwZW9mIGNzdlRleHQgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc3RhdGUucGVyc2lzdERhdGFzZXRzKSB7CiAgICAgICAgICAgICAgdXBkYXRlU3RvcmVkRGF0YXNldENvbnRyb2xzKG51bGwpOw0KICAgICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgew0KICAgICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSAiRGF0YXNldCBsb2FkZWQuIE9wdCBpbiBhYm92ZSB0byBzYXZlIGl0IG9uIHRoaXMgZGV2aWNlLiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZE1ldGEgPSB7DQogICAgICAgICAgICAgIG5hbWU6IG1ldGEubmFtZSB8fCAiU2F2ZWQgZGF0YXNldCIsDQogICAgICAgICAgICAgIHNpemU6IHR5cGVvZiBtZXRhLnNpemUgPT09ICJudW1iZXIiID8gbWV0YS5zaXplIDogY3N2VGV4dC5sZW5ndGgsDQogICAgICAgICAgICAgIHJvd3M6IG1ldGEucm93cyB8fCBudWxsLA0KICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IG1ldGEubGFzdE1vZGlmaWVkIHx8IG51bGwsDQogICAgICAgICAgICAgIHNhdmVkQXQ6IERhdGUubm93KCkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICByZW1lbWJlckxhc3REYXRhc2V0KGNzdlRleHQsIG5vcm1hbGl6ZWRNZXRhKTsNCiAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhub3JtYWxpemVkTWV0YSk7DQogICAgICAgICAgICBjb25zdCBzZXRTYXZlZFN0YXR1c01lc3NhZ2UgPSAoKSA9PiB7DQogICAgICAgICAgICAgIGlmIChkb20udXBsb2FkU3RhdHVzKSB7DQogICAgICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gIiBTYXZlZCBsb2NhbGx5LiI7DQogICAgICAgICAgICAgICAgaWYgKCFkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50LmluY2x1ZGVzKHN1ZmZpeCkpIHsNCiAgICAgICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSBgJHtkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50fSR7c3VmZml4fWAudHJpbSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGNvbnN0IGhhbmRsZUxvY2FsU3RvcmFnZUZhbGxiYWNrID0gZXJyb3IgPT4gewogICAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gcGVyc2lzdCBkYXRhc2V0IGluIEluZGV4ZWREQiIsIGVycm9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHBlcnNpc3REYXRhc2V0VG9Mb2NhbFN0b3JhZ2UoY3N2VGV4dCwgbm9ybWFsaXplZE1ldGEpKSB7CiAgICAgICAgICAgICAgICBzZXRTYXZlZFN0YXR1c01lc3NhZ2UoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvbS51cGxvYWRTdGF0dXMpIHsKICAgICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSAiTG9hZGVkIGRhdGFzZXQsIGJ1dCB1bmFibGUgdG8gc3RvcmUgaXQgbG9jYWxseS4iOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKERBVEFfREJfU1VQUE9SVEVEKSB7CiAgICAgICAgICAgICAgc2F2ZURhdGFzZXRUb0luZGV4ZWREQihjc3ZUZXh0LCBub3JtYWxpemVkTWV0YSkudGhlbihzYXZlZE1ldGEgPT4gewogICAgICAgICAgICAgICAgdXBkYXRlU3RvcmVkRGF0YXNldENvbnRyb2xzKHNhdmVkTWV0YSk7CiAgICAgICAgICAgICAgICBzdG9yZURhdGFzZXRNZXRhKHNhdmVkTWV0YSk7CiAgICAgICAgICAgICAgICBzZXRTYXZlZFN0YXR1c01lc3NhZ2UoKTsKICAgICAgICAgICAgICAgIGlmICghcGVyc2lzdERhdGFzZXRUb0xvY2FsU3RvcmFnZShjc3ZUZXh0LCBzYXZlZE1ldGEpKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIG1pcnJvciBkYXRhc2V0IGluIGxvY2FsIHN0b3JhZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KS5jYXRjaChoYW5kbGVMb2NhbFN0b3JhZ2VGYWxsYmFjayk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGhhbmRsZUxvY2FsU3RvcmFnZUZhbGxiYWNrKG51bGwpOwogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwZXJzaXN0QWdlbnREYXRhc2V0KGNzdlRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBjc3ZUZXh0ICE9PSAic3RyaW5nIiB8fCAhY3N2VGV4dC50cmltKCkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5wZXJzaXN0RGF0YXNldHMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZE1ldGEgPSB7DQogICAgICAgICAgICAgIG5hbWU6IG1ldGEubmFtZSB8fCAiQWdlbnQgdXNhZ2UgZXhwb3J0IiwNCiAgICAgICAgICAgICAgc2l6ZTogdHlwZW9mIG1ldGEuc2l6ZSA9PT0gIm51bWJlciIgPyBtZXRhLnNpemUgOiBjc3ZUZXh0Lmxlbmd0aCwNCiAgICAgICAgICAgICAgcm93czogbWV0YS5yb3dzIHx8IG51bGwsDQogICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogbWV0YS5sYXN0TW9kaWZpZWQgfHwgbnVsbCwNCiAgICAgICAgICAgICAgc2F2ZWRBdDogRGF0ZS5ub3coKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJlbWVtYmVyTGFzdEFnZW50RGF0YXNldChjc3ZUZXh0LCBub3JtYWxpemVkTWV0YSk7DQogICAgICAgICAgICBjb25zdCBzZXRTYXZlZFN0YXR1c01lc3NhZ2UgPSAoKSA9PiB7DQogICAgICAgICAgICAgIGlmIChkb20uYWdlbnRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBzdWZmaXggPSAiIFNhdmVkIGxvY2FsbHkuIjsNCiAgICAgICAgICAgICAgICBpZiAoIWRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudC5pbmNsdWRlcyhzdWZmaXgpKSB7DQogICAgICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSBgJHtkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnR9JHtzdWZmaXh9YC50cmltKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgY29uc3QgcGVyc2lzdFRvTG9jYWxTdG9yYWdlID0gKCkgPT4gew0KICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gew0KICAgICAgICAgICAgICAgICAgdmVyc2lvbjogMSwNCiAgICAgICAgICAgICAgICAgIGNzdjogY3N2VGV4dCwNCiAgICAgICAgICAgICAgICAgIG1ldGE6IG5vcm1hbGl6ZWRNZXRhDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShBR0VOVF9EQVRBX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSk7DQogICAgICAgICAgICAgICAgc3RvcmVBZ2VudERhdGFzZXRNZXRhKG5vcm1hbGl6ZWRNZXRhKTsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuYWdlbnRVc2FnZU1ldGEpIHsNCiAgICAgICAgICAgICAgICAgIHN0YXRlLmFnZW50VXNhZ2VNZXRhLnNhdmVkQXQgPSBub3JtYWxpemVkTWV0YS5zYXZlZEF0Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBzZXRTYXZlZFN0YXR1c01lc3NhZ2UoKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IGFnZW50IGRhdGFzZXQgaW4gbG9jYWwgc3RvcmFnZSIsIGVycm9yKTsNCiAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oQUdFTlRfREFUQV9TVE9SQUdFX01FVEFfS0VZKTsNCiAgICAgICAgICAgICAgICB9IGNhdGNoIChtZXRhRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGNsZWFyIGFnZW50IGRhdGFzZXQgbWV0YWRhdGEiLCBtZXRhRXJyb3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpZiAoREFUQV9EQl9TVVBQT1JURUQpIHsNCiAgICAgICAgICAgICAgc2F2ZUFnZW50RGF0YXNldFRvSW5kZXhlZERCKGNzdlRleHQsIG5vcm1hbGl6ZWRNZXRhKS50aGVuKHNhdmVkTWV0YSA9PiB7DQogICAgICAgICAgICAgICAgc3RvcmVBZ2VudERhdGFzZXRNZXRhKHNhdmVkTWV0YSk7DQogICAgICAgICAgICAgICAgaWYgKHN0YXRlLmFnZW50VXNhZ2VNZXRhKSB7DQogICAgICAgICAgICAgICAgICBzdGF0ZS5hZ2VudFVzYWdlTWV0YS5zYXZlZEF0ID0gc2F2ZWRNZXRhLnNhdmVkQXQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7DQogICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShBR0VOVF9EQVRBX1NUT1JBR0VfS0VZKTsNCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBjbGVhciBsZWdhY3kgYWdlbnQgZGF0YXNldCBjYWNoZSIsIGNsZWFudXBFcnJvcik7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHNldFNhdmVkU3RhdHVzTWVzc2FnZSgpOw0KICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gcGVyc2lzdCBhZ2VudCBkYXRhc2V0IGluIEluZGV4ZWREQiIsIGVycm9yKTsNCiAgICAgICAgICAgICAgICBpZiAoIXBlcnNpc3RUb0xvY2FsU3RvcmFnZSgpICYmIGRvbS5hZ2VudFN0YXR1cykgew0KICAgICAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gIkxvYWRlZCBhZ2VudCBkYXRhc2V0LCBidXQgdW5hYmxlIHRvIHN0b3JlIGl0IGxvY2FsbHkuIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXBlcnNpc3RUb0xvY2FsU3RvcmFnZSgpICYmIGRvbS5hZ2VudFN0YXR1cykgew0KICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSAiTG9hZGVkIGFnZW50IGRhdGFzZXQsIGJ1dCBsb2NhbCBzdG9yYWdlIGlzIHVuYXZhaWxhYmxlLiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gY2xlYXJTdG9yZWREYXRhc2V0KHsgcXVpZXQgPSBmYWxzZSwga2VlcFJ1bnRpbWUgPSBmYWxzZSB9ID0ge30pIHsNCiAgICAgICAgICAgIGNvbnN0IGNsZWFyTG9jYWxTdG9yYWdlID0gKCkgPT4gew0KICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShEQVRBX1NUT1JBR0VfS0VZKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKERBVEFfU1RPUkFHRV9NRVRBX0tFWSk7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShBR0VOVF9EQVRBX1NUT1JBR0VfS0VZKTsKICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKEFHRU5UX0RBVEFfU1RPUkFHRV9NRVRBX0tFWSk7CiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShBR0VOVF9IVUJfU1RPUkFHRV9LRVkpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1VuYWJsZSB0byBjbGVhciBzYXZlZCBkYXRhc2V0IG1ldGFkYXRhJywgZXJyb3IpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgZmluYWxpemVDbGVhciA9ICgpID0+IHsKICAgICAgICAgICAgICBjbGVhckxvY2FsU3RvcmFnZSgpOwogICAgICAgICAgICAgIGNsZWFyUGVyc2lzdGVkQWdlbnRIdWJTbmFwc2hvdCgpOwogICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsKICAgICAgICAgICAgICBpZiAoIWtlZXBSdW50aW1lKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5hZ2VudFVzYWdlUm93cyA9IFtdOwogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnRVc2FnZU1ldGEgPSBudWxsOwogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSA1OwogICAgICAgICAgICAgICAgc3RhdGUuYWdlbnRTb3J0ID0geyBjb2x1bW46ICJyZXNwb25zZXMiLCBkaXJlY3Rpb246ICJkZXNjIiB9OwogICAgICAgICAgICAgICAgdXBkYXRlQWdlbnRVc2FnZUNhcmQoW10pOwogICAgICAgICAgICAgICAgY2xlYXJSZW1lbWJlcmVkRGF0YXNldCgpOwogICAgICAgICAgICAgICAgY2xlYXJSZW1lbWJlcmVkQWdlbnREYXRhc2V0KCk7CiAgICAgICAgICAgICAgICBBR0VOVF9IVUJfVFlQRVMuZm9yRWFjaCh0eXBlID0+IHJlc2V0QWdlbnRIdWJEYXRhc2V0KHR5cGUsIHsgc2tpcFBlcnNpc3Q6IHRydWUgfSkpOwogICAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFN0YXR1cykgewogICAgICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSBxdWlldCA/ICJBZ2VudCBkYXRhc2V0IGNsZWFyZWQuIiA6ICJBZ2VudCBkYXRhc2V0IGNsZWFyZWQgZnJvbSB0aGlzIGRldmljZS4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFxdWlldCAmJiBkb20udXBsb2FkU3RhdHVzKSB7CiAgICAgICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSAnU2F2ZWQgZGF0YXNldCByZW1vdmVkIGZyb20gdGhpcyBkZXZpY2UuJzsKICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudFVzYWdlQ2FyZChzdGF0ZS5hZ2VudFVzYWdlUm93cyk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpZiAoIURBVEFfREJfU1VQUE9SVEVEKSB7DQogICAgICAgICAgICAgIGZpbmFsaXplQ2xlYXIoKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgUHJvbWlzZS5hbGxTZXR0bGVkKFsKICAgICAgICAgICAgICBkZWxldGVEYXRhc2V0RnJvbUluZGV4ZWREQigpLAogICAgICAgICAgICAgIGRlbGV0ZUFnZW50RGF0YXNldEZyb21JbmRleGVkREIoKQogICAgICAgICAgICBdKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICBmaW5hbGl6ZUNsZWFyKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBsb2FkQWdlbnREYXRhc2V0RnJvbUxvY2FsU3RvcmFnZUxlZ2FjeSgpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGNvbnN0IHJhdyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEFHRU5UX0RBVEFfU1RPUkFHRV9LRVkpOw0KICAgICAgICAgICAgICBpZiAoIXJhdykgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShyYXcpOw0KICAgICAgICAgICAgICBpZiAoIXBheWxvYWQgfHwgdHlwZW9mIHBheWxvYWQgIT09ICJvYmplY3QiKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCBzYXZlZE1ldGEgPSBwYXlsb2FkLm1ldGEgfHwge307DQogICAgICAgICAgICAgIGlmICgoIXNhdmVkTWV0YSB8fCBPYmplY3Qua2V5cyhzYXZlZE1ldGEpLmxlbmd0aCA9PT0gMCkgJiYgd2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBjb25zdCBtZXRhUmF3ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oQUdFTlRfREFUQV9TVE9SQUdFX01FVEFfS0VZKTsNCiAgICAgICAgICAgICAgICAgIGlmIChtZXRhUmF3KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZE1ldGEgPSBKU09OLnBhcnNlKG1ldGFSYXcpOw0KICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VkTWV0YSAmJiB0eXBlb2YgcGFyc2VkTWV0YSA9PT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBzYXZlZE1ldGEgPSBwYXJzZWRNZXRhOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBjYXRjaCAobWV0YUVycm9yKSB7DQogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byByZWFkIGFnZW50IGRhdGFzZXQgbWV0YWRhdGEiLCBtZXRhRXJyb3IpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAocGF5bG9hZC5jc3YgJiYgdHlwZW9mIHBheWxvYWQuY3N2ID09PSAic3RyaW5nIiAmJiBwYXlsb2FkLmNzdi50cmltKCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoREFUQV9EQl9TVVBQT1JURUQpIHsNCiAgICAgICAgICAgICAgICAgIHNhdmVBZ2VudERhdGFzZXRUb0luZGV4ZWREQihwYXlsb2FkLmNzdiwgc2F2ZWRNZXRhKS50aGVuKG1ldGFVcGRhdGUgPT4gew0KICAgICAgICAgICAgICAgICAgICBzdG9yZUFnZW50RGF0YXNldE1ldGEobWV0YVVwZGF0ZSk7DQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oQUdFTlRfREFUQV9TVE9SQUdFX0tFWSk7DQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGNsZWFyIGxlZ2FjeSBhZ2VudCBkYXRhc2V0IGNhY2hlIiwgY2xlYW51cEVycm9yKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBtaWdyYXRlIGFnZW50IGRhdGFzZXQgdG8gSW5kZXhlZERCIiwgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChkb20uYWdlbnRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudCA9ICJSZXN0b3Jpbmcgc2F2ZWQgYWdlbnQgdXNhZ2UgZGF0YXNldC4uLiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlQWdlbnRVc2FnZVRleHQocGF5bG9hZC5jc3YsIHNhdmVkTWV0YSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgc2F2ZWQgYWdlbnQgZGF0YXNldCBmcm9tIGxvY2FsU3RvcmFnZSIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBsb2FkU3RvcmVkQWdlbnREYXRhc2V0RnJvbURldmljZSgpIHsNCiAgICAgICAgICAgIGlmICghc3RhdGUucGVyc2lzdERhdGFzZXRzKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsNCiAgICAgICAgICAgICAgbG9hZEFnZW50RGF0YXNldEZyb21Mb2NhbFN0b3JhZ2VMZWdhY3koKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbG9hZEFnZW50RGF0YXNldEZyb21JbmRleGVkREIoKS50aGVuKHJlY29yZCA9PiB7DQogICAgICAgICAgICAgIGlmICghcmVjb3JkIHx8ICFyZWNvcmQuY3N2KSB7DQogICAgICAgICAgICAgICAgbG9hZEFnZW50RGF0YXNldEZyb21Mb2NhbFN0b3JhZ2VMZWdhY3koKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3Qgc2F2ZWRNZXRhID0gcmVjb3JkLm1ldGEgfHwge307DQogICAgICAgICAgICAgIHN0b3JlQWdlbnREYXRhc2V0TWV0YShzYXZlZE1ldGEpOw0KICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gIlJlc3RvcmluZyBzYXZlZCBhZ2VudCB1c2FnZSBkYXRhc2V0Li4uIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBwYXJzZUFnZW50VXNhZ2VUZXh0KHJlY29yZC5jc3YsIHNhdmVkTWV0YSk7DQogICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgc2F2ZWQgYWdlbnQgZGF0YXNldCBmcm9tIEluZGV4ZWREQiIsIGVycm9yKTsNCiAgICAgICAgICAgICAgbG9hZEFnZW50RGF0YXNldEZyb21Mb2NhbFN0b3JhZ2VMZWdhY3koKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGlzQ3N2RmlsZShmaWxlKSB7DQogICAgICAgICAgICBpZiAoIWZpbGUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdHlwZSA9IChmaWxlLnR5cGUgfHwgIiIpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBpZiAodHlwZSAmJiBDU1ZfQUNDRVBURURfTUlNRV9UWVBFUy5oYXModHlwZSkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBuYW1lID0gKGZpbGUubmFtZSB8fCAiIikudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgIHJldHVybiBuYW1lLmVuZHNXaXRoKCIuY3N2Iik7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVDc3ZGaWxlKGZpbGUpIHsNCiAgICAgICAgICAgIGlmICghaXNDc3ZGaWxlKGZpbGUpKSB7DQogICAgICAgICAgICAgIHNob3dVcGxvYWRFcnJvcigiT25seSBDU1YgZXhwb3J0cyBhcmUgc3VwcG9ydGVkLiBQbGVhc2UgY2hvb3NlIGEgLmNzdiBmaWxlLiIpOw0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGZpbGUuc2l6ZSkgJiYgZmlsZS5zaXplID4gTUFYX0RBVEFTRVRfRklMRV9TSVpFKSB7DQogICAgICAgICAgICAgIGNvbnN0IGxpbWl0TWIgPSBNYXRoLnJvdW5kKE1BWF9EQVRBU0VUX0ZJTEVfU0laRSAvICgxMDI0ICogMTAyNCkpOw0KICAgICAgICAgICAgICBzaG93VXBsb2FkRXJyb3IoYEZpbGUgaXMgdG9vIGxhcmdlLiBQbGVhc2UgY2hvb3NlIGEgQ1NWIHVuZGVyICR7bGltaXRNYn0gTUIuYCk7DQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHNob3dVcGxvYWRFcnJvcihtZXNzYWdlKSB7DQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgew0KICAgICAgICAgICAgICBkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50ID0gbWVzc2FnZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZGF0YXNldE1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXNzYWdlLnRleHRDb250ZW50ID0gIlVwbG9hZCBhIHZhbGlkIENTViBleHBvcnQgdG8gY29udGludWUuIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkTWV0YSkgew0KICAgICAgICAgICAgICBkb20udXBsb2FkTWV0YS50ZXh0Q29udGVudCA9ICJObyBmaWxlIGNob3NlbiB5ZXQuIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkUHJvZ3Jlc3MpIHsNCiAgICAgICAgICAgICAgZG9tLnVwbG9hZFByb2dyZXNzLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFByb2dyZXNzQmFyKSB7DQogICAgICAgICAgICAgIGRvbS51cGxvYWRQcm9ncmVzc0Jhci52YWx1ZSA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFpvbmUpIHsNCiAgICAgICAgICAgICAgZG9tLnVwbG9hZFpvbmUuY2xhc3NMaXN0LmFkZCgiaXMtZXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjbGVhclVwbG9hZEVycm9yKCkgew0KICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRab25lKSB7DQogICAgICAgICAgICAgIGRvbS51cGxvYWRab25lLmNsYXNzTGlzdC5yZW1vdmUoImlzLWVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gY29tcHV0ZVBlcmNlbnQoY3Vyc29yLCBzaXplKSB7DQogICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShjdXJzb3IpIHx8ICFOdW1iZXIuaXNGaW5pdGUoc2l6ZSkgfHwgc2l6ZSA8PSAwKSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIChjdXJzb3IgLyBzaXplKSAqIDEwMDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzdGFydFVwbG9hZFByb2dyZXNzKGZpbGUpIHsNCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkUHJvZ3Jlc3MpIHsNCiAgICAgICAgICAgICAgZG9tLnVwbG9hZFByb2dyZXNzLmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRQcm9ncmVzc0Jhcikgew0KICAgICAgICAgICAgICBkb20udXBsb2FkUHJvZ3Jlc3NCYXIudmFsdWUgPSAwOw0KICAgICAgICAgICAgICBkb20udXBsb2FkUHJvZ3Jlc3NCYXIubWF4ID0gMTAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBmaWxlICYmIGZpbGUubmFtZSA/IGZpbGUubmFtZSA6ICJkYXRhc2V0IjsNCiAgICAgICAgICAgICAgZG9tLnVwbG9hZFN0YXR1cy50ZXh0Q29udGVudCA9IGBQYXJzaW5nICR7bGFiZWx9Li4uYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZGF0YXNldE1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXNzYWdlLnRleHRDb250ZW50ID0gIlBhcnNpbmcgaW4gcHJvZ3Jlc3MuLi4iOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5kYXRhc2V0TWV0YVdyYXBwZXIpIHsNCiAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXRhV3JhcHBlci5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVVwbG9hZFByb2dyZXNzKHsgcGVyY2VudCwgcm93c1Byb2Nlc3NlZCB9KSB7DQogICAgICAgICAgICBjb25zdCBib3VuZGVkUGVyY2VudCA9IE51bWJlci5pc0Zpbml0ZShwZXJjZW50KSA/IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgTWF0aC5yb3VuZChwZXJjZW50KSkpIDogbnVsbDsNCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkUHJvZ3Jlc3NCYXIgJiYgYm91bmRlZFBlcmNlbnQgIT0gbnVsbCkgew0KICAgICAgICAgICAgICBkb20udXBsb2FkUHJvZ3Jlc3NCYXIudmFsdWUgPSBib3VuZGVkUGVyY2VudDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkU3RhdHVzKSB7DQogICAgICAgICAgICAgIGNvbnN0IHBpZWNlcyA9IFtdOw0KICAgICAgICAgICAgICBpZiAoYm91bmRlZFBlcmNlbnQgIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHBpZWNlcy5wdXNoKGAke2JvdW5kZWRQZXJjZW50fSUgY29tcGxldGVgKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHJvd3NQcm9jZXNzZWQpICYmIHJvd3NQcm9jZXNzZWQgPiAwKSB7DQogICAgICAgICAgICAgICAgcGllY2VzLnB1c2goYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChyb3dzUHJvY2Vzc2VkKX0gcm93cyBwcm9jZXNzZWRgKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50ID0gcGllY2VzLmxlbmd0aA0KICAgICAgICAgICAgICAgID8gYFBhcnNpbmcgJHtwaWVjZXMuam9pbigiIC0gIil9Li4uYA0KICAgICAgICAgICAgICAgIDogIlBhcnNpbmcgaW4gcHJvZ3Jlc3MuLi4iOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGZpbmlzaFVwbG9hZFByb2dyZXNzKG1lc3NhZ2UpIHsNCiAgICAgICAgICAgIGlmIChkb20udXBsb2FkUHJvZ3Jlc3MpIHsNCiAgICAgICAgICAgICAgZG9tLnVwbG9hZFByb2dyZXNzLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFByb2dyZXNzQmFyKSB7DQogICAgICAgICAgICAgIGRvbS51cGxvYWRQcm9ncmVzc0Jhci52YWx1ZSA9IDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobWVzc2FnZSAmJiBkb20udXBsb2FkU3RhdHVzKSB7DQogICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSBtZXNzYWdlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHNldEFjdGl2ZVBhcnNlQ29udHJvbGxlcihjb250cm9sbGVyKSB7DQogICAgICAgICAgICBhY3RpdmVQYXJzZUNvbnRyb2xsZXIgPSBjb250cm9sbGVyOw0KICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRDYW5jZWwpIHsNCiAgICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBCb29sZWFuKGNvbnRyb2xsZXIpOw0KICAgICAgICAgICAgICBkb20udXBsb2FkQ2FuY2VsLmRpc2FibGVkID0gIWlzQWN0aXZlOw0KICAgICAgICAgICAgICBkb20udXBsb2FkQ2FuY2VsLnNldEF0dHJpYnV0ZSgiYXJpYS1kaXNhYmxlZCIsIFN0cmluZyghaXNBY3RpdmUpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjYW5jZWxBY3RpdmVQYXJzZShvcHRpb25zID0ge30pIHsNCiAgICAgICAgICAgIGNvbnN0IHNpbGVudCA9IEJvb2xlYW4ob3B0aW9ucyAmJiBvcHRpb25zLnNpbGVudCk7DQogICAgICAgICAgICBpZiAoIWFjdGl2ZVBhcnNlQ29udHJvbGxlcikgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhY3RpdmVQYXJzZUNvbnRyb2xsZXIuYWJvcnRlZCA9IHRydWU7DQogICAgICAgICAgICBhY3RpdmVQYXJzZUNvbnRyb2xsZXIuc2lsZW50QWJvcnQgPSBzaWxlbnQ7DQogICAgICAgICAgICBpZiAoYWN0aXZlUGFyc2VDb250cm9sbGVyLnBhcnNlciAmJiB0eXBlb2YgYWN0aXZlUGFyc2VDb250cm9sbGVyLnBhcnNlci5hYm9ydCA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGFjdGl2ZVBhcnNlQ29udHJvbGxlci5wYXJzZXIuYWJvcnQoKTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBhYm9ydCBwYXJzZXIiLCBlcnJvcik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGZpbmlzaFVwbG9hZFByb2dyZXNzKHNpbGVudCA/IG51bGwgOiAiSW1wb3J0IGNhbmNlbGVkLiIpOw0KICAgICAgICAgICAgc2V0QWN0aXZlUGFyc2VDb250cm9sbGVyKG51bGwpOw0KICAgICAgICAgICAgaWYgKCFzaWxlbnQgJiYgZG9tLmRhdGFzZXRNZXNzYWdlKSB7DQogICAgICAgICAgICAgIGRvbS5kYXRhc2V0TWVzc2FnZS50ZXh0Q29udGVudCA9ICJVcGxvYWQgY2FuY2VsZWQuIFNlbGVjdCBhIENTViB0byB0cnkgYWdhaW4uIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVGaWxlKGZpbGUpIHsNCiAgICAgICAgICAgIGlmICghZmlsZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYW5jZWxBY3RpdmVQYXJzZSh7IHNpbGVudDogdHJ1ZSB9KTsNCiAgICAgICAgICAgIGNsZWFyVXBsb2FkRXJyb3IoKTsNCiAgICAgICAgICAgIGlmICghdmFsaWRhdGVDc3ZGaWxlKGZpbGUpKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRldGVjdENzdkZpbGVUeXBlKGZpbGUpLnRoZW4odHlwZSA9PiB7DQogICAgICAgICAgICAgIGlmICh0eXBlID09PSAiYWdlbnQiKSB7DQogICAgICAgICAgICAgICAgcGFyc2VBZ2VudFVzYWdlRmlsZShmaWxlKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBwcm9jZXNzQ29waWxvdERhdGFzZXRGaWxlKGZpbGUpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgICAgIHByb2Nlc3NDb3BpbG90RGF0YXNldEZpbGUoZmlsZSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBkZXRlY3RDc3ZGaWxlVHlwZShmaWxlKSB7DQogICAgICAgICAgICBpZiAoIWZpbGUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgidW5rbm93biIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbmFtZSA9IChmaWxlLm5hbWUgfHwgIiIpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygiYWdlbnQiKSAmJiAobmFtZS5pbmNsdWRlcygidXNhZ2UiKSB8fCBuYW1lLmluY2x1ZGVzKCJjb3BpbG90IikpKSB7DQogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoImFnZW50Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIGZpbGUuc2xpY2UgIT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgiY29waWxvdCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IGZpbGUuc2xpY2UoMCwgNDA5Nik7DQogICAgICAgICAgICAgIGlmICghc25pcHBldCB8fCB0eXBlb2Ygc25pcHBldC50ZXh0ICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgiY29waWxvdCIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJldHVybiBzbmlwcGV0LnRleHQoKS50aGVuKHRleHQgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlckxpbmUgPSBTdHJpbmcodGV4dCB8fCAiIikuc3BsaXQoL1xyP1xuLykuZmluZChsaW5lID0+IGxpbmUudHJpbSgpKTsNCiAgICAgICAgICAgICAgICBpZiAoIWhlYWRlckxpbmUpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiAiY29waWxvdCI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBoZWFkZXJMaW5lLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGFnZW50VG9rZW5zID0gWyJhZ2VudCBpZCIsICJhZ2VudCBuYW1lIiwgInJlc3BvbnNlcyBzZW50IHRvIHVzZXJzIl07DQogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IGFnZW50VG9rZW5zLmZpbHRlcih0b2tlbiA9PiBub3JtYWxpemVkLmluY2x1ZGVzKHRva2VuKSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMubGVuZ3RoID49IDIgPyAiYWdlbnQiIDogImNvcGlsb3QiOw0KICAgICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiAiY29waWxvdCIpOw0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gaW5zcGVjdCBDU1YgaGVhZGVyIiwgZXJyb3IpOw0KICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCJjb3BpbG90Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZmluYWxpemVQYXJzZWREYXRhc2V0KGNvbnRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgY3VycmVudENzdkZpZWxkTG9va3VwID0gbnVsbDsNCiAgICAgICAgICAgIGZpbHRlclByZWZlcmVuY2VzQXBwbGllZCA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc3Qgew0KICAgICAgICAgICAgICBwYXJzZWRSb3dzLA0KICAgICAgICAgICAgICB1bmlxdWVQZXJzb25zLA0KICAgICAgICAgICAgICBvcmdhbml6YXRpb25zLA0KICAgICAgICAgICAgICBjb3VudHJpZXMsDQogICAgICAgICAgICAgIGVhcmxpZXN0RGF0ZSwNCiAgICAgICAgICAgICAgbGF0ZXN0RGF0ZSwNCiAgICAgICAgICAgICAgc2tpcHBlZFJvd3MsDQogICAgICAgICAgICAgIHJvd0Vycm9ycw0KICAgICAgICAgICAgfSA9IGNvbnRleHQ7DQogICAgICANCiAgICAgICAgICAgIHN0YXRlLnJvd3MgPSBwYXJzZWRSb3dzOw0KICAgICAgICAgICAgc3RhdGUudW5pcXVlUGVyc29ucyA9IHVuaXF1ZVBlcnNvbnM7DQogICAgICAgICAgICBzdGF0ZS5lYXJsaWVzdERhdGUgPSBlYXJsaWVzdERhdGU7DQogICAgICAgICAgICBzdGF0ZS5sYXRlc3REYXRlID0gbGF0ZXN0RGF0ZTsNCiAgICAgICAgICAgIHN0YXRlLnVuaXF1ZU9yZ2FuaXphdGlvbnMgPSBvcmdhbml6YXRpb25zOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCA9IGVhcmxpZXN0RGF0ZSA/IG5ldyBEYXRlKGVhcmxpZXN0RGF0ZS5nZXRUaW1lKCkpIDogbnVsbDsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY3VzdG9tRW5kID0gbGF0ZXN0RGF0ZSA/IG5ldyBEYXRlKGxhdGVzdERhdGUuZ2V0VGltZSgpKSA6IG51bGw7DQogICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbVJhbmdlSW52YWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgc3luY0N1c3RvbVJhbmdlSW5wdXRzKCk7DQogICAgICAgICAgICB1cGRhdGVDdXN0b21SYW5nZVZpc2liaWxpdHkoKTsNCiAgICAgIA0KICAgICAgICAgICAgdXBkYXRlU2VsZWN0T3B0aW9ucyhkb20ub3JnYW5pemF0aW9uRmlsdGVyLCBvcmdhbml6YXRpb25zLCAnQWxsIG9yZ2FuaXphdGlvbnMnKTsNCiAgICAgICAgICAgIHVwZGF0ZVNlbGVjdE9wdGlvbnMoZG9tLmNvdW50cnlGaWx0ZXIsIGNvdW50cmllcywgJ0FsbCByZWdpb25zJyk7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IG5vdGVzID0gW107DQogICAgICAgICAgICBpZiAoc2tpcHBlZFJvd3MpIHsNCiAgICAgICAgICAgICAgbm90ZXMucHVzaChgc2tpcHBlZCAke3NraXBwZWRSb3dzfSByb3dzIHdpdGggbWlzc2luZyBkYXRlcyBvciB2YWx1ZXNgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChyb3dFcnJvcnMpIHsNCiAgICAgICAgICAgICAgbm90ZXMucHVzaChgJHtyb3dFcnJvcnN9IHJvdyBwYXJzZSBlcnJvcnNgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG5vdGVzVGV4dCA9IG5vdGVzLmxlbmd0aCA/IGAgKCR7bm90ZXMuam9pbignOyAnKX0pYCA6ICcnOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCByb3dDb3VudCA9IHBhcnNlZFJvd3MubGVuZ3RoOw0KICAgICAgICAgICAgY29uc3Qgcm93Q291bnRUZXh0ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChyb3dDb3VudCk7DQogICAgICAgICAgICBjb25zdCBzaXplQnl0ZXMgPSB0eXBlb2YgbWV0YS5zb3VyY2VTaXplID09PSAnbnVtYmVyJyA/IG1ldGEuc291cmNlU2l6ZSA6IG51bGw7DQogICAgICAgICAgICBjb25zdCBzaXplVGV4dCA9IHR5cGVvZiBzaXplQnl0ZXMgPT09ICdudW1iZXInID8gYCR7KHNpemVCeXRlcyAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSl9IE1CYCA6IG51bGw7DQogICAgICAgICAgICBjb25zdCBzb3VyY2VOYW1lID0gbWV0YS5zb3VyY2VOYW1lIHx8IChtZXRhLnNhdmVkTWV0YSAmJiBtZXRhLnNhdmVkTWV0YS5uYW1lKTsNCiAgICAgICAgICAgIGNvbnN0IGZvcm1hdHRlZFNvdXJjZSA9IHNvdXJjZU5hbWUgPyBzaG9ydGVuTGFiZWwoc291cmNlTmFtZSkgOiBudWxsOw0KICAgICAgDQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZE1ldGEpIHsNCiAgICAgICAgICAgICAgaWYgKGZvcm1hdHRlZFNvdXJjZSAmJiBzaXplVGV4dCkgew0KICAgICAgICAgICAgICAgIGRvbS51cGxvYWRNZXRhLnRleHRDb250ZW50ID0gYCR7Zm9ybWF0dGVkU291cmNlfSDCtyAke3NpemVUZXh0fWA7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0dGVkU291cmNlKSB7DQogICAgICAgICAgICAgICAgZG9tLnVwbG9hZE1ldGEudGV4dENvbnRlbnQgPSBmb3JtYXR0ZWRTb3VyY2U7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZVRleHQpIHsNCiAgICAgICAgICAgICAgICBkb20udXBsb2FkTWV0YS50ZXh0Q29udGVudCA9IHNpemVUZXh0Ow0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGRvbS51cGxvYWRNZXRhLnRleHRDb250ZW50ID0gYCR7cm93Q291bnRUZXh0fSByb3dzYDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgew0KICAgICAgICAgICAgICBkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50ID0gbWV0YS5sb2FkZWRGcm9tU3RvcmFnZQ0KICAgICAgICAgICAgICAgID8gIlNhdmVkIGRhdGFzZXQgbG9hZGVkLiINCiAgICAgICAgICAgICAgICA6IGBMb2FkZWQgJHtyb3dDb3VudFRleHR9IHJvd3Mke25vdGVzVGV4dH0uYDsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKGRvbS5kYXRhc2V0TWVzc2FnZSkgew0KICAgICAgICAgICAgICBkb20uZGF0YXNldE1lc3NhZ2UudGV4dENvbnRlbnQgPSBtZXRhLmxvYWRlZEZyb21TdG9yYWdlDQogICAgICAgICAgICAgICAgPyAnRGF0YXNldCByZXN0b3JlZC4gRmlsdGVycyByZWZsZWN0IGRldGVjdGVkIHNlZ21lbnRzLicNCiAgICAgICAgICAgICAgICA6ICdEYXRhc2V0IHJlYWR5LiBGaWx0ZXJzIHJlZmxlY3QgZGV0ZWN0ZWQgc2VnbWVudHMuJzsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKGRvbS5kYXRhc2V0TWV0YVdyYXBwZXIpIHsKICAgICAgICAgICAgICBkb20uZGF0YXNldE1ldGFXcmFwcGVyLmhpZGRlbiA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkb20ubWV0YVJlY29yZHMpIHsKICAgICAgICAgICAgICBkb20ubWV0YVJlY29yZHMudGV4dENvbnRlbnQgPSByb3dDb3VudFRleHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRvbS5tZXRhVXNlcnMpIHsKICAgICAgICAgICAgICBkb20ubWV0YVVzZXJzLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdCh1bmlxdWVQZXJzb25zLnNpemUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChkb20ubWV0YVJhbmdlKSB7CiAgICAgICAgICAgICAgZG9tLm1ldGFSYW5nZS50ZXh0Q29udGVudCA9IGZvcm1hdFJhbmdlTGFiZWwoZWFybGllc3REYXRlLCBsYXRlc3REYXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9tLm1ldGFPcmdzKSB7CiAgICAgICAgICAgICAgZG9tLm1ldGFPcmdzLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChvcmdhbml6YXRpb25zLnNpemUgfHwgMCk7CiAgICAgICAgICAgIH0KICAgICAgDQogICAgICAgICAgICBjb25zdCBzbmFwc2hvdFBheWxvYWQgPSBwZW5kaW5nU25hcHNob3RQYXlsb2FkOw0KICAgICAgICAgICAgbGV0IHNuYXBzaG90RmlsdGVyc0FwcGxpZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIGlmIChzbmFwc2hvdFBheWxvYWQgJiYgc25hcHNob3RQYXlsb2FkLmRhdGFzZXQgJiYgc25hcHNob3RQYXlsb2FkLmRhdGFzZXQuY3N2VGV4dCA9PT0gbGFzdFBhcnNlZENzdlRleHQpIHsNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBzbmFwc2hvdEZpbHRlcnNBcHBsaWVkID0gYXBwbHlTbmFwc2hvdFN0YXRlKHNuYXBzaG90UGF5bG9hZCk7DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gYXBwbHkgc25hcHNob3Qgc3RhdGUiLCBlcnJvcik7DQogICAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgcGVuZGluZ1NuYXBzaG90UGF5bG9hZCA9IG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHBlbmRpbmdTbmFwc2hvdFBheWxvYWQgPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBpZiAoIXNuYXBzaG90RmlsdGVyc0FwcGxpZWQpIHsNCiAgICAgICAgICAgICAgbWF5YmVBcHBseVN0b3JlZEZpbHRlcnMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHBlcnNpc3RGaWx0ZXJQcmVmZXJlbmNlcygpOw0KICAgICAgICAgICAgc2V0VHJlbmRDb2xvckNvbnRyb2xzVmlzaWJpbGl0eShzdGF0ZS5maWx0ZXJzLm1ldHJpYyAhPT0gImhvdXJzIik7DQogICAgICANCiAgICAgICAgICAgIGlmIChtZXRhLnNhdmVkTWV0YSkgew0KICAgICAgICAgICAgICBjb25zdCBzdG9yZWRNZXRhID0gew0KICAgICAgICAgICAgICAgIC4uLm1ldGEuc2F2ZWRNZXRhLA0KICAgICAgICAgICAgICAgIG5hbWU6IG1ldGEuc2F2ZWRNZXRhLm5hbWUgfHwgc291cmNlTmFtZSwNCiAgICAgICAgICAgICAgICByb3dzOiBtZXRhLnNhdmVkTWV0YS5yb3dzIHx8IHJvd0NvdW50DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhzdG9yZWRNZXRhKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUNzdlRleHRDb250ZW50KGNzdlRleHQsIG1ldGEgPSB7fSkgew0KICAgICAgICAgICAgY3VycmVudENzdkZpZWxkTG9va3VwID0gbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IHBhcnNlZFJvd3MgPSBbXTsNCiAgICAgICAgICAgIGNvbnN0IHVuaXF1ZVBlcnNvbnMgPSBuZXcgU2V0KCk7DQogICAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgY29uc3QgY291bnRyaWVzID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgbGV0IGVhcmxpZXN0RGF0ZSA9IG51bGw7DQogICAgICAgICAgICBsZXQgbGF0ZXN0RGF0ZSA9IG51bGw7DQogICAgICAgICAgICBsZXQgc2tpcHBlZFJvd3MgPSAwOw0KICAgICAgICAgICAgbGV0IHJvd0Vycm9ycyA9IDA7DQoNCiAgICAgICAgICAgIGNvbnN0IGRldGVjdGVkRGVsaW1pdGVyID0gZGV0ZWN0RGVsaW1pdGVyRnJvbVNhbXBsZShjc3ZUZXh0KTsNCiAgICAgICAgICAgIFBhcGEucGFyc2UoY3N2VGV4dCwgew0KICAgICAgICAgICAgICBoZWFkZXI6IHRydWUsDQogICAgICAgICAgICAgIHNraXBFbXB0eUxpbmVzOiB0cnVlLA0KICAgICAgICAgICAgICBkZWxpbWl0ZXI6IGRldGVjdGVkRGVsaW1pdGVyIHx8ICIiLA0KICAgICAgICAgICAgICBzdGVwOiByZXN1bHRzID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCByYXcgPSByZXN1bHRzLmRhdGE7DQogICAgICAgICAgICAgICAgZW5zdXJlRGF0YXNldEZpZWxkTG9va3VwKHJlc3VsdHM/Lm1ldGE/LmZpZWxkcywgcmF3KTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0cy5lcnJvcnMgJiYgcmVzdWx0cy5lcnJvcnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICByb3dFcnJvcnMgKz0gcmVzdWx0cy5lcnJvcnMubGVuZ3RoOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIXJhdyB8fCBPYmplY3Qua2V5cyhyYXcpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgc2tpcHBlZFJvd3MgKz0gMTsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gdHJhbnNmb3JtUm93KHJhdyk7DQogICAgICAgICAgICAgICAgaWYgKCFwYXJzZWQpIHsNCiAgICAgICAgICAgICAgICAgIHNraXBwZWRSb3dzICs9IDE7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBhcnNlZFJvd3MucHVzaChwYXJzZWQpOw0KICAgICAgICAgICAgICAgIGlmIChwYXJzZWQudG90YWxBY3Rpb25zID4gMCB8fCBwYXJzZWQuYXNzaXN0ZWRIb3VycyA+IDApIHsNCiAgICAgICAgICAgICAgICAgIHVuaXF1ZVBlcnNvbnMuYWRkKHBhcnNlZC5wZXJzb25JZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwYXJzZWQub3JnYW5pemF0aW9uKSB7DQogICAgICAgICAgICAgICAgICBvcmdhbml6YXRpb25zLmFkZChwYXJzZWQub3JnYW5pemF0aW9uKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlZC5jb3VudHJ5KSB7DQogICAgICAgICAgICAgICAgICBjb3VudHJpZXMuYWRkKHBhcnNlZC5jb3VudHJ5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKCFlYXJsaWVzdERhdGUgfHwgcGFyc2VkLmRhdGUgPCBlYXJsaWVzdERhdGUpIHsNCiAgICAgICAgICAgICAgICAgIGVhcmxpZXN0RGF0ZSA9IHBhcnNlZC5kYXRlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoIWxhdGVzdERhdGUgfHwgcGFyc2VkLmRhdGUgPiBsYXRlc3REYXRlKSB7DQogICAgICAgICAgICAgICAgICBsYXRlc3REYXRlID0gcGFyc2VkLmRhdGU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBlcnJvcjogZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7DQogICAgICAgICAgICAgICAgZG9tLnVwbG9hZFN0YXR1cy50ZXh0Q29udGVudCA9IGBTYXZlZCBkYXRhc2V0IGNvdWxkIG5vdCBiZSBsb2FkZWQgKCR7bWVzc2FnZX0pLmA7DQogICAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXNzYWdlLnRleHRDb250ZW50ID0gIlN0b3JlZCBkYXRhc2V0IHdhcyBjbGVhcmVkLiBMb2FkIGEgQ1NWIHRvIGNvbnRpbnVlLiI7DQogICAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXRhV3JhcHBlci5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGNsZWFyU3RvcmVkRGF0YXNldCh7IHF1aWV0OiB0cnVlIH0pOw0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICBjb21wbGV0ZTogKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmICghcGFyc2VkUm93cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSAiU2F2ZWQgZGF0YXNldCB3YXMgZW1wdHkgb3IgdW5yZWFkYWJsZS4iOw0KICAgICAgICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXNzYWdlLnRleHRDb250ZW50ID0gIlN0b3JlZCBkYXRhc2V0IHdhcyBjbGVhcmVkLiBMb2FkIGEgQ1NWIHRvIGNvbnRpbnVlLiI7DQogICAgICAgICAgICAgICAgICBkb20uZGF0YXNldE1ldGFXcmFwcGVyLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgICBjbGVhclN0b3JlZERhdGFzZXQoeyBxdWlldDogdHJ1ZSB9KTsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBjb25zdCBydW50aW1lTWV0YSA9IHsNCiAgICAgICAgICAgICAgICAgIG5hbWU6IG1ldGEuc291cmNlTmFtZSB8fCAobWV0YS5zYXZlZE1ldGEgJiYgbWV0YS5zYXZlZE1ldGEubmFtZSkgfHwgIlNhdmVkIGRhdGFzZXQiLA0KICAgICAgICAgICAgICAgICAgc2l6ZTogdHlwZW9mIG1ldGEuc291cmNlU2l6ZSA9PT0gIm51bWJlciIgPyBtZXRhLnNvdXJjZVNpemUgOiBjc3ZUZXh0Lmxlbmd0aCwNCiAgICAgICAgICAgICAgICAgIHJvd3M6IHBhcnNlZFJvd3MubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBtZXRhLnNhdmVkTWV0YT8ubGFzdE1vZGlmaWVkIHx8IG1ldGEubGFzdE1vZGlmaWVkIHx8IG51bGwsDQogICAgICAgICAgICAgICAgICBzYXZlZEF0OiBtZXRhLnNhdmVkTWV0YT8uc2F2ZWRBdCB8fCBudWxsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICByZW1lbWJlckxhc3REYXRhc2V0KGNzdlRleHQsIHJ1bnRpbWVNZXRhKTsKCiAgICAgICAgICAgICAgICBjb25zdCBsb2FkZWRGcm9tU3RvcmFnZSA9IEJvb2xlYW4obWV0YS5sb2FkZWRGcm9tU3RvcmFnZSB8fCBtZXRhLnNhdmVkTWV0YSk7CiAgICAgICAgICAgICAgICBjb25zdCBzYXZlZE1ldGFQYXlsb2FkID0gbG9hZGVkRnJvbVN0b3JhZ2UgJiYgKG1ldGEuc2F2ZWRNZXRhCiAgICAgICAgICAgICAgICAgID8geyAuLi5tZXRhLnNhdmVkTWV0YSwgcm93czogcGFyc2VkUm93cy5sZW5ndGggfQogICAgICAgICAgICAgICAgICA6IHsgbmFtZTogcnVudGltZU1ldGEubmFtZSwgcm93czogcGFyc2VkUm93cy5sZW5ndGgsIHNhdmVkQXQ6IHJ1bnRpbWVNZXRhLnNhdmVkQXQgfSk7CgogICAgICAgICAgICAgICAgZmluYWxpemVQYXJzZWREYXRhc2V0KHsKICAgICAgICAgICAgICAgICAgcGFyc2VkUm93cywKICAgICAgICAgICAgICAgICAgdW5pcXVlUGVyc29ucywKICAgICAgICAgICAgICAgICAgb3JnYW5pemF0aW9ucywKICAgICAgICAgICAgICAgICAgY291bnRyaWVzLAogICAgICAgICAgICAgICAgICBlYXJsaWVzdERhdGUsCiAgICAgICAgICAgICAgICAgIGxhdGVzdERhdGUsCiAgICAgICAgICAgICAgICAgIHNraXBwZWRSb3dzLAogICAgICAgICAgICAgICAgICByb3dFcnJvcnMKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogcnVudGltZU1ldGEubmFtZSwKICAgICAgICAgICAgICAgICAgc291cmNlU2l6ZTogcnVudGltZU1ldGEuc2l6ZSwKICAgICAgICAgICAgICAgICAgbG9hZGVkRnJvbVN0b3JhZ2UsCiAgICAgICAgICAgICAgICAgIHNhdmVkTWV0YTogc2F2ZWRNZXRhUGF5bG9hZCB8fCB1bmRlZmluZWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5wZXJzaXN0RGF0YXNldHMgJiYgIWxvYWRlZEZyb21TdG9yYWdlICYmICFtZXRhLnNraXBQZXJzaXN0ZW5jZSkgewogICAgICAgICAgICAgICAgICBwZXJzaXN0RGF0YXNldChjc3ZUZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgLi4ucnVudGltZU1ldGEsCiAgICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogcnVudGltZU1ldGEubmFtZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoNCiAgICAgICAgICBmdW5jdGlvbiBsb2FkRGF0YXNldEZyb21Mb2NhbFN0b3JhZ2VMZWdhY3koKSB7DQogICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhbFN0b3JhZ2UpIHsNCiAgICAgICAgICAgICAgdXBkYXRlU3RvcmVkRGF0YXNldENvbnRyb2xzKG51bGwpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXN0YXRlLnBlcnNpc3REYXRhc2V0cykgew0KICAgICAgICAgICAgICB1cGRhdGVTdG9yZWREYXRhc2V0Q29udHJvbHMobnVsbCk7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGNvbnN0IHJhdyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKERBVEFfU1RPUkFHRV9LRVkpOw0KICAgICAgICAgICAgICBpZiAoIXJhdykgew0KICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UocmF3KTsNCiAgICAgICAgICAgICAgaWYgKCFwYXlsb2FkIHx8IHR5cGVvZiBwYXlsb2FkICE9PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbGV0IHNhdmVkTWV0YSA9IHBheWxvYWQubWV0YSB8fCB7fTsNCiAgICAgICAgICAgICAgaWYgKCghc2F2ZWRNZXRhIHx8IE9iamVjdC5rZXlzKHNhdmVkTWV0YSkubGVuZ3RoID09PSAwKSAmJiB3aW5kb3cubG9jYWxTdG9yYWdlKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFSYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShEQVRBX1NUT1JBR0VfTUVUQV9LRVkpOw0KICAgICAgICAgICAgICAgICAgaWYgKG1ldGFSYXcpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyc2VkTWV0YSA9IEpTT04ucGFyc2UobWV0YVJhdyk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZWRNZXRhICYmIHR5cGVvZiBwYXJzZWRNZXRhID09PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICAgICAgICAgIHNhdmVkTWV0YSA9IHBhcnNlZE1ldGE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGNhdGNoIChtZXRhRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgZGF0YXNldCBtZXRhZGF0YSIsIG1ldGFFcnJvcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IGhhc01ldGEgPSBzYXZlZE1ldGEgJiYgKHNhdmVkTWV0YS5uYW1lIHx8IHNhdmVkTWV0YS5yb3dzIHx8IHNhdmVkTWV0YS5zaXplKTsKICAgICAgICAgICAgICB1cGRhdGVTdG9yZWREYXRhc2V0Q29udHJvbHMoaGFzTWV0YSA/IHNhdmVkTWV0YSA6IG51bGwpOwogICAgICAgICAgICAgIGNvbnN0IHN0b3JlZENzdiA9IHR5cGVvZiBwYXlsb2FkLmNzdiA9PT0gInN0cmluZyIgPyBwYXlsb2FkLmNzdiA6ICIiOwogICAgICAgICAgICAgIGNvbnN0IGVuY29kaW5nID0gdHlwZW9mIHBheWxvYWQuZW5jb2RpbmcgPT09ICJzdHJpbmciID8gcGF5bG9hZC5lbmNvZGluZyA6ICJwbGFpbiI7CiAgICAgICAgICAgICAgY29uc3QgY3N2VGV4dCA9IGRlY29tcHJlc3NEYXRhc2V0VGV4dChzdG9yZWRDc3YsIGVuY29kaW5nKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNzdlRleHQgPT09ICJzdHJpbmciICYmIGNzdlRleHQudHJpbSgpKSB7CiAgICAgICAgICAgICAgICBpZiAoREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICAgICAgc2F2ZURhdGFzZXRUb0luZGV4ZWREQihjc3ZUZXh0LCBzYXZlZE1ldGEpLnRoZW4obWV0YVVwZGF0ZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc3RvcmVEYXRhc2V0TWV0YShtZXRhVXBkYXRlKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oREFUQV9TVE9SQUdFX0tFWSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBjbGVhciBsZWdhY3kgZGF0YXNldCBjYWNoZSIsIGNsZWFudXBFcnJvcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gbWlncmF0ZSBkYXRhc2V0IHRvIEluZGV4ZWREQiIsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgewogICAgICAgICAgICAgICAgICBkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50ID0gIlJlc3RvcmluZyBzYXZlZCBkYXRhc2V0Li4uIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBhcnNlQ3N2VGV4dENvbnRlbnQoY3N2VGV4dCwgewogICAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzYXZlZE1ldGEubmFtZSB8fCAiU2F2ZWQgZGF0YXNldCIsCiAgICAgICAgICAgICAgICAgIHNvdXJjZVNpemU6IHNhdmVkTWV0YS5zaXplLAogICAgICAgICAgICAgICAgICBzYXZlZE1ldGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gcmVhZCBzYXZlZCBkYXRhc2V0IGZyb20gbG9jYWxTdG9yYWdlIiwgZXJyb3IpOw0KICAgICAgICAgICAgICB1cGRhdGVTdG9yZWREYXRhc2V0Q29udHJvbHMobnVsbCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gbG9hZFN0b3JlZERhdGFzZXRGcm9tRGV2aWNlKCkgewogICAgICAgICAgICBpZiAoIXN0YXRlLnBlcnNpc3REYXRhc2V0cykgewogICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFEQVRBX0RCX1NVUFBPUlRFRCkgew0KICAgICAgICAgICAgICBsb2FkRGF0YXNldEZyb21Mb2NhbFN0b3JhZ2VMZWdhY3koKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbG9hZERhdGFzZXRGcm9tSW5kZXhlZERCKCkudGhlbihyZWNvcmQgPT4gew0KICAgICAgICAgICAgICBpZiAoIXJlY29yZCB8fCAhcmVjb3JkLmNzdikgew0KICAgICAgICAgICAgICAgIGxvYWREYXRhc2V0RnJvbUxvY2FsU3RvcmFnZUxlZ2FjeSgpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBzYXZlZE1ldGEgPSByZWNvcmQubWV0YSB8fCB7fTsNCiAgICAgICAgICAgICAgdXBkYXRlU3RvcmVkRGF0YXNldENvbnRyb2xzKHNhdmVkTWV0YSk7DQogICAgICAgICAgICAgIHN0b3JlRGF0YXNldE1ldGEoc2F2ZWRNZXRhKTsNCiAgICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgICBkb20udXBsb2FkU3RhdHVzLnRleHRDb250ZW50ID0gIlJlc3RvcmluZyBzYXZlZCBkYXRhc2V0Li4uIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBwYXJzZUNzdlRleHRDb250ZW50KHJlY29yZC5jc3YsIHsNCiAgICAgICAgICAgICAgICBzb3VyY2VOYW1lOiBzYXZlZE1ldGEubmFtZSB8fCAiU2F2ZWQgZGF0YXNldCIsDQogICAgICAgICAgICAgICAgc291cmNlU2l6ZTogc2F2ZWRNZXRhLnNpemUsDQogICAgICAgICAgICAgICAgc2F2ZWRNZXRhDQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byByZWFkIHNhdmVkIGRhdGFzZXQgZnJvbSBJbmRleGVkREIiLCBlcnJvcik7CiAgICAgICAgICAgICAgbG9hZERhdGFzZXRGcm9tTG9jYWxTdG9yYWdlTGVnYWN5KCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGxvYWRTdG9yZWRBZ2VudEh1YkRhdGFzZXRzRnJvbURldmljZSgpIHsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5wZXJzaXN0RGF0YXNldHMpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYXBwbHlTbmFwc2hvdCA9IHNuYXBzaG90ID0+IHsKICAgICAgICAgICAgICBpZiAoc25hcHNob3QgJiYgdHlwZW9mIHNuYXBzaG90ID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgYXBwbHlBZ2VudEh1YlNuYXBzaG90KHNuYXBzaG90LCB7IHN0YXR1c1ByZWZpeDogIlJlc3RvcmVkIiB9KTsKICAgICAgICAgICAgICAgIGlmIChEQVRBX0RCX1NVUFBPUlRFRCkgewogICAgICAgICAgICAgICAgICBwZXJzaXN0QWdlbnRIdWJTbmFwc2hvdFRvTG9jYWxTdG9yYWdlKHNuYXBzaG90KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNvbnN0IGxvYWRGcm9tTG9jYWxTdG9yYWdlID0gKCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gbG9hZEFnZW50SHViU25hcHNob3RGcm9tTG9jYWxTdG9yYWdlKCk7CiAgICAgICAgICAgICAgYXBwbHlTbmFwc2hvdChzbmFwc2hvdCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICghREFUQV9EQl9TVVBQT1JURUQpIHsKICAgICAgICAgICAgICBsb2FkRnJvbUxvY2FsU3RvcmFnZSgpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2FkQWdlbnRIdWJTbmFwc2hvdEZyb21JbmRleGVkREIoKS50aGVuKHNuYXBzaG90ID0+IHsKICAgICAgICAgICAgICBpZiAoIWFwcGx5U25hcHNob3Qoc25hcHNob3QpKSB7CiAgICAgICAgICAgICAgICBsb2FkRnJvbUxvY2FsU3RvcmFnZSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgYWdlbnQgaHViIGRhdGFzZXRzIGZyb20gSW5kZXhlZERCIiwgZXJyb3IpOwogICAgICAgICAgICAgIGxvYWRGcm9tTG9jYWxTdG9yYWdlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzQ29waWxvdERhdGFzZXRGaWxlKGZpbGUpIHsNCiAgICAgICAgICAgIGlmICghZmlsZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBzaXplSW5NYiA9IE51bWJlci5pc0Zpbml0ZShmaWxlLnNpemUpID8gKGZpbGUuc2l6ZSAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMSkgOiBudWxsOw0KICAgICAgICAgICAgaWYgKGRvbS51cGxvYWRNZXRhKSB7DQogICAgICAgICAgICAgIGlmIChmaWxlLm5hbWUgJiYgc2l6ZUluTWIpIHsNCiAgICAgICAgICAgICAgICBkb20udXBsb2FkTWV0YS50ZXh0Q29udGVudCA9IGAke3Nob3J0ZW5MYWJlbChmaWxlLm5hbWUpfSR7QlVMTEVUX1NFUEFSQVRPUn0ke3NpemVJbk1ifSBNQmA7DQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZS5uYW1lKSB7DQogICAgICAgICAgICAgICAgZG9tLnVwbG9hZE1ldGEudGV4dENvbnRlbnQgPSBzaG9ydGVuTGFiZWwoZmlsZS5uYW1lKTsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzaXplSW5NYikgew0KICAgICAgICAgICAgICAgIGRvbS51cGxvYWRNZXRhLnRleHRDb250ZW50ID0gYCR7c2l6ZUluTWJ9IE1CYDsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkb20udXBsb2FkTWV0YS50ZXh0Q29udGVudCA9ICIiOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNsZWFyVXBsb2FkRXJyb3IoKTsNCiAgICAgICAgICAgIHN0YXJ0VXBsb2FkUHJvZ3Jlc3MoZmlsZSk7DQoNCiAgICAgICAgICAgIGN1cnJlbnRDc3ZGaWVsZExvb2t1cCA9IG51bGw7DQogICAgICAgICAgICBjb25zdCBjb250cm9sbGVyID0gew0KICAgICAgICAgICAgICBmaWxlLA0KICAgICAgICAgICAgICBmaWxlU2l6ZTogTnVtYmVyLmlzRmluaXRlKGZpbGUuc2l6ZSkgPyBmaWxlLnNpemUgOiAwLA0KICAgICAgICAgICAgICByb3dzUHJvY2Vzc2VkOiAwLA0KICAgICAgICAgICAgICBhYm9ydGVkOiBmYWxzZSwNCiAgICAgICAgICAgICAgcGFyc2VyOiBudWxsLA0KICAgICAgICAgICAgICBzaWxlbnRBYm9ydDogZmFsc2UNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBzZXRBY3RpdmVQYXJzZUNvbnRyb2xsZXIoY29udHJvbGxlcik7DQoNCiAgICAgICAgICAgIGNvbnN0IGFjY3VtdWxhdG9ycyA9IHsNCiAgICAgICAgICAgICAgcGFyc2VkUm93czogW10sDQogICAgICAgICAgICAgIHVuaXF1ZVBlcnNvbnM6IG5ldyBTZXQoKSwNCiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uczogbmV3IFNldCgpLA0KICAgICAgICAgICAgICBjb3VudHJpZXM6IG5ldyBTZXQoKSwNCiAgICAgICAgICAgICAgZWFybGllc3REYXRlOiBudWxsLA0KICAgICAgICAgICAgICBsYXRlc3REYXRlOiBudWxsLA0KICAgICAgICAgICAgICBza2lwcGVkUm93czogMCwNCiAgICAgICAgICAgICAgcm93RXJyb3JzOiAwDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCByZXNldEFjY3VtdWxhdG9ycyA9ICgpID0+IHsNCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLnBhcnNlZFJvd3MubGVuZ3RoID0gMDsNCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLnVuaXF1ZVBlcnNvbnMuY2xlYXIoKTsNCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLm9yZ2FuaXphdGlvbnMuY2xlYXIoKTsNCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLmNvdW50cmllcy5jbGVhcigpOw0KICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMuZWFybGllc3REYXRlID0gbnVsbDsNCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLmxhdGVzdERhdGUgPSBudWxsOw0KICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMuc2tpcHBlZFJvd3MgPSAwOw0KICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMucm93RXJyb3JzID0gMDsNCiAgICAgICAgICAgICAgY29udHJvbGxlci5yb3dzUHJvY2Vzc2VkID0gMDsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3NSb3cgPSByYXcgPT4gew0KICAgICAgICAgICAgICBpZiAoIXJhdyB8fCAodHlwZW9mIHJhdyA9PT0gIm9iamVjdCIgJiYgT2JqZWN0LmtleXMocmF3KS5sZW5ndGggPT09IDApKSB7DQogICAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLnNraXBwZWRSb3dzICs9IDE7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGVuc3VyZURhdGFzZXRGaWVsZExvb2t1cChudWxsLCByYXcpOw0KICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSB0cmFuc2Zvcm1Sb3cocmF3KTsNCiAgICAgICAgICAgICAgaWYgKCFwYXJzZWQpIHsNCiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMuc2tpcHBlZFJvd3MgKz0gMTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLnBhcnNlZFJvd3MucHVzaChwYXJzZWQpOw0KICAgICAgICAgICAgICBpZiAocGFyc2VkLnRvdGFsQWN0aW9ucyA+IDAgfHwgcGFyc2VkLmFzc2lzdGVkSG91cnMgPiAwKSB7DQogICAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLnVuaXF1ZVBlcnNvbnMuYWRkKHBhcnNlZC5wZXJzb25JZCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHBhcnNlZC5vcmdhbml6YXRpb24pIHsNCiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMub3JnYW5pemF0aW9ucy5hZGQocGFyc2VkLm9yZ2FuaXphdGlvbik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHBhcnNlZC5jb3VudHJ5KSB7DQogICAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLmNvdW50cmllcy5hZGQocGFyc2VkLmNvdW50cnkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmICghYWNjdW11bGF0b3JzLmVhcmxpZXN0RGF0ZSB8fCBwYXJzZWQuZGF0ZSA8IGFjY3VtdWxhdG9ycy5lYXJsaWVzdERhdGUpIHsNCiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvcnMuZWFybGllc3REYXRlID0gcGFyc2VkLmRhdGU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFhY2N1bXVsYXRvcnMubGF0ZXN0RGF0ZSB8fCBwYXJzZWQuZGF0ZSA+IGFjY3VtdWxhdG9ycy5sYXRlc3REYXRlKSB7DQogICAgICAgICAgICAgICAgYWNjdW11bGF0b3JzLmxhdGVzdERhdGUgPSBwYXJzZWQuZGF0ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgY29uc3QgZmluYWxpemVTdWNjZXNzID0gKCkgPT4gew0KICAgICAgICAgICAgICBzZXRBY3RpdmVQYXJzZUNvbnRyb2xsZXIobnVsbCk7DQogICAgICAgICAgICAgIGZpbmlzaFVwbG9hZFByb2dyZXNzKG51bGwpOw0KICAgICAgICAgICAgICBpZiAoIWFjY3VtdWxhdG9ycy5wYXJzZWRSb3dzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIHNob3dVcGxvYWRFcnJvcigiTm8gdmFsaWQgcm93cyB3ZXJlIGZvdW5kIGluIHRoZSBmaWxlLiIpOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBydW50aW1lTWV0YSA9IHsNCiAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsDQogICAgICAgICAgICAgICAgc2l6ZTogY29udHJvbGxlci5maWxlU2l6ZSwNCiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGZpbGUubGFzdE1vZGlmaWVkLA0KICAgICAgICAgICAgICAgIHJvd3M6IGFjY3VtdWxhdG9ycy5wYXJzZWRSb3dzLmxlbmd0aA0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICBmaW5hbGl6ZVBhcnNlZERhdGFzZXQoew0KICAgICAgICAgICAgICAgIHBhcnNlZFJvd3M6IGFjY3VtdWxhdG9ycy5wYXJzZWRSb3dzLA0KICAgICAgICAgICAgICAgIHVuaXF1ZVBlcnNvbnM6IGFjY3VtdWxhdG9ycy51bmlxdWVQZXJzb25zLA0KICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbnM6IGFjY3VtdWxhdG9ycy5vcmdhbml6YXRpb25zLA0KICAgICAgICAgICAgICAgIGNvdW50cmllczogYWNjdW11bGF0b3JzLmNvdW50cmllcywNCiAgICAgICAgICAgICAgICBlYXJsaWVzdERhdGU6IGFjY3VtdWxhdG9ycy5lYXJsaWVzdERhdGUsDQogICAgICAgICAgICAgICAgbGF0ZXN0RGF0ZTogYWNjdW11bGF0b3JzLmxhdGVzdERhdGUsDQogICAgICAgICAgICAgICAgc2tpcHBlZFJvd3M6IGFjY3VtdWxhdG9ycy5za2lwcGVkUm93cywNCiAgICAgICAgICAgICAgICByb3dFcnJvcnM6IGFjY3VtdWxhdG9ycy5yb3dFcnJvcnMNCiAgICAgICAgICAgICAgfSwgew0KICAgICAgICAgICAgICAgIHNvdXJjZU5hbWU6IGZpbGUubmFtZSwNCiAgICAgICAgICAgICAgICBzb3VyY2VTaXplOiBjb250cm9sbGVyLmZpbGVTaXplLA0KICAgICAgICAgICAgICAgIHJvd3M6IGFjY3VtdWxhdG9ycy5wYXJzZWRSb3dzLmxlbmd0aA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgc3RhdGUuZGF0YXNldFNpemVCeXRlcyA9IHJ1bnRpbWVNZXRhLnNpemU7DQogICAgICAgICAgICAgIHN0YXRlLmRhdGFzZXRDYWNoaW5nRGlzYWJsZWQgPSBkYXRhc2V0RXhjZWVkc0NhY2hlTGltaXQocnVudGltZU1ldGEuc2l6ZSk7DQogICAgICAgICAgICAgIGlmIChzdGF0ZS5kYXRhc2V0Q2FjaGluZ0Rpc2FibGVkKSB7DQogICAgICAgICAgICAgICAgYnVmZmVyZWRDc3ZUZXh0ID0gbnVsbDsNCiAgICAgICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgew0KICAgICAgICAgICAgICAgICAgZG9tLnVwbG9hZFN0YXR1cy50ZXh0Q29udGVudCA9IGBEYXRhc2V0IGxvYWRlZCAoJHtmb3JtYXRGaWxlU2l6ZShydW50aW1lTWV0YS5zaXplKX0pLiAke2dldERhdGFzZXRDYWNoZUxpbWl0TWVzc2FnZSgpfWA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3JlZERhdGFzZXRDb250cm9scyhudWxsKTsNCiAgICAgICAgICAgICAgICB1cGRhdGVTbmFwc2hvdENvbnRyb2xzQXZhaWxhYmlsaXR5KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGVuc3VyZUJ1ZmZlcmVkQ3N2VGV4dChydW50aW1lTWV0YSk7DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCBlbnN1cmVCdWZmZXJlZENzdlRleHQgPSBydW50aW1lTWV0YSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHJlbWVtYmVyQW5kUGVyc2lzdCA9IGNzdlRleHQgPT4gew0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3N2VGV4dCAhPT0gInN0cmluZyIgfHwgIWNzdlRleHQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICBjbGVhclJlbWVtYmVyZWREYXRhc2V0KCk7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJ1ZmZlcmVkQ3N2VGV4dCA9IGNzdlRleHQ7DQogICAgICAgICAgICAgICAgcmVtZW1iZXJMYXN0RGF0YXNldChjc3ZUZXh0LCBydW50aW1lTWV0YSk7DQogICAgICAgICAgICAgICAgcGVyc2lzdERhdGFzZXQoY3N2VGV4dCwgcnVudGltZU1ldGEpOw0KICAgICAgICAgICAgICAgIGJ1ZmZlcmVkQ3N2VGV4dCA9IG51bGw7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIGlmIChidWZmZXJlZENzdlRleHQpIHsNCiAgICAgICAgICAgICAgICByZW1lbWJlckFuZFBlcnNpc3QoYnVmZmVyZWRDc3ZUZXh0KTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFmaWxlIHx8IHR5cGVvZiBmaWxlLnRleHQgIT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICBidWZmZXJlZENzdlRleHQgPSBudWxsOw0KICAgICAgICAgICAgICAgIGNsZWFyUmVtZW1iZXJlZERhdGFzZXQoKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZmlsZS50ZXh0KCkudGhlbihyZW1lbWJlckFuZFBlcnNpc3QpLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICBidWZmZXJlZENzdlRleHQgPSBudWxsOw0KICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIGJ1ZmZlciBkYXRhc2V0IHRleHQiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgY2xlYXJSZW1lbWJlcmVkRGF0YXNldCgpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGNvbnN0IGZpbmlzaFdpdGhFcnJvciA9IG1lc3NhZ2UgPT4gew0KICAgICAgICAgICAgICBzZXRBY3RpdmVQYXJzZUNvbnRyb2xsZXIobnVsbCk7DQogICAgICAgICAgICAgIGN1cnJlbnRDc3ZGaWVsZExvb2t1cCA9IG51bGw7DQogICAgICAgICAgICAgIGlmIChtZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgc2hvd1VwbG9hZEVycm9yKG1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHNob3dVcGxvYWRFcnJvcigiUGFyc2luZyBmYWlsZWQuIENvbmZpcm0gdGhlIENTViBleHBvcnQgZm9ybWF0LiIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBjb25zdCBydW5QYXJzZSA9IChzb3VyY2UsIHBhcnNlRGVsaW1pdGVyKSA9PiB7DQogICAgICAgICAgICAgIGxldCByb3dzU2luY2VQcm9ncmVzc1VwZGF0ZSA9IDA7DQogICAgICAgICAgICAgIGxldCBwZW5kaW5nUHJvZ3Jlc3MgPSBudWxsOw0KICAgICAgICAgICAgICBsZXQgcHJvZ3Jlc3NGcmFtZSA9IG51bGw7DQogICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZURlbGltaXRlciA9IHBhcnNlRGVsaW1pdGVyIHx8ICIiOw0KICAgICAgICAgICAgICBjb25zdCBzY2hlZHVsZUZyYW1lID0gdHlwZW9mIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9PT0gImZ1bmN0aW9uIg0KICAgICAgICAgICAgICAgID8gcmVxdWVzdEFuaW1hdGlvbkZyYW1lDQogICAgICAgICAgICAgICAgOiBjYWxsYmFjayA9PiBzZXRUaW1lb3V0KGNhbGxiYWNrLCAxNik7DQogICAgICAgICAgICAgIGNvbnN0IGNhbmNlbEZyYW1lID0gdHlwZW9mIGNhbmNlbEFuaW1hdGlvbkZyYW1lID09PSAiZnVuY3Rpb24iDQogICAgICAgICAgICAgICAgPyBjYW5jZWxBbmltYXRpb25GcmFtZQ0KICAgICAgICAgICAgICAgIDogY2xlYXJUaW1lb3V0Ow0KICAgICAgICAgICAgICBjb25zdCBxdWV1ZVByb2dyZXNzVXBkYXRlID0gcHJvZ3Jlc3MgPT4gew0KICAgICAgICAgICAgICAgIHBlbmRpbmdQcm9ncmVzcyA9IHByb2dyZXNzOw0KICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc0ZyYW1lICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcHJvZ3Jlc3NGcmFtZSA9IHNjaGVkdWxlRnJhbWUoKCkgPT4gew0KICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NGcmFtZSA9IG51bGw7DQogICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ1Byb2dyZXNzKSB7DQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVVwbG9hZFByb2dyZXNzKHBlbmRpbmdQcm9ncmVzcyk7DQogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdQcm9ncmVzcyA9IG51bGw7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIGNvbnN0IGZsdXNoUHJvZ3Jlc3NVcGRhdGVzID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIGlmIChwcm9ncmVzc0ZyYW1lICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgIGNhbmNlbEZyYW1lKHByb2dyZXNzRnJhbWUpOw0KICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NGcmFtZSA9IG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nUHJvZ3Jlc3MpIHsNCiAgICAgICAgICAgICAgICAgIHVwZGF0ZVVwbG9hZFByb2dyZXNzKHBlbmRpbmdQcm9ncmVzcyk7DQogICAgICAgICAgICAgICAgICBwZW5kaW5nUHJvZ3Jlc3MgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgUGFwYS5wYXJzZShzb3VyY2UsIHsNCiAgICAgICAgICAgICAgICBoZWFkZXI6IHRydWUsDQogICAgICAgICAgICAgICAgc2tpcEVtcHR5TGluZXM6ICJncmVlZHkiLA0KICAgICAgICAgICAgICAgIGRlbGltaXRlcjogZWZmZWN0aXZlRGVsaW1pdGVyLA0KICAgICAgICAgICAgICAgIHdvcmtlcjogdHJ1ZSwNCiAgICAgICAgICAgICAgICBjaHVua1NpemU6IDUyNDI4OCwNCiAgICAgICAgICAgICAgICBjaHVuazogKHJlc3VsdHMsIHBhcnNlcikgPT4gew0KICAgICAgICAgICAgICAgICAgY29udHJvbGxlci5wYXJzZXIgPSBwYXJzZXI7DQogICAgICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci5hYm9ydGVkKSB7DQogICAgICAgICAgICAgICAgICAgIHBhcnNlci5hYm9ydCgpOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXN1bHRzLmVycm9ycykgJiYgcmVzdWx0cy5lcnJvcnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgIGFjY3VtdWxhdG9ycy5yb3dFcnJvcnMgKz0gcmVzdWx0cy5lcnJvcnMubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IEFycmF5LmlzQXJyYXkocmVzdWx0cy5kYXRhKSA/IHJlc3VsdHMuZGF0YSA6IFtyZXN1bHRzLmRhdGFdOw0KICAgICAgICAgICAgICAgICAgZW5zdXJlRGF0YXNldEZpZWxkTG9va3VwKHJlc3VsdHM/Lm1ldGE/LmZpZWxkcywgcm93c1swXSk7DQogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcm93cy5sZW5ndGg7IGluZGV4ICs9IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Jvdyhyb3dzW2luZGV4XSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnJvd3NQcm9jZXNzZWQgKz0gcm93cy5sZW5ndGg7DQogICAgICAgICAgICAgICAgICByb3dzU2luY2VQcm9ncmVzc1VwZGF0ZSArPSByb3dzLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLnJvd3NQcm9jZXNzZWQgPD0gNTAgfHwgcm93c1NpbmNlUHJvZ3Jlc3NVcGRhdGUgPj0gNDAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJvd3NTaW5jZVByb2dyZXNzVXBkYXRlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3Vyc29yID0gcmVzdWx0cyAmJiByZXN1bHRzLm1ldGEgPyBOdW1iZXIocmVzdWx0cy5tZXRhLmN1cnNvcikgOiBudWxsOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gY29tcHV0ZVBlcmNlbnQoY3Vyc29yLCBjb250cm9sbGVyLmZpbGVTaXplKTsNCiAgICAgICAgICAgICAgICAgICAgcXVldWVQcm9ncmVzc1VwZGF0ZSh7IHBlcmNlbnQsIHJvd3NQcm9jZXNzZWQ6IGNvbnRyb2xsZXIucm93c1Byb2Nlc3NlZCB9KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvciA9PiB7DQogICAgICAgICAgICAgICAgICBmbHVzaFByb2dyZXNzVXBkYXRlcygpOw0KICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIuYWJvcnRlZCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgJiYgZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IgfHwgIlVua25vd24gZXJyb3IiKTsNCiAgICAgICAgICAgICAgICAgIGZpbmlzaFdpdGhFcnJvcihgUGFyc2luZyBmYWlsZWQ6ICR7bWVzc2FnZX1gKTsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7DQogICAgICAgICAgICAgICAgICBmbHVzaFByb2dyZXNzVXBkYXRlcygpOw0KICAgICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIuYWJvcnRlZCkgew0KICAgICAgICAgICAgICAgICAgICBmaW5pc2hVcGxvYWRQcm9ncmVzcyhjb250cm9sbGVyLnNpbGVudEFib3J0ID8gbnVsbCA6ICJJbXBvcnQgY2FuY2VsZWQuIik7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLnJvd3NQcm9jZXNzZWQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHVwZGF0ZVVwbG9hZFByb2dyZXNzKHsgcGVyY2VudDogMTAwLCByb3dzUHJvY2Vzc2VkOiBjb250cm9sbGVyLnJvd3NQcm9jZXNzZWQgfSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnBhcnNlciA9IG51bGw7DQogICAgICAgICAgICAgICAgICBmaW5hbGl6ZVN1Y2Nlc3MoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgcmVzZXRBY2N1bXVsYXRvcnMoKTsNCiAgICAgICAgICAgIGJ1ZmZlcmVkQ3N2VGV4dCA9IG51bGw7DQogICAgICAgICAgICBjb250cm9sbGVyLmZpbGVTaXplID0gTnVtYmVyLmlzRmluaXRlKGZpbGUuc2l6ZSkgPyBmaWxlLnNpemUgOiAwOw0KDQogICAgICAgICAgICBjb25zdCBiZWdpblBhcnNpbmcgPSBkZWxpbWl0ZXIgPT4gew0KICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci5hYm9ydGVkKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcnVuUGFyc2UoZmlsZSwgZGVsaW1pdGVyKTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgJiYgZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IgfHwgIlVua25vd24gZXJyb3IiKTsNCiAgICAgICAgICAgICAgICBmaW5pc2hXaXRoRXJyb3IoYFVuYWJsZSB0byByZWFkIGZpbGU6ICR7bWVzc2FnZX1gKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgZGV0ZWN0RGVsaW1pdGVyRm9yRmlsZShmaWxlKS50aGVuKGJlZ2luUGFyc2luZykuY2F0Y2goKCkgPT4gYmVnaW5QYXJzaW5nKCIiKSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbG9hZFNhbXBsZURhdGFzZXQoKSB7CiAgICAgICAgICAgIGNsZWFyVXBsb2FkRXJyb3IoKTsKICAgICAgICAgICAgY2FuY2VsQWN0aXZlUGFyc2UoeyBzaWxlbnQ6IHRydWUgfSk7CiAgICAgICAgICAgIGlmIChkb20udXBsb2FkTWV0YSkgewogICAgICAgICAgICAgIGRvbS51cGxvYWRNZXRhLnRleHRDb250ZW50ID0gIlNhbXBsZSBkYXRhc2V0IjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9tLnVwbG9hZFN0YXR1cykgewogICAgICAgICAgICAgIGRvbS51cGxvYWRTdGF0dXMudGV4dENvbnRlbnQgPSAiTG9hZGluZyBzYW1wbGUgZGF0YXNldC4uLiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHBhcnNlU2FtcGxlID0gKGNzdlRleHQsIGxhYmVsID0gIlNhbXBsZSBkYXRhc2V0IikgPT4gewogICAgICAgICAgICBpZiAoIWNzdlRleHQpIHsKICAgICAgICAgICAgICBzaG93VXBsb2FkRXJyb3IoIlNhbXBsZSBkYXRhc2V0IGlzIHVuYXZhaWxhYmxlLiIpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5pc2hVcGxvYWRQcm9ncmVzcyhudWxsKTsKICAgICAgICAgICAgcGFyc2VDc3ZUZXh0Q29udGVudChjc3ZUZXh0LCB7CiAgICAgICAgICAgICAgc291cmNlTmFtZTogbGFiZWwsCiAgICAgICAgICAgICAgc291cmNlU2l6ZTogY3N2VGV4dC5sZW5ndGgsCiAgICAgICAgICAgICAgc2tpcFBlcnNpc3RlbmNlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgdXNlSW5saW5lU2FtcGxlID0gKCkgPT4gewogICAgICAgICAgICAgIGlmICh0eXBlb2YgU0FNUExFX0RBVEFTRVRfSU5MSU5FID09PSAic3RyaW5nIiAmJiBTQU1QTEVfREFUQVNFVF9JTkxJTkUudHJpbSgpLmxlbmd0aCkgewogICAgICAgICAgICAgICAgYnVmZmVyZWRTYW1wbGVDc3YgPSBTQU1QTEVfREFUQVNFVF9JTkxJTkU7CiAgICAgICAgICAgICAgICBwYXJzZVNhbXBsZShTQU1QTEVfREFUQVNFVF9JTkxJTkUsICJCdWlsdC1pbiBzYW1wbGUgZGF0YXNldCIpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKGJ1ZmZlcmVkU2FtcGxlQ3N2KSB7CiAgICAgICAgICAgICAgcGFyc2VTYW1wbGUoYnVmZmVyZWRTYW1wbGVDc3YpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGFydFVwbG9hZFByb2dyZXNzKHsgbmFtZTogIlNhbXBsZSBkYXRhc2V0IiB9KTsKICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgPT09ICJmaWxlOiIpIHsKICAgICAgICAgICAgICBpZiAoIXVzZUlubGluZVNhbXBsZSgpKSB7CiAgICAgICAgICAgICAgICBmaW5pc2hVcGxvYWRQcm9ncmVzcyhudWxsKTsKICAgICAgICAgICAgICAgIHNob3dVcGxvYWRFcnJvcigiU2FtcGxlIGRhdGFzZXQgaXMgdW5hdmFpbGFibGUgaW4gb2ZmbGluZSBtb2RlLiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmV0Y2goU0FNUExFX0RBVEFTRVRfVVJMLCB7IGNhY2hlOiAibm8tc3RvcmUiIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTsKICAgICAgICAgICAgfSkudGhlbihjc3ZUZXh0ID0+IHsKICAgICAgICAgICAgICBidWZmZXJlZFNhbXBsZUNzdiA9IGNzdlRleHQ7CiAgICAgICAgICAgICAgcGFyc2VTYW1wbGUoY3N2VGV4dCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgICBmaW5pc2hVcGxvYWRQcm9ncmVzcyhudWxsKTsKICAgICAgICAgICAgICBpZiAoIXVzZUlubGluZVNhbXBsZSgpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgJiYgZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IgfHwgIlVua25vd24gZXJyb3IiKTsKICAgICAgICAgICAgICAgIHNob3dVcGxvYWRFcnJvcihgVW5hYmxlIHRvIGxvYWQgc2FtcGxlIGRhdGFzZXQgKCR7bWVzc2FnZX0pLmApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGxvYWRTdG9yZWRGaWx0ZXJQcmVmZXJlbmNlcygpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmF3ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oRklMVEVSX1BSRUZFUkVOQ0VTX0tFWSk7DQogICAgICAgICAgICAgICAgaWYgKCFyYXcpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHJhdyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlZCAmJiB0eXBlb2YgcGFyc2VkID09PSAib2JqZWN0IiA/IHBhcnNlZCA6IG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgc3RvcmVkIGZpbHRlciBwcmVmZXJlbmNlcyIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHBlcnNpc3RGaWx0ZXJQcmVmZXJlbmNlcygpIHsNCiAgICAgICAgICAgIGlmICghc3RhdGUucm93cyB8fCAhc3RhdGUucm93cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcHJlZmVyZW5jZXMgPSB7DQogICAgICAgICAgICAgIG9yZ2FuaXphdGlvbjogQXJyYXkuZnJvbShzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbiB8fCBbXSksDQogICAgICAgICAgICAgIGNvdW50cnk6IEFycmF5LmZyb20oc3RhdGUuZmlsdGVycy5jb3VudHJ5IHx8IFtdKSwNCiAgICAgICAgICAgICAgdGltZWZyYW1lOiBzdGF0ZS5maWx0ZXJzLnRpbWVmcmFtZSwNCiAgICAgICAgICAgICAgY3VzdG9tU3RhcnQ6IHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQgPyB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQpIDogbnVsbCwNCiAgICAgICAgICAgICAgY3VzdG9tRW5kOiBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCA/IHRvRGF0ZUlucHV0VmFsdWUoc3RhdGUuZmlsdGVycy5jdXN0b21FbmQpIDogbnVsbCwNCiAgICAgICAgICAgICAgYWdncmVnYXRlOiBzdGF0ZS5maWx0ZXJzLmFnZ3JlZ2F0ZSwNCiAgICAgICAgICAgICAgbWV0cmljOiBzdGF0ZS5maWx0ZXJzLm1ldHJpYywNCiAgICAgICAgICAgICAgZ3JvdXA6IHN0YXRlLmZpbHRlcnMuZ3JvdXANCiAgICAgICAgICAgIH07DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSkgew0KICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKEZJTFRFUl9QUkVGRVJFTkNFU19LRVksIEpTT04uc3RyaW5naWZ5KHByZWZlcmVuY2VzKSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHBlcnNpc3QgZmlsdGVyIHByZWZlcmVuY2VzIiwgZXJyb3IpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGFwcGx5U3RvcmVkRmlsdGVyUHJlZmVyZW5jZXMocHJlZmVyZW5jZXMpIHsNCiAgICAgICAgICAgIGlmICghcHJlZmVyZW5jZXMgfHwgdHlwZW9mIHByZWZlcmVuY2VzICE9PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQgYXBwbGllZCA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwcmVmZXJlbmNlcy5vcmdhbml6YXRpb24pKSB7DQogICAgICAgICAgICAgIGNvbnN0IHZhbGlkT3JnYW5pemF0aW9ucyA9IGRvbS5vcmdhbml6YXRpb25GaWx0ZXINCiAgICAgICAgICAgICAgICA/IG5ldyBTZXQoQXJyYXkuZnJvbShkb20ub3JnYW5pemF0aW9uRmlsdGVyLm9wdGlvbnMpLm1hcChvcHRpb24gPT4gb3B0aW9uLnZhbHVlKS5maWx0ZXIodmFsdWUgPT4gdmFsdWUgIT09ICJhbGwiKSkNCiAgICAgICAgICAgICAgICA6IG51bGw7DQogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvblZhbHVlcyA9IHByZWZlcmVuY2VzLm9yZ2FuaXphdGlvbi5maWx0ZXIodmFsdWUgPT4gIXZhbGlkT3JnYW5pemF0aW9ucyB8fCB2YWxpZE9yZ2FuaXphdGlvbnMuaGFzKHZhbHVlKSk7DQogICAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMub3JnYW5pemF0aW9uID0gbmV3IFNldChvcmdhbml6YXRpb25WYWx1ZXMpOw0KICAgICAgICAgICAgICBzeW5jTXVsdGlTZWxlY3QoZG9tLm9yZ2FuaXphdGlvbkZpbHRlciwgc3RhdGUuZmlsdGVycy5vcmdhbml6YXRpb24pOw0KICAgICAgICAgICAgICBhcHBsaWVkID0gYXBwbGllZCB8fCBzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbi5zaXplID4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHByZWZlcmVuY2VzLmNvdW50cnkpKSB7DQogICAgICAgICAgICAgIGNvbnN0IHZhbGlkQ291bnRyaWVzID0gZG9tLmNvdW50cnlGaWx0ZXINCiAgICAgICAgICAgICAgICA/IG5ldyBTZXQoQXJyYXkuZnJvbShkb20uY291bnRyeUZpbHRlci5vcHRpb25zKS5tYXAob3B0aW9uID0+IG9wdGlvbi52YWx1ZSkuZmlsdGVyKHZhbHVlID0+IHZhbHVlICE9PSAiYWxsIikpDQogICAgICAgICAgICAgICAgOiBudWxsOw0KICAgICAgICAgICAgICBjb25zdCBjb3VudHJ5VmFsdWVzID0gcHJlZmVyZW5jZXMuY291bnRyeS5maWx0ZXIodmFsdWUgPT4gIXZhbGlkQ291bnRyaWVzIHx8IHZhbGlkQ291bnRyaWVzLmhhcyh2YWx1ZSkpOw0KICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmNvdW50cnkgPSBuZXcgU2V0KGNvdW50cnlWYWx1ZXMpOw0KICAgICAgICAgICAgICBzeW5jTXVsdGlTZWxlY3QoZG9tLmNvdW50cnlGaWx0ZXIsIHN0YXRlLmZpbHRlcnMuY291bnRyeSk7DQogICAgICAgICAgICAgIGFwcGxpZWQgPSBhcHBsaWVkIHx8IHN0YXRlLmZpbHRlcnMuY291bnRyeS5zaXplID4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2YgcHJlZmVyZW5jZXMudGltZWZyYW1lID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICBkb20udGltZWZyYW1lRmlsdGVyLnZhbHVlID0gcHJlZmVyZW5jZXMudGltZWZyYW1lOw0KICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLnRpbWVmcmFtZSA9IHByZWZlcmVuY2VzLnRpbWVmcmFtZTsNCiAgICAgICAgICAgICAgYXBwbGllZCA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIHByZWZlcmVuY2VzLmFnZ3JlZ2F0ZSA9PT0gInN0cmluZyIpIHsNCiAgICAgICAgICAgICAgZG9tLmFnZ3JlZ2F0ZUZpbHRlci52YWx1ZSA9IHByZWZlcmVuY2VzLmFnZ3JlZ2F0ZTsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGUgPSBwcmVmZXJlbmNlcy5hZ2dyZWdhdGU7DQogICAgICAgICAgICAgIGFwcGxpZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBwcmVmZXJlbmNlcy5tZXRyaWMgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIGRvbS5tZXRyaWNGaWx0ZXIudmFsdWUgPSBwcmVmZXJlbmNlcy5tZXRyaWM7DQogICAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMubWV0cmljID0gcHJlZmVyZW5jZXMubWV0cmljOw0KICAgICAgICAgICAgICBhcHBsaWVkID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2YgcHJlZmVyZW5jZXMuZ3JvdXAgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgIGRvbS5ncm91cEZpbHRlci52YWx1ZSA9IHByZWZlcmVuY2VzLmdyb3VwOw0KICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmdyb3VwID0gcHJlZmVyZW5jZXMuZ3JvdXA7DQogICAgICAgICAgICAgIGFwcGxpZWQgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVycy50aW1lZnJhbWUgPT09ICJjdXN0b20iKSB7DQogICAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gcGFyc2VEYXRlSW5wdXRWYWx1ZShwcmVmZXJlbmNlcy5jdXN0b21TdGFydCk7DQogICAgICAgICAgICAgIGNvbnN0IGVuZCA9IHBhcnNlRGF0ZUlucHV0VmFsdWUocHJlZmVyZW5jZXMuY3VzdG9tRW5kKTsNCiAgICAgICAgICAgICAgaWYgKHN0YXJ0ICYmIGVuZCkgew0KICAgICAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQgPSBzdGFydDsNCiAgICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCA9IGVuZDsNCiAgICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbVJhbmdlSW52YWxpZCA9IHN0YXJ0ID4gZW5kOw0KICAgICAgICAgICAgICAgIGlmIChkb20uY3VzdG9tUmFuZ2VTdGFydCkgew0KICAgICAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQudmFsdWUgPSBwcmVmZXJlbmNlcy5jdXN0b21TdGFydDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRvbS5jdXN0b21SYW5nZUVuZCkgew0KICAgICAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLnZhbHVlID0gcHJlZmVyZW5jZXMuY3VzdG9tRW5kOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCA9IHN0YXRlLmVhcmxpZXN0RGF0ZSA/IG5ldyBEYXRlKHN0YXRlLmVhcmxpZXN0RGF0ZS5nZXRUaW1lKCkpIDogbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21FbmQgPSBzdGF0ZS5sYXRlc3REYXRlID8gbmV3IERhdGUoc3RhdGUubGF0ZXN0RGF0ZS5nZXRUaW1lKCkpIDogbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21SYW5nZUludmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgaWYgKGRvbS5jdXN0b21SYW5nZVN0YXJ0KSB7DQogICAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQudmFsdWUgPSAiIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoZG9tLmN1c3RvbVJhbmdlRW5kKSB7DQogICAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLnZhbHVlID0gIiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUN1c3RvbVJhbmdlVmlzaWJpbGl0eSgpOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmV0dXJuIGFwcGxpZWQ7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gbWF5YmVBcHBseVN0b3JlZEZpbHRlcnMoKSB7DQogICAgICAgICAgICBpZiAoZmlsdGVyUHJlZmVyZW5jZXNBcHBsaWVkKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gbG9hZFN0b3JlZEZpbHRlclByZWZlcmVuY2VzKCk7DQogICAgICAgICAgICBpZiAocHJlZmVyZW5jZXMgJiYgYXBwbHlTdG9yZWRGaWx0ZXJQcmVmZXJlbmNlcyhwcmVmZXJlbmNlcykpIHsNCiAgICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZWZyZXNoRmlsdGVyVG9nZ2xlU3RhdGVzKCk7DQogICAgICAgICAgICBmaWx0ZXJQcmVmZXJlbmNlc0FwcGxpZWQgPSB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0RmlsdGVyc1RvRGVmYXVsdCgpIHsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMub3JnYW5pemF0aW9uID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jb3VudHJ5ID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy50aW1lZnJhbWUgPSAiYWxsIjsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQgPSBzdGF0ZS5lYXJsaWVzdERhdGUgPyBuZXcgRGF0ZShzdGF0ZS5lYXJsaWVzdERhdGUuZ2V0VGltZSgpKSA6IG51bGw7DQogICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCA9IHN0YXRlLmxhdGVzdERhdGUgPyBuZXcgRGF0ZShzdGF0ZS5sYXRlc3REYXRlLmdldFRpbWUoKSkgOiBudWxsOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21SYW5nZUludmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuYWdncmVnYXRlID0gIndlZWtseSI7DQogICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9ICJhY3Rpb25zIjsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuZ3JvdXAgPSAib3JnYW5pemF0aW9uIjsNCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY2F0ZWdvcnlTZWxlY3Rpb24gPSBudWxsOw0KICAgICAgICAgICAgc3luY011bHRpU2VsZWN0KGRvbS5vcmdhbml6YXRpb25GaWx0ZXIsIHN0YXRlLmZpbHRlcnMub3JnYW5pemF0aW9uKTsNCiAgICAgICAgICAgIHN5bmNNdWx0aVNlbGVjdChkb20uY291bnRyeUZpbHRlciwgc3RhdGUuZmlsdGVycy5jb3VudHJ5KTsNCiAgICAgICAgICAgIGlmIChkb20udGltZWZyYW1lRmlsdGVyKSB7DQogICAgICAgICAgICAgIGRvbS50aW1lZnJhbWVGaWx0ZXIudmFsdWUgPSAiYWxsIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uYWdncmVnYXRlRmlsdGVyKSB7DQogICAgICAgICAgICAgIGRvbS5hZ2dyZWdhdGVGaWx0ZXIudmFsdWUgPSAid2Vla2x5IjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20ubWV0cmljRmlsdGVyKSB7DQogICAgICAgICAgICAgIGRvbS5tZXRyaWNGaWx0ZXIudmFsdWUgPSAiYWN0aW9ucyI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLmdyb3VwRmlsdGVyKSB7DQogICAgICAgICAgICAgIGRvbS5ncm91cEZpbHRlci52YWx1ZSA9ICJvcmdhbml6YXRpb24iOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5jdXN0b21SYW5nZVN0YXJ0ICYmIHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQpIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQudmFsdWUgPSB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS5jdXN0b21SYW5nZUVuZCAmJiBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCkgew0KICAgICAgICAgICAgICBkb20uY3VzdG9tUmFuZ2VFbmQudmFsdWUgPSB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmZpbHRlcnMuY3VzdG9tRW5kKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUN1c3RvbVJhbmdlVmlzaWJpbGl0eSgpOw0KICAgICAgICAgICAgcmVmcmVzaEZpbHRlclRvZ2dsZVN0YXRlcygpOw0KICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICBwZXJzaXN0RmlsdGVyUHJlZmVyZW5jZXMoKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB0cmFuc2Zvcm1Sb3cocmF3KSB7DQogICAgICAgICAgICBjb25zdCBkYXRlID0gcGFyc2VNZXRyaWNEYXRlKHJhdy5NZXRyaWNEYXRlKTsNCiAgICAgICAgICAgIGlmICghZGF0ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHdlZWtFbmREYXRlID0gY29tcHV0ZVdlZWtFbmRpbmdEYXRlKGRhdGUpIHx8IGRhdGU7DQogICAgICAgICAgICBjb25zdCBpc29JbmZvID0gdG9Jc29XZWVrKHdlZWtFbmREYXRlKTsNCiAgICAgICAgICAgIGNvbnN0IG1vbnRoS2V5ID0gYCR7ZGF0ZS5nZXRVVENGdWxsWWVhcigpfS0ke3BhZChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKX1gOw0KICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IHt9Ow0KICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IENTVl9GSUVMRF9FTlRSSUVTX0NPVU5UOyBpbmRleCArPSAxKSB7DQogICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gY3N2RmllbGRFbnRyaWVzW2luZGV4XTsNCiAgICAgICAgICAgICAgY29uc3Qga2V5ID0gZW50cnlbMF07DQogICAgICAgICAgICAgIGNvbnN0IG1hcHBpbmcgPSBlbnRyeVsxXTsNCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBleHRyYWN0TWV0cmljVmFsdWUocmF3LCBtYXBwaW5nKTsNCiAgICAgICAgICAgICAgbWV0cmljc1trZXldID0gTnVtYmVyLmlzRmluaXRlKHZhbHVlKSA/IHZhbHVlIDogMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgIHBlcnNvbklkOiByYXcuUGVyc29uSWQgfHwgIlVua25vd24iLA0KICAgICAgICAgICAgICBvcmdhbml6YXRpb246IHNhbml0aXplTGFiZWwocmF3Lk9yZ2FuaXphdGlvbikgfHwgIlVuc3BlY2lmaWVkIiwNCiAgICAgICAgICAgICAgY291bnRyeTogc2FuaXRpemVMYWJlbChyYXcuQ291bnRyeU9yUmVnaW9uKSB8fCAiVW5zcGVjaWZpZWQiLA0KICAgICAgICAgICAgICBkb21haW46IHNhbml0aXplTGFiZWwocmF3LkRvbWFpbikgfHwgIlVuc3BlY2lmaWVkIiwNCiAgICAgICAgICAgICAgZGF0ZSwNCiAgICAgICAgICAgICAgd2Vla0VuZERhdGUsDQogICAgICAgICAgICAgIGlzb1dlZWs6IGlzb0luZm8ud2VlaywNCiAgICAgICAgICAgICAgaXNvWWVhcjogaXNvSW5mby55ZWFyLA0KICAgICAgICAgICAgICBtb250aEtleSwNCiAgICAgICAgICAgICAgdG90YWxBY3Rpb25zOiBtZXRyaWNzLnRvdGFsQWN0aW9ucywNCiAgICAgICAgICAgICAgYXNzaXN0ZWRIb3VyczogbWV0cmljcy5hc3Npc3RlZEhvdXJzLA0KICAgICAgICAgICAgICBtZXRyaWNzDQogICAgICAgICAgICB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFnZW50RmlsZVNlbGVjdGlvbihldmVudCkgew0KICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBldmVudCAmJiBldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50ID8gZXZlbnQudGFyZ2V0IDogbnVsbDsNCiAgICAgICAgICAgIGNvbnN0IGZpbGUgPSBpbnB1dCAmJiBpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlcy5sZW5ndGggPyBpbnB1dC5maWxlc1swXSA6IG51bGw7DQogICAgICAgICAgICBpZiAoIWZpbGUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcGFyc2VBZ2VudFVzYWdlRmlsZShmaWxlKTsNCiAgICAgICAgICAgIGlmIChpbnB1dCkgew0KICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlQWdlbnRVc2FnZUZpbGUoZmlsZSkgew0KICAgICAgICAgICAgaWYgKCFmaWxlKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uYWdlbnRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gYFBhcnNpbmcgJHtmaWxlLm5hbWV9Li4uYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc3RhcnRBZ2VudFBhcnNlID0gZGVsaW1pdGVyID0+IHsKICAgICAgICAgICAgICBjb25zdCByZXNvbHZlZERlbGltaXRlciA9IHR5cGVvZiBkZWxpbWl0ZXIgPT09ICJzdHJpbmciICYmIGRlbGltaXRlci5sZW5ndGggPyBkZWxpbWl0ZXIgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgUGFwYS5wYXJzZShmaWxlLCB7CiAgICAgICAgICAgICAgICBoZWFkZXI6IHRydWUsCiAgICAgICAgICAgICAgICBza2lwRW1wdHlMaW5lczogdHJ1ZSwKICAgICAgICAgICAgICAgIGRlbGltaXRlcjogcmVzb2x2ZWREZWxpbWl0ZXIsCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGU6IHJlc3VsdHMgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCB7IHJlc29sdmVkRmllbGRzLCBtaXNzaW5nQ29sdW1ucywgZGF0YXNldFR5cGUgfSA9IHJlc29sdmVBZ2VudEZpZWxkTWFwcGluZyhyZXN1bHRzPy5tZXRhPy5maWVsZHMpOw0KICAgICAgICAgICAgICAgICAgaWYgKG1pc3NpbmdDb2x1bW5zLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCByZXF1aXJlZEZpZWxkQ291bnQgPSBkYXRhc2V0VHlwZSA9PT0gInVzZXItZGV0YWlsIiA/IDYgOiA1Ow0KICAgICAgICAgICAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbnMubGVuZ3RoID49IHJlcXVpcmVkRmllbGRDb3VudCkgew0KICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBmaWxlIGxpa2VseSBpc24ndCBhbiBhZ2VudCBleHBvcnQ7IGZhbGwgYmFjayB0byBtYWluIGRhdGFzZXQgcGFyc2luZy4NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSAiQXdhaXRpbmcgYWdlbnQgdXNhZ2UgQ1NWLiI7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZG9tLmFnZW50RW1wdHkuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS50ZXh0Q29udGVudCA9ICJVcGxvYWQgYWdlbnQgdXNhZ2UgQ1NWIHRvIHZpZXcgaW5zaWdodHMuIjsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0NvcGlsb3REYXRhc2V0RmlsZShmaWxlKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFN0YXR1cykgew0KICAgICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudCA9IGBNaXNzaW5nIHJlcXVpcmVkIGNvbHVtbnM6ICR7bWlzc2luZ0NvbHVtbnMuam9pbigiLCAiKX0uYDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50RW1wdHkpIHsNCiAgICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS50ZXh0Q29udGVudCA9ICJJbmNsdWRlIHRoZSBzdGFuZGFyZCBhZ2VudCB1c2FnZSBjb2x1bW5zIGFuZCB0cnkgYWdhaW4uIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoZGF0YXNldFR5cGUgPT09ICJ1c2VyLXN1bW1hcnkiKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZVJvd3MgPSBBcnJheS5pc0FycmF5KHJlc3VsdHMuZGF0YSkgPyByZXN1bHRzLmRhdGEubGVuZ3RoIDogMDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VtbWFyeU1ldGEgPSB7DQogICAgICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogZmlsZS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGZpbGUubGFzdE1vZGlmaWVkLA0KICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXRUeXBlLA0KICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJvd3MsDQogICAgICAgICAgICAgICAgICAgICAgcm93czogc291cmNlUm93cw0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gIlVzZXIgc3VtbWFyeSBkYXRhc2V0IGRldGVjdGVkLiBDYWNoZWQgbG9jYWxseSBmb3IgbGF0ZXIgdXNlLiI7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudEVtcHR5ICYmICFzdGF0ZS5hZ2VudFVzYWdlUm93cy5sZW5ndGggJiYgIXN0YXRlLmFnZW50VXNhZ2VEZXRhaWxSb3dzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LnRleHRDb250ZW50ID0gIkxvYWQgYW4gYWdlbnQgdXNhZ2UgZXhwb3J0IHRvIHBvcHVsYXRlIHRoaXMgdGFibGUuIjsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbGUudGV4dCA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICAgICAgICAgIGZpbGUudGV4dCgpLnRoZW4oY3N2VGV4dCA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZW1lbWJlckxhc3RBZ2VudERhdGFzZXQoY3N2VGV4dCwgc3VtbWFyeU1ldGEpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdEFnZW50RGF0YXNldChjc3ZUZXh0LCBzdW1tYXJ5TWV0YSk7DQogICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gY2FjaGUgdXNlciBzdW1tYXJ5IGRhdGFzZXQiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgcmVtZW1iZXJMYXN0QWdlbnREYXRhc2V0KCIiLCBzdW1tYXJ5TWV0YSk7DQogICAgICAgICAgICAgICAgICAgICAgcGVyc2lzdEFnZW50RGF0YXNldCgiIiwgc3VtbWFyeU1ldGEpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcm93cywgZGV0YWlsUm93cywgc2tpcHBlZCwgc291cmNlUm93cyB9ID0gYnVpbGRBZ2VudFJvd3MocmVzdWx0cy5kYXRhLCByZXNvbHZlZEZpZWxkcywgZGF0YXNldFR5cGUpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYXBwbGllZCA9IGluZ2VzdEFnZW50VXNhZ2VSb3dzKHJvd3MsIHsNCiAgICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogZmlsZS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsDQogICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsDQogICAgICAgICAgICAgICAgICAgIGRhdGFzZXRUeXBlLA0KICAgICAgICAgICAgICAgICAgICBzb3VyY2VSb3dzDQogICAgICAgICAgICAgICAgICB9LCBza2lwcGVkLCBkZXRhaWxSb3dzKTsNCiAgICAgICAgICAgICAgICAgIGlmIChhcHBsaWVkICYmIHJvd3MubGVuZ3RoICYmIHR5cGVvZiBmaWxlLnRleHQgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgICAgZmlsZS50ZXh0KCkudGhlbihjc3ZUZXh0ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICByZW1lbWJlckxhc3RBZ2VudERhdGFzZXQoY3N2VGV4dCwgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLA0KICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLA0KICAgICAgICAgICAgICAgICAgICAgICAgcm93czogcm93cy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxSb3dzOiBkZXRhaWxSb3dzLmxlbmd0aCwNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsDQogICAgICAgICAgICAgICAgICAgICAgICBkYXRhc2V0VHlwZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVJvd3MNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICBwZXJzaXN0QWdlbnREYXRhc2V0KGNzdlRleHQsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3M6IHJvd3MubGVuZ3RoLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsUm93czogZGV0YWlsUm93cy5sZW5ndGgsDQogICAgICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGZpbGUubGFzdE1vZGlmaWVkLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldFR5cGUsDQogICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VSb3dzDQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBwZXJzaXN0IGFnZW50IGRhdGFzZXQiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6ICJVbmtub3duIGVycm9yIjsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkFnZW50IENTViBwYXJzZSBmYWlsZWQiLCBlcnJvcik7DQogICAgICAgICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFN0YXR1cy50ZXh0Q29udGVudCA9IGBBZ2VudCBDU1YgcGFyc2UgZmFpbGVkOiAke21lc3NhZ2V9YDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICAgICAgICBkb20uYWdlbnRFbXB0eS5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgZG9tLmFnZW50RW1wdHkudGV4dENvbnRlbnQgPSAiVW5hYmxlIHRvIHBhcnNlIHRoZSBhZ2VudCB1c2FnZSBDU1YuIjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgZGV0ZWN0RGVsaW1pdGVyRm9yRmlsZShmaWxlKS50aGVuKHN0YXJ0QWdlbnRQYXJzZSkuY2F0Y2goKCkgPT4gc3RhcnRBZ2VudFBhcnNlKCIiKSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplSGVhZGVyTGFiZWwodmFsdWUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgICAgICAgICAgLnRyaW0oKQogICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpCiAgICAgICAgICAgICAgLnJlcGxhY2UoL1tccy9fXC0oKSsuLHxcXFtcXXt9XSsvZywgIiIpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgImFuZCIpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHRvSGVhZGVyQ2FuZGlkYXRlcyhsYWJlbCkgewogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsYWJlbCkpIHsKICAgICAgICAgICAgICByZXR1cm4gbGFiZWwuZmlsdGVyKGVudHJ5ID0+IHR5cGVvZiBlbnRyeSA9PT0gInN0cmluZyIgJiYgZW50cnkudHJpbSgpLmxlbmd0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBsYWJlbCA9PT0gInN0cmluZyIgJiYgbGFiZWwudHJpbSgpLmxlbmd0aCkgewogICAgICAgICAgICAgIHJldHVybiBbbGFiZWxdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaEhlYWRlckZyb21Mb29rdXAoY2FuZGlkYXRlcywgbG9va3VwKSB7CiAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjYW5kaWRhdGVzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICAgIGNvbnN0IGNhbmRpZGF0ZSA9IGNhbmRpZGF0ZXNbaW5kZXhdOwogICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVIZWFkZXJMYWJlbChjYW5kaWRhdGUpOwogICAgICAgICAgICAgIGlmIChub3JtYWxpemVkICYmIGxvb2t1cFtub3JtYWxpemVkXSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvb2t1cFtub3JtYWxpemVkXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgbG93ZXJlZCA9IHR5cGVvZiBjYW5kaWRhdGUgPT09ICJzdHJpbmciID8gY2FuZGlkYXRlLnRyaW0oKS50b0xvd2VyQ2FzZSgpIDogIiI7CiAgICAgICAgICAgICAgaWYgKGxvd2VyZWQgJiYgbG9va3VwW2xvd2VyZWRdKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbG9va3VwW2xvd2VyZWRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlQWdlbnRGaWVsZExvb2t1cChmaWVsZHMpIHsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkcy5yZWR1Y2UoKGFjY3VtdWxhdG9yLCBmaWVsZCkgPT4gewogICAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgIT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGxvd2VyZWQgPSBmaWVsZC50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplSGVhZGVyTGFiZWwoZmllbGQpOwogICAgICAgICAgICAgIGlmIChsb3dlcmVkICYmICFhY2N1bXVsYXRvcltsb3dlcmVkXSkgewogICAgICAgICAgICAgICAgYWNjdW11bGF0b3JbbG93ZXJlZF0gPSBmaWVsZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWQgJiYgIWFjY3VtdWxhdG9yW25vcm1hbGl6ZWRdKSB7CiAgICAgICAgICAgICAgICBhY2N1bXVsYXRvcltub3JtYWxpemVkXSA9IGZpZWxkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7CiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgIH0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZUFnZW50RmllbGRNYXBwaW5nKGZpZWxkcykgew0KICAgICAgICAgICAgY29uc3QgbG9va3VwID0gcmVzb2x2ZUFnZW50RmllbGRMb29rdXAoQXJyYXkuaXNBcnJheShmaWVsZHMpID8gZmllbGRzIDogW10pOw0KICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWRGaWVsZHMgPSB7fTsNCiAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdDb2x1bW5zID0gW107DQogICAgICAgICAgICBPYmplY3QuZW50cmllcyhhZ2VudENzdkZpZWxkTWFwKS5mb3JFYWNoKChba2V5LCBleHBlY3RlZF0pID0+IHsKICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVzID0gdG9IZWFkZXJDYW5kaWRhdGVzKGV4cGVjdGVkKTsKICAgICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBtYXRjaEhlYWRlckZyb21Mb29rdXAoY2FuZGlkYXRlcywgbG9va3VwKTsKICAgICAgICAgICAgICBpZiAoYWN0dWFsKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlZEZpZWxkc1trZXldID0gYWN0dWFsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQ29sdW1ucy5wdXNoKGNhbmRpZGF0ZXNbMF0gfHwgU3RyaW5nKGV4cGVjdGVkKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHsgcmVzb2x2ZWRGaWVsZHMsIG1pc3NpbmdDb2x1bW5zIH07CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHRyYW5zZm9ybUFnZW50VXNhZ2VSb3cocmF3LCBmaWVsZHMpIHsNCiAgICAgICAgICAgIGlmICghcmF3KSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgaWQgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZHMuaWRdKTsNCiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZHMubmFtZV0pOw0KICAgICAgICAgICAgY29uc3QgY3JlYXRvclR5cGUgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZHMuY3JlYXRvclR5cGVdKSB8fCAiVW5zcGVjaWZpZWQiOw0KICAgICAgICAgICAgY29uc3QgYWN0aXZlTGljZW5zZWQgPSBwYXJzZU51bWJlcihyYXdbZmllbGRzLmFjdGl2ZUxpY2Vuc2VkXSk7DQogICAgICAgICAgICBjb25zdCBhY3RpdmVVbmxpY2Vuc2VkID0gcGFyc2VOdW1iZXIocmF3W2ZpZWxkcy5hY3RpdmVVbmxpY2Vuc2VkXSk7DQogICAgICAgICAgICBjb25zdCByZXNwb25zZXMgPSBwYXJzZU51bWJlcihyYXdbZmllbGRzLnJlc3BvbnNlc10pOw0KICAgICAgICAgICAgY29uc3QgdG90YWxBY3RpdmUgPSBhY3RpdmVMaWNlbnNlZCArIGFjdGl2ZVVubGljZW5zZWQ7DQogICAgICAgICAgICBjb25zdCBsYXN0QWN0aXZpdHkgPSBwYXJzZUFnZW50RGF0ZShyYXdbZmllbGRzLmxhc3RBY3Rpdml0eV0pOw0KICAgICAgICAgICAgaWYgKCFuYW1lICYmICFpZCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgIGlkOiBpZCB8fCBudWxsLA0KICAgICAgICAgICAgICBuYW1lOiBuYW1lIHx8IGlkIHx8ICJVbm5hbWVkIGFnZW50IiwNCiAgICAgICAgICAgICAgY3JlYXRvclR5cGUsDQogICAgICAgICAgICAgIGFjdGl2ZUxpY2Vuc2VkLA0KICAgICAgICAgICAgICBhY3RpdmVVbmxpY2Vuc2VkLA0KICAgICAgICAgICAgICB0b3RhbEFjdGl2ZSwNCiAgICAgICAgICAgICAgcmVzcG9uc2VzLA0KICAgICAgICAgICAgICBsYXN0QWN0aXZpdHkNCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gYnVpbGRBZ2VudFJvd3MoZGF0YSwgcmVzb2x2ZWRGaWVsZHMpIHsNCiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBbXTsNCiAgICAgICAgICAgIGxldCBza2lwcGVkID0gMDsNCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7DQogICAgICAgICAgICAgIGRhdGEuZm9yRWFjaChyYXcgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHRyYW5zZm9ybUFnZW50VXNhZ2VSb3cocmF3LCByZXNvbHZlZEZpZWxkcyk7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlZCkgew0KICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKHBhcnNlZCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHNraXBwZWQgKz0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHsgcm93cywgc2tpcHBlZCB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGluZ2VzdEFnZW50VXNhZ2VSb3dzKHJvd3MsIG1ldGEgPSB7fSwgc2tpcHBlZCA9IDApIHsKICAgICAgICAgICAgY29uc3QgbGlzdCA9IEFycmF5LmlzQXJyYXkocm93cykgPyByb3dzIDogW107CiAgICAgICAgICAgIGNvbnN0IHRvdGFsUm93cyA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICBzdGF0ZS5hZ2VudFVzYWdlUm93cyA9IGxpc3Q7CiAgICAgICAgICAgIHN0YXRlLmFnZW50VXNhZ2VNZXRhID0gewogICAgICAgICAgICAgIHNvdXJjZU5hbWU6IG1ldGEuc291cmNlTmFtZSB8fCBtZXRhLm5hbWUgfHwgIkFnZW50IHVzYWdlIGV4cG9ydCIsDQogICAgICAgICAgICAgIHRvdGFsUm93cywNCiAgICAgICAgICAgICAgc2tpcHBlZDogTnVtYmVyLmlzRmluaXRlKHNraXBwZWQpID8gc2tpcHBlZCA6IDAsDQogICAgICAgICAgICAgIHNpemU6IG1ldGEuc2l6ZSB8fCBudWxsLA0KICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IG1ldGEubGFzdE1vZGlmaWVkIHx8IG51bGwsDQogICAgICAgICAgICAgIHNhdmVkQXQ6IG1ldGEuc2F2ZWRBdCB8fCBudWxsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgPSB0b3RhbFJvd3MgPyBNYXRoLm1pbig1LCB0b3RhbFJvd3MpIDogNTsNCiAgICAgICAgICAgIHN0YXRlLmFnZW50U29ydCA9IHsgY29sdW1uOiAicmVzcG9uc2VzIiwgZGlyZWN0aW9uOiAiZGVzYyIgfTsNCiAgICAgICAgICAgIGlmICghdG90YWxSb3dzKSB7DQogICAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKFtdKTsNCiAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFN0YXR1cykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gc3RhdGUuYWdlbnRVc2FnZU1ldGEuc291cmNlTmFtZTsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSBsYWJlbA0KICAgICAgICAgICAgICAgICAgPyBgTm8gYWdlbnQgYWN0aXZpdHkgcm93cyB3ZXJlIGZvdW5kIGluICR7bGFiZWx9LmANCiAgICAgICAgICAgICAgICAgIDogIk5vIGFnZW50IGFjdGl2aXR5IHJvd3Mgd2VyZSBmb3VuZCBpbiB0aGUgcHJvdmlkZWQgZmlsZS4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LnRleHRDb250ZW50ID0gIlRoZSBhZ2VudCB1c2FnZSBleHBvcnQgZGlkIG5vdCBjb250YWluIGFueSBhY3Rpdml0eS4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKGxpc3QpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplQWdlbnRIdWIoKSB7CiAgICAgICAgICAgIGlmICghZG9tLmFnZW50SHViQ29udGFpbmVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRUYWIgPSBzdGF0ZS5hZ2VudEh1Yj8uYWN0aXZlVGFiIHx8ICJ1c2VycyI7CiAgICAgICAgICAgIHNldEFnZW50SHViQWN0aXZlVGFiKGN1cnJlbnRUYWIpOwogICAgICAgICAgICBpZiAoZG9tLmFnZW50SHViUmVzZXQpIHsKICAgICAgICAgICAgICBkb20uYWdlbnRIdWJSZXNldC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICByZXNldEFnZW50SHViKCk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRvbS5hZ2VudEh1YlRhYkJ1dHRvbnMgJiYgZG9tLmFnZW50SHViVGFiQnV0dG9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICBkb20uYWdlbnRIdWJUYWJCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhYiA9IGJ1dHRvbi5nZXRBdHRyaWJ1dGUoImRhdGEtYWdlbnQtdGFiIik7CiAgICAgICAgICAgICAgICBpZiAoIXRhYikgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzZXRBZ2VudEh1YkFjdGl2ZVRhYih0YWIpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBBR0VOVF9IVUJfVFlQRVMuZm9yRWFjaCh0eXBlID0+IHsKICAgICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gYWdlbnRIdWJTZWN0aW9uc1t0eXBlXTsKICAgICAgICAgICAgICBpZiAoIXNlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlY3Rpb24udXBsb2FkQnV0dG9uICYmIHNlY3Rpb24uaW5wdXQpIHsKICAgICAgICAgICAgICAgIHNlY3Rpb24udXBsb2FkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZlbnQgPT4gewogICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICBzZWN0aW9uLmlucHV0LmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlY3Rpb24uaW5wdXQpIHsKICAgICAgICAgICAgICAgIHNlY3Rpb24uaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgZXZlbnQgPT4gaGFuZGxlQWdlbnRIdWJJbnB1dENoYW5nZShldmVudCwgdHlwZSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VjdGlvbi5kcm9wem9uZSkgewogICAgICAgICAgICAgICAgc2V0dXBBZ2VudEh1YkRyb3B6b25lKHNlY3Rpb24uZHJvcHpvbmUsIHR5cGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VjdGlvbi5maWx0ZXJJbnB1dCkgewogICAgICAgICAgICAgICAgc2VjdGlvbi5maWx0ZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGV2ZW50ID0+IHsKICAgICAgICAgICAgICAgICAgc2V0QWdlbnRIdWJGaWx0ZXIodHlwZSwgZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VjdGlvbi5maWx0ZXJDbGVhcikgewogICAgICAgICAgICAgICAgc2VjdGlvbi5maWx0ZXJDbGVhci5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV2ZW50ID0+IHsKICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgc2V0QWdlbnRIdWJGaWx0ZXIodHlwZSwgIiIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWN0aW9uLnNvcnRCdXR0b25zICYmIHNlY3Rpb24uc29ydEJ1dHRvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBzZWN0aW9uLnNvcnRCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsKICAgICAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXZlbnQgPT4gewogICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gYnV0dG9uLmdldEF0dHJpYnV0ZSgiZGF0YS1hZ2VudC1odWItc29ydC1rZXkiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICBzZXRBZ2VudEh1YlNvcnQodHlwZSwga2V5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJSZXNldFZpc2liaWxpdHkoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVBZ2VudEh1YklucHV0Q2hhbmdlKGV2ZW50LCB0eXBlKSB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCA/IGV2ZW50LnRhcmdldCA6IG51bGw7CiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gaW5wdXQgJiYgaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID8gQXJyYXkuZnJvbShpbnB1dC5maWxlcykgOiBbXTsKICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCkgewogICAgICAgICAgICAgIHF1ZXVlQWdlbnRIdWJGaWxlcyhmaWxlcywgdHlwZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAiIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGxvYWRBZ2VudEh1YlNuYXBzaG90RnJvbUxvY2FsU3RvcmFnZSgpIHsKICAgICAgICAgICAgaWYgKCF3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCByYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShBR0VOVF9IVUJfU1RPUkFHRV9LRVkpOwogICAgICAgICAgICAgIGlmICghcmF3KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UocmF3KTsKICAgICAgICAgICAgICBpZiAocGF5bG9hZCAmJiB0eXBlb2YgcGF5bG9hZCA9PT0gIm9iamVjdCIgJiYgcGF5bG9hZC5kYXRhc2V0cykgewogICAgICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQuZGF0YXNldHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIHJlYWQgYWdlbnQgaHViIGRhdGFzZXRzIGZyb20gbG9jYWwgc3RvcmFnZSIsIGVycm9yKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXR1cEFnZW50SHViRHJvcHpvbmUoZHJvcHpvbmUsIHR5cGUpIHsKICAgICAgICAgICAgZHJvcHpvbmUuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ2VudGVyIiwgZXZlbnQgPT4gewogICAgICAgICAgICAgIGlmICghZXZlbnRDb250YWluc0ZpbGVzKGV2ZW50KSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIGRyb3B6b25lLmNsYXNzTGlzdC5hZGQoImlzLWFjdGl2ZSIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZHJvcHpvbmUuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLCBldmVudCA9PiB7CiAgICAgICAgICAgICAgaWYgKCFldmVudENvbnRhaW5zRmlsZXMoZXZlbnQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgZHJvcHpvbmUuY2xhc3NMaXN0LmFkZCgiaXMtYWN0aXZlIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkcm9wem9uZS5hZGRFdmVudExpc3RlbmVyKCJkcmFnbGVhdmUiLCAoKSA9PiB7CiAgICAgICAgICAgICAgZHJvcHpvbmUuY2xhc3NMaXN0LnJlbW92ZSgiaXMtYWN0aXZlIik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkcm9wem9uZS5hZGRFdmVudExpc3RlbmVyKCJkcm9wIiwgZXZlbnQgPT4gewogICAgICAgICAgICAgIGlmICghZXZlbnRDb250YWluc0ZpbGVzKGV2ZW50KSkgewogICAgICAgICAgICAgICAgZHJvcHpvbmUuY2xhc3NMaXN0LnJlbW92ZSgiaXMtYWN0aXZlIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgZHJvcHpvbmUuY2xhc3NMaXN0LnJlbW92ZSgiaXMtYWN0aXZlIik7CiAgICAgICAgICAgICAgY29uc3QgdHJhbnNmZXJGaWxlcyA9IGV2ZW50LmRhdGFUcmFuc2ZlciAmJiBldmVudC5kYXRhVHJhbnNmZXIuZmlsZXMgPyBBcnJheS5mcm9tKGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlcykgOiBbXTsKICAgICAgICAgICAgICBpZiAodHJhbnNmZXJGaWxlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHF1ZXVlQWdlbnRIdWJGaWxlcyh0cmFuc2ZlckZpbGVzLCB0eXBlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHF1ZXVlQWdlbnRIdWJGaWxlcyhmaWxlcywgdHlwZSkgewogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmlsZXMpIHx8ICFmaWxlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgICBpZiAoZmlsZSkgewogICAgICAgICAgICAgICAgcGFyc2VBZ2VudEh1YkZpbGUoZmlsZSwgdHlwZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUFnZW50SHViRmlsZShmaWxlLCB0eXBlSGludCkgewogICAgICAgICAgICBpZiAoIWZpbGUpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVIaW50KSB7CiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJTdGF0dXModHlwZUhpbnQsIGBQYXJzaW5nICR7ZmlsZS5uYW1lfS4uLmApOwogICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViRW1wdHlTdGF0ZSh0eXBlSGludCwgeyBoaWRkZW46IHRydWUgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgYmVnaW5QYXJzaW5nID0gZGVsaW1pdGVyID0+IHsKICAgICAgICAgICAgICBjb25zdCByZXNvbHZlZERlbGltaXRlciA9IHR5cGVvZiBkZWxpbWl0ZXIgPT09ICJzdHJpbmciICYmIGRlbGltaXRlci5sZW5ndGggPyBkZWxpbWl0ZXIgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBQYXBhID09PSAidW5kZWZpbmVkIiB8fCB0eXBlb2YgUGFwYS5wYXJzZSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tUeXBlID0gdHlwZUhpbnQgfHwgc3RhdGUuYWdlbnRIdWI/LmFjdGl2ZVRhYiB8fCAidXNlcnMiOwogICAgICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJTdGF0dXMoZmFsbGJhY2tUeXBlLCAiQ1NWIHBhcnNlciBpcyB1bmF2YWlsYWJsZSBpbiB0aGlzIGJyb3dzZXIuIik7CiAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudEh1YkVtcHR5U3RhdGUoZmFsbGJhY2tUeXBlLCB7IGhpZGRlbjogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIFBhcGEucGFyc2UoZmlsZSwgewogICAgICAgICAgICAgICAgaGVhZGVyOiB0cnVlLAogICAgICAgICAgICAgICAgc2tpcEVtcHR5TGluZXM6IHRydWUsCiAgICAgICAgICAgICAgICBkZWxpbWl0ZXI6IHJlc29sdmVkRGVsaW1pdGVyLAogICAgICAgICAgICAgICAgY29tcGxldGU6IHJlc3VsdHMgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSByZXN1bHRzICYmIHJlc3VsdHMubWV0YSAmJiBBcnJheS5pc0FycmF5KHJlc3VsdHMubWV0YS5maWVsZHMpID8gcmVzdWx0cy5tZXRhLmZpZWxkcyA6IFtdOwogICAgICAgICAgICAgICAgICBjb25zdCB7IHJlc29sdmVkLCBtaXNzaW5nLCBkYXRhc2V0VHlwZSB9ID0gcmVzb2x2ZUFnZW50SHViQ29sdW1uc0F1dG8odHlwZUhpbnQsIGZpZWxkcyk7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFR5cGUgPSBkYXRhc2V0VHlwZSB8fCB0eXBlSGludCB8fCBzdGF0ZS5hZ2VudEh1Yj8uYWN0aXZlVGFiIHx8ICJ1c2VycyI7CiAgICAgICAgICAgICAgICAgIGlmIChtaXNzaW5nLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdMYWJlbCA9IG1pc3Npbmcuam9pbigiLCAiKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudEh1YlN0YXR1cyh0YXJnZXRUeXBlLCBgTWlzc2luZyByZXF1aXJlZCBjb2x1bW5zOiAke21pc3NpbmdMYWJlbH0uYCk7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJFbXB0eVN0YXRlKHRhcmdldFR5cGUsIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAiSW5jbHVkZSB0aGUgc3RhbmRhcmQgYWdlbnQgdXNhZ2UgY29sdW1ucyBhbmQgdHJ5IGFnYWluLiIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZUhpbnQgJiYgdHlwZUhpbnQgIT09IHRhcmdldFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViU3RhdHVzKHR5cGVIaW50LCBgJHtmaWxlLm5hbWV9IGRvZXMgbm90IG1hdGNoIHRoZSBleHBlY3RlZCBjb2x1bW5zIGZvciB0aGlzIHRhYi5gKTsKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViRW1wdHlTdGF0ZSh0eXBlSGludCwgeyBoaWRkZW46IGZhbHNlIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IEFycmF5LmlzQXJyYXkocmVzdWx0cyAmJiByZXN1bHRzLmRhdGEpID8gcmVzdWx0cy5kYXRhIDogW107CiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgcm93cywgc2tpcHBlZCB9ID0gYnVpbGRBZ2VudEh1YlJvd3ModGFyZ2V0VHlwZSwgZGF0YXNldCwgcmVzb2x2ZWQpOwogICAgICAgICAgICAgICAgICBhcHBseUFnZW50SHViRGF0YXNldCgKICAgICAgICAgICAgICAgICAgICB0YXJnZXRUeXBlLAogICAgICAgICAgICAgICAgICAgIHJvd3MsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgc291cmNlTmFtZTogZmlsZS5uYW1lLAogICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLAogICAgICAgICAgICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc2tpcHBlZAogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICBpZiAodHlwZUhpbnQgJiYgdHlwZUhpbnQgIT09IHRhcmdldFR5cGUpIHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudEh1YlN0YXR1cyh0eXBlSGludCwgYCR7ZmlsZS5uYW1lfSBtYXRjaGVkICR7Z2V0QWdlbnRIdWJUeXBlTGFiZWwodGFyZ2V0VHlwZSl9LiBEYXRhIG1vdmVkIHRvIHRoYXQgdGFiLmApOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViRW1wdHlTdGF0ZSh0eXBlSGludCwgeyBoaWRkZW46IGZhbHNlLCBtZXNzYWdlOiBnZXRBZ2VudEh1YkRlZmF1bHRFbXB0eU1lc3NhZ2UodHlwZUhpbnQpIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6ICgpID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tUeXBlID0gdHlwZUhpbnQgfHwgc3RhdGUuYWdlbnRIdWI/LmFjdGl2ZVRhYiB8fCAidXNlcnMiOwogICAgICAgICAgICAgICAgICB1cGRhdGVBZ2VudEh1YlN0YXR1cyhmYWxsYmFja1R5cGUsICJVbmFibGUgdG8gcmVhZCB0aGlzIENTViBmaWxlLiBEb3dubG9hZCBpdCBhZ2FpbiBhbmQgcmV0cnkuIik7CiAgICAgICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViRW1wdHlTdGF0ZShmYWxsYmFja1R5cGUsIHsgaGlkZGVuOiBmYWxzZSB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgZGV0ZWN0RGVsaW1pdGVyRm9yRmlsZShmaWxlKS50aGVuKGJlZ2luUGFyc2luZykuY2F0Y2goKCkgPT4gYmVnaW5QYXJzaW5nKCIiKSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZUFnZW50SHViQ29sdW1ucyh0eXBlLCBmaWVsZHMsIGxvb2t1cCkgewogICAgICAgICAgICBjb25zdCBjb25maWcgPSBhZ2VudEh1YkRhdGFzZXRDb25maWdbdHlwZV07CiAgICAgICAgICAgIGlmICghY29uZmlnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsgcmVzb2x2ZWQ6IHt9LCBtaXNzaW5nOiBbXSB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGhlYWRlckxvb2t1cCA9IGxvb2t1cCB8fCByZXNvbHZlQWdlbnRGaWVsZExvb2t1cChBcnJheS5pc0FycmF5KGZpZWxkcykgPyBmaWVsZHMgOiBbXSk7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVkID0ge307CiAgICAgICAgICAgIGNvbnN0IG1pc3NpbmcgPSBbXTsKICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoY29uZmlnLnJlcXVpcmVkRmllbGRzKS5mb3JFYWNoKChba2V5LCBsYWJlbF0pID0+IHsKICAgICAgICAgICAgICBjb25zdCBjYW5kaWRhdGVzID0gdG9IZWFkZXJDYW5kaWRhdGVzKGxhYmVsKTsKICAgICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBtYXRjaEhlYWRlckZyb21Mb29rdXAoY2FuZGlkYXRlcywgaGVhZGVyTG9va3VwKTsKICAgICAgICAgICAgICBpZiAoYWN0dWFsKSB7CiAgICAgICAgICAgICAgICByZXNvbHZlZFtrZXldID0gYWN0dWFsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nLnB1c2goY2FuZGlkYXRlc1swXSB8fCBTdHJpbmcobGFiZWwpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4geyByZXNvbHZlZCwgbWlzc2luZyB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVBZ2VudEh1YkNvbHVtbnNBdXRvKHByZWZlcnJlZFR5cGUsIGZpZWxkcykgewogICAgICAgICAgICBjb25zdCBsb29rdXAgPSByZXNvbHZlQWdlbnRGaWVsZExvb2t1cChBcnJheS5pc0FycmF5KGZpZWxkcykgPyBmaWVsZHMgOiBbXSk7CiAgICAgICAgICAgIGNvbnN0IGF0dGVtcHRzID0gW107CiAgICAgICAgICAgIGNvbnN0IHRyeVR5cGUgPSBjYW5kaWRhdGVUeXBlID0+IHsKICAgICAgICAgICAgICBpZiAoIWNhbmRpZGF0ZVR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXNvbHZlQWdlbnRIdWJDb2x1bW5zKGNhbmRpZGF0ZVR5cGUsIGZpZWxkcywgbG9va3VwKTsKICAgICAgICAgICAgICBhdHRlbXB0cy5wdXNoKHsgdHlwZTogY2FuZGlkYXRlVHlwZSwgLi4ucmVzdWx0IH0pOwogICAgICAgICAgICAgIGlmICghcmVzdWx0Lm1pc3NpbmcubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBkYXRhc2V0VHlwZTogY2FuZGlkYXRlVHlwZSwgcmVzb2x2ZWQ6IHJlc3VsdC5yZXNvbHZlZCwgbWlzc2luZzogW10gfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxldCBtYXRjaCA9IHRyeVR5cGUocHJlZmVycmVkVHlwZSk7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgQUdFTlRfSFVCX1RZUEVTLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlID0gQUdFTlRfSFVCX1RZUEVTW2luZGV4XTsKICAgICAgICAgICAgICAgIGlmIChjYW5kaWRhdGUgPT09IHByZWZlcnJlZFR5cGUpIHsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtYXRjaCA9IHRyeVR5cGUoY2FuZGlkYXRlKTsKICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGJlc3QgPSBhdHRlbXB0cy5sZW5ndGgKICAgICAgICAgICAgICA/IGF0dGVtcHRzLnNsaWNlKCkuc29ydCgoYSwgYikgPT4gYS5taXNzaW5nLmxlbmd0aCAtIGIubWlzc2luZy5sZW5ndGgpWzBdCiAgICAgICAgICAgICAgOiBudWxsOwogICAgICAgICAgICBpZiAoYmVzdCkgewogICAgICAgICAgICAgIHJldHVybiB7IGRhdGFzZXRUeXBlOiBiZXN0LnR5cGUsIHJlc29sdmVkOiBiZXN0LnJlc29sdmVkLCBtaXNzaW5nOiBiZXN0Lm1pc3NpbmcgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBmYWxsYmFja1R5cGUgPSBwcmVmZXJyZWRUeXBlIHx8IEFHRU5UX0hVQl9UWVBFU1swXTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkYXRhc2V0VHlwZTogZmFsbGJhY2tUeXBlLAogICAgICAgICAgICAgIHJlc29sdmVkOiB7fSwKICAgICAgICAgICAgICBtaXNzaW5nOiBPYmplY3QudmFsdWVzKGFnZW50SHViRGF0YXNldENvbmZpZ1tmYWxsYmFja1R5cGVdPy5yZXF1aXJlZEZpZWxkcyB8fCB7fSkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBidWlsZEFnZW50SHViUm93cyh0eXBlLCBkYXRhLCBmaWVsZE1hcCkgewogICAgICAgICAgICBjb25zdCByb3dzID0gW107CiAgICAgICAgICAgIGxldCBza2lwcGVkID0gMDsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHsKICAgICAgICAgICAgICBkYXRhLmZvckVhY2gocmF3ID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnNlZCA9IHRyYW5zZm9ybUFnZW50SHViUm93KHR5cGUsIHJhdywgZmllbGRNYXApOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlZCkgewogICAgICAgICAgICAgICAgICByb3dzLnB1c2gocGFyc2VkKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHNraXBwZWQgKz0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4geyByb3dzLCBza2lwcGVkIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdHJhbnNmb3JtQWdlbnRIdWJSb3codHlwZSwgcmF3LCBmaWVsZE1hcCkgewogICAgICAgICAgICBpZiAoIXJhdyB8fCAhZmllbGRNYXApIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZSA9PT0gInVzZXJzIikgewogICAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gc2FuaXRpemVMYWJlbChyYXdbZmllbGRNYXAudXNlcm5hbWVdKTsKICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IHNhbml0aXplTGFiZWwocmF3W2ZpZWxkTWFwLmRpc3BsYXlOYW1lXSk7CiAgICAgICAgICAgICAgaWYgKCF1c2VybmFtZSAmJiAhZGlzcGxheU5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBhZ2VudENvdW50ID0gcGFyc2VOdW1iZXIocmF3W2ZpZWxkTWFwLmFnZW50Q291bnRdKTsKICAgICAgICAgICAgICBjb25zdCByZXNwb25zZXMgPSBwYXJzZU51bWJlcihyYXdbZmllbGRNYXAucmVzcG9uc2VzXSk7CiAgICAgICAgICAgICAgY29uc3QgbGFzdEFjdGl2aXR5ID0gcGFyc2VBZ2VudERhdGUocmF3W2ZpZWxkTWFwLmxhc3RBY3Rpdml0eV0pOwogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUgfHwgIiIsCiAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogZGlzcGxheU5hbWUgfHwgIiIsCiAgICAgICAgICAgICAgICBhZ2VudENvdW50LAogICAgICAgICAgICAgICAgcmVzcG9uc2VzLAogICAgICAgICAgICAgICAgbGFzdEFjdGl2aXR5LAogICAgICAgICAgICAgICAgbGFzdEFjdGl2aXR5UmF3OiBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZE1hcC5sYXN0QWN0aXZpdHldKSB8fCAiIgogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJhZ2VudHMiKSB7CiAgICAgICAgICAgICAgY29uc3QgYWdlbnRJZCA9IHNhbml0aXplTGFiZWwocmF3W2ZpZWxkTWFwLmFnZW50SWRdKTsKICAgICAgICAgICAgICBjb25zdCBhZ2VudE5hbWUgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZE1hcC5hZ2VudE5hbWVdKTsKICAgICAgICAgICAgICBpZiAoIWFnZW50SWQgJiYgIWFnZW50TmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGNyZWF0b3JUeXBlID0gc2FuaXRpemVMYWJlbChyYXdbZmllbGRNYXAuY3JlYXRvclR5cGVdKSB8fCAiVW5zcGVjaWZpZWQiOwogICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUxpY2Vuc2VkID0gcGFyc2VOdW1iZXIocmF3W2ZpZWxkTWFwLmFjdGl2ZUxpY2Vuc2VkXSk7CiAgICAgICAgICAgICAgY29uc3QgYWN0aXZlVW5saWNlbnNlZCA9IHBhcnNlTnVtYmVyKHJhd1tmaWVsZE1hcC5hY3RpdmVVbmxpY2Vuc2VkXSk7CiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VzID0gcGFyc2VOdW1iZXIocmF3W2ZpZWxkTWFwLnJlc3BvbnNlc10pOwogICAgICAgICAgICAgIGNvbnN0IGxhc3RBY3Rpdml0eSA9IHBhcnNlQWdlbnREYXRlKHJhd1tmaWVsZE1hcC5sYXN0QWN0aXZpdHldKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgYWdlbnRJZDogYWdlbnRJZCB8fCAiIiwKICAgICAgICAgICAgICAgIGFnZW50TmFtZTogYWdlbnROYW1lIHx8IGFnZW50SWQgfHwgIiIsCiAgICAgICAgICAgICAgICBjcmVhdG9yVHlwZSwKICAgICAgICAgICAgICAgIGFjdGl2ZUxpY2Vuc2VkLAogICAgICAgICAgICAgICAgYWN0aXZlVW5saWNlbnNlZCwKICAgICAgICAgICAgICAgIHJlc3BvbnNlcywKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eSwKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eVJhdzogc2FuaXRpemVMYWJlbChyYXdbZmllbGRNYXAubGFzdEFjdGl2aXR5XSkgfHwgIiIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlID09PSAiY29tYmluZWQiKSB7CiAgICAgICAgICAgICAgY29uc3QgYWdlbnRJZCA9IHNhbml0aXplTGFiZWwocmF3W2ZpZWxkTWFwLmFnZW50SWRdKTsKICAgICAgICAgICAgICBjb25zdCBhZ2VudE5hbWUgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZE1hcC5hZ2VudE5hbWVdKTsKICAgICAgICAgICAgICBjb25zdCB1c2VybmFtZSA9IHNhbml0aXplTGFiZWwocmF3W2ZpZWxkTWFwLnVzZXJuYW1lXSk7CiAgICAgICAgICAgICAgaWYgKCFhZ2VudElkICYmICFhZ2VudE5hbWUgJiYgIXVzZXJuYW1lKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgY3JlYXRvclR5cGUgPSBzYW5pdGl6ZUxhYmVsKHJhd1tmaWVsZE1hcC5jcmVhdG9yVHlwZV0pIHx8ICJVbnNwZWNpZmllZCI7CiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VzID0gcGFyc2VOdW1iZXIocmF3W2ZpZWxkTWFwLnJlc3BvbnNlc10pOwogICAgICAgICAgICAgIGNvbnN0IGxhc3RBY3Rpdml0eSA9IHBhcnNlQWdlbnREYXRlKHJhd1tmaWVsZE1hcC5sYXN0QWN0aXZpdHldKTsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgYWdlbnRJZDogYWdlbnRJZCB8fCAiIiwKICAgICAgICAgICAgICAgIGFnZW50TmFtZTogYWdlbnROYW1lIHx8IGFnZW50SWQgfHwgIiIsCiAgICAgICAgICAgICAgICBjcmVhdG9yVHlwZSwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSB8fCAiIiwKICAgICAgICAgICAgICAgIHJlc3BvbnNlcywKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eSwKICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eVJhdzogc2FuaXRpemVMYWJlbChyYXdbZmllbGRNYXAubGFzdEFjdGl2aXR5XSkgfHwgIiIKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGFwcGx5QWdlbnRIdWJEYXRhc2V0KHR5cGUsIHJvd3MsIG1ldGEgPSB7fSwgc2tpcHBlZCA9IDAsIG9wdGlvbnMgPSB7fSkgewogICAgICAgICAgICBpZiAoIXN0YXRlLmFnZW50SHViIHx8ICFzdGF0ZS5hZ2VudEh1Yi5kYXRhc2V0cyB8fCAhc3RhdGUuYWdlbnRIdWIuZGF0YXNldHNbdHlwZV0pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICAgcGVyc2lzdDogdHJ1ZSwKICAgICAgICAgICAgICBzdGF0dXNNZXNzYWdlOiBudWxsLAogICAgICAgICAgICAgIC4uLm9wdGlvbnMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHN0YXRlLmFnZW50SHViLmRhdGFzZXRzW3R5cGVdOwogICAgICAgICAgICBkYXRhc2V0LnJvd3MgPSBBcnJheS5pc0FycmF5KHJvd3MpID8gcm93cyA6IFtdOwogICAgICAgICAgICBkYXRhc2V0Lm1ldGEgPSB7CiAgICAgICAgICAgICAgc291cmNlTmFtZTogbWV0YS5zb3VyY2VOYW1lIHx8ICJBZ2VudCBDU1YiLAogICAgICAgICAgICAgIHNpemU6IE51bWJlci5pc0Zpbml0ZShtZXRhLnNpemUpID8gbWV0YS5zaXplIDogbnVsbCwKICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IE51bWJlci5pc0Zpbml0ZShtZXRhLmxhc3RNb2RpZmllZCkgPyBtZXRhLmxhc3RNb2RpZmllZCA6IG51bGwsCiAgICAgICAgICAgICAgcm93czogZGF0YXNldC5yb3dzLmxlbmd0aCwKICAgICAgICAgICAgICBza2lwcGVkOiBOdW1iZXIuaXNGaW5pdGUoc2tpcHBlZCkgPyBza2lwcGVkIDogMAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoZGF0YXNldC5yb3dzLmxlbmd0aCkgewogICAgICAgICAgICAgIGNvbnN0IGxvYWRlZE1lc3NhZ2UgPSBkYXRhc2V0Lm1ldGEuc2tpcHBlZAogICAgICAgICAgICAgICAgPyBgTG9hZGVkICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChkYXRhc2V0LnJvd3MubGVuZ3RoKX0gcm93cyAoc2tpcHBlZCAke251bWJlckZvcm1hdHRlci5mb3JtYXQoZGF0YXNldC5tZXRhLnNraXBwZWQpfSkuYAogICAgICAgICAgICAgICAgOiBgTG9hZGVkICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChkYXRhc2V0LnJvd3MubGVuZ3RoKX0gcm93cy5gOwogICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViU3RhdHVzKHR5cGUsIHNldHRpbmdzLnN0YXR1c01lc3NhZ2UgfHwgbG9hZGVkTWVzc2FnZSk7CiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJFbXB0eVN0YXRlKHR5cGUsIHsgaGlkZGVuOiB0cnVlIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViU3RhdHVzKHR5cGUsICJObyB2YWxpZCByb3dzIHdlcmUgZm91bmQgaW4gdGhpcyBDU1YuIik7CiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJFbXB0eVN0YXRlKHR5cGUsIHsKICAgICAgICAgICAgICAgIGhpZGRlbjogZmFsc2UsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAiVXBsb2FkIGEgQ1NWIHdpdGggdGhlIHN0YW5kYXJkIGNvbHVtbnMgdG8gcG9wdWxhdGUgdGhpcyB0YWJsZS4iCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJNZXRhKHR5cGUsIGRhdGFzZXQubWV0YSk7CiAgICAgICAgICAgIHRvZ2dsZUFnZW50SHViRmlsdGVyQmFyKHR5cGUsIGRhdGFzZXQucm93cy5sZW5ndGggPiAwKTsKICAgICAgICAgICAgcmVuZGVyQWdlbnRIdWJUYWJsZSh0eXBlKTsKICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJSZXNldFZpc2liaWxpdHkoKTsKICAgICAgICAgICAgaWYgKHNldHRpbmdzLnBlcnNpc3QpIHsKICAgICAgICAgICAgICBwZXJzaXN0QWdlbnRIdWJTbmFwc2hvdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gYXBwbHlBZ2VudEh1YlNuYXBzaG90KHNuYXBzaG90LCB7IHN0YXR1c1ByZWZpeCA9ICJSZXN0b3JlZCIgfSA9IHt9KSB7CiAgICAgICAgICAgIGlmICghc25hcHNob3QgfHwgdHlwZW9mIHNuYXBzaG90ICE9PSAib2JqZWN0IikgewogICAgICAgICAgICAgIEFHRU5UX0hVQl9UWVBFUy5mb3JFYWNoKHR5cGUgPT4gcmVzZXRBZ2VudEh1YkRhdGFzZXQodHlwZSwgeyBza2lwUGVyc2lzdDogdHJ1ZSB9KSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEFHRU5UX0hVQl9UWVBFUy5mb3JFYWNoKHR5cGUgPT4gewogICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBzbmFwc2hvdFt0eXBlXTsKICAgICAgICAgICAgICBpZiAoZGF0YSAmJiBBcnJheS5pc0FycmF5KGRhdGEucm93cykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGh5ZHJhdGVkUm93cyA9IGRhdGEucm93cy5tYXAoZGVzZXJpYWxpemVBZ2VudEh1YlJvdyk7CiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGh5ZHJhdGVkUm93cy5sZW5ndGgKICAgICAgICAgICAgICAgICAgPyBgJHtzdGF0dXNQcmVmaXh9ICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChkYXRhLnJvd3MubGVuZ3RoKX0gcm93cy5gCiAgICAgICAgICAgICAgICAgIDogYCR7c3RhdHVzUHJlZml4fSBkYXRhc2V0IGxvYWRlZC5gOwogICAgICAgICAgICAgICAgYXBwbHlBZ2VudEh1YkRhdGFzZXQodHlwZSwgaHlkcmF0ZWRSb3dzLCBkYXRhLm1ldGEgfHwge30sIGRhdGEubWV0YT8uc2tpcHBlZCB8fCAwLCB7CiAgICAgICAgICAgICAgICAgIHBlcnNpc3Q6IGZhbHNlLAogICAgICAgICAgICAgICAgICBzdGF0dXNNZXNzYWdlOiBsYWJlbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc2V0QWdlbnRIdWJEYXRhc2V0KHR5cGUsIHsgc2tpcFBlcnNpc3Q6IHRydWUgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmVuZGVyQWdlbnRIdWJUYWJsZShzdGF0ZS5hZ2VudEh1Yj8uYWN0aXZlVGFiIHx8ICJ1c2VycyIpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlckFnZW50SHViVGFibGUodHlwZSkgewogICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gYWdlbnRIdWJTZWN0aW9uc1t0eXBlXTsKICAgICAgICAgICAgaWYgKCFzZWN0aW9uIHx8ICFzZWN0aW9uLnRib2R5KSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlY3Rpb24udGJvZHkuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgICAgIGNvbnN0IGRhdGFzZXQgPSBzdGF0ZS5hZ2VudEh1YiAmJiBzdGF0ZS5hZ2VudEh1Yi5kYXRhc2V0cyA/IHN0YXRlLmFnZW50SHViLmRhdGFzZXRzW3R5cGVdIDogbnVsbDsKICAgICAgICAgICAgY29uc3Qgc291cmNlUm93cyA9IGRhdGFzZXQgJiYgQXJyYXkuaXNBcnJheShkYXRhc2V0LnJvd3MpID8gZGF0YXNldC5yb3dzLnNsaWNlKCkgOiBbXTsKICAgICAgICAgICAgY29uc3QgZmlsdGVyZWRSb3dzID0gZmlsdGVyQWdlbnRIdWJSb3dzKHR5cGUsIHNvdXJjZVJvd3MpOwogICAgICAgICAgICBjb25zdCByb3dzID0gc29ydEFnZW50SHViUm93cyh0eXBlLCBmaWx0ZXJlZFJvd3MpOwogICAgICAgICAgICB1cGRhdGVBZ2VudEh1YkZpbHRlckNvbnRyb2xzKHR5cGUpOwogICAgICAgICAgICB1cGRhdGVBZ2VudEh1YlNvcnRJbmRpY2F0b3JzKHR5cGUpOwogICAgICAgICAgICBpZiAoIXJvd3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKHNlY3Rpb24udGFibGVXcmFwcGVyKSB7CiAgICAgICAgICAgICAgICBzZWN0aW9uLnRhYmxlV3JhcHBlci5oaWRkZW4gPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VjdGlvbi5lbXB0eSkgewogICAgICAgICAgICAgICAgaWYgKHNvdXJjZVJvd3MubGVuZ3RoICYmIChzdGF0ZS5hZ2VudEh1Yj8uZmlsdGVycz8uW3R5cGVdIHx8ICIiKS50cmltKCkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIHNlY3Rpb24uZW1wdHkudGV4dENvbnRlbnQgPSAiTm8gcm93cyBtYXRjaCB0aGUgY3VycmVudCBmaWx0ZXIuIjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbi5kZWZhdWx0cykgewogICAgICAgICAgICAgICAgICBzZWN0aW9uLmVtcHR5LnRleHRDb250ZW50ID0gc2VjdGlvbi5kZWZhdWx0cy5lbXB0eTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlY3Rpb24uZW1wdHkuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBjb25maWcgPSBhZ2VudEh1YkRhdGFzZXRDb25maWdbdHlwZV07CiAgICAgICAgICAgIGlmICghY29uZmlnKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOwogICAgICAgICAgICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7CiAgICAgICAgICAgICAgY29uZmlnLmNvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4gewogICAgICAgICAgICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOwogICAgICAgICAgICAgICAgaWYgKGNvbHVtbi50eXBlID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgICB0ZC5jbGFzc0xpc3QuYWRkKCJpcy1udW1lcmljIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IGZvcm1hdEFnZW50SHViQ2VsbFZhbHVlKHJvdywgY29sdW1uKTsKICAgICAgICAgICAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0cik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzZWN0aW9uLnRib2R5LmFwcGVuZENoaWxkKGZyYWdtZW50KTsKICAgICAgICAgICAgaWYgKHNlY3Rpb24udGFibGVXcmFwcGVyKSB7CiAgICAgICAgICAgICAgc2VjdGlvbi50YWJsZVdyYXBwZXIuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNlY3Rpb24uZW1wdHkpIHsKICAgICAgICAgICAgICBzZWN0aW9uLmVtcHR5LmhpZGRlbiA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBmb3JtYXRBZ2VudEh1YkNlbGxWYWx1ZShyb3csIGNvbHVtbikgewogICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHJvd1tjb2x1bW4ua2V5XTsKICAgICAgICAgICAgaWYgKGNvbHVtbi50eXBlID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgIHJldHVybiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgPyB2YWx1ZSA6IDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gImRhdGUiKSB7CiAgICAgICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSAmJiAhTnVtYmVyLmlzTmFOKHZhbHVlLmdldFRpbWUoKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmb3JtYXRTaG9ydERhdGUodmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gcm93W2Ake2NvbHVtbi5rZXl9UmF3YF0gfHwgIi0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSB8fCAiLSI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQWdlbnRIdWJTdGF0dXModHlwZSwgbWVzc2FnZSkgewogICAgICAgICAgICBjb25zdCBzZWN0aW9uID0gYWdlbnRIdWJTZWN0aW9uc1t0eXBlXTsKICAgICAgICAgICAgaWYgKHNlY3Rpb24gJiYgc2VjdGlvbi5zdGF0dXMpIHsKICAgICAgICAgICAgICBzZWN0aW9uLnN0YXR1cy50ZXh0Q29udGVudCA9IG1lc3NhZ2UgfHwgKHNlY3Rpb24uZGVmYXVsdHMgPyBzZWN0aW9uLmRlZmF1bHRzLnN0YXR1cyA6ICIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUFnZW50SHViTWV0YSh0eXBlLCBtZXRhKSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICBpZiAoIXNlY3Rpb24gfHwgIXNlY3Rpb24ubWV0YSkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWV0YSAmJiAoTnVtYmVyLmlzRmluaXRlKG1ldGEucm93cykgfHwgbWV0YS5zb3VyY2VOYW1lKSkgewogICAgICAgICAgICAgIHNlY3Rpb24ubWV0YS50ZXh0Q29udGVudCA9IGRlc2NyaWJlQWdlbnRIdWJNZXRhKG1ldGEpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWN0aW9uLm1ldGEudGV4dENvbnRlbnQgPSBzZWN0aW9uLmRlZmF1bHRzID8gc2VjdGlvbi5kZWZhdWx0cy5tZXRhIDogIiI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGVzY3JpYmVBZ2VudEh1Yk1ldGEobWV0YSkgewogICAgICAgICAgICBpZiAoIW1ldGEpIHsKICAgICAgICAgICAgICByZXR1cm4gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGFydHMgPSBbXTsKICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShtZXRhLnJvd3MpKSB7CiAgICAgICAgICAgICAgcGFydHMucHVzaChgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KG1ldGEucm93cyl9IHJvd3NgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKG1ldGEuc2tpcHBlZCkgJiYgbWV0YS5za2lwcGVkID4gMCkgewogICAgICAgICAgICAgIHBhcnRzLnB1c2goYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChtZXRhLnNraXBwZWQpfSBza2lwcGVkYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1ldGEuc2l6ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgcGFydHMucHVzaChmb3JtYXRGaWxlU2l6ZShtZXRhLnNpemUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobWV0YS5sYXN0TW9kaWZpZWQpIHsKICAgICAgICAgICAgICBjb25zdCBtb2RpZmllZCA9IG5ldyBEYXRlKG1ldGEubGFzdE1vZGlmaWVkKTsKICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc05hTihtb2RpZmllZC5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGBNb2RpZmllZCAke2Zvcm1hdFNob3J0RGF0ZShtb2RpZmllZCl9YCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGgpIHsKICAgICAgICAgICAgICByZXR1cm4gbWV0YS5zb3VyY2VOYW1lID8gYCR7bWV0YS5zb3VyY2VOYW1lfSR7QlVMTEVUX1NFUEFSQVRPUn0ke3BhcnRzLmpvaW4oQlVMTEVUX1NFUEFSQVRPUil9YCA6IHBhcnRzLmpvaW4oQlVMTEVUX1NFUEFSQVRPUik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG1ldGEuc291cmNlTmFtZSB8fCAiIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVBZ2VudEh1YkVtcHR5U3RhdGUodHlwZSwgb3B0aW9ucyA9IHt9KSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICBpZiAoIXNlY3Rpb24gfHwgIXNlY3Rpb24uZW1wdHkpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLm1lc3NhZ2UgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgc2VjdGlvbi5lbXB0eS50ZXh0Q29udGVudCA9IG9wdGlvbnMubWVzc2FnZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMuaGlkZGVuID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgICBzZWN0aW9uLmVtcHR5LmhpZGRlbiA9IG9wdGlvbnMuaGlkZGVuOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0QWdlbnRIdWJUeXBlTGFiZWwodHlwZSkgewogICAgICAgICAgICByZXR1cm4gYWdlbnRIdWJUeXBlTGFiZWxzW3R5cGVdIHx8ICJBZ2VudCBDU1YiOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEFnZW50SHViRGVmYXVsdEVtcHR5TWVzc2FnZSh0eXBlKSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICByZXR1cm4gc2VjdGlvbiAmJiBzZWN0aW9uLmRlZmF1bHRzID8gc2VjdGlvbi5kZWZhdWx0cy5lbXB0eSA6ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0QWdlbnRIdWIoKSB7CiAgICAgICAgICAgIEFHRU5UX0hVQl9UWVBFUy5mb3JFYWNoKHR5cGUgPT4gewogICAgICAgICAgICAgIHJlc2V0QWdlbnRIdWJEYXRhc2V0KHR5cGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJSZXNldFZpc2liaWxpdHkoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZXNldEFnZW50SHViRGF0YXNldCh0eXBlLCBvcHRpb25zID0ge30pIHsKICAgICAgICAgICAgaWYgKHN0YXRlLmFnZW50SHViICYmIHN0YXRlLmFnZW50SHViLmRhdGFzZXRzICYmIHN0YXRlLmFnZW50SHViLmRhdGFzZXRzW3R5cGVdKSB7CiAgICAgICAgICAgICAgc3RhdGUuYWdlbnRIdWIuZGF0YXNldHNbdHlwZV0ucm93cyA9IFtdOwogICAgICAgICAgICAgIHN0YXRlLmFnZW50SHViLmRhdGFzZXRzW3R5cGVdLm1ldGEgPSBudWxsOwogICAgICAgICAgICAgIGlmIChzdGF0ZS5hZ2VudEh1Yi5maWx0ZXJzKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5hZ2VudEh1Yi5maWx0ZXJzW3R5cGVdID0gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5hZ2VudEh1Yi5zb3J0KSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5hZ2VudEh1Yi5zb3J0W3R5cGVdID0geyBjb2x1bW46IG51bGwsIGRpcmVjdGlvbjogImFzYyIgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc2VjdGlvbiA9IGFnZW50SHViU2VjdGlvbnNbdHlwZV07CiAgICAgICAgICAgIGlmICghc2VjdGlvbikgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VjdGlvbi50Ym9keSkgewogICAgICAgICAgICAgIHNlY3Rpb24udGJvZHkuaW5uZXJIVE1MID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNlY3Rpb24udGFibGVXcmFwcGVyKSB7CiAgICAgICAgICAgICAgc2VjdGlvbi50YWJsZVdyYXBwZXIuaGlkZGVuID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VjdGlvbi5zdGF0dXMgJiYgc2VjdGlvbi5kZWZhdWx0cykgewogICAgICAgICAgICAgIHNlY3Rpb24uc3RhdHVzLnRleHRDb250ZW50ID0gc2VjdGlvbi5kZWZhdWx0cy5zdGF0dXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNlY3Rpb24ubWV0YSAmJiBzZWN0aW9uLmRlZmF1bHRzKSB7CiAgICAgICAgICAgICAgc2VjdGlvbi5tZXRhLnRleHRDb250ZW50ID0gc2VjdGlvbi5kZWZhdWx0cy5tZXRhOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWN0aW9uLmVtcHR5ICYmIHNlY3Rpb24uZGVmYXVsdHMpIHsKICAgICAgICAgICAgICBzZWN0aW9uLmVtcHR5LmhpZGRlbiA9IGZhbHNlOwogICAgICAgICAgICAgIHNlY3Rpb24uZW1wdHkudGV4dENvbnRlbnQgPSBzZWN0aW9uLmRlZmF1bHRzLmVtcHR5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzZWN0aW9uLmlucHV0KSB7CiAgICAgICAgICAgICAgc2VjdGlvbi5pbnB1dC52YWx1ZSA9ICIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZUFnZW50SHViRmlsdGVyQ29udHJvbHModHlwZSk7CiAgICAgICAgICAgIHRvZ2dsZUFnZW50SHViRmlsdGVyQmFyKHR5cGUsIGZhbHNlKTsKICAgICAgICAgICAgdXBkYXRlQWdlbnRIdWJTb3J0SW5kaWNhdG9ycyh0eXBlKTsKICAgICAgICAgICAgaWYgKCFvcHRpb25zLnNraXBQZXJzaXN0KSB7CiAgICAgICAgICAgICAgcGVyc2lzdEFnZW50SHViU25hcHNob3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldEFnZW50SHViQWN0aXZlVGFiKHRhYikgewogICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBBR0VOVF9IVUJfVFlQRVMuaW5jbHVkZXModGFiKSA/IHRhYiA6ICJ1c2VycyI7CiAgICAgICAgICAgIGlmIChzdGF0ZS5hZ2VudEh1YikgewogICAgICAgICAgICAgIHN0YXRlLmFnZW50SHViLmFjdGl2ZVRhYiA9IHRhcmdldDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9tLmFnZW50SHViVGFiQnV0dG9ucyAmJiBkb20uYWdlbnRIdWJUYWJCdXR0b25zLmxlbmd0aCkgewogICAgICAgICAgICAgIGRvbS5hZ2VudEh1YlRhYkJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gewogICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uVGFiID0gYnV0dG9uLmdldEF0dHJpYnV0ZSgiZGF0YS1hZ2VudC10YWIiKTsKICAgICAgICAgICAgICAgIGlmIChidXR0b25UYWIgPT09IHRhcmdldCkgewogICAgICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgiaXMtYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtc2VsZWN0ZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoImlzLWFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLXNlbGVjdGVkIiwgImZhbHNlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQUdFTlRfSFVCX1RZUEVTLmZvckVhY2godHlwZSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgcGFuZWwgPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdID8gYWdlbnRIdWJTZWN0aW9uc1t0eXBlXS5wYW5lbCA6IG51bGw7CiAgICAgICAgICAgICAgaWYgKHBhbmVsKSB7CiAgICAgICAgICAgICAgICBwYW5lbC5oaWRkZW4gPSB0eXBlICE9PSB0YXJnZXQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVBZ2VudEh1YlJlc2V0VmlzaWJpbGl0eSgpIHsKICAgICAgICAgICAgaWYgKCFkb20uYWdlbnRIdWJSZXNldCkgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBoYXNEYXRhID0gQUdFTlRfSFVCX1RZUEVTLnNvbWUodHlwZSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHN0YXRlLmFnZW50SHViICYmIHN0YXRlLmFnZW50SHViLmRhdGFzZXRzID8gc3RhdGUuYWdlbnRIdWIuZGF0YXNldHNbdHlwZV0gOiBudWxsOwogICAgICAgICAgICAgIHJldHVybiAhIShkYXRhc2V0ICYmIEFycmF5LmlzQXJyYXkoZGF0YXNldC5yb3dzKSAmJiBkYXRhc2V0LnJvd3MubGVuZ3RoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGRvbS5hZ2VudEh1YlJlc2V0LmhpZGRlbiA9ICFoYXNEYXRhOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGV2ZW50Q29udGFpbnNGaWxlcyhldmVudCkgewogICAgICAgICAgICBpZiAoIWV2ZW50IHx8ICFldmVudC5kYXRhVHJhbnNmZXIpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgdHlwZXMgPSBldmVudC5kYXRhVHJhbnNmZXIudHlwZXM7CiAgICAgICAgICAgIGlmICghdHlwZXMpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdHlwZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVzW2luZGV4XSA9PT0gIkZpbGVzIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBmaWx0ZXJBZ2VudEh1YlJvd3ModHlwZSwgcm93cykgewogICAgICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZSA9IChzdGF0ZS5hZ2VudEh1Yj8uZmlsdGVycz8uW3R5cGVdIHx8ICIiKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYgKCFmaWx0ZXJWYWx1ZSkgewogICAgICAgICAgICAgIHJldHVybiByb3dzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGFnZW50SHViRGF0YXNldENvbmZpZ1t0eXBlXTsKICAgICAgICAgICAgaWYgKCFjb25maWcgfHwgIUFycmF5LmlzQXJyYXkoY29uZmlnLmZpbHRlcktleXMpIHx8ICFjb25maWcuZmlsdGVyS2V5cy5sZW5ndGgpIHsKICAgICAgICAgICAgICByZXR1cm4gcm93czsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcm93cy5maWx0ZXIocm93ID0+IGNvbmZpZy5maWx0ZXJLZXlzLnNvbWUoa2V5ID0+IHsKICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHJvd1trZXldIHx8IHJvd1tgJHtrZXl9UmF3YF07CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgJiYgdmFsdWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZSk7CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYXZlQWdlbnRIdWJTbmFwc2hvdFRvSW5kZXhlZERCKHNuYXBzaG90ID0ge30pIHsKICAgICAgICAgICAgaWYgKCFEQVRBX0RCX1NVUFBPUlRFRCkgewogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoIkluZGV4ZWREQiBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlci4iKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wZW5EYXRhc2V0RGF0YWJhc2UoKS50aGVuKGRiID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKERBVEFfREJfQUdFTlRfSFVCX1NUT1JFLCAicmVhZHdyaXRlIik7CiAgICAgICAgICAgICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShEQVRBX0RCX0FHRU5UX0hVQl9TVE9SRSk7CiAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gewogICAgICAgICAgICAgICAgaWQ6IERBVEFfREJfQUdFTlRfSFVCX0tFWSwKICAgICAgICAgICAgICAgIGRhdGE6IHNuYXBzaG90LAogICAgICAgICAgICAgICAgc2F2ZWRBdDogRGF0ZS5ub3coKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgc3RvcmUucHV0KHJlY29yZCk7CiAgICAgICAgICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7CiAgICAgICAgICAgICAgICByZXNvbHZlKHJlY29yZCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5vbmVycm9yID0gZXZlbnQgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSB0cmFuc2FjdGlvbi5lcnJvciB8fCBldmVudC50YXJnZXQuZXJyb3I7CiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yIHx8IG5ldyBFcnJvcigiVW5hYmxlIHRvIHN0b3JlIGFnZW50IGh1YiBkYXRhc2V0cy4iKSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRlbGV0ZUFnZW50SHViU25hcHNob3RGcm9tSW5kZXhlZERCKCkgewogICAgICAgICAgICBpZiAoIURBVEFfREJfU1VQUE9SVEVEKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBvcGVuRGF0YXNldERhdGFiYXNlKCkudGhlbihkYiA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihEQVRBX0RCX0FHRU5UX0hVQl9TVE9SRSwgInJlYWR3cml0ZSIpOwogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9BR0VOVF9IVUJfU1RPUkUpOwogICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5kZWxldGUoREFUQV9EQl9BR0VOVF9IVUJfS0VZKTsKICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHJlcXVlc3QuZXJyb3IgfHwgbmV3IEVycm9yKCJVbmFibGUgdG8gZGVsZXRlIHN0b3JlZCBhZ2VudCBodWIgZGF0YXNldHMuIik7CiAgICAgICAgICAgICAgICBkYi5jbG9zZSgpOwogICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4gewogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbG9hZEFnZW50SHViU25hcHNob3RGcm9tSW5kZXhlZERCKCkgewogICAgICAgICAgICBpZiAoIURBVEFfREJfU1VQUE9SVEVEKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gb3BlbkRhdGFzZXREYXRhYmFzZSgpLnRoZW4oZGIgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oREFUQV9EQl9BR0VOVF9IVUJfU1RPUkUsICJyZWFkb25seSIpOwogICAgICAgICAgICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoREFUQV9EQl9BR0VOVF9IVUJfU1RPUkUpOwogICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXQoREFUQV9EQl9BR0VOVF9IVUJfS0VZKTsKICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IHJlcXVlc3QuZXJyb3IgfHwgbmV3IEVycm9yKCJVbmFibGUgdG8gcmVhZCBzdG9yZWQgYWdlbnQgaHViIGRhdGFzZXRzLiIpOwogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHJlcXVlc3QucmVzdWx0OwogICAgICAgICAgICAgICAgZGIuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGlmICghcmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmUobnVsbCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc29sdmUocmVjb3JkLmRhdGEgfHwge30pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzb3J0QWdlbnRIdWJSb3dzKHR5cGUsIHJvd3MpIHsKICAgICAgICAgICAgY29uc3Qgc29ydFN0YXRlID0gc3RhdGUuYWdlbnRIdWI/LnNvcnQ/Llt0eXBlXTsKICAgICAgICAgICAgY29uc3QgY29sdW1uID0gc29ydFN0YXRlPy5jb2x1bW47CiAgICAgICAgICAgIGlmICghY29sdW1uKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJvd3M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY29uZmlnID0gYWdlbnRIdWJEYXRhc2V0Q29uZmlnW3R5cGVdOwogICAgICAgICAgICBpZiAoIWNvbmZpZykgewogICAgICAgICAgICAgIHJldHVybiByb3dzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNvbHVtbkNvbmZpZyA9IGNvbmZpZy5jb2x1bW5zLmZpbmQoY29sID0+IGNvbC5rZXkgPT09IGNvbHVtbik7CiAgICAgICAgICAgIGlmICghY29sdW1uQ29uZmlnKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJvd3M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gc29ydFN0YXRlLmRpcmVjdGlvbiA9PT0gImRlc2MiID8gLTEgOiAxOwogICAgICAgICAgICByZXR1cm4gcm93cy5zbGljZSgpLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICBjb25zdCBjb21wYXJpc29uID0gY29tcGFyZUFnZW50SHViVmFsdWVzKGNvbHVtbkNvbmZpZy50eXBlLCBhW2NvbHVtbl0sIGJbY29sdW1uXSk7CiAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmlzb24gKiBkaXJlY3Rpb247CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVBZ2VudEh1YlZhbHVlcyh0eXBlLCBhVmFsdWUsIGJWYWx1ZSkgewogICAgICAgICAgICBpZiAodHlwZSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICBjb25zdCBhTnVtYmVyID0gTnVtYmVyLmlzRmluaXRlKGFWYWx1ZSkgPyBhVmFsdWUgOiAwOwogICAgICAgICAgICAgIGNvbnN0IGJOdW1iZXIgPSBOdW1iZXIuaXNGaW5pdGUoYlZhbHVlKSA/IGJWYWx1ZSA6IDA7CiAgICAgICAgICAgICAgcmV0dXJuIGFOdW1iZXIgLSBiTnVtYmVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlID09PSAiZGF0ZSIpIHsKICAgICAgICAgICAgICBjb25zdCBhVGltZSA9IGFWYWx1ZSBpbnN0YW5jZW9mIERhdGUgJiYgIU51bWJlci5pc05hTihhVmFsdWUuZ2V0VGltZSgpKSA/IGFWYWx1ZS5nZXRUaW1lKCkgOiAtSW5maW5pdHk7CiAgICAgICAgICAgICAgY29uc3QgYlRpbWUgPSBiVmFsdWUgaW5zdGFuY2VvZiBEYXRlICYmICFOdW1iZXIuaXNOYU4oYlZhbHVlLmdldFRpbWUoKSkgPyBiVmFsdWUuZ2V0VGltZSgpIDogLUluZmluaXR5OwogICAgICAgICAgICAgIHJldHVybiBhVGltZSAtIGJUaW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGFUZXh0ID0gU3RyaW5nKGFWYWx1ZSB8fCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgY29uc3QgYlRleHQgPSBTdHJpbmcoYlZhbHVlIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gYVRleHQubG9jYWxlQ29tcGFyZShiVGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2V0QWdlbnRIdWJGaWx0ZXIodHlwZSwgdmFsdWUpIHsKICAgICAgICAgICAgaWYgKCFzdGF0ZS5hZ2VudEh1YiB8fCAhc3RhdGUuYWdlbnRIdWIuZmlsdGVycykgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdGF0ZS5hZ2VudEh1Yi5maWx0ZXJzW3R5cGVdID0gdmFsdWUgfHwgIiI7CiAgICAgICAgICAgIHJlbmRlckFnZW50SHViVGFibGUodHlwZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2V0QWdlbnRIdWJTb3J0KHR5cGUsIGNvbHVtbikgewogICAgICAgICAgICBpZiAoIXN0YXRlLmFnZW50SHViIHx8ICFzdGF0ZS5hZ2VudEh1Yi5zb3J0IHx8ICFjb2x1bW4pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHN0YXRlLmFnZW50SHViLnNvcnRbdHlwZV0gfHwgeyBjb2x1bW46IG51bGwsIGRpcmVjdGlvbjogImFzYyIgfTsKICAgICAgICAgICAgbGV0IGRpcmVjdGlvbiA9ICJhc2MiOwogICAgICAgICAgICBpZiAoY3VycmVudC5jb2x1bW4gPT09IGNvbHVtbikgewogICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGN1cnJlbnQuZGlyZWN0aW9uID09PSAiYXNjIiA/ICJkZXNjIiA6ICJhc2MiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0YXRlLmFnZW50SHViLnNvcnRbdHlwZV0gPSB7IGNvbHVtbiwgZGlyZWN0aW9uIH07CiAgICAgICAgICAgIHJlbmRlckFnZW50SHViVGFibGUodHlwZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQWdlbnRIdWJGaWx0ZXJDb250cm9scyh0eXBlKSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICBpZiAoIXNlY3Rpb24pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZmlsdGVyVmFsdWUgPSBzdGF0ZS5hZ2VudEh1Yj8uZmlsdGVycz8uW3R5cGVdIHx8ICIiOwogICAgICAgICAgICBpZiAoc2VjdGlvbi5maWx0ZXJJbnB1dCAmJiBzZWN0aW9uLmZpbHRlcklucHV0LnZhbHVlICE9PSBmaWx0ZXJWYWx1ZSkgewogICAgICAgICAgICAgIHNlY3Rpb24uZmlsdGVySW5wdXQudmFsdWUgPSBmaWx0ZXJWYWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2VjdGlvbi5maWx0ZXJDbGVhcikgewogICAgICAgICAgICAgIHNlY3Rpb24uZmlsdGVyQ2xlYXIuaGlkZGVuID0gIWZpbHRlclZhbHVlLnRyaW0oKS5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVBZ2VudEh1YkZpbHRlckJhcih0eXBlLCB2aXNpYmxlKSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICBpZiAoc2VjdGlvbiAmJiBzZWN0aW9uLmZpbHRlckJhcikgewogICAgICAgICAgICAgIHNlY3Rpb24uZmlsdGVyQmFyLmhpZGRlbiA9ICF2aXNpYmxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQWdlbnRIdWJTb3J0SW5kaWNhdG9ycyh0eXBlKSB7CiAgICAgICAgICAgIGNvbnN0IHNlY3Rpb24gPSBhZ2VudEh1YlNlY3Rpb25zW3R5cGVdOwogICAgICAgICAgICBpZiAoIXNlY3Rpb24gfHwgIXNlY3Rpb24uc29ydEJ1dHRvbnMpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qgc29ydFN0YXRlID0gc3RhdGUuYWdlbnRIdWI/LnNvcnQ/Llt0eXBlXSB8fCB7IGNvbHVtbjogbnVsbCwgZGlyZWN0aW9uOiAiYXNjIiB9OwogICAgICAgICAgICBzZWN0aW9uLnNvcnRCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsKICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSBidXR0b24uZ2V0QXR0cmlidXRlKCJkYXRhLWFnZW50LWh1Yi1zb3J0LWtleSIpOwogICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gY29sdW1uICYmIGNvbHVtbiA9PT0gc29ydFN0YXRlLmNvbHVtbjsKICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgiaXMtYWN0aXZlIiwgQm9vbGVhbihpc0FjdGl2ZSkpOwogICAgICAgICAgICAgIGNvbnN0IGluZGljYXRvciA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCIuYWdlbnQtc29ydC1pbmRpY2F0b3IiKTsKICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yKSB7CiAgICAgICAgICAgICAgICBpbmRpY2F0b3IudGV4dENvbnRlbnQgPSBpc0FjdGl2ZSA/IChzb3J0U3RhdGUuZGlyZWN0aW9uID09PSAiZGVzYyIgPyAi4pa8IiA6ICLilrIiKSA6ICIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCB0aCA9IGJ1dHRvbi5jbG9zZXN0KCJ0aCIpOwogICAgICAgICAgICAgIGlmICh0aCkgewogICAgICAgICAgICAgICAgdGguc2V0QXR0cmlidXRlKCJhcmlhLXNvcnQiLCBpc0FjdGl2ZSA/IChzb3J0U3RhdGUuZGlyZWN0aW9uID09PSAiZGVzYyIgPyAiZGVzY2VuZGluZyIgOiAiYXNjZW5kaW5nIikgOiAibm9uZSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlckRhc2hib2FyZCgpIHsNCiAgICAgICAgICAgIHVwZGF0ZVNlcmllc1RvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICB1cGRhdGVTZXJpZXNEZXRhaWxNb2RlQnV0dG9uKCk7DQogICAgICAgICAgICB1cGRhdGVDdXN0b21SYW5nZUhpbnQoKTsNCiAgICAgICAgICAgIHVwZGF0ZVRoZW1lVG9nZ2xlVUkoKTsNCiAgICAgICAgICAgIHVwZGF0ZVNuYXBzaG90Q29udHJvbHNBdmFpbGFiaWxpdHkoKTsNCiAgICAgICAgICAgIHVwZGF0ZUZpbHRlckNoaXBzKCk7DQogICAgICAgICAgICBzeW5jVXNhZ2VUaHJlc2hvbGRJbnB1dHMoKTsNCiAgICAgICAgICAgIHVwZGF0ZVJldHVybmluZ01ldHJpY1RvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICB1cGRhdGVSZXR1cm5pbmdJbnRlcnZhbFRvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICB1cGRhdGVUcmVuZFZpZXdUb2dnbGVTdGF0ZSgpOw0KICAgICAgICAgICAgdXBkYXRlQWN0aXZlRGF5c1RvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICBpZiAoZG9tLnJldHVybmluZ01ldHJpYyAmJiBkb20ucmV0dXJuaW5nTWV0cmljLnZhbHVlICE9PSBzdGF0ZS5yZXR1cm5pbmdNZXRyaWMpIHsNCiAgICAgICAgICAgICAgZG9tLnJldHVybmluZ01ldHJpYy52YWx1ZSA9IHN0YXRlLnJldHVybmluZ01ldHJpYzsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5yb3dzLmxlbmd0aCkgewogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5QWN0aW9ucy50ZXh0Q29udGVudCA9ICItIjsKICAgICAgICAgICAgICBkb20uc3VtbWFyeUhvdXJzLnRleHRDb250ZW50ID0gIi0iOwogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5VXNlcnMudGV4dENvbnRlbnQgPSAiLSI7CiAgICAgICAgICAgICAgc2V0TGF0ZXN0U3VtbWFyeShudWxsLCBudWxsKTsKICAgICAgICAgICAgICBkb20uc3VtbWFyeUFjdGlvbnNOb3RlLnRleHRDb250ZW50ID0gIlVwbG9hZCBkYXRhIHRvIGJlZ2luLiI7DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5SG91cnNOb3RlLnRleHRDb250ZW50ID0gIlVwbG9hZCBkYXRhIHRvIGJlZ2luLiI7DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5VXNlcnNOb3RlLnRleHRDb250ZW50ID0gIlVwbG9hZCBkYXRhIHRvIGJlZ2luLiI7DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0Tm90ZS50ZXh0Q29udGVudCA9ICJMYXRlc3QgcGVyaW9kIGFwcGVhcnMgYWZ0ZXIgcGFyc2luZy4iOw0KICAgICAgICAgICAgICBkb20udHJlbmRDYXB0aW9uLnRleHRDb250ZW50ID0gIlVwbG9hZCBkYXRhIHRvIHZpc3VhbGl6ZSBtb21lbnR1bS4iOw0KICAgICAgICAgICAgICBkb20udHJlbmRXaW5kb3cudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgIGRvbS50cmVuZEVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQuZGF0YS5sYWJlbHMgPSBbXTsNCiAgICAgICAgICAgICAgc3RhdGUuY2hhcnRzLnRyZW5kLmRhdGEuZGF0YXNldHMgPSBbXTsNCiAgICAgICAgICAgICAgc3RhdGUuY2hhcnRzLnRyZW5kLnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgICBkb20uZ3JvdXBCb2R5LmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgICBkb20uZ3JvdXBDYXB0aW9uLnRleHRDb250ZW50ID0gIlNlbGVjdCBhIG1ldHJpYyBhbmQgdmlldyB0byBjb21wYXJlIGdyb3Vwcy4iOw0KICAgICAgICAgICAgICBkb20udmlld01vcmVCdXR0b24uaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgYnVpbGRUb3BVc2Vyc0xpc3QoW10pOw0KICAgICAgICAgICAgICB1cGRhdGVDYXRlZ29yeUNhcmRzKG51bGwpOw0KICAgICAgICAgICAgICB1cGRhdGVBZG9wdGlvbkJ5QXBwKG51bGwpOw0KICAgICAgICAgICAgICB1cGRhdGVVc2FnZUludGVuc2l0eShudWxsKTsNCiAgICAgICAgICAgICAgdXBkYXRlRW5hYmxlZExpY2Vuc2VzQ2hhcnQobnVsbCk7DQogICAgICAgICAgICAgIHVwZGF0ZVJldHVybmluZ1VzZXJzKG51bGwpOw0KICAgICAgICAgICAgICB1cGRhdGVBY3RpdmVEYXlzQ2FyZChudWxsKTsNCiAgICAgICAgICAgICAgdXBkYXRlQWdlbnRVc2FnZUNhcmQoc3RhdGUuYWdlbnRVc2FnZVJvd3MpOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RUcmVuZFBlcmlvZHMgPSBbXTsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0R3JvdXBEYXRhID0gbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0VG9wVXNlcnMgPSBbXTsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0UmV0dXJuaW5nQWdncmVnYXRlcyA9IG51bGw7DQogICAgICAgICAgICAgIHN0YXRlLmxhdGVzdEFkb3B0aW9uID0gbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0QWN0aXZlRGF5cyA9IG51bGw7DQogICAgICAgICAgICAgIHN0YXRlLmxhdGVzdEVuYWJsZWRUaW1lbGluZSA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RQZXJBcHBBY3Rpb25zID0gW107DQogICAgICAgICAgICAgIHN0YXRlLmdyb3Vwc0V4cGFuZGVkID0gZmFsc2U7DQogICAgICAgICAgICAgIHN0YXRlLnRvcFVzZXJzRXhwYW5kZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgdXBkYXRlRXhwb3J0RGV0YWlsT3B0aW9uKCk7DQogICAgICAgICAgICAgIHNldFRyZW5kQ29sb3JDb250cm9sc1Zpc2liaWxpdHkoZmFsc2UpOw0KICAgICAgICAgICAgICBpZiAoZG9tLnNlcmllc01vZGVUb2dnbGUpIHsNCiAgICAgICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgZG9tLnNlcmllc01vZGVUb2dnbGUuY2xhc3NMaXN0LmFkZCgiaXMtZGlzYWJsZWQiKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkID0gYXBwbHlGaWx0ZXJzKHN0YXRlLnJvd3MpOw0KICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlcnMudGltZWZyYW1lID09PSAiY3VzdG9tIiAmJiBzdGF0ZS5maWx0ZXJzLmN1c3RvbVJhbmdlSW52YWxpZCkgew0KICAgICAgICAgICAgICBoYW5kbGVJbnZhbGlkQ3VzdG9tUmFuZ2UoKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFmaWx0ZXJlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICBkb20uc3VtbWFyeUFjdGlvbnMudGV4dENvbnRlbnQgPSAiMCI7CiAgICAgICAgICAgICAgZG9tLnN1bW1hcnlIb3Vycy50ZXh0Q29udGVudCA9ICIwIjsKICAgICAgICAgICAgICBkb20uc3VtbWFyeVVzZXJzLnRleHRDb250ZW50ID0gIjAiOwogICAgICAgICAgICAgIHNldExhdGVzdFN1bW1hcnkobnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgZG9tLnN1bW1hcnlBY3Rpb25zTm90ZS50ZXh0Q29udGVudCA9ICJObyByb3dzIG1hdGNoIHRoZSBjdXJyZW50IGZpbHRlcnMuIjsNCiAgICAgICAgICAgICAgZG9tLnN1bW1hcnlIb3Vyc05vdGUudGV4dENvbnRlbnQgPSAiTm8gcm93cyBtYXRjaCB0aGUgY3VycmVudCBmaWx0ZXJzLiI7DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5VXNlcnNOb3RlLnRleHRDb250ZW50ID0gIkFkanVzdCBmaWx0ZXJzIHRvIHNlZSB1c2Vycy4iOw0KICAgICAgICAgICAgICBkb20uc3VtbWFyeUxhdGVzdE5vdGUudGV4dENvbnRlbnQgPSAiQWRqdXN0IGZpbHRlcnMgdG8gc2VlIGEgbGF0ZXN0IHBlcmlvZC4iOw0KICAgICAgICAgICAgICBkb20udHJlbmRDYXB0aW9uLnRleHRDb250ZW50ID0gIk5vIGRhdGEgZm9yIHRoZSBzZWxlY3RlZCBmaWx0ZXJzLiI7DQogICAgICAgICAgICAgIGRvbS50cmVuZFdpbmRvdy50ZXh0Q29udGVudCA9ICItIjsNCiAgICAgICAgICAgICAgZG9tLnRyZW5kRW1wdHkudGV4dENvbnRlbnQgPSAiTm8gZGF0YSBmb3IgdGhlIHNlbGVjdGVkIGZpbHRlcnMuIjsNCiAgICAgICAgICAgICAgZG9tLnRyZW5kRW1wdHkuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy50cmVuZC5kYXRhLmxhYmVscyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQuZGF0YS5kYXRhc2V0cyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQudXBkYXRlKCJub25lIik7DQogICAgICAgICAgICAgIGRvbS5ncm91cEJvZHkuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICAgIGRvbS5ncm91cENhcHRpb24udGV4dENvbnRlbnQgPSAiTm8gZ3JvdXAgZGF0YSBhdmFpbGFibGUgZm9yIHRoZSBjdXJyZW50IGZpbHRlcnMuIjsNCiAgICAgICAgICAgICAgZG9tLnZpZXdNb3JlQnV0dG9uLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgIGJ1aWxkVG9wVXNlcnNMaXN0KFtdKTsNCiAgICAgICAgICAgICAgdXBkYXRlQ2F0ZWdvcnlDYXJkcyhudWxsKTsNCiAgICAgICAgICAgICAgdXBkYXRlQWRvcHRpb25CeUFwcChudWxsKTsNCiAgICAgICAgICAgICAgdXBkYXRlVXNhZ2VJbnRlbnNpdHkobnVsbCk7DQogICAgICAgICAgICAgIHVwZGF0ZUVuYWJsZWRMaWNlbnNlc0NoYXJ0KG51bGwpOw0KICAgICAgICAgICAgICB1cGRhdGVSZXR1cm5pbmdVc2VycyhudWxsKTsNCiAgICAgICAgICAgICAgdXBkYXRlQWN0aXZlRGF5c0NhcmQobnVsbCk7DQogICAgICAgICAgICAgIHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RHcm91cERhdGEgPSBudWxsOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RUb3BVc2VycyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RSZXR1cm5pbmdBZ2dyZWdhdGVzID0gbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0QWRvcHRpb24gPSBudWxsOw0KICAgICAgICAgICAgICBzdGF0ZS5sYXRlc3RBY3RpdmVEYXlzID0gbnVsbDsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0RW5hYmxlZFRpbWVsaW5lID0gW107DQogICAgICAgICAgICAgIHN0YXRlLmdyb3Vwc0V4cGFuZGVkID0gZmFsc2U7DQogICAgICAgICAgICAgIHN0YXRlLnRvcFVzZXJzRXhwYW5kZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgdXBkYXRlRXhwb3J0RGV0YWlsT3B0aW9uKCk7DQogICAgICAgICAgICAgIHNldFRyZW5kQ29sb3JDb250cm9sc1Zpc2liaWxpdHkoZmFsc2UpOw0KICAgICAgICAgICAgICBpZiAoZG9tLnNlcmllc01vZGVUb2dnbGUpIHsNCiAgICAgICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgZG9tLnNlcmllc01vZGVUb2dnbGUuY2xhc3NMaXN0LmFkZCgiaXMtZGlzYWJsZWQiKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGFnZ3JlZ2F0ZXMgPSBjb21wdXRlQWdncmVnYXRlcyhmaWx0ZXJlZCk7DQogICAgICAgICAgICBjb25zdCBzdXBwbGVtZW50YWwgPSBidWlsZFN1cHBsZW1lbnRhbEluc2lnaHRzKGZpbHRlcmVkKTsNCiAgICAgICAgICAgIHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA9IEFycmF5LmlzQXJyYXkoYWdncmVnYXRlcy5wZXJpb2RzKSA/IGFnZ3JlZ2F0ZXMucGVyaW9kcy5zbGljZSgpIDogW107DQogICAgICAgICAgICBzdGF0ZS5sYXRlc3RFbmFibGVkVGltZWxpbmUgPSBBcnJheS5pc0FycmF5KGFnZ3JlZ2F0ZXMubW9udGhseUVuYWJsZWRVc2VycykgPyBhZ2dyZWdhdGVzLm1vbnRobHlFbmFibGVkVXNlcnMuc2xpY2UoKSA6IFtdOw0KICAgICAgICAgICAgc3RhdGUubGF0ZXN0UGVyQXBwQWN0aW9ucyA9IEFycmF5LmlzQXJyYXkoc3VwcGxlbWVudGFsLnBlckFwcEFjdGlvbnMpID8gc3VwcGxlbWVudGFsLnBlckFwcEFjdGlvbnMuc2xpY2UoKSA6IFtdOw0KICAgICAgDQogICAgICAgICAgICBkb20uc3VtbWFyeUFjdGlvbnMudGV4dENvbnRlbnQgPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQoYWdncmVnYXRlcy50b3RhbHMudG90YWxBY3Rpb25zKSk7DQogICAgICAgICAgICBkb20uc3VtbWFyeUhvdXJzLnRleHRDb250ZW50ID0gYCR7aG91cnNGb3JtYXR0ZXIuZm9ybWF0KGFnZ3JlZ2F0ZXMudG90YWxzLmFzc2lzdGVkSG91cnMpfSBocnNgOwogICAgICAgICAgICBkb20uc3VtbWFyeVVzZXJzLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChhZ2dyZWdhdGVzLmFjdGl2ZVVzZXJzLnNpemUpOwogICAgICAgICAgICBpZiAoYWdncmVnYXRlcy5sYXRlc3RXZWVrKSB7CiAgICAgICAgICAgICAgY29uc3QgbWV0cmljVmFsdWUgPQogICAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIKICAgICAgICAgICAgICAgICAgPyBgJHtob3Vyc0Zvcm1hdHRlci5mb3JtYXQoYWdncmVnYXRlcy5sYXRlc3RXZWVrLmFzc2lzdGVkSG91cnMpfSBocnNgCiAgICAgICAgICAgICAgICAgIDogbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKGFnZ3JlZ2F0ZXMubGF0ZXN0V2Vlay50b3RhbEFjdGlvbnMpKTsKICAgICAgICAgICAgICBzZXRMYXRlc3RTdW1tYXJ5KGFnZ3JlZ2F0ZXMubGF0ZXN0V2Vlay5sYWJlbCwgbWV0cmljVmFsdWUpOwogICAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gYWdncmVnYXRlcy5wcmV2aW91c1dlZWsKICAgICAgICAgICAgICAgID8gc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIKICAgICAgICAgICAgICAgICAgPyBhZ2dyZWdhdGVzLmxhdGVzdFdlZWsuYXNzaXN0ZWRIb3VycyAtIGFnZ3JlZ2F0ZXMucHJldmlvdXNXZWVrLmFzc2lzdGVkSG91cnMKICAgICAgICAgICAgICAgICAgOiBhZ2dyZWdhdGVzLmxhdGVzdFdlZWsudG90YWxBY3Rpb25zIC0gYWdncmVnYXRlcy5wcmV2aW91c1dlZWsudG90YWxBY3Rpb25zCiAgICAgICAgICAgICAgICA6IG51bGw7CiAgICAgICAgICAgICAgZG9tLnN1bW1hcnlMYXRlc3ROb3RlLnRleHRDb250ZW50ID0KICAgICAgICAgICAgICAgIGRlbHRhID09IG51bGwKICAgICAgICAgICAgICAgICAgPyAiTm8gcHJpb3IgcGVyaW9kIGF2YWlsYWJsZS4iCiAgICAgICAgICAgICAgICAgIDogYENoYW5nZSB2cyBwcmlvciBwZXJpb2Q6ICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKGRlbHRhKSl9YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZXRMYXRlc3RTdW1tYXJ5KG51bGwsIG51bGwpOwogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0Tm90ZS50ZXh0Q29udGVudCA9ICJObyBsYXRlc3QgcGVyaW9kIGF2YWlsYWJsZS4iOwogICAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgICAgZG9tLnN1bW1hcnlBY3Rpb25zTm90ZS50ZXh0Q29udGVudCA9IGBBY3Jvc3MgJHthZ2dyZWdhdGVzLmZpbHRlcmVkQ291bnR9IHJlY29yZHMgKGF2ZyAke251bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZChhZ2dyZWdhdGVzLmF2ZXJhZ2VBY3Rpb25zUGVyVXNlcikpfSBhY3Rpb25zIHBlciBhY3RpdmUgdXNlcikuYDsNCiAgICAgICAgICAgIGRvbS5zdW1tYXJ5SG91cnNOb3RlLnRleHRDb250ZW50ID0gYEF2ZXJhZ2UgJHtob3Vyc0Zvcm1hdHRlci5mb3JtYXQoYWdncmVnYXRlcy5hdmVyYWdlSG91cnNQZXJVc2VyKX0gaHJzIHBlciBhY3RpdmUgdXNlci5gOw0KICAgICAgICAgICAgY29uc3QgYWN0aXZlVXNlckNvdW50ID0gYWdncmVnYXRlcy5hY3RpdmVVc2Vycy5zaXplOw0KICAgICAgICAgICAgY29uc3QgZW5hYmxlZFVzZXJDb3VudCA9IGFnZ3JlZ2F0ZXMuZW5hYmxlZFVzZXJzIGluc3RhbmNlb2YgU2V0ID8gYWdncmVnYXRlcy5lbmFibGVkVXNlcnMuc2l6ZSA6IDA7DQogICAgICAgICAgICBpZiAoYWN0aXZlVXNlckNvdW50IHx8IGVuYWJsZWRVc2VyQ291bnQpIHsNCiAgICAgICAgICAgICAgY29uc3QgZnJhZ21lbnRzID0gW107DQogICAgICAgICAgICAgIGlmIChhY3RpdmVVc2VyQ291bnQpIHsNCiAgICAgICAgICAgICAgICBmcmFnbWVudHMucHVzaChgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KGFjdGl2ZVVzZXJDb3VudCl9IGFjdGl2ZSAod2l0aCBhY3Rpb25zKWApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChlbmFibGVkVXNlckNvdW50KSB7DQogICAgICAgICAgICAgICAgZnJhZ21lbnRzLnB1c2goYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChlbmFibGVkVXNlckNvdW50KX0gZW5hYmxlZGApOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5VXNlcnNOb3RlLnRleHRDb250ZW50ID0gZnJhZ21lbnRzLmpvaW4oIiDCtyAiKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGRvbS5zdW1tYXJ5VXNlcnNOb3RlLnRleHRDb250ZW50ID0gIk5vIGFjdGl2ZSB1c2VycyBpbiB2aWV3LiI7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIHVwZGF0ZVRyZW5kQ2FwdGlvblRleHQoKTsNCiAgICAgICAgICAgIGRvbS50cmVuZFdpbmRvdy50ZXh0Q29udGVudCA9IGFnZ3JlZ2F0ZXMud2luZG93TGFiZWw7DQoNCiAgICAgICAgICAgIHVwZGF0ZVRyZW5kQ2hhcnQoYWdncmVnYXRlcy5wZXJpb2RzKTsNCiAgICAgICAgICAgIGNvbnN0IHRvdGFsTWV0cmljID0gc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyBhZ2dyZWdhdGVzLnRvdGFscy5hc3Npc3RlZEhvdXJzIDogYWdncmVnYXRlcy50b3RhbHMudG90YWxBY3Rpb25zOw0KICAgICAgICAgICAgc3RhdGUubGF0ZXN0R3JvdXBEYXRhID0gew0KICAgICAgICAgICAgICBncm91cHM6IEFycmF5LmlzQXJyYXkoYWdncmVnYXRlcy5ncm91cHMpID8gYWdncmVnYXRlcy5ncm91cHMgOiBbXSwNCiAgICAgICAgICAgICAgdG90YWxNZXRyaWNWYWx1ZTogdG90YWxNZXRyaWMNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBzdGF0ZS5sYXRlc3RUb3BVc2VycyA9IEFycmF5LmlzQXJyYXkoYWdncmVnYXRlcy50b3BVc2VycykgPyBhZ2dyZWdhdGVzLnRvcFVzZXJzIDogW107DQogICAgICAgICAgICBzdGF0ZS5sYXRlc3RSZXR1cm5pbmdBZ2dyZWdhdGVzID0gew0KICAgICAgICAgICAgICBwZXJpb2RzOiBhZ2dyZWdhdGVzLnBlcmlvZHMsDQogICAgICAgICAgICAgIHdlZWtseVRpbWVsaW5lOiBhZ2dyZWdhdGVzLndlZWtseVRpbWVsaW5lDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgc3RhdGUubGF0ZXN0QWRvcHRpb24gPSBhZ2dyZWdhdGVzLmFkb3B0aW9uOw0KICAgICAgICAgICAgc3RhdGUubGF0ZXN0QWN0aXZlRGF5cyA9IGFnZ3JlZ2F0ZXMuYWN0aXZlRGF5c0xhc3QzMDsNCiAgICAgICAgICAgIHVwZGF0ZUdyb3VwVGFibGUoc3RhdGUubGF0ZXN0R3JvdXBEYXRhLmdyb3Vwcywgc3RhdGUubGF0ZXN0R3JvdXBEYXRhLnRvdGFsTWV0cmljVmFsdWUpOw0KICAgICAgICAgICAgYnVpbGRUb3BVc2Vyc0xpc3Qoc3RhdGUubGF0ZXN0VG9wVXNlcnMpOw0KICAgICAgICAgICAgdXBkYXRlQ2F0ZWdvcnlDYXJkcyhhZ2dyZWdhdGVzLmNhdGVnb3J5VG90YWxzKTsNCiAgICAgICAgICAgIHVwZGF0ZUFkb3B0aW9uQnlBcHAoc3RhdGUubGF0ZXN0QWRvcHRpb24pOw0KICAgICAgICAgICAgdXBkYXRlVXNhZ2VJbnRlbnNpdHkoYWdncmVnYXRlcyk7DQogICAgICAgICAgICB1cGRhdGVFbmFibGVkTGljZW5zZXNDaGFydChzdGF0ZS5sYXRlc3RFbmFibGVkVGltZWxpbmUpOw0KICAgICAgICAgICAgdXBkYXRlUmV0dXJuaW5nVXNlcnMoc3RhdGUubGF0ZXN0UmV0dXJuaW5nQWdncmVnYXRlcyk7DQogICAgICAgICAgICB1cGRhdGVBY3RpdmVEYXlzQ2FyZChzdGF0ZS5sYXRlc3RBY3RpdmVEYXlzKTsNCiAgICAgICAgICAgIHVwZGF0ZUFnZW50VXNhZ2VDYXJkKHN0YXRlLmFnZW50VXNhZ2VSb3dzKTsNCiAgICAgICAgICAgIGlmIChkb20uc2VyaWVzTW9kZVRvZ2dsZSkgew0KICAgICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCJpcy1kaXNhYmxlZCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc2V0VHJlbmRDb2xvckNvbnRyb2xzVmlzaWJpbGl0eShzdGF0ZS5maWx0ZXJzLm1ldHJpYyAhPT0gImhvdXJzIik7DQogICAgICAgICAgICB1cGRhdGVFeHBvcnREZXRhaWxPcHRpb24oKTsNCiAgICAgICAgICB9DQogICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ3VzdG9tUmFuZ2VDaGFuZ2UoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5jdXN0b21SYW5nZVN0YXJ0IHx8ICFkb20uY3VzdG9tUmFuZ2VFbmQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCA9IHBhcnNlRGF0ZUlucHV0VmFsdWUoZG9tLmN1c3RvbVJhbmdlU3RhcnQudmFsdWUpOw0KICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21FbmQgPSBwYXJzZURhdGVJbnB1dFZhbHVlKGRvbS5jdXN0b21SYW5nZUVuZC52YWx1ZSk7DQogICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbVJhbmdlSW52YWxpZCA9IEJvb2xlYW4oc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCAmJiBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCAmJiBzdGF0ZS5maWx0ZXJzLmN1c3RvbVN0YXJ0ID4gc3RhdGUuZmlsdGVycy5jdXN0b21FbmQpOw0KICAgICAgICAgICAgdXBkYXRlQ3VzdG9tUmFuZ2VIaW50KCk7DQogICAgICAgICAgICByZW5kZXJEYXNoYm9hcmQoKTsNCiAgICAgICAgICAgIHBlcnNpc3RGaWx0ZXJQcmVmZXJlbmNlcygpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGVuc3VyZUN1c3RvbVJhbmdlRGVmYXVsdHMoKSB7DQogICAgICAgICAgICBpZiAoIXN0YXRlLmVhcmxpZXN0RGF0ZSB8fCAhc3RhdGUubGF0ZXN0RGF0ZSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIXN0YXRlLmZpbHRlcnMuY3VzdG9tU3RhcnQpIHsNCiAgICAgICAgICAgICAgc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCA9IG5ldyBEYXRlKHN0YXRlLmVhcmxpZXN0RGF0ZS5nZXRUaW1lKCkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCkgew0KICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmN1c3RvbUVuZCA9IG5ldyBEYXRlKHN0YXRlLmxhdGVzdERhdGUuZ2V0VGltZSgpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY3VzdG9tUmFuZ2VJbnZhbGlkID0gZmFsc2U7DQogICAgICAgICAgICBzeW5jQ3VzdG9tUmFuZ2VJbnB1dHMoKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzeW5jQ3VzdG9tUmFuZ2VJbnB1dHMoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5jdXN0b21SYW5nZVN0YXJ0IHx8ICFkb20uY3VzdG9tUmFuZ2VFbmQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbWluVmFsdWUgPSBzdGF0ZS5lYXJsaWVzdERhdGUgPyB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmVhcmxpZXN0RGF0ZSkgOiAiIjsNCiAgICAgICAgICAgIGNvbnN0IG1heFZhbHVlID0gc3RhdGUubGF0ZXN0RGF0ZSA/IHRvRGF0ZUlucHV0VmFsdWUoc3RhdGUubGF0ZXN0RGF0ZSkgOiAiIjsNCiAgICAgICAgICAgIGlmIChtaW5WYWx1ZSkgew0KICAgICAgICAgICAgICBkb20uY3VzdG9tUmFuZ2VTdGFydC5taW4gPSBtaW5WYWx1ZTsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLm1pbiA9IG1pblZhbHVlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQucmVtb3ZlQXR0cmlidXRlKCJtaW4iKTsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLnJlbW92ZUF0dHJpYnV0ZSgibWluIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobWF4VmFsdWUpIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQubWF4ID0gbWF4VmFsdWU7DQogICAgICAgICAgICAgIGRvbS5jdXN0b21SYW5nZUVuZC5tYXggPSBtYXhWYWx1ZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGRvbS5jdXN0b21SYW5nZVN0YXJ0LnJlbW92ZUF0dHJpYnV0ZSgibWF4Iik7DQogICAgICAgICAgICAgIGRvbS5jdXN0b21SYW5nZUVuZC5yZW1vdmVBdHRyaWJ1dGUoIm1heCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlU3RhcnQudmFsdWUgPSBzdGF0ZS5maWx0ZXJzLmN1c3RvbVN0YXJ0ID8gdG9EYXRlSW5wdXRWYWx1ZShzdGF0ZS5maWx0ZXJzLmN1c3RvbVN0YXJ0KSA6ICIiOw0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlRW5kLnZhbHVlID0gc3RhdGUuZmlsdGVycy5jdXN0b21FbmQgPyB0b0RhdGVJbnB1dFZhbHVlKHN0YXRlLmZpbHRlcnMuY3VzdG9tRW5kKSA6ICIiOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUN1c3RvbVJhbmdlVmlzaWJpbGl0eSgpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmN1c3RvbVJhbmdlQ29udGFpbmVyKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGlzQ3VzdG9tID0gc3RhdGUuZmlsdGVycy50aW1lZnJhbWUgPT09ICJjdXN0b20iOw0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlQ29udGFpbmVyLmhpZGRlbiA9ICFpc0N1c3RvbTsNCiAgICAgICAgICAgIGlmIChpc0N1c3RvbSkgew0KICAgICAgICAgICAgICBzeW5jQ3VzdG9tUmFuZ2VJbnB1dHMoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHVwZGF0ZUN1c3RvbVJhbmdlSGludCgpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUN1c3RvbVJhbmdlSGludCgpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmN1c3RvbVJhbmdlSGludCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVycy50aW1lZnJhbWUgIT09ICJjdXN0b20iKSB7DQogICAgICAgICAgICAgIGRvbS5jdXN0b21SYW5nZUhpbnQuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5lYXJsaWVzdERhdGUgfHwgIXN0YXRlLmxhdGVzdERhdGUpIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlSGludC50ZXh0Q29udGVudCA9ICJVcGxvYWQgZGF0YSB0byBlbmFibGUgdGhlIGN1c3RvbSByYW5nZS4iOw0KICAgICAgICAgICAgICBkb20uY3VzdG9tUmFuZ2VIaW50LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoc3RhdGUuZmlsdGVycy5jdXN0b21SYW5nZUludmFsaWQpIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlSGludC50ZXh0Q29udGVudCA9ICJTdGFydCBkYXRlIG11c3QgYmUgb24gb3IgYmVmb3JlIGVuZCBkYXRlLiI7DQogICAgICAgICAgICAgIGRvbS5jdXN0b21SYW5nZUhpbnQuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghc3RhdGUuZmlsdGVycy5jdXN0b21TdGFydCAmJiAhc3RhdGUuZmlsdGVycy5jdXN0b21FbmQpIHsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlSGludC50ZXh0Q29udGVudCA9ICJTZWxlY3Qgc3RhcnQgYW5kIGVuZCBkYXRlcyB3aXRoaW4gdGhlIGRhdGFzZXQgcmFuZ2UuIjsNCiAgICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlSGludC5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG9tLmN1c3RvbVJhbmdlSGludC5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUZpbHRlckNoaXBzKCkgew0KICAgICAgICAgICAgLy8gY2hpcHMgcmVtb3ZlZDsga2VlcCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHN5bmNVc2FnZVRocmVzaG9sZElucHV0cygpIHsKICAgICAgICAgICAgY29uc3QgeyBtaWRkbGUsIGhpZ2ggfSA9IGdldFVzYWdlVGhyZXNob2xkU3RhcnRzKCk7CiAgICAgICAgICAgIGlmIChkb20udXNhZ2VUaHJlc2hvbGRNaWRkbGUgJiYgZG9tLnVzYWdlVGhyZXNob2xkTWlkZGxlLnZhbHVlICE9PSBTdHJpbmcobWlkZGxlKSkgewogICAgICAgICAgICAgIGRvbS51c2FnZVRocmVzaG9sZE1pZGRsZS52YWx1ZSA9IG1pZGRsZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9tLnVzYWdlVGhyZXNob2xkSGlnaCAmJiBkb20udXNhZ2VUaHJlc2hvbGRIaWdoLnZhbHVlICE9PSBTdHJpbmcoaGlnaCkpIHsKICAgICAgICAgICAgICBkb20udXNhZ2VUaHJlc2hvbGRIaWdoLnZhbHVlID0gaGlnaDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldExhdGVzdFN1bW1hcnkocGVyaW9kTGFiZWwsIG1ldHJpY1ZhbHVlKSB7CiAgICAgICAgICAgIGlmIChkb20uc3VtbWFyeUxhdGVzdFBlcmlvZCAmJiBkb20uc3VtbWFyeUxhdGVzdE1ldHJpYykgewogICAgICAgICAgICAgIGlmIChwZXJpb2RMYWJlbCA9PSBudWxsICYmIG1ldHJpY1ZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0UGVyaW9kLnRleHRDb250ZW50ID0gIi0iOwogICAgICAgICAgICAgICAgZG9tLnN1bW1hcnlMYXRlc3RNZXRyaWMudGV4dENvbnRlbnQgPSAiIjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZG9tLnN1bW1hcnlMYXRlc3RQZXJpb2QudGV4dENvbnRlbnQgPSBwZXJpb2RMYWJlbCA/PyAiIjsKICAgICAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0TWV0cmljLnRleHRDb250ZW50ID0gbWV0cmljVmFsdWUgPz8gIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGRvbS5zdW1tYXJ5TGF0ZXN0KSB7CiAgICAgICAgICAgICAgaWYgKHBlcmlvZExhYmVsID09IG51bGwgJiYgbWV0cmljVmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZG9tLnN1bW1hcnlMYXRlc3QudGV4dENvbnRlbnQgPSAiLSI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwZXJpb2RMYWJlbCAmJiBtZXRyaWNWYWx1ZSkgewogICAgICAgICAgICAgICAgZG9tLnN1bW1hcnlMYXRlc3QudGV4dENvbnRlbnQgPSBgJHtwZXJpb2RMYWJlbH0gLSAke21ldHJpY1ZhbHVlfWA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0LnRleHRDb250ZW50ID0gcGVyaW9kTGFiZWwgfHwgbWV0cmljVmFsdWUgfHwgIi0iOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAKICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZUludmFsaWRDdXN0b21SYW5nZSgpIHsKICAgICAgICAgICAgZG9tLnN1bW1hcnlBY3Rpb25zLnRleHRDb250ZW50ID0gIi0iOwogICAgICAgICAgICBkb20uc3VtbWFyeUhvdXJzLnRleHRDb250ZW50ID0gIi0iOwogICAgICAgICAgICBkb20uc3VtbWFyeVVzZXJzLnRleHRDb250ZW50ID0gIi0iOwogICAgICAgICAgICBzZXRMYXRlc3RTdW1tYXJ5KG51bGwsIG51bGwpOwogICAgICAgICAgICBkb20uc3VtbWFyeUFjdGlvbnNOb3RlLnRleHRDb250ZW50ID0gIlNlbGVjdCBhIHZhbGlkIGN1c3RvbSBkYXRlIHJhbmdlLiI7DQogICAgICAgICAgICBkb20uc3VtbWFyeUhvdXJzTm90ZS50ZXh0Q29udGVudCA9ICJTZWxlY3QgYSB2YWxpZCBjdXN0b20gZGF0ZSByYW5nZS4iOw0KICAgICAgICAgICAgZG9tLnN1bW1hcnlVc2Vyc05vdGUudGV4dENvbnRlbnQgPSAiU2VsZWN0IGEgdmFsaWQgY3VzdG9tIGRhdGUgcmFuZ2UuIjsNCiAgICAgICAgICAgIGRvbS5zdW1tYXJ5TGF0ZXN0Tm90ZS50ZXh0Q29udGVudCA9ICJTZWxlY3QgYSB2YWxpZCBjdXN0b20gZGF0ZSByYW5nZS4iOwogICAgICAgICAgICBkb20udHJlbmRDYXB0aW9uLnRleHRDb250ZW50ID0gIkN1c3RvbSBkYXRlIHJhbmdlIGludmFsaWQuIjsNCiAgICAgICAgICAgIGRvbS50cmVuZFdpbmRvdy50ZXh0Q29udGVudCA9ICItIjsNCiAgICAgICAgICAgIGRvbS50cmVuZEVtcHR5LnRleHRDb250ZW50ID0gIkFkanVzdCB0aGUgY3VzdG9tIHJhbmdlIHRvIHZpZXcgZGF0YS4iOw0KICAgICAgICAgICAgZG9tLnRyZW5kRW1wdHkuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLnRyZW5kKSB7DQogICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy50cmVuZC5kYXRhLmxhYmVscyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQuZGF0YS5kYXRhc2V0cyA9IFtdOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudHJlbmQudXBkYXRlKCJub25lIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20uZ3JvdXBCb2R5LmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgZG9tLmdyb3VwQ2FwdGlvbi50ZXh0Q29udGVudCA9ICJBZGp1c3QgdGhlIGN1c3RvbSByYW5nZSB0byBzZWUgZGF0YS4iOw0KICAgICAgICAgICAgZG9tLnZpZXdNb3JlQnV0dG9uLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICBidWlsZFRvcFVzZXJzTGlzdChbXSk7DQogICAgICAgICAgICB1cGRhdGVDYXRlZ29yeUNhcmRzKG51bGwpOw0KICAgICAgICAgICAgdXBkYXRlQWRvcHRpb25CeUFwcChudWxsKTsNCiAgICAgICAgICAgIHVwZGF0ZVVzYWdlSW50ZW5zaXR5KG51bGwpOw0KICAgICAgICAgICAgdXBkYXRlUmV0dXJuaW5nVXNlcnMobnVsbCk7DQogICAgICAgICAgICB1cGRhdGVBY3RpdmVEYXlzQ2FyZChudWxsKTsNCiAgICAgICAgICAgIHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA9IFtdOw0KICAgICAgICAgICAgdXBkYXRlRXhwb3J0RGV0YWlsT3B0aW9uKCk7DQogICAgICAgICAgICBzZXRUcmVuZENvbG9yQ29udHJvbHNWaXNpYmlsaXR5KGZhbHNlKTsNCiAgICAgICAgICAgIGlmIChkb20uc2VyaWVzTW9kZVRvZ2dsZSkgew0KICAgICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgIGRvbS5zZXJpZXNNb2RlVG9nZ2xlLmNsYXNzTGlzdC5hZGQoImlzLWRpc2FibGVkIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlSW5wdXRWYWx1ZSh2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKCF2YWx1ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdmFsdWUuc3BsaXQoIi0iKTsNCiAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggIT09IDMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB5ZWFyID0gTnVtYmVyKHBhcnRzWzBdKTsNCiAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gTnVtYmVyKHBhcnRzWzFdKTsNCiAgICAgICAgICAgIGNvbnN0IGRheSA9IE51bWJlcihwYXJ0c1syXSk7DQogICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh5ZWFyKSB8fCAhTnVtYmVyLmlzRmluaXRlKG1vbnRoKSB8fCAhTnVtYmVyLmlzRmluaXRlKGRheSkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXkpKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB0b0RhdGVJbnB1dFZhbHVlKGRhdGUpIHsNCiAgICAgICAgICAgIGlmICghZGF0ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpOw0KICAgICAgICAgICAgY29uc3QgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRVVENNb250aCgpICsgMSkucGFkU3RhcnQoMiwgIjAiKTsNCiAgICAgICAgICAgIGNvbnN0IGRheSA9IFN0cmluZyhkYXRlLmdldFVUQ0RhdGUoKSkucGFkU3RhcnQoMiwgIjAiKTsNCiAgICAgICAgICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX1gOw0KICAgICAgICAgIH0NCiAgICAgICAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMocm93cykgew0KICAgICAgICAgICAgY29uc3QgeyBvcmdhbml6YXRpb24sIGNvdW50cnksIHRpbWVmcmFtZSwgY3VzdG9tU3RhcnQsIGN1c3RvbUVuZCwgY3VzdG9tUmFuZ2VJbnZhbGlkIH0gPSBzdGF0ZS5maWx0ZXJzOw0KICAgICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uRmlsdGVyID0gb3JnYW5pemF0aW9uIGluc3RhbmNlb2YgU2V0ID8gb3JnYW5pemF0aW9uIDogbmV3IFNldCgpOw0KICAgICAgICAgICAgY29uc3QgY291bnRyeUZpbHRlciA9IGNvdW50cnkgaW5zdGFuY2VvZiBTZXQgPyBjb3VudHJ5IDogbmV3IFNldCgpOw0KICAgICAgICAgICAgY29uc3QgaGFzT3JnYW5pemF0aW9uRmlsdGVyID0gb3JnYW5pemF0aW9uRmlsdGVyLnNpemUgPiAwOw0KICAgICAgICAgICAgY29uc3QgaGFzQ291bnRyeUZpbHRlciA9IGNvdW50cnlGaWx0ZXIuc2l6ZSA+IDA7DQogICAgICAgICAgICBpZiAodGltZWZyYW1lID09PSAiY3VzdG9tIiAmJiBjdXN0b21SYW5nZUludmFsaWQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgY3V0b2ZmID0gdGltZWZyYW1lID09PSAiY3VzdG9tIiA/IG51bGwgOiBjb21wdXRlQ3V0b2ZmRGF0ZSh0aW1lZnJhbWUpOw0KICAgICAgICAgICAgcmV0dXJuIHJvd3MuZmlsdGVyKHJvdyA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHJvd09yZ2FuaXphdGlvbiA9IHJvdy5vcmdhbml6YXRpb24gfHwgIlVuc3BlY2lmaWVkIjsNCiAgICAgICAgICAgICAgaWYgKGhhc09yZ2FuaXphdGlvbkZpbHRlciAmJiAhb3JnYW5pemF0aW9uRmlsdGVyLmhhcyhyb3dPcmdhbml6YXRpb24pKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHJvd0NvdW50cnkgPSByb3cuY291bnRyeSB8fCAiVW5zcGVjaWZpZWQiOw0KICAgICAgICAgICAgICBpZiAoaGFzQ291bnRyeUZpbHRlciAmJiAhY291bnRyeUZpbHRlci5oYXMocm93Q291bnRyeSkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHRpbWVmcmFtZSA9PT0gImN1c3RvbSIpIHsNCiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tU3RhcnQgJiYgcm93LmRhdGUgPCBjdXN0b21TdGFydCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tRW5kICYmIHJvdy5kYXRlID4gY3VzdG9tRW5kKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1dG9mZiAmJiByb3cuZGF0ZSA8IGN1dG9mZikgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGNvbXB1dGVDdXRvZmZEYXRlKHRpbWVmcmFtZSkgew0KICAgICAgICAgICAgaWYgKCFzdGF0ZS5sYXRlc3REYXRlIHx8IHRpbWVmcmFtZSA9PT0gImFsbCIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBsYXRlc3QgPSBuZXcgRGF0ZShzdGF0ZS5sYXRlc3REYXRlLmdldFRpbWUoKSk7DQogICAgICAgICAgICBpZiAodGltZWZyYW1lID09PSAiM20iKSB7DQogICAgICAgICAgICAgIGxhdGVzdC5zZXRVVENNb250aChsYXRlc3QuZ2V0VVRDTW9udGgoKSAtIDMpOw0KICAgICAgICAgICAgfSBlbHNlIGlmICh0aW1lZnJhbWUgPT09ICI2bSIpIHsNCiAgICAgICAgICAgICAgbGF0ZXN0LnNldFVUQ01vbnRoKGxhdGVzdC5nZXRVVENNb250aCgpIC0gNik7DQogICAgICAgICAgICB9IGVsc2UgaWYgKHRpbWVmcmFtZSA9PT0gIjEybSIpIHsNCiAgICAgICAgICAgICAgbGF0ZXN0LnNldFVUQ01vbnRoKGxhdGVzdC5nZXRVVENNb250aCgpIC0gMTIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGF0ZXN0LnNldFVUQ0hvdXJzKDAsIDAsIDAsIDApOw0KICAgICAgICAgICAgcmV0dXJuIGxhdGVzdDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBidWlsZFN1cHBsZW1lbnRhbEluc2lnaHRzKHJvd3MpIHsNCiAgICAgICAgICAgIGNvbnN0IHBlckFwcENvbmZpZyA9IHsNCiAgICAgICAgICAgICAgd29yZDogew0KICAgICAgICAgICAgICAgIGxhYmVsOiAiV29yZCIsDQogICAgICAgICAgICAgICAgZmllbGRzOiBbIndvcmRBY3Rpb25zIiwgImRvY3VtZW50U3VtbWFyaWVzIiwgInJld3JpdGVUZXh0V29yZCIsICJkcmFmdFdvcmQiLCAidmlzdWFsaXplVGFibGVXb3JkIiwgIndvcmRDaGF0UHJvbXB0cyJdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHRlYW1zOiB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJUZWFtcyIsDQogICAgICAgICAgICAgICAgZmllbGRzOiBbInRlYW1zQWN0aW9ucyIsICJtZWV0aW5nUmVjYXAiLCAibWVldGluZ1N1bW1hcmllc1RvdGFsIiwgIm1lZXRpbmdTdW1tYXJpZXNBY3Rpb25zIiwgImNoYXRDb21wb3NlIiwgImNoYXRTdW1tYXJpZXMiLCAiY2hhdENvbnZlcnNhdGlvbnMiLCAiY2hhdFByb21wdHNUZWFtcyJdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIHBvd2VycG9pbnQ6IHsNCiAgICAgICAgICAgICAgICBsYWJlbDogIlBvd2VyUG9pbnQiLA0KICAgICAgICAgICAgICAgIGZpZWxkczogWyJwb3dlcnBvaW50QWN0aW9ucyIsICJwcmVzZW50YXRpb25DcmVhdGVkIiwgImFkZENvbnRlbnRQcmVzZW50YXRpb24iLCAib3JnYW5pemVQcmVzZW50YXRpb24iLCAic3VtbWFyaXplUHJlc2VudGF0aW9uIiwgInBvd2VycG9pbnRDaGF0UHJvbXB0cyJdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGV4Y2VsOiB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJFeGNlbCIsDQogICAgICAgICAgICAgICAgZmllbGRzOiBbImV4Y2VsQWN0aW9ucyIsICJleGNlbEFuYWx5c2lzIiwgImV4Y2VsRm9ybXVsYSIsICJleGNlbEZvcm1hdHRpbmciLCAiZXhjZWxDaGF0UHJvbXB0cyJdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIG91dGxvb2s6IHsNCiAgICAgICAgICAgICAgICBsYWJlbDogIk91dGxvb2siLA0KICAgICAgICAgICAgICAgIGZpZWxkczogWyJvdXRsb29rQWN0aW9ucyIsICJlbWFpbERyYWZ0cyIsICJlbWFpbFN1bW1hcmllcyIsICJlbWFpbENvYWNoaW5nIiwgImVtYWlsVG90YWxXaXRoQ29waWxvdCJdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGNoYXRXb3JrOiB7DQogICAgICAgICAgICAgICAgbGFiZWw6ICJDb3BpbG90IGNoYXQgKHdvcmspIiwNCiAgICAgICAgICAgICAgICBmaWVsZHM6IFsiY2hhdFdvcmtBY3Rpb25zIiwgImNoYXRQcm9tcHRzV29yayIsICJjaGF0UHJvbXB0c1dvcmtUZWFtcyIsICJjaGF0UHJvbXB0c1dvcmtPdXRsb29rIl0sDQogICAgICAgICAgICAgICAgZXhjbHVzaXZlR3JvdXBzOiBbDQogICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHByaW1hcnk6ICJjaGF0UHJvbXB0c1dvcmsiLA0KICAgICAgICAgICAgICAgICAgICBmYWxsYmFjazogWyJjaGF0UHJvbXB0c1dvcmtUZWFtcyIsICJjaGF0UHJvbXB0c1dvcmtPdXRsb29rIl0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIGNoYXRXZWI6IHsNCiAgICAgICAgICAgICAgICBsYWJlbDogIkNvcGlsb3QgY2hhdCAod2ViKSIsDQogICAgICAgICAgICAgICAgZmllbGRzOiBbImNoYXRQcm9tcHRzV2ViIiwgImNoYXRQcm9tcHRzV2ViVGVhbXMiLCAiY2hhdFByb21wdHNXZWJPdXRsb29rIl0sDQogICAgICAgICAgICAgICAgZXhjbHVzaXZlR3JvdXBzOiBbDQogICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHByaW1hcnk6ICJjaGF0UHJvbXB0c1dlYiIsDQogICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrOiBbImNoYXRQcm9tcHRzV2ViVGVhbXMiLCAiY2hhdFByb21wdHNXZWJPdXRsb29rIl0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBjb25zdCBwZXJBcHBUb3RhbHMgPSBPYmplY3QuZW50cmllcyhwZXJBcHBDb25maWcpLnJlZHVjZSgoYWNjLCBba2V5LCBjb25maWddKSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IEFycmF5LmlzQXJyYXkoY29uZmlnLmZpZWxkcykgPyBjb25maWcuZmllbGRzIDogW107DQogICAgICAgICAgICAgIGFjY1trZXldID0gew0KICAgICAgICAgICAgICAgIGxhYmVsOiBjb25maWcubGFiZWwsDQogICAgICAgICAgICAgICAgZmllbGRzOiBmaWVsZHMucmVkdWNlKChmaWVsZEFjYywgZmllbGQpID0+IHsNCiAgICAgICAgICAgICAgICAgIGZpZWxkQWNjW2ZpZWxkXSA9IDA7DQogICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGRBY2M7DQogICAgICAgICAgICAgICAgfSwge30pLA0KICAgICAgICAgICAgICAgIHRvdGFsOiAwDQogICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIHJldHVybiBhY2M7DQogICAgICAgICAgICB9LCB7fSk7DQogICAgICAgICAgICBjb25zdCBpdGVyYWJsZVJvd3MgPSBBcnJheS5pc0FycmF5KHJvd3MpID8gcm93cyA6IFtdOw0KICAgICAgICAgICAgaXRlcmFibGVSb3dzLmZvckVhY2gocm93ID0+IHsNCiAgICAgICAgICAgICAgaWYgKCFyb3cgfHwgdHlwZW9mIHJvdyAhPT0gIm9iamVjdCIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IHJvdy5tZXRyaWNzIHx8IHt9Ow0KICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhwZXJBcHBDb25maWcpLmZvckVhY2goKFtrZXksIGNvbmZpZ10pID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbHMgPSBwZXJBcHBUb3RhbHNba2V5XTsNCiAgICAgICAgICAgICAgICBpZiAoIXRvdGFscykgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBleGNsdXNpdmVHcm91cHMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5leGNsdXNpdmVHcm91cHMpID8gY29uZmlnLmV4Y2x1c2l2ZUdyb3VwcyA6IFtdOw0KICAgICAgICAgICAgICAgIGxldCByb3dGaWVsZHMgPSBBcnJheS5pc0FycmF5KGNvbmZpZy5maWVsZHMpID8gQXJyYXkuZnJvbShjb25maWcuZmllbGRzKSA6IFtdOw0KICAgICAgICAgICAgICAgIGV4Y2x1c2l2ZUdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsNCiAgICAgICAgICAgICAgICAgIGlmICghZ3JvdXApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgY29uc3QgcHJpbWFyeUZpZWxkID0gZ3JvdXAucHJpbWFyeTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZhbGxiYWNrRmllbGRzID0gQXJyYXkuaXNBcnJheShncm91cC5mYWxsYmFjaykgPyBncm91cC5mYWxsYmFjayA6IFtdOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gcHJpbWFyeUZpZWxkID8gbWV0cmljc1twcmltYXJ5RmllbGRdIHx8IDAgOiAwOw0KICAgICAgICAgICAgICAgICAgaWYgKHByaW1hcnlGaWVsZCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAocHJpbWFyeVZhbHVlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIHJvd0ZpZWxkcyA9IHJvd0ZpZWxkcy5maWx0ZXIoZmllbGQgPT4gIWZhbGxiYWNrRmllbGRzLmluY2x1ZGVzKGZpZWxkKSk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgcm93RmllbGRzID0gcm93RmllbGRzLmZpbHRlcihmaWVsZCA9PiBmaWVsZCAhPT0gcHJpbWFyeUZpZWxkKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIGxldCByb3dUb3RhbCA9IDA7DQogICAgICAgICAgICAgICAgcm93RmllbGRzLmZvckVhY2goZmllbGQgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBtZXRyaWNzW2ZpZWxkXSB8fCAwOw0KICAgICAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUodmFsdWUpIHx8IHZhbHVlIDw9IDApIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgdG90YWxzLmZpZWxkc1tmaWVsZF0gKz0gdmFsdWU7DQogICAgICAgICAgICAgICAgICByb3dUb3RhbCArPSB2YWx1ZTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICB0b3RhbHMudG90YWwgKz0gcm93VG90YWw7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb25zdCBwZXJBcHBBY3Rpb25zID0gT2JqZWN0LmVudHJpZXMocGVyQXBwVG90YWxzKQ0KICAgICAgICAgICAgICAubWFwKChba2V5LCBkYXRhXSkgPT4gKHsNCiAgICAgICAgICAgICAgICBrZXksDQogICAgICAgICAgICAgICAgbGFiZWw6IGRhdGEubGFiZWwsDQogICAgICAgICAgICAgICAgdG90YWw6IGRhdGEudG90YWwsDQogICAgICAgICAgICAgICAgZmllbGRzOiBkYXRhLmZpZWxkcw0KICAgICAgICAgICAgICB9KSkNCiAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IChiLnRvdGFsIHx8IDApIC0gKGEudG90YWwgfHwgMCkpOw0KICAgICAgICAgICAgcmV0dXJuIHsgcGVyQXBwQWN0aW9ucyB9Ow0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGNvbXB1dGVBZ2dyZWdhdGVzKHJvd3MsIGdyb3VwT3ZlcnJpZGUpIHsKICAgICAgICAgICAgY29uc3QgdG90YWxzID0gew0KICAgICAgICAgICAgICB0b3RhbEFjdGlvbnM6IDAsDQogICAgICAgICAgICAgIGFzc2lzdGVkSG91cnM6IDANCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBjb25zdCBhY3RpdmVVc2VycyA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRVc2VycyA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgIGNvbnN0IGdyb3VwTWFwID0gbmV3IE1hcCgpOw0KICAgICAgICAgICAgY29uc3QgcGVyaW9kTWFwID0gbmV3IE1hcCgpOw0KICAgICAgICAgICAgY29uc3QgdXNlclRvdGFscyA9IG5ldyBNYXAoKTsNCiAgICAgICAgICAgIGNvbnN0IGxhc3QzMEN1dG9mZiA9IHN0YXRlLmxhdGVzdERhdGUgaW5zdGFuY2VvZiBEYXRlDQogICAgICAgICAgICAgID8gKCgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjdXRvZmYgPSBuZXcgRGF0ZShzdGF0ZS5sYXRlc3REYXRlLmdldFRpbWUoKSk7DQogICAgICAgICAgICAgICAgY3V0b2ZmLnNldFVUQ0RhdGUoY3V0b2ZmLmdldFVUQ0RhdGUoKSAtIDI5KTsNCiAgICAgICAgICAgICAgICBjdXRvZmYuc2V0VVRDSG91cnMoMCwgMCwgMCwgMCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGN1dG9mZjsNCiAgICAgICAgICAgICAgfSkoKQ0KICAgICAgICAgICAgICA6IG51bGw7DQogICAgICAgICAgICBjb25zdCBsYXN0MzBVc2VyU2V0cyA9IG5ldyBNYXAoYWN0aXZlRGF5S2V5cy5tYXAoa2V5ID0+IFtrZXksIG5ldyBTZXQoKV0pKTsNCiAgICAgICAgICAgIGNvbnN0IGxhc3QzMFByb21wdFRvdGFscyA9IE9iamVjdC5mcm9tRW50cmllcyhhY3RpdmVEYXlLZXlzLm1hcChrZXkgPT4gW2tleSwgMF0pKTsNCiAgICAgICAgICAgIGNvbnN0IHVzZXJXZWVrbHlBY3Rpdml0eSA9IG5ldyBNYXAoKTsNCiAgICAgICAgICAgIGNvbnN0IHVzZXJXZWVrQWN0aW9ucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgICAgIGNvbnN0IHdlZWtNYXAgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBjb25zdCBtb250aGx5VXNhZ2VNYXAgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBjb25zdCBjYXRlZ29yeUtleXMgPSBPYmplY3Qua2V5cyhjYXRlZ29yeUNvbmZpZyk7DQogICAgICAgICAgICBjb25zdCBjcmVhdGVDYXRlZ29yeUFjY3VtdWxhdG9yID0gKCkgPT4gT2JqZWN0LmZyb21FbnRyaWVzKGNhdGVnb3J5S2V5cy5tYXAoa2V5ID0+IFtrZXksIHsKICAgICAgICAgICAgICBwcmltYXJ5OiAwLAogICAgICAgICAgICAgIHNlY29uZGFyeTogY2F0ZWdvcnlDb25maWdba2V5XS5zZWNvbmRhcnkubWFwKCgpID0+IDApLAogICAgICAgICAgICAgIHRvdGFsOiAwCiAgICAgICAgICAgIH1dKSk7CiAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5VG90YWxzID0ge307CiAgICAgICAgICAgIGNhdGVnb3J5S2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0gY2F0ZWdvcnlDb25maWdba2V5XTsKICAgICAgICAgICAgICBjYXRlZ29yeVRvdGFsc1trZXldID0gewogICAgICAgICAgICAgICAgcHJpbWFyeTogMCwKICAgICAgICAgICAgICAgIHNlY29uZGFyeTogY29uZmlnLnNlY29uZGFyeS5tYXAoKCkgPT4gMCksCiAgICAgICAgICAgICAgICB0b3RhbDogMAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBhZG9wdGlvbkVudHJpZXMgPSBPYmplY3QuZW50cmllcyhhZG9wdGlvbkFwcENvbmZpZykubWFwKChba2V5LCBjb25maWddKSA9PiAoew0KICAgICAgICAgICAgICBrZXksDQogICAgICAgICAgICAgIGNvbmZpZywNCiAgICAgICAgICAgICAgdXNlclNldDogbmV3IFNldCgpLA0KICAgICAgICAgICAgICBmZWF0dXJlU2V0czogQXJyYXkuaXNBcnJheShjb25maWcuZmVhdHVyZXMpID8gY29uZmlnLmZlYXR1cmVzLm1hcCgoKSA9PiBuZXcgU2V0KCkpIDogW10NCiAgICAgICAgICAgIH0pKTsNCiAgICAgIA0KICAgICAgICAgICAgbGV0IHBlcmlvZEVhcmxpZXN0ID0gbnVsbDsNCiAgICAgICAgICAgIGxldCBwZXJpb2RMYXRlc3QgPSBudWxsOw0KICAgICAgICAgICAgbGV0IGxhdGVzdFdlZWsgPSBudWxsOw0KICAgICAgICAgICAgbGV0IHByZXZpb3VzV2VlayA9IG51bGw7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHVzYWdlQnVja2V0c1RlbXBsYXRlID0gYnVpbGRVc2FnZUZyZXF1ZW5jeUJ1Y2tldHMoKTsKICAgICAgICAgICAgY29uc3QgYWdncmVnYXRlSXNXZWVrbHkgPSBzdGF0ZS5maWx0ZXJzLmFnZ3JlZ2F0ZSA9PT0gIndlZWtseSI7CiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbkNvbnRleHQgPSBidWlsZFNlbGVjdGlvbkNvbnRleHQoZ2V0QWN0aXZlQ2F0ZWdvcnlTZWxlY3Rpb24oKSk7CiAgICAgICAgICAgIGNvbnN0IGhpZGRlbkNhcGFiaWxpdHlGaWVsZHMgPSBzZWxlY3Rpb25Db250ZXh0LmhpZGRlbkNhcGFiaWxpdHlGaWVsZHMgfHwgbmV3IFNldCgpOwogICAgICAgICAgICBjb25zdCBoaWRkZW5Ib3VyQ2F0ZWdvcmllcyA9IHNlbGVjdGlvbkNvbnRleHQuaGlkZGVuSG91ckNhdGVnb3JpZXMgfHwgbmV3IFNldCgpOwoKICAgICAgICAgICAgcm93cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgY29uc3Qgcm93VG90YWxBY3Rpb25zID0gcm93LnRvdGFsQWN0aW9ucyB8fCAwOwogICAgICAgICAgICAgIGNvbnN0IHJvd1RvdGFsSG91cnMgPSByb3cuYXNzaXN0ZWRIb3VycyB8fCAwOwogICAgICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSByb3cubWV0cmljcyB8fCB7fTsKCiAgICAgICAgICAgICAgbGV0IGhpZGRlbkFjdGlvblRvdGFsID0gMDsKICAgICAgICAgICAgICBoaWRkZW5DYXBhYmlsaXR5RmllbGRzLmZvckVhY2goZmllbGQgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBOdW1iZXIobWV0cmljc1tmaWVsZF0pOwogICAgICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgaGlkZGVuQWN0aW9uVG90YWwgKz0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgbGV0IHJvd1NlbGVjdGVkQWN0aW9ucyA9IHJvd1RvdGFsQWN0aW9ucyAtIGhpZGRlbkFjdGlvblRvdGFsOwogICAgICAgICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKHJvd1NlbGVjdGVkQWN0aW9ucykpIHsKICAgICAgICAgICAgICAgIHJvd1NlbGVjdGVkQWN0aW9ucyA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb3dTZWxlY3RlZEFjdGlvbnMgPCAwKSB7CiAgICAgICAgICAgICAgICByb3dTZWxlY3RlZEFjdGlvbnMgPSAwOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbGV0IGhpZGRlbkhvdXJUb3RhbCA9IDA7CiAgICAgICAgICAgICAgaGlkZGVuSG91ckNhdGVnb3JpZXMuZm9yRWFjaChjYXRlZ29yeUtleSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBob3VyRmllbGQgPSBjYXRlZ29yeUhvdXJGaWVsZE1hcFtjYXRlZ29yeUtleV07CiAgICAgICAgICAgICAgICBpZiAoIWhvdXJGaWVsZCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE51bWJlcihtZXRyaWNzW2hvdXJGaWVsZF0pOwogICAgICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgaGlkZGVuSG91clRvdGFsICs9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGxldCByb3dTZWxlY3RlZEhvdXJzID0gcm93VG90YWxIb3VycyAtIGhpZGRlbkhvdXJUb3RhbDsKICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShyb3dTZWxlY3RlZEhvdXJzKSkgewogICAgICAgICAgICAgICAgcm93U2VsZWN0ZWRIb3VycyA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb3dTZWxlY3RlZEhvdXJzIDwgMCkgewogICAgICAgICAgICAgICAgcm93U2VsZWN0ZWRIb3VycyA9IDA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0b3RhbHMudG90YWxBY3Rpb25zICs9IHJvd1NlbGVjdGVkQWN0aW9uczsKICAgICAgICAgICAgICB0b3RhbHMuYXNzaXN0ZWRIb3VycyArPSByb3dTZWxlY3RlZEhvdXJzOwogICAgICANCiAgICAgICAgICAgICAgY29uc3QgcGVyc29uS2V5ID0gc2FuaXRpemVMYWJlbChyb3cucGVyc29uSWQpIHx8ICJVbnNwZWNpZmllZCI7DQogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbiA9IHJvdy5vcmdhbml6YXRpb24gfHwgIlVuc3BlY2lmaWVkIjsNCiAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdVc2VySW5mbyA9IHVzZXJUb3RhbHMuZ2V0KHBlcnNvbktleSkgfHwgew0KICAgICAgICAgICAgICAgIG5hbWU6IHBlcnNvbktleSwNCiAgICAgICAgICAgICAgICBvcmdhbml6YXRpb24sDQogICAgICAgICAgICAgICAgdG90YWxBY3Rpb25zOiAwLA0KICAgICAgICAgICAgICAgIGFzc2lzdGVkSG91cnM6IDANCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgZXhpc3RpbmdVc2VySW5mby5uYW1lID0gcGVyc29uS2V5Ow0KICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nVXNlckluZm8ub3JnYW5pemF0aW9uIHx8IGV4aXN0aW5nVXNlckluZm8ub3JnYW5pemF0aW9uID09PSAiVW5zcGVjaWZpZWQiKSB7DQogICAgICAgICAgICAgICAgZXhpc3RpbmdVc2VySW5mby5vcmdhbml6YXRpb24gPSBvcmdhbml6YXRpb247DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgZXhpc3RpbmdVc2VySW5mby50b3RhbEFjdGlvbnMgKz0gcm93U2VsZWN0ZWRBY3Rpb25zOw0KICAgICAgICAgICAgICBleGlzdGluZ1VzZXJJbmZvLmFzc2lzdGVkSG91cnMgKz0gcm93U2VsZWN0ZWRIb3VyczsNCiAgICAgICAgICAgICAgdXNlclRvdGFscy5zZXQocGVyc29uS2V5LCBleGlzdGluZ1VzZXJJbmZvKTsNCiAgICAgIA0KICAgICAgICAgICAgICBpZiAocm93U2VsZWN0ZWRBY3Rpb25zID4gMCB8fCByb3dTZWxlY3RlZEhvdXJzID4gMCkgew0KICAgICAgICAgICAgICAgIGFjdGl2ZVVzZXJzLmFkZChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgICAgY29uc3Qgd2l0aGluTGFzdDMwID0gbGFzdDMwQ3V0b2ZmIGluc3RhbmNlb2YgRGF0ZSAmJiByb3cuZGF0ZSA+PSBsYXN0MzBDdXRvZmY7DQogICAgICAgICAgICAgIGlmICh3aXRoaW5MYXN0MzApIHsNCiAgICAgICAgICAgICAgICBhY3RpdmVEYXlLZXlzLmZvckVhY2goa2V5ID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IGFjdGl2ZURheXNDb25maWdba2V5XTsNCiAgICAgICAgICAgICAgICAgIGlmICghY29uZmlnKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSByb3cubWV0cmljcyB8fCB7fTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRheUZpZWxkID0gY29uZmlnLmRheUZpZWxkOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcHJvbXB0RmllbGRzID0gQXJyYXkuaXNBcnJheShjb25maWcucHJvbXB0RmllbGRzKSA/IGNvbmZpZy5wcm9tcHRGaWVsZHMgOiBbXTsNCiAgICAgICAgICAgICAgICAgIGxldCBoYXNVc2FnZSA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgaWYgKGRheUZpZWxkKSB7DQogICAgICAgICAgICAgICAgICAgIGhhc1VzYWdlID0gKG1ldHJpY3NbZGF5RmllbGRdIHx8IDApID4gMDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICghaGFzVXNhZ2UgJiYgcHJvbXB0RmllbGRzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBoYXNVc2FnZSA9IHByb21wdEZpZWxkcy5zb21lKGZpZWxkID0+IChtZXRyaWNzW2ZpZWxkXSB8fCAwKSA+IDApOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKGhhc1VzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldCA9IGxhc3QzMFVzZXJTZXRzLmdldChrZXkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0KSB7DQogICAgICAgICAgICAgICAgICAgICAgc2V0LmFkZChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAocHJvbXB0RmllbGRzLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgICAgICBsZXQgcHJvbXB0U3VtID0gMDsNCiAgICAgICAgICAgICAgICAgICAgcHJvbXB0RmllbGRzLmZvckVhY2goZmllbGQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbWV0cmljc1tmaWVsZF0gfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKHZhbHVlKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcHJvbXB0U3VtICs9IHZhbHVlOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChwcm9tcHRTdW0gPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGFzdDMwUHJvbXB0VG90YWxzW2tleV0gKz0gcHJvbXB0U3VtOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBpc0NvcGlsb3RFbmFibGVkID0gKHJvdy5tZXRyaWNzLmNvcGlsb3RFbmFibGVkVXNlciB8fCAwKSA+IDA7DQogICAgICAgICAgICAgIGlmIChpc0NvcGlsb3RFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgZW5hYmxlZFVzZXJzLmFkZChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgICAgY29uc3Qgd2Vla0tleSA9IGAke3Jvdy5pc29ZZWFyfS1XJHtwYWQocm93Lmlzb1dlZWspfWA7DQogICAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZVdlZWtEYXRlID0gcm93LndlZWtFbmREYXRlIHx8IHJvdy5kYXRlOw0KICAgICAgICAgICAgICBsZXQgd2Vla0J1Y2tldCA9IHdlZWtNYXAuZ2V0KHdlZWtLZXkpOw0KICAgICAgICAgICAgICBpZiAoIXdlZWtCdWNrZXQpIHsNCiAgICAgICAgICAgICAgICB3ZWVrQnVja2V0ID0gew0KICAgICAgICAgICAgICAgICAga2V5OiB3ZWVrS2V5LA0KICAgICAgICAgICAgICAgICAgdG90YWxBY3Rpb25zOiAwLA0KICAgICAgICAgICAgICAgICAgYXNzaXN0ZWRIb3VyczogMCwNCiAgICAgICAgICAgICAgICAgIGRhdGU6IGVmZmVjdGl2ZVdlZWtEYXRlLA0KICAgICAgICAgICAgICAgICAgdXNlcnM6IG5ldyBTZXQoKSwNCiAgICAgICAgICAgICAgICAgIGVuYWJsZWRVc2VyczogbmV3IFNldCgpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB3ZWVrTWFwLnNldCh3ZWVrS2V5LCB3ZWVrQnVja2V0KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB3ZWVrQnVja2V0LnRvdGFsQWN0aW9ucyArPSByb3dTZWxlY3RlZEFjdGlvbnM7DQogICAgICAgICAgICAgIHdlZWtCdWNrZXQuYXNzaXN0ZWRIb3VycyArPSByb3dTZWxlY3RlZEhvdXJzOw0KICAgICAgICAgICAgICBpZiAoIXdlZWtCdWNrZXQuZGF0ZSB8fCBlZmZlY3RpdmVXZWVrRGF0ZSA+IHdlZWtCdWNrZXQuZGF0ZSkgew0KICAgICAgICAgICAgICAgIHdlZWtCdWNrZXQuZGF0ZSA9IGVmZmVjdGl2ZVdlZWtEYXRlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChpc0NvcGlsb3RFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgd2Vla0J1Y2tldC5lbmFibGVkVXNlcnMuYWRkKHBlcnNvbktleSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHJvd1NlbGVjdGVkQWN0aW9ucyA+IDAgfHwgcm93U2VsZWN0ZWRIb3VycyA+IDApIHsNCiAgICAgICAgICAgICAgICB3ZWVrQnVja2V0LnVzZXJzLmFkZChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICAgIGxldCBwZXJzb25XZWVrcyA9IHVzZXJXZWVrbHlBY3Rpdml0eS5nZXQocGVyc29uS2V5KTsNCiAgICAgICAgICAgICAgICBpZiAoIXBlcnNvbldlZWtzKSB7DQogICAgICAgICAgICAgICAgICBwZXJzb25XZWVrcyA9IG5ldyBTZXQoKTsNCiAgICAgICAgICAgICAgICAgIHVzZXJXZWVrbHlBY3Rpdml0eS5zZXQocGVyc29uS2V5LCBwZXJzb25XZWVrcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHBlcnNvbldlZWtzLmFkZCh3ZWVrS2V5KTsNCiAgICAgICAgICAgICAgICBpZiAocm93U2VsZWN0ZWRBY3Rpb25zID4gMCkgew0KICAgICAgICAgICAgICAgICAgbGV0IHdlZWtBY3Rpb25zID0gdXNlcldlZWtBY3Rpb25zLmdldChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICAgICAgaWYgKCF3ZWVrQWN0aW9ucykgew0KICAgICAgICAgICAgICAgICAgICB3ZWVrQWN0aW9ucyA9IG5ldyBNYXAoKTsNCiAgICAgICAgICAgICAgICAgICAgdXNlcldlZWtBY3Rpb25zLnNldChwZXJzb25LZXksIHdlZWtBY3Rpb25zKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRXZWVrVG90YWwgPSB3ZWVrQWN0aW9ucy5nZXQod2Vla0tleSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgIHdlZWtBY3Rpb25zLnNldCh3ZWVrS2V5LCBjdXJyZW50V2Vla1RvdGFsICsgcm93U2VsZWN0ZWRBY3Rpb25zKTsNCiAgICAgICAgICAgICAgICAgIGxldCBtb250aFVzYWdlID0gbW9udGhseVVzYWdlTWFwLmdldChyb3cubW9udGhLZXkpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFtb250aFVzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgIG1vbnRoVXNhZ2UgPSB7DQogICAgICAgICAgICAgICAgICAgICAga2V5OiByb3cubW9udGhLZXksDQogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZvcm1hdE1vbnRoWWVhcihyb3cuZGF0ZSksDQogICAgICAgICAgICAgICAgICAgICAgdXNlckFjdGlvbnM6IG5ldyBNYXAoKSwNCiAgICAgICAgICAgICAgICAgICAgICB1c2VyV2Vla3M6IG5ldyBNYXAoKSwNCiAgICAgICAgICAgICAgICAgICAgICB3ZWVrS2V5czogbmV3IFNldCgpLA0KICAgICAgICAgICAgICAgICAgICAgIGZpcnN0RGF0ZTogZWZmZWN0aXZlV2Vla0RhdGUsDQogICAgICAgICAgICAgICAgICAgICAgbGFzdERhdGU6IGVmZmVjdGl2ZVdlZWtEYXRlDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICAgIG1vbnRobHlVc2FnZU1hcC5zZXQocm93Lm1vbnRoS2V5LCBtb250aFVzYWdlKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRoVG90YWwgPSBtb250aFVzYWdlLnVzZXJBY3Rpb25zLmdldChwZXJzb25LZXkpIHx8IDA7DQogICAgICAgICAgICAgICAgICBtb250aFVzYWdlLnVzZXJBY3Rpb25zLnNldChwZXJzb25LZXksIG1vbnRoVG90YWwgKyByb3dTZWxlY3RlZEFjdGlvbnMpOw0KICAgICAgICAgICAgICAgICAgbGV0IG1vbnRoV2Vla1NldCA9IG1vbnRoVXNhZ2UudXNlcldlZWtzLmdldChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFtb250aFdlZWtTZXQpIHsNCiAgICAgICAgICAgICAgICAgICAgbW9udGhXZWVrU2V0ID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgICAgICAgICBtb250aFVzYWdlLnVzZXJXZWVrcy5zZXQocGVyc29uS2V5LCBtb250aFdlZWtTZXQpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKHdlZWtLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgbW9udGhXZWVrU2V0LmFkZCh3ZWVrS2V5KTsNCiAgICAgICAgICAgICAgICAgICAgbW9udGhVc2FnZS53ZWVrS2V5cy5hZGQod2Vla0tleSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjb25zdCBjb21wYXJhdGl2ZURhdGUgPSBlZmZlY3RpdmVXZWVrRGF0ZSB8fCByb3cuZGF0ZTsNCiAgICAgICAgICAgICAgICAgIGlmIChjb21wYXJhdGl2ZURhdGUgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghbW9udGhVc2FnZS5maXJzdERhdGUgfHwgY29tcGFyYXRpdmVEYXRlIDwgbW9udGhVc2FnZS5maXJzdERhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICBtb250aFVzYWdlLmZpcnN0RGF0ZSA9IGNvbXBhcmF0aXZlRGF0ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAoIW1vbnRoVXNhZ2UubGFzdERhdGUgfHwgY29tcGFyYXRpdmVEYXRlID4gbW9udGhVc2FnZS5sYXN0RGF0ZSkgew0KICAgICAgICAgICAgICAgICAgICAgIG1vbnRoVXNhZ2UubGFzdERhdGUgPSBjb21wYXJhdGl2ZURhdGU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBwZXJpb2RLZXkgPSBhZ2dyZWdhdGVJc1dlZWtseQ0KICAgICAgICAgICAgICAgID8gYCR7cm93Lmlzb1llYXJ9LVcke3BhZChyb3cuaXNvV2Vlayl9YA0KICAgICAgICAgICAgICAgIDogcm93Lm1vbnRoS2V5Ow0KICAgICAgICAgICAgICBsZXQgcGVyaW9kQnVja2V0ID0gcGVyaW9kTWFwLmdldChwZXJpb2RLZXkpOw0KICAgICAgICAgICAgICBpZiAoIXBlcmlvZEJ1Y2tldCkgew0KICAgICAgICAgICAgICAgIHBlcmlvZEJ1Y2tldCA9IHsNCiAgICAgICAgICAgICAgICAgIHRvdGFsQWN0aW9uczogMCwNCiAgICAgICAgICAgICAgICAgIGFzc2lzdGVkSG91cnM6IDAsDQogICAgICAgICAgICAgICAgICBkYXRlOiBhZ2dyZWdhdGVJc1dlZWtseSA/IChyb3cud2Vla0VuZERhdGUgfHwgcm93LmRhdGUpIDogcm93LmRhdGUsDQogICAgICAgICAgICAgICAgICBpc29ZZWFyOiByb3cuaXNvWWVhciwNCiAgICAgICAgICAgICAgICAgIGlzb1dlZWs6IHJvdy5pc29XZWVrLA0KICAgICAgICAgICAgICAgICAgdXNlcnM6IG5ldyBTZXQoKSwNCiAgICAgICAgICAgICAgICAgIGVuYWJsZWRVc2VyczogbmV3IFNldCgpLA0KICAgICAgICAgICAgICAgICAgY2F0ZWdvcmllczogY3JlYXRlQ2F0ZWdvcnlBY2N1bXVsYXRvcigpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBwZXJpb2RNYXAuc2V0KHBlcmlvZEtleSwgcGVyaW9kQnVja2V0KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBwZXJpb2RCdWNrZXQudG90YWxBY3Rpb25zICs9IHJvd1NlbGVjdGVkQWN0aW9uczsNCiAgICAgICAgICAgICAgcGVyaW9kQnVja2V0LmFzc2lzdGVkSG91cnMgKz0gcm93U2VsZWN0ZWRIb3VyczsNCiAgICAgICAgICAgICAgY29uc3QgZWZmZWN0aXZlRGF0ZSA9IGFnZ3JlZ2F0ZUlzV2Vla2x5ID8gZWZmZWN0aXZlV2Vla0RhdGUgOiByb3cuZGF0ZTsNCiAgICAgICAgICAgICAgaWYgKCFwZXJpb2RCdWNrZXQuZGF0ZSB8fCBlZmZlY3RpdmVEYXRlID4gcGVyaW9kQnVja2V0LmRhdGUpIHsNCiAgICAgICAgICAgICAgICBwZXJpb2RCdWNrZXQuZGF0ZSA9IGVmZmVjdGl2ZURhdGU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHJvd1NlbGVjdGVkQWN0aW9ucyA+IDAgfHwgcm93U2VsZWN0ZWRIb3VycyA+IDApIHsNCiAgICAgICAgICAgICAgICBwZXJpb2RCdWNrZXQudXNlcnMuYWRkKHBlcnNvbktleSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGlzQ29waWxvdEVuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICBwZXJpb2RCdWNrZXQuZW5hYmxlZFVzZXJzLmFkZChwZXJzb25LZXkpOw0KICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgICAgaWYgKCFwZXJpb2RFYXJsaWVzdCB8fCBlZmZlY3RpdmVEYXRlIDwgcGVyaW9kRWFybGllc3QpIHsNCiAgICAgICAgICAgICAgICBwZXJpb2RFYXJsaWVzdCA9IGVmZmVjdGl2ZURhdGU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFwZXJpb2RMYXRlc3QgfHwgZWZmZWN0aXZlRGF0ZSA+IHBlcmlvZExhdGVzdCkgewogICAgICAgICAgICAgICAgcGVyaW9kTGF0ZXN0ID0gZWZmZWN0aXZlRGF0ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IGdyb3VwaW5nID0gZ3JvdXBPdmVycmlkZSB8fCBzdGF0ZS5maWx0ZXJzLmdyb3VwOwogICAgICAgICAgICAgIGNvbnN0IGdyb3VwS2V5ID0gZ2V0R3JvdXBLZXkocm93LCBncm91cGluZyk7CiAgICAgICAgICAgICAgbGV0IGdyb3VwQnVja2V0ID0gZ3JvdXBNYXAuZ2V0KGdyb3VwS2V5KTsNCiAgICAgICAgICAgICAgaWYgKCFncm91cEJ1Y2tldCkgew0KICAgICAgICAgICAgICAgIGdyb3VwQnVja2V0ID0geyB0b3RhbEFjdGlvbnM6IDAsIGFzc2lzdGVkSG91cnM6IDAsIHVzZXJzOiBuZXcgU2V0KCkgfTsNCiAgICAgICAgICAgICAgICBncm91cE1hcC5zZXQoZ3JvdXBLZXksIGdyb3VwQnVja2V0KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBncm91cEJ1Y2tldC50b3RhbEFjdGlvbnMgKz0gcm93U2VsZWN0ZWRBY3Rpb25zOw0KICAgICAgICAgICAgICBncm91cEJ1Y2tldC5hc3Npc3RlZEhvdXJzICs9IHJvd1NlbGVjdGVkSG91cnM7DQogICAgICAgICAgICAgIGlmIChyb3dTZWxlY3RlZEFjdGlvbnMgPiAwIHx8IHJvd1NlbGVjdGVkSG91cnMgPiAwKSB7DQogICAgICAgICAgICAgICAgZ3JvdXBCdWNrZXQudXNlcnMuYWRkKHBlcnNvbktleSk7DQogICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhjYXRlZ29yeUNvbmZpZykuZm9yRWFjaCgoW2tleSwgY29uZmlnXSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdG90YWxzRm9yQ2F0ZWdvcnkgPSBjYXRlZ29yeVRvdGFsc1trZXldOwogICAgICAgICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gcm93Lm1ldHJpY3NbY29uZmlnLnByaW1hcnldIHx8IDA7CiAgICAgICAgICAgICAgICB0b3RhbHNGb3JDYXRlZ29yeS5wcmltYXJ5ICs9IHByaW1hcnlWYWx1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHBlcmlvZENhdGVnb3J5ID0gcGVyaW9kQnVja2V0LmNhdGVnb3JpZXNba2V5XTsKICAgICAgICAgICAgICAgIGlmIChwZXJpb2RDYXRlZ29yeSkgewogICAgICAgICAgICAgICAgICBwZXJpb2RDYXRlZ29yeS5wcmltYXJ5ICs9IHByaW1hcnlWYWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsc0ZvckNhdGVnb3J5LnRvdGFsID0gKHRvdGFsc0ZvckNhdGVnb3J5LnRvdGFsIHx8IDApICsgcHJpbWFyeVZhbHVlOwogICAgICAgICAgICAgICAgaWYgKHBlcmlvZENhdGVnb3J5KSB7CiAgICAgICAgICAgICAgICAgIHBlcmlvZENhdGVnb3J5LnRvdGFsID0gKHBlcmlvZENhdGVnb3J5LnRvdGFsIHx8IDApICsgcHJpbWFyeVZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uZmlnLnNlY29uZGFyeS5mb3JFYWNoKChmaWVsZCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSByb3cubWV0cmljc1tmaWVsZF0gfHwgMDsKICAgICAgICAgICAgICAgICAgdG90YWxzRm9yQ2F0ZWdvcnkuc2Vjb25kYXJ5W2luZGV4XSArPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgaWYgKHBlcmlvZENhdGVnb3J5KSB7CiAgICAgICAgICAgICAgICAgICAgcGVyaW9kQ2F0ZWdvcnkuc2Vjb25kYXJ5W2luZGV4XSArPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB0b3RhbHNGb3JDYXRlZ29yeS50b3RhbCArPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgaWYgKHBlcmlvZENhdGVnb3J5KSB7CiAgICAgICAgICAgICAgICAgICAgcGVyaW9kQ2F0ZWdvcnkudG90YWwgPSAocGVyaW9kQ2F0ZWdvcnkudG90YWwgfHwgMCkgKyB2YWx1ZTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYWRvcHRpb25FbnRyaWVzLmZvckVhY2goZW50cnkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHsgY29uZmlnLCB1c2VyU2V0LCBmZWF0dXJlU2V0cyB9ID0gZW50cnk7DQogICAgICAgICAgICAgICAgY29uc3QgbWV0cmljcyA9IHJvdy5tZXRyaWNzIHx8IHt9Ow0KICAgICAgICAgICAgICAgIGlmICghYWN0aXZlVXNlcnMuaGFzKHBlcnNvbktleSkpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgbGV0IGFzc2lnbmVkVG9BcHAgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcuZmVhdHVyZXMpICYmIGNvbmZpZy5mZWF0dXJlcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgIGNvbmZpZy5mZWF0dXJlcy5mb3JFYWNoKChmZWF0dXJlLCBmZWF0dXJlSW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmllbGRzID0gQXJyYXkuaXNBcnJheShmZWF0dXJlLm1ldHJpY3MpID8gZmVhdHVyZS5tZXRyaWNzIDogW107DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZWQgPSBmaWVsZHMuc29tZShmaWVsZCA9PiAobWV0cmljc1tmaWVsZF0gfHwgMCkgPiAwKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgICBmZWF0dXJlU2V0c1tmZWF0dXJlSW5kZXhdPy5hZGQocGVyc29uS2V5KTsNCiAgICAgICAgICAgICAgICAgICAgICBhc3NpZ25lZFRvQXBwID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghYXNzaWduZWRUb0FwcCAmJiBBcnJheS5pc0FycmF5KGNvbmZpZy5pbmRpY2F0b3JzKSAmJiBjb25maWcuaW5kaWNhdG9ycy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0luZGljYXRvciA9IGNvbmZpZy5pbmRpY2F0b3JzLnNvbWUoZmllbGQgPT4gKG1ldHJpY3NbZmllbGRdIHx8IDApID4gMCk7DQogICAgICAgICAgICAgICAgICBpZiAoaGFzSW5kaWNhdG9yKSB7DQogICAgICAgICAgICAgICAgICAgIGFzc2lnbmVkVG9BcHAgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoYXNzaWduZWRUb0FwcCkgew0KICAgICAgICAgICAgICAgICAgdXNlclNldC5hZGQocGVyc29uS2V5KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IG1ldHJpY0tleSA9IHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiID8gImFzc2lzdGVkSG91cnMiIDogInRvdGFsQWN0aW9ucyI7DQogICAgICAgICAgICBjb25zdCBncm91cEVudHJpZXMgPSBBcnJheS5mcm9tKGdyb3VwTWFwLmVudHJpZXMoKSkNCiAgICAgICAgICAgICAgLm1hcCgoW25hbWUsIHZhbHVlc10pID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCB1c2VyQ291bnQgPSB2YWx1ZXMudXNlcnMgPyB2YWx1ZXMudXNlcnMuc2l6ZSA6IDA7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgIG5hbWUsDQogICAgICAgICAgICAgICAgICB0b3RhbEFjdGlvbnM6IHZhbHVlcy50b3RhbEFjdGlvbnMsDQogICAgICAgICAgICAgICAgICBhc3Npc3RlZEhvdXJzOiB2YWx1ZXMuYXNzaXN0ZWRIb3VycywNCiAgICAgICAgICAgICAgICAgIHVzZXJzOiB1c2VyQ291bnQsDQogICAgICAgICAgICAgICAgICBhdmVyYWdlQWN0aW9uc1BlclVzZXI6IHVzZXJDb3VudCA/IHZhbHVlcy50b3RhbEFjdGlvbnMgLyB1c2VyQ291bnQgOiAwDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgLmZpbHRlcihlbnRyeSA9PiBlbnRyeVttZXRyaWNLZXldID4gMCkNCiAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGJbbWV0cmljS2V5XSAtIGFbbWV0cmljS2V5XSk7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHBlcmlvZHMgPSBBcnJheS5mcm9tKHBlcmlvZE1hcC5lbnRyaWVzKCkpDQogICAgICAgICAgICAgIC5tYXAoKFtsYWJlbCwgdmFsdWVzXSkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJzU2V0ID0gdmFsdWVzLnVzZXJzIGluc3RhbmNlb2YgU2V0ID8gdmFsdWVzLnVzZXJzIDogbmV3IFNldCgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRTZXQgPSB2YWx1ZXMuZW5hYmxlZFVzZXJzIGluc3RhbmNlb2YgU2V0ID8gdmFsdWVzLmVuYWJsZWRVc2VycyA6IG5ldyBTZXQoKTsNCiAgICAgICAgICAgICAgICBjb25zdCB1c2VyQ291bnQgPSB1c2Vyc1NldC5zaXplIHx8IDA7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgIGxhYmVsOiBmb3JtYXRQZXJpb2RMYWJlbChsYWJlbCwgdmFsdWVzLmRhdGUpLA0KICAgICAgICAgICAgICAgICAgdG90YWxBY3Rpb25zOiB2YWx1ZXMudG90YWxBY3Rpb25zLA0KICAgICAgICAgICAgICAgICAgYXNzaXN0ZWRIb3VyczogdmFsdWVzLmFzc2lzdGVkSG91cnMsDQogICAgICAgICAgICAgICAgICBkYXRlOiB2YWx1ZXMuZGF0ZSwNCiAgICAgICAgICAgICAgICAgIGNhdGVnb3JpZXM6IHZhbHVlcy5jYXRlZ29yaWVzLA0KICAgICAgICAgICAgICAgICAgdXNlcnM6IG5ldyBTZXQodXNlcnNTZXQpLA0KICAgICAgICAgICAgICAgICAgZW5hYmxlZFVzZXJzOiBuZXcgU2V0KGVuYWJsZWRTZXQpLA0KICAgICAgICAgICAgICAgICAgZW5hYmxlZFVzZXJzQ291bnQ6IGVuYWJsZWRTZXQuc2l6ZSB8fCAwLA0KICAgICAgICAgICAgICAgICAgdXNlckNvdW50LA0KICAgICAgICAgICAgICAgICAgYXZlcmFnZUFjdGlvbnNQZXJVc2VyOiB1c2VyQ291bnQgPyB2YWx1ZXMudG90YWxBY3Rpb25zIC8gdXNlckNvdW50IDogMCwNCiAgICAgICAgICAgICAgICAgIGF2ZXJhZ2VIb3Vyc1BlclVzZXI6IHVzZXJDb3VudCA/IHZhbHVlcy5hc3Npc3RlZEhvdXJzIC8gdXNlckNvdW50IDogMA0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmRhdGUgLSBiLmRhdGUpOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCB3ZWVrbHlUaW1lbGluZSA9IEFycmF5LmZyb20od2Vla01hcC5lbnRyaWVzKCkpDQogICAgICAgICAgICAgIC5tYXAoKFtrZXksIHZhbHVlc10pID0+ICh7DQogICAgICAgICAgICAgICAga2V5LA0KICAgICAgICAgICAgICAgIGxhYmVsOiBmb3JtYXRTaG9ydERhdGUodmFsdWVzLmRhdGUpLA0KICAgICAgICAgICAgICAgIHRvdGFsQWN0aW9uczogdmFsdWVzLnRvdGFsQWN0aW9ucywNCiAgICAgICAgICAgICAgICBhc3Npc3RlZEhvdXJzOiB2YWx1ZXMuYXNzaXN0ZWRIb3VycywNCiAgICAgICAgICAgICAgICBkYXRlOiB2YWx1ZXMuZGF0ZSwNCiAgICAgICAgICAgICAgICB1c2VyczogdmFsdWVzLnVzZXJzIGluc3RhbmNlb2YgU2V0ID8gbmV3IFNldCh2YWx1ZXMudXNlcnMpIDogbmV3IFNldCgpLA0KICAgICAgICAgICAgICAgIGVuYWJsZWRVc2VyczogdmFsdWVzLmVuYWJsZWRVc2VycyBpbnN0YW5jZW9mIFNldCA/IG5ldyBTZXQodmFsdWVzLmVuYWJsZWRVc2VycykgOiBuZXcgU2V0KCkNCiAgICAgICAgICAgICAgfSkpDQogICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmRhdGUgLSBiLmRhdGUpOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCBjb25zaXN0ZW50U2xpY2UgPSB3ZWVrbHlUaW1lbGluZS5zbGljZSgtNCk7DQogICAgICAgICAgICBjb25zdCByZWNlbnRXZWVrU2xpY2UgPSBjb25zaXN0ZW50U2xpY2UubGVuZ3RoID09PSA0DQogICAgICAgICAgICAgID8gY29uc2lzdGVudFNsaWNlDQogICAgICAgICAgICAgIDogY29uc2lzdGVudFNsaWNlLnNsaWNlKC1jb25zaXN0ZW50U2xpY2UubGVuZ3RoKTsNCiAgICAgICAgICAgIGNvbnN0IGZyZXF1ZW50VXNhZ2VUb3RhbHMgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBpZiAocmVjZW50V2Vla1NsaWNlLmxlbmd0aCkgew0KICAgICAgICAgICAgICBjb25zdCByZWNlbnRLZXlzID0gcmVjZW50V2Vla1NsaWNlLm1hcChlbnRyeSA9PiBlbnRyeS5rZXkpOw0KICAgICAgICAgICAgICB1c2VyV2Vla0FjdGlvbnMuZm9yRWFjaCgod2Vla01hcCwgdXNlcikgPT4gew0KICAgICAgICAgICAgICAgIGlmICghKHdlZWtNYXAgaW5zdGFuY2VvZiBNYXApKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCB0b3RhbCA9IDA7DQogICAgICAgICAgICAgICAgcmVjZW50S2V5cy5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgICAgICAgICAgICB0b3RhbCArPSB3ZWVrTWFwLmdldChrZXkpIHx8IDA7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gMCkgew0KICAgICAgICAgICAgICAgICAgZnJlcXVlbnRVc2FnZVRvdGFscy5zZXQodXNlciwgdG90YWwpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBmcmVxdWVudFVzYWdlV2luZG93TGFiZWwgPSByZWNlbnRXZWVrU2xpY2UubGVuZ3RoDQogICAgICAgICAgICAgID8gZm9ybWF0UmFuZ2VMYWJlbChyZWNlbnRXZWVrU2xpY2VbMF0uZGF0ZSwgcmVjZW50V2Vla1NsaWNlW3JlY2VudFdlZWtTbGljZS5sZW5ndGggLSAxXS5kYXRlKQ0KICAgICAgICAgICAgICA6IG51bGw7DQogICAgICANCiAgICAgICAgICAgIGlmIChwZXJpb2RzLmxlbmd0aCkgew0KICAgICAgICAgICAgICBsYXRlc3RXZWVrID0gcGVyaW9kc1twZXJpb2RzLmxlbmd0aCAtIDFdOw0KICAgICAgICAgICAgICBwcmV2aW91c1dlZWsgPSBwZXJpb2RzLmxlbmd0aCA+IDEgPyBwZXJpb2RzW3BlcmlvZHMubGVuZ3RoIC0gMl0gOiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBjb25zdCBhdmVyYWdlQWN0aW9uc1BlclVzZXIgPSBhY3RpdmVVc2Vycy5zaXplID8gdG90YWxzLnRvdGFsQWN0aW9ucyAvIGFjdGl2ZVVzZXJzLnNpemUgOiAwOw0KICAgICAgICAgICAgY29uc3QgYXZlcmFnZUhvdXJzUGVyVXNlciA9IGFjdGl2ZVVzZXJzLnNpemUgPyB0b3RhbHMuYXNzaXN0ZWRIb3VycyAvIGFjdGl2ZVVzZXJzLnNpemUgOiAwOw0KICAgICAgICAgICAgY29uc3QgdXNlclN1bW1hcmllcyA9IEFycmF5LmZyb20odXNlclRvdGFscy52YWx1ZXMoKSk7DQogICAgICAgICAgICBjb25zdCB0b3BVc2VycyA9IHVzZXJTdW1tYXJpZXMNCiAgICAgICAgICAgICAgLmZpbHRlcihlbnRyeSA9PiAoZW50cnkudG90YWxBY3Rpb25zIHx8IDApID4gMCkNCiAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IChiLnRvdGFsQWN0aW9ucyB8fCAwKSAtIChhLnRvdGFsQWN0aW9ucyB8fCAwKSk7DQogICAgICAgICAgICBjb25zdCB0b3RhbEFjdGl2ZVVzZXJzQ291bnQgPSBhY3RpdmVVc2Vycy5zaXplOw0KICAgICAgICAgICAgY29uc3QgYWRvcHRpb25BcHBzID0gW107DQogICAgICAgICAgICBhZG9wdGlvbkVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGFwcFVzZXJzID0gZW50cnkudXNlclNldC5zaXplOw0KICAgICAgICAgICAgICBjb25zdCBzaGFyZURlbm9taW5hdG9yID0gdG90YWxBY3RpdmVVc2Vyc0NvdW50IHx8IDA7DQogICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVEZXRhaWxzID0gQXJyYXkuaXNBcnJheShlbnRyeS5jb25maWcuZmVhdHVyZXMpDQogICAgICAgICAgICAgICAgPyBlbnRyeS5jb25maWcuZmVhdHVyZXMubWFwKChmZWF0dXJlLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgZmVhdHVyZVNldCA9IGVudHJ5LmZlYXR1cmVTZXRzW2luZGV4XTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gZmVhdHVyZVNldCBpbnN0YW5jZW9mIFNldCA/IGZlYXR1cmVTZXQuc2l6ZSA6IDA7DQogICAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICBrZXk6IGZlYXR1cmUua2V5LA0KICAgICAgICAgICAgICAgICAgICBsYWJlbDogZmVhdHVyZS5sYWJlbCwNCiAgICAgICAgICAgICAgICAgICAgdXNlcnM6IGNvdW50LA0KICAgICAgICAgICAgICAgICAgICBzaGFyZTogc2hhcmVEZW5vbWluYXRvciA/IChjb3VudCAvIHNoYXJlRGVub21pbmF0b3IpICogMTAwIDogMA0KICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICB9KS5maWx0ZXIoZmVhdHVyZSA9PiBmZWF0dXJlLnVzZXJzID4gMCB8fCBmZWF0dXJlLmFsd2F5c1Nob3cpDQogICAgICAgICAgICAgICAgOiBbXTsNCiAgICAgICAgICAgICAgZmVhdHVyZURldGFpbHMuc29ydCgoYSwgYikgPT4gYi51c2VycyAtIGEudXNlcnMpOw0KICAgICAgICAgICAgICBjb25zdCBzaG91bGRJbmNsdWRlID0gYXBwVXNlcnMgPiAwIHx8IGZlYXR1cmVEZXRhaWxzLmxlbmd0aCA+IDAgfHwgZW50cnkuY29uZmlnLmFsd2F5c1Nob3c7DQogICAgICAgICAgICAgIGlmICghc2hvdWxkSW5jbHVkZSkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBhZG9wdGlvbkFwcHMucHVzaCh7DQogICAgICAgICAgICAgICAga2V5OiBlbnRyeS5rZXksDQogICAgICAgICAgICAgICAgbGFiZWw6IGVudHJ5LmNvbmZpZy5sYWJlbCB8fCBlbnRyeS5rZXksDQogICAgICAgICAgICAgICAgY29sb3I6IGVudHJ5LmNvbmZpZy5jb2xvciB8fCBudWxsLA0KICAgICAgICAgICAgICAgIHVzZXJzOiBhcHBVc2VycywNCiAgICAgICAgICAgICAgICBzaGFyZTogc2hhcmVEZW5vbWluYXRvciA/IChhcHBVc2VycyAvIHNoYXJlRGVub21pbmF0b3IpICogMTAwIDogMCwNCiAgICAgICAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZURldGFpbHMNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGFkb3B0aW9uQXBwcy5zb3J0KChhLCBiKSA9PiBiLnVzZXJzIC0gYS51c2Vycyk7DQogICAgICAgICAgICBjb25zdCBtb250aGx5VXNhZ2VBcnJheSA9IEFycmF5LmZyb20obW9udGhseVVzYWdlTWFwLmVudHJpZXMoKSkubWFwKChbbW9udGhLZXksIG1vbnRoRGF0YV0pID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgW3llYXJTdHJpbmcsIG1vbnRoU3RyaW5nXSA9IG1vbnRoS2V5ID8gbW9udGhLZXkuc3BsaXQoIi0iKSA6IFtdOw0KICAgICAgICAgICAgICBjb25zdCB5ZWFyID0gTnVtYmVyKHllYXJTdHJpbmcpOw0KICAgICAgICAgICAgICBjb25zdCBtb250aEluZGV4ID0gTnVtYmVyKG1vbnRoU3RyaW5nKTsNCiAgICAgICAgICAgICAgY29uc3QgbW9udGhEYXRlID0gTnVtYmVyLmlzRmluaXRlKHllYXIpICYmIE51bWJlci5pc0Zpbml0ZShtb250aEluZGV4KQ0KICAgICAgICAgICAgICAgID8gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGhJbmRleCAtIDEsIDEpKQ0KICAgICAgICAgICAgICAgIDogbnVsbDsNCiAgICAgICAgICAgICAgY29uc3QgZnJlcXVlbmN5VGVtcGxhdGUgPSB1c2FnZUJ1Y2tldHNUZW1wbGF0ZS5tYXAoYnVja2V0ID0+ICh7DQogICAgICAgICAgICAgICAgaWQ6IGJ1Y2tldC5pZCwNCiAgICAgICAgICAgICAgICBsYWJlbDogYnVja2V0LmxhYmVsLA0KICAgICAgICAgICAgICAgIG1pbjogYnVja2V0Lm1pbiwNCiAgICAgICAgICAgICAgICBtYXg6IGJ1Y2tldC5tYXgsDQogICAgICAgICAgICAgICAgY291bnQ6IDANCiAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICBjb25zdCB3ZWVrRW50cmllcyA9IEFycmF5LmZyb20obW9udGhEYXRhLndlZWtLZXlzIHx8IFtdKS5tYXAoa2V5ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCB3ZWVrSW5mbyA9IHdlZWtNYXAuZ2V0KGtleSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgIGtleSwNCiAgICAgICAgICAgICAgICAgIGRhdGU6IHdlZWtJbmZvICYmIHdlZWtJbmZvLmRhdGUgaW5zdGFuY2VvZiBEYXRlID8gd2Vla0luZm8uZGF0ZSA6IG51bGwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICB9KS5maWx0ZXIoZW50cnlQb2ludCA9PiBlbnRyeVBvaW50LmRhdGUgaW5zdGFuY2VvZiBEYXRlKQ0KICAgICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmRhdGUgLSBiLmRhdGUpOw0KICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFdlZWtFbnRyaWVzID0gd2Vla0VudHJpZXMuc2xpY2UoLTQpOw0KICAgICAgICAgICAgICBjb25zdCBvYnNlcnZlZFdlZWtDb3VudCA9IHNlbGVjdGVkV2Vla0VudHJpZXMubGVuZ3RoOw0KICAgICAgICAgICAgICBjb25zdCBhbGxvd2VkV2Vla0tleXMgPSBuZXcgU2V0KHNlbGVjdGVkV2Vla0VudHJpZXMubWFwKGVudHJ5ID0+IGVudHJ5LmtleSkpOw0KICAgICAgICAgICAgICBjb25zdCB1c2VyVG90YWxzRm9yV2luZG93ID0gbmV3IE1hcCgpOw0KICAgICAgICAgICAgICBtb250aERhdGEudXNlcldlZWtzLmZvckVhY2goKHNldCwgdXNlcikgPT4gew0KICAgICAgICAgICAgICAgIGlmICghKHNldCBpbnN0YW5jZW9mIFNldCkgfHwgIXNldC5zaXplKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCB1c2VyVG90YWwgPSAwOw0KICAgICAgICAgICAgICAgIGFsbG93ZWRXZWVrS2V5cy5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgICAgICAgICAgICBpZiAoc2V0LmhhcyhrZXkpKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdlZWtUb3RhbHMgPSB1c2VyV2Vla0FjdGlvbnMuZ2V0KHVzZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAod2Vla1RvdGFscyBpbnN0YW5jZW9mIE1hcCkgew0KICAgICAgICAgICAgICAgICAgICAgIHVzZXJUb3RhbCArPSB3ZWVrVG90YWxzLmdldChrZXkpIHx8IDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpZiAodXNlclRvdGFsID4gMCkgew0KICAgICAgICAgICAgICAgICAgdXNlclRvdGFsc0ZvcldpbmRvdy5zZXQodXNlciwgdXNlclRvdGFsKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB1c2VyVG90YWxzRm9yV2luZG93LmZvckVhY2godG90YWwgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHJvdW5kZWQgPSBNYXRoLnJvdW5kKHRvdGFsIHx8IDApOw0KICAgICAgICAgICAgICAgIGlmIChyb3VuZGVkIDw9IDApIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgYnVja2V0ID0gZnJlcXVlbmN5VGVtcGxhdGUuZmluZChpdGVtID0+IHJvdW5kZWQgPj0gaXRlbS5taW4gJiYgcm91bmRlZCA8PSBpdGVtLm1heCk7DQogICAgICAgICAgICAgICAgaWYgKGJ1Y2tldCkgew0KICAgICAgICAgICAgICAgICAgYnVja2V0LmNvdW50ICs9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgY29uc3QgdG90YWxVc2Vyc0ZvcldpbmRvdyA9IHVzZXJUb3RhbHNGb3JXaW5kb3cuc2l6ZTsNCiAgICAgICAgICAgICAgY29uc3QgZnJlcXVlbmN5QnVja2V0cyA9IGZyZXF1ZW5jeVRlbXBsYXRlLm1hcChidWNrZXQgPT4gKHsNCiAgICAgICAgICAgICAgICBsYWJlbDogYnVja2V0LmxhYmVsLA0KICAgICAgICAgICAgICAgIGNvdW50OiBidWNrZXQuY291bnQsDQogICAgICAgICAgICAgICAgc2hhcmU6IHRvdGFsVXNlcnNGb3JXaW5kb3cgPyAoYnVja2V0LmNvdW50IC8gdG90YWxVc2Vyc0ZvcldpbmRvdykgKiAxMDAgOiAwLA0KICAgICAgICAgICAgICAgIG1pbjogYnVja2V0Lm1pbiwNCiAgICAgICAgICAgICAgICBtYXg6IGJ1Y2tldC5tYXgNCiAgICAgICAgICAgICAgfSkpOw0KICAgICAgICAgICAgICBjb25zdCBoaWdoQnVja2V0ID0gZnJlcXVlbmN5VGVtcGxhdGVbZnJlcXVlbmN5VGVtcGxhdGUubGVuZ3RoIC0gMV07DQogICAgICAgICAgICAgIGNvbnN0IHBvd2VyVXNlcnMgPSBoaWdoQnVja2V0LmNvdW50Ow0KICAgICAgICAgICAgICBjb25zdCBwb3dlclNoYXJlID0gdG90YWxVc2Vyc0ZvcldpbmRvdyA/IChwb3dlclVzZXJzIC8gdG90YWxVc2Vyc0ZvcldpbmRvdykgKiAxMDAgOiAwOw0KICAgICAgICAgICAgICBjb25zdCBjb25zaXN0ZW5jeUJ1Y2tldHMgPSBvYnNlcnZlZFdlZWtDb3VudCA/IEFycmF5LmZyb20oeyBsZW5ndGg6IG9ic2VydmVkV2Vla0NvdW50IH0sICgpID0+IDApIDogW107DQogICAgICAgICAgICAgIGxldCB3ZWVrbHlBY3RpdmVVc2VycyA9IDA7DQogICAgICAgICAgICAgIG1vbnRoRGF0YS51c2VyV2Vla3MuZm9yRWFjaChzZXQgPT4gew0KICAgICAgICAgICAgICAgIGlmICghKHNldCBpbnN0YW5jZW9mIFNldCkgfHwgIXNldC5zaXplKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCBhY3RpdmVXZWVrcyA9IDA7DQogICAgICAgICAgICAgICAgYWxsb3dlZFdlZWtLZXlzLmZvckVhY2goa2V5ID0+IHsNCiAgICAgICAgICAgICAgICAgIGlmIChzZXQuaGFzKGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgYWN0aXZlV2Vla3MgKz0gMTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlV2Vla3MgPiAwKSB7DQogICAgICAgICAgICAgICAgICB3ZWVrbHlBY3RpdmVVc2VycyArPSAxOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYnVja2V0SW5kZXggPSBNYXRoLm1pbihvYnNlcnZlZFdlZWtDb3VudCwgYWN0aXZlV2Vla3MpIC0gMTsNCiAgICAgICAgICAgICAgICAgIGlmIChidWNrZXRJbmRleCA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5QnVja2V0c1tidWNrZXRJbmRleF0gKz0gMTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBjb25zdCBjb25zaXN0ZW50VXNlcnMgPSBvYnNlcnZlZFdlZWtDb3VudCAmJiBjb25zaXN0ZW5jeUJ1Y2tldHMubGVuZ3RoDQogICAgICAgICAgICAgICAgPyBjb25zaXN0ZW5jeUJ1Y2tldHNbY29uc2lzdGVuY3lCdWNrZXRzLmxlbmd0aCAtIDFdIHx8IDANCiAgICAgICAgICAgICAgICA6IDA7DQogICAgICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbnRTaGFyZSA9IHdlZWtseUFjdGl2ZVVzZXJzID8gKGNvbnNpc3RlbnRVc2VycyAvIHdlZWtseUFjdGl2ZVVzZXJzKSAqIDEwMCA6IDA7DQogICAgICAgICAgICAgIGNvbnN0IHJhbmdlU3RhcnQgPSBzZWxlY3RlZFdlZWtFbnRyaWVzLmxlbmd0aCA/IHNlbGVjdGVkV2Vla0VudHJpZXNbMF0uZGF0ZSA6IG1vbnRoRGF0YS5maXJzdERhdGU7DQogICAgICAgICAgICAgIGNvbnN0IHJhbmdlRW5kID0gc2VsZWN0ZWRXZWVrRW50cmllcy5sZW5ndGggPyBzZWxlY3RlZFdlZWtFbnRyaWVzW3NlbGVjdGVkV2Vla0VudHJpZXMubGVuZ3RoIC0gMV0uZGF0ZSA6IG1vbnRoRGF0YS5sYXN0RGF0ZTsNCiAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRSYW5nZUxhYmVsID0gcmFuZ2VTdGFydCAmJiByYW5nZUVuZCA/IGZvcm1hdFJhbmdlTGFiZWwocmFuZ2VTdGFydCwgcmFuZ2VFbmQpIDogbnVsbDsNCiAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBtb250aERhdGUsDQogICAgICAgICAgICAgICAgZGF0YTogew0KICAgICAgICAgICAgICAgICAga2V5OiBtb250aEtleSwNCiAgICAgICAgICAgICAgICAgIGxhYmVsOiBtb250aERhdGEubGFiZWwsDQogICAgICAgICAgICAgICAgICB0b3RhbFVzZXJzOiB0b3RhbFVzZXJzRm9yV2luZG93LA0KICAgICAgICAgICAgICAgICAgZnJlcXVlbmN5QnVja2V0cywNCiAgICAgICAgICAgICAgICAgIHBvd2VyVXNlcnMsDQogICAgICAgICAgICAgICAgICBwb3dlclNoYXJlLA0KICAgICAgICAgICAgICAgICAgaGlnaEJ1Y2tldExhYmVsOiBoaWdoQnVja2V0LmxhYmVsLA0KICAgICAgICAgICAgICAgICAgb2JzZXJ2ZWRXZWVrQ291bnQsDQogICAgICAgICAgICAgICAgICB3ZWVrbHlBY3RpdmVVc2VycywNCiAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5QnVja2V0cywNCiAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbnRVc2VycywNCiAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbnRTaGFyZSwNCiAgICAgICAgICAgICAgICAgIHdlZWtSYW5nZUxhYmVsOiBzZWxlY3RlZFJhbmdlTGFiZWwsDQogICAgICAgICAgICAgICAgICBtb250aFJhbmdlTGFiZWw6IHNlbGVjdGVkUmFuZ2VMYWJlbA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0pLmZpbHRlcihlbnRyeSA9PiBlbnRyeS5tb250aERhdGUgaW5zdGFuY2VvZiBEYXRlKTsNCiAgICAgICAgICAgIG1vbnRobHlVc2FnZUFycmF5LnNvcnQoKGEsIGIpID0+IGEubW9udGhEYXRlIC0gYi5tb250aERhdGUpOw0KICAgICAgICAgICAgY29uc3QgbW9udGhseVVzYWdlSW50ZW5zaXR5ID0gbW9udGhseVVzYWdlQXJyYXkuc2xpY2UoLTEyKS5tYXAoZW50cnkgPT4gZW50cnkuZGF0YSk7DQogICAgICAgICAgICBjb25zdCB3ZWVrc0J5TW9udGggPSBuZXcgTWFwKCk7DQogICAgICAgICAgICB3ZWVrTWFwLmZvckVhY2god2Vla0VudHJ5ID0+IHsNCiAgICAgICAgICAgICAgaWYgKCF3ZWVrRW50cnkgfHwgISh3ZWVrRW50cnkuZGF0ZSBpbnN0YW5jZW9mIERhdGUpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IG1vbnRoS2V5ID0gYCR7d2Vla0VudHJ5LmRhdGUuZ2V0VVRDRnVsbFllYXIoKX0tJHtwYWQod2Vla0VudHJ5LmRhdGUuZ2V0VVRDTW9udGgoKSArIDEpfWA7DQogICAgICAgICAgICAgIGxldCBidWNrZXQgPSB3ZWVrc0J5TW9udGguZ2V0KG1vbnRoS2V5KTsNCiAgICAgICAgICAgICAgaWYgKCFidWNrZXQpIHsNCiAgICAgICAgICAgICAgICBidWNrZXQgPSBbXTsNCiAgICAgICAgICAgICAgICB3ZWVrc0J5TW9udGguc2V0KG1vbnRoS2V5LCBidWNrZXQpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGJ1Y2tldC5wdXNoKHsNCiAgICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSh3ZWVrRW50cnkuZGF0ZS5nZXRUaW1lKCkpLA0KICAgICAgICAgICAgICAgIGNvdW50OiB3ZWVrRW50cnkuZW5hYmxlZFVzZXJzIGluc3RhbmNlb2YgU2V0ID8gd2Vla0VudHJ5LmVuYWJsZWRVc2Vycy5zaXplIDogMA0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgbW9udGhseUVuYWJsZWRVc2VycyA9IEFycmF5LmZyb20od2Vla3NCeU1vbnRoLmVudHJpZXMoKSkNCiAgICAgICAgICAgICAgLm1hcCgoW21vbnRoS2V5LCBlbnRyaWVzXSkgPT4gew0KICAgICAgICAgICAgICAgIGVudHJpZXMuc29ydCgoYSwgYikgPT4gYS5kYXRlIC0gYi5kYXRlKTsNCiAgICAgICAgICAgICAgICBjb25zdCBbeWVhciwgbW9udGhdID0gbW9udGhLZXkuc3BsaXQoIi0iKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgICAgICAgICBjb25zdCBtb250aFN0YXJ0ID0gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgKG1vbnRoIHx8IDEpIC0gMSwgMSkpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHR3b1dlZWtFbmQgPSBuZXcgRGF0ZShtb250aFN0YXJ0LmdldFRpbWUoKSk7DQogICAgICAgICAgICAgICAgdHdvV2Vla0VuZC5zZXRVVENEYXRlKHR3b1dlZWtFbmQuZ2V0VVRDRGF0ZSgpICsgMTMpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0Rm9ydG5pZ2h0ID0gZW50cmllcy5maWx0ZXIoZW50cnkgPT4gZW50cnkuZGF0ZSA+PSBtb250aFN0YXJ0ICYmIGVudHJ5LmRhdGUgPD0gdHdvV2Vla0VuZCk7DQogICAgICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlcyA9IGZpcnN0Rm9ydG5pZ2h0Lmxlbmd0aCA/IGZpcnN0Rm9ydG5pZ2h0IDogZW50cmllcy5zbGljZSgwLCAxKTsNCiAgICAgICAgICAgICAgICBjb25zdCBiZXN0RW50cnkgPSBjYW5kaWRhdGVzLnJlZHVjZSgoYmVzdCwgZW50cnkpID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGJlc3RDb3VudCA9IGJlc3QgPyBiZXN0LmNvdW50IHx8IDAgOiAtSW5maW5pdHk7DQogICAgICAgICAgICAgICAgICByZXR1cm4gKGVudHJ5LmNvdW50IHx8IDApID4gYmVzdENvdW50ID8gZW50cnkgOiBiZXN0Ow0KICAgICAgICAgICAgICAgIH0sIGNhbmRpZGF0ZXNbMF0gfHwgbnVsbCk7DQogICAgICAgICAgICAgICAgY29uc3QgYmVzdENvdW50ID0gYmVzdEVudHJ5ICYmIE51bWJlci5pc0Zpbml0ZShiZXN0RW50cnkuY291bnQpID8gYmVzdEVudHJ5LmNvdW50IDogMDsNCiAgICAgICAgICAgICAgICBjb25zdCByZXByZXNlbnRhdGl2ZURhdGUgPSBiZXN0RW50cnk/LmRhdGUgfHwgZW50cmllc1swXS5kYXRlOw0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICBrZXk6IG1vbnRoS2V5LA0KICAgICAgICAgICAgICAgICAgbGFiZWw6IGZvcm1hdE1vbnRoWWVhcihyZXByZXNlbnRhdGl2ZURhdGUpLA0KICAgICAgICAgICAgICAgICAgY291bnQ6IGJlc3RDb3VudCwNCiAgICAgICAgICAgICAgICAgIGRhdGU6IHJlcHJlc2VudGF0aXZlRGF0ZQ0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIC5zb3J0KChhLCBiKSA9PiBhLmRhdGUgLSBiLmRhdGUpOw0KICAgICAgICAgICAgY29uc3QgYWRvcHRpb24gPSB7DQogICAgICAgICAgICAgIHRvdGFsQWN0aXZlVXNlcnM6IHRvdGFsQWN0aXZlVXNlcnNDb3VudCwNCiAgICAgICAgICAgICAgYXBwczogYWRvcHRpb25BcHBzDQogICAgICAgICAgICB9Ow0KICAgICAgDQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICB0b3RhbHMsDQogICAgICAgICAgICAgIGFjdGl2ZVVzZXJzLA0KICAgICAgICAgICAgICBlbmFibGVkVXNlcnMsDQogICAgICAgICAgICAgIGdyb3VwczogZ3JvdXBFbnRyaWVzLA0KICAgICAgICAgICAgICBwZXJpb2RzLA0KICAgICAgICAgICAgICBmaWx0ZXJlZENvdW50OiByb3dzLmxlbmd0aCwNCiAgICAgICAgICAgICAgYXZlcmFnZUFjdGlvbnNQZXJVc2VyLA0KICAgICAgICAgICAgICBhdmVyYWdlSG91cnNQZXJVc2VyLA0KICAgICAgICAgICAgICB0b3BVc2VycywNCiAgICAgICAgICAgICAgdXNlclN1bW1hcmllcywNCiAgICAgICAgICAgICAgdXNlcldlZWtseUFjdGl2aXR5LA0KICAgICAgICAgICAgICB3ZWVrbHlUaW1lbGluZSwNCiAgICAgICAgICAgICAgYWN0aXZlRGF5c0xhc3QzMDogew0KICAgICAgICAgICAgICAgIHVuaXF1ZVVzZXJzOiBPYmplY3QuZnJvbUVudHJpZXMoYWN0aXZlRGF5S2V5cy5tYXAoa2V5ID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHNldCA9IGxhc3QzMFVzZXJTZXRzLmdldChrZXkpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuIFtrZXksIHNldCBpbnN0YW5jZW9mIFNldCA/IHNldC5zaXplIDogMF07DQogICAgICAgICAgICAgICAgfSkpLA0KICAgICAgICAgICAgICAgIHByb21wdFRvdGFsczogT2JqZWN0LmZyb21FbnRyaWVzKGFjdGl2ZURheUtleXMubWFwKGtleSA9PiB7DQogICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IGxhc3QzMFByb21wdFRvdGFsc1trZXldIHx8IDA7DQogICAgICAgICAgICAgICAgICByZXR1cm4gW2tleSwgdG90YWxdOw0KICAgICAgICAgICAgICAgIH0pKSwNCiAgICAgICAgICAgICAgICByYW5nZUxhYmVsOiBsYXN0MzBDdXRvZmYgJiYgc3RhdGUubGF0ZXN0RGF0ZSA/IGZvcm1hdFJhbmdlTGFiZWwobGFzdDMwQ3V0b2ZmLCBzdGF0ZS5sYXRlc3REYXRlKSA6IG51bGwNCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgY2F0ZWdvcnlUb3RhbHMsDQogICAgICAgICAgICAgIG1vbnRobHlVc2FnZUludGVuc2l0eSwNCiAgICAgICAgICAgICAgbW9udGhseUVuYWJsZWRVc2VycywNCiAgICAgICAgICAgICAgZnJlcXVlbnRVc2FnZVRvdGFscywNCiAgICAgICAgICAgICAgZnJlcXVlbnRVc2FnZVdpbmRvd0xhYmVsLA0KICAgICAgICAgICAgICBhZG9wdGlvbiwNCiAgICAgICAgICAgICAgd2luZG93TGFiZWw6IGZvcm1hdFJhbmdlTGFiZWwocGVyaW9kRWFybGllc3QsIHBlcmlvZExhdGVzdCksDQogICAgICAgICAgICAgIGxhdGVzdFdlZWssDQogICAgICAgICAgICAgIHByZXZpb3VzV2Vlaw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBidWlsZFRyZW5kRGF0YXNldHMocGVyaW9kcywgbWV0cmljLCBkZXRhaWxNb2RlID0gInJlc3BlY3QiKSB7DQogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocGVyaW9kcykgfHwgIXBlcmlvZHMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHJldHVybiBjaGFydFNlcmllc0RlZmluaXRpb25zDQogICAgICAgICAgICAgICAgLmZpbHRlcihkZWYgPT4gIWRlZi50b2dnbGFibGUgfHwgZGVmLmlkID09PSAidG90YWwiKQ0KICAgICAgICAgICAgICAgIC5tYXAoZGVmID0+ICh7DQogICAgICAgICAgICAgICAgICBsYWJlbDogdHlwZW9mIGRlZi5sYWJlbCA9PT0gImZ1bmN0aW9uIiA/IGRlZi5sYWJlbChtZXRyaWMpIDogZGVmLmxhYmVsLA0KICAgICAgICAgICAgICAgICAgZGF0YTogW10sDQogICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogZGVmLmJvcmRlckNvbG9yLA0KICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBkZWYuYmFja2dyb3VuZENvbG9yLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IGRlZi5ib3JkZXJXaWR0aCA/PyAyLA0KICAgICAgICAgICAgICAgICAgZmlsbDogZGVmLmZpbGwgPz8gZmFsc2UsDQogICAgICAgICAgICAgICAgICB0ZW5zaW9uOiBkZWYudGVuc2lvbiA/PyAwLjI2LA0KICAgICAgICAgICAgICAgICAgcG9pbnRSYWRpdXM6IGRlZi5wb2ludFJhZGl1cyA/PyAzLA0KICAgICAgICAgICAgICAgICAgcG9pbnRIb3ZlclJhZGl1czogZGVmLnBvaW50SG92ZXJSYWRpdXMgPz8gNSwNCiAgICAgICAgICAgICAgICAgIHBvaW50QmFja2dyb3VuZENvbG9yOiBkZWYucG9pbnRCYWNrZ3JvdW5kQ29sb3IgPz8gIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgICAgcG9pbnRCb3JkZXJDb2xvcjogZGVmLnBvaW50Qm9yZGVyQ29sb3IgPz8gZGVmLmJvcmRlckNvbG9yLA0KICAgICAgICAgICAgICAgICAgcG9pbnRCb3JkZXJXaWR0aDogZGVmLnBvaW50Qm9yZGVyV2lkdGggPz8gMiwNCiAgICAgICAgICAgICAgICAgIGJvcmRlckRhc2g6IGRlZi5ib3JkZXJEYXNoLA0KICAgICAgICAgICAgICAgICAgX19jb3BpbG90RGVmaW5pdGlvbklkOiBkZWYuaWQsDQogICAgICAgICAgICAgICAgICBfX2NvcGlsb3RJc0RldGFpbFNlcmllczogQm9vbGVhbihkZWYudG9nZ2xhYmxlKQ0KICAgICAgICAgICAgICAgIH0pKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWREZXRhaWxNb2RlID0gZGV0YWlsTW9kZSB8fCAicmVzcGVjdCI7DQogICAgICAgICAgICBjb25zdCBhY3RpdmVTZWxlY3Rpb24gPSBnZXRBY3RpdmVDYXRlZ29yeVNlbGVjdGlvbigpOw0KICAgICAgICAgICAgcmV0dXJuIGNoYXJ0U2VyaWVzRGVmaW5pdGlvbnMNCiAgICAgICAgICAgICAgLmZpbHRlcihkZWYgPT4gew0KICAgICAgICAgICAgICAgIGlmIChkZWYubWV0cmljcyAmJiAhZGVmLm1ldHJpY3MuaW5jbHVkZXMobWV0cmljKSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUudHJlbmRWaWV3ID09PSAiYXZlcmFnZSIgJiYgZGVmLnN1cHBvcnRzQXZlcmFnZSA9PT0gZmFsc2UpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGRlZi5pZCA9PT0gInRvdGFsIikgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICghZGVmLnRvZ2dsYWJsZSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChtZXRyaWMgPT09ICJob3VycyIpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWREZXRhaWxNb2RlID09PSAibm9uZSIpIHsNCiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWREZXRhaWxNb2RlID09PSAiYWxsIikgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zZXJpZXNWaXNpYmlsaXR5W2RlZi5pZF0gPT09IGZhbHNlKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBhY3RpdmVTZWxlY3Rpb24uaGFzKGRlZi5pZCk7DQogICAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgIC5tYXAoZGVmID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBwZXJpb2RzLm1hcChwZXJpb2QgPT4gYWRqdXN0VHJlbmRWYWx1ZUZvclZpZXcoZGVmLmdldFZhbHVlKHBlcmlvZCksIHBlcmlvZCwgZGVmKSk7DQogICAgICAgICAgICAgICAgbGV0IGxhYmVsID0gdHlwZW9mIGRlZi5sYWJlbCA9PT0gImZ1bmN0aW9uIiA/IGRlZi5sYWJlbChtZXRyaWMpIDogZGVmLmxhYmVsOw0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS50cmVuZFZpZXcgPT09ICJhdmVyYWdlIiAmJiBkZWYuc3VwcG9ydHNBdmVyYWdlICE9PSBmYWxzZSkgew0KICAgICAgICAgICAgICAgICAgaWYgKGRlZi5pZCA9PT0gInRvdGFsIikgew0KICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IG1ldHJpYyA9PT0gImhvdXJzIiA/ICJBdmcgaG91cnMgcGVyIHVzZXIiIDogIkF2ZyBhY3Rpb25zIHBlciB1c2VyIjsNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGxhYmVsID0gYCR7bGFiZWx9IChhdmcpYDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHsNCiAgICAgICAgICAgICAgICAgIGxhYmVsLA0KICAgICAgICAgICAgICAgICAgZGF0YTogdmFsdWVzLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6IGRlZi5ib3JkZXJDb2xvciwNCiAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogZGVmLmJhY2tncm91bmRDb2xvciwNCiAgICAgICAgICAgICAgICAgIGJvcmRlcldpZHRoOiBkZWYuYm9yZGVyV2lkdGggPz8gMiwNCiAgICAgICAgICAgICAgICAgIGZpbGw6IGRlZi5maWxsID8/IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgdGVuc2lvbjogZGVmLnRlbnNpb24gPz8gMC4yNiwNCiAgICAgICAgICAgICAgICAgIHBvaW50UmFkaXVzOiBkZWYucG9pbnRSYWRpdXMgPz8gMywNCiAgICAgICAgICAgICAgICAgIHBvaW50SG92ZXJSYWRpdXM6IGRlZi5wb2ludEhvdmVyUmFkaXVzID8/IDUsDQogICAgICAgICAgICAgICAgICBwb2ludEJhY2tncm91bmRDb2xvcjogZGVmLnBvaW50QmFja2dyb3VuZENvbG9yID8/ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgIHBvaW50Qm9yZGVyQ29sb3I6IGRlZi5wb2ludEJvcmRlckNvbG9yID8/IGRlZi5ib3JkZXJDb2xvciwNCiAgICAgICAgICAgICAgICAgIHBvaW50Qm9yZGVyV2lkdGg6IGRlZi5wb2ludEJvcmRlcldpZHRoID8/IDIsDQogICAgICAgICAgICAgICAgICBib3JkZXJEYXNoOiBkZWYuYm9yZGVyRGFzaCwNCiAgICAgICAgICAgICAgICAgIF9fY29waWxvdERlZmluaXRpb25JZDogZGVmLmlkLA0KICAgICAgICAgICAgICAgICAgX19jb3BpbG90SXNEZXRhaWxTZXJpZXM6IEJvb2xlYW4oZGVmLnRvZ2dsYWJsZSkNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIHJldHVybiBhcHBseVRyZW5kQ29sb3JUb0RhdGFzZXQoZGF0YXNldCwgZGVmLmlkKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVHJlbmRDaGFydChwZXJpb2RzKSB7DQogICAgICAgICAgICBjb25zdCBjaGFydCA9IHN0YXRlLmNoYXJ0cy50cmVuZDsNCiAgICAgICAgICAgIGlmICghY2hhcnQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFwZXJpb2RzLmxlbmd0aCkgew0KICAgICAgICAgICAgICBkb20udHJlbmRFbXB0eS5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgY2hhcnQuZGF0YS5sYWJlbHMgPSBbXTsNCiAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0cyA9IFtdOw0KICAgICAgICAgICAgICBjaGFydC51cGRhdGUoIm5vbmUiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG9tLnRyZW5kRW1wdHkuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIGNoYXJ0LmRhdGEubGFiZWxzID0gcGVyaW9kcy5tYXAoaXRlbSA9PiBpdGVtLmxhYmVsKTsNCg0KICAgICAgICAgICAgY29uc3QgbWV0cmljID0gc3RhdGUuZmlsdGVycy5tZXRyaWM7DQogICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzID0gYnVpbGRUcmVuZERhdGFzZXRzKHBlcmlvZHMsIG1ldHJpYywgc3RhdGUuc2VyaWVzRGV0YWlsTW9kZSk7DQogICAgICAgICAgICBjb25zdCB5U2NhbGUgPSBjaGFydC5vcHRpb25zPy5zY2FsZXM/Lnk7DQogICAgICAgICAgICBpZiAoeVNjYWxlICYmIHlTY2FsZS50aWNrcykgew0KICAgICAgICAgICAgICB5U2NhbGUudGlja3MuY2FsbGJhY2sgPSB2YWx1ZSA9PiBmb3JtYXRUcmVuZEF4aXNUaWNrKHZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNoYXJ0LnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRyZW5kQ2FwdGlvblRleHQoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS50cmVuZENhcHRpb24pIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgaXNBdmVyYWdlVmlldyA9IHN0YXRlLnRyZW5kVmlldyA9PT0gImF2ZXJhZ2UiOw0KICAgICAgICAgICAgY29uc3QgaXNIb3Vyc01ldHJpYyA9IHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiOw0KICAgICAgICAgICAgY29uc3QgbWV0cmljTGFiZWwgPSBpc0hvdXJzTWV0cmljDQogICAgICAgICAgICAgID8gKGlzQXZlcmFnZVZpZXcgPyAiQ29waWxvdCBhc3Npc3RlZCBob3VycyBwZXIgYWN0aXZlIHVzZXIiIDogIkNvcGlsb3QgYXNzaXN0ZWQgaG91cnMiKQ0KICAgICAgICAgICAgICA6IChpc0F2ZXJhZ2VWaWV3ID8gIkNvcGlsb3QgYWN0aW9ucyBwZXIgYWN0aXZlIHVzZXIiIDogIkNvcGlsb3QgYWN0aW9ucyIpOw0KICAgICAgICAgICAgZG9tLnRyZW5kQ2FwdGlvbi50ZXh0Q29udGVudCA9IGAke21ldHJpY0xhYmVsfSBhZ2dyZWdhdGVkICR7c3RhdGUuZmlsdGVycy5hZ2dyZWdhdGV9LmA7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVNlcmllc1RvZ2dsZXMoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5zZXJpZXNUb2dnbGVHcm91cCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20uc2VyaWVzVG9nZ2xlR3JvdXAuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICBzZXJpZXNUb2dnbGVCdXR0b25zLmNsZWFyKCk7DQogICAgICAgICAgICBjaGFydFNlcmllc0RlZmluaXRpb25zLmZvckVhY2goZGVmID0+IHsNCiAgICAgICAgICAgICAgaWYgKCFkZWYudG9nZ2xhYmxlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICAgICAgICAgICAgICBidXR0b24udHlwZSA9ICJidXR0b24iOw0KICAgICAgICAgICAgICBidXR0b24uY2xhc3NOYW1lID0gInNlcmllcy10b2dnbGUiOw0KICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IHR5cGVvZiBkZWYubGFiZWwgPT09ICJmdW5jdGlvbiIgPyBkZWYubGFiZWwoImFjdGlvbnMiKSA6IGRlZi5sYWJlbDsNCiAgICAgICAgICAgICAgY29uc3QgaXNWaXNpYmxlID0gc3RhdGUuc2VyaWVzVmlzaWJpbGl0eVtkZWYuaWRdICE9PSBmYWxzZTsNCiAgICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gbGFiZWw7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBpc1Zpc2libGUpOw0KICAgICAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCBTdHJpbmcoaXNWaXNpYmxlKSk7DQogICAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2VsZWN0aW9uID0gY2xvbmVBY3RpdmVDYXRlZ29yeVNlbGVjdGlvbigpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRseVZpc2libGUgPSBjdXJyZW50U2VsZWN0aW9uLmhhcyhkZWYuaWQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5leHRWaXNpYmxlID0gIWN1cnJlbnRseVZpc2libGU7DQogICAgICAgICAgICAgICAgaWYgKCFuZXh0VmlzaWJsZSAmJiBjdXJyZW50U2VsZWN0aW9uLnNpemUgPD0gMSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAobmV4dFZpc2libGUpIHsNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZWxlY3Rpb24uYWRkKGRlZi5pZCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnRTZWxlY3Rpb24uZGVsZXRlKGRlZi5pZCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHN0YXRlLmZpbHRlcnMuY2F0ZWdvcnlTZWxlY3Rpb24gPSBjdXJyZW50U2VsZWN0aW9uOw0KICAgICAgICAgICAgICAgIHN0YXRlLnNlcmllc1Zpc2liaWxpdHlbZGVmLmlkXSA9IG5leHRWaXNpYmxlOw0KICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBuZXh0VmlzaWJsZSk7DQogICAgICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgU3RyaW5nKG5leHRWaXNpYmxlKSk7DQogICAgICAgICAgICAgICAgcmVuZGVyRGFzaGJvYXJkKCk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBkb20uc2VyaWVzVG9nZ2xlR3JvdXAuYXBwZW5kKGJ1dHRvbik7DQogICAgICAgICAgICAgIHNlcmllc1RvZ2dsZUJ1dHRvbnMuc2V0KGRlZi5pZCwgYnV0dG9uKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUV4cG9ydERldGFpbE9wdGlvbigpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmV4cG9ydEluY2x1ZGVEZXRhaWxzV3JhcHBlciB8fCAhZG9tLmV4cG9ydEluY2x1ZGVEZXRhaWxzKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGhhc0RldGFpbERlZmluaXRpb25zID0gY2hhcnRTZXJpZXNEZWZpbml0aW9ucy5zb21lKGRlZiA9PiBkZWYudG9nZ2xhYmxlKTsNCiAgICAgICAgICAgIGNvbnN0IG1ldHJpY1N1cHBvcnRzRGV0YWlscyA9IHN0YXRlLmZpbHRlcnMubWV0cmljICE9PSAiaG91cnMiOw0KICAgICAgICAgICAgY29uc3QgaGFzVHJlbmREYXRhID0gQXJyYXkuaXNBcnJheShzdGF0ZS5sYXRlc3RUcmVuZFBlcmlvZHMpICYmIHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcy5sZW5ndGggPiAwOw0KICAgICAgICAgICAgY29uc3QgZGV0YWlsTW9kZUFsbG93cyA9IHN0YXRlLnNlcmllc0RldGFpbE1vZGUgIT09ICJub25lIjsNCiAgICAgICAgICAgIGNvbnN0IHNob3VsZFNob3cgPSBoYXNEZXRhaWxEZWZpbml0aW9ucyAmJiBtZXRyaWNTdXBwb3J0c0RldGFpbHMgJiYgaGFzVHJlbmREYXRhICYmIGRldGFpbE1vZGVBbGxvd3M7DQogICAgICAgICAgICBkb20uZXhwb3J0SW5jbHVkZURldGFpbHNXcmFwcGVyLmhpZGRlbiA9ICFzaG91bGRTaG93Ow0KICAgICAgICAgICAgaWYgKCFzaG91bGRTaG93KSB7DQogICAgICAgICAgICAgIGRvbS5leHBvcnRJbmNsdWRlRGV0YWlscy5kaXNhYmxlZCA9IHRydWU7DQogICAgICAgICAgICAgIGRvbS5leHBvcnRJbmNsdWRlRGV0YWlscy5jaGVja2VkID0gZmFsc2U7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvbS5leHBvcnRJbmNsdWRlRGV0YWlscy5kaXNhYmxlZCA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc3QgaW5jbHVkZSA9IHN0YXRlLmV4cG9ydFByZWZlcmVuY2VzLmluY2x1ZGVEZXRhaWxzICE9PSBmYWxzZTsNCiAgICAgICAgICAgIGRvbS5leHBvcnRJbmNsdWRlRGV0YWlscy5jaGVja2VkID0gaW5jbHVkZTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZXJpZXNUb2dnbGVTdGF0ZSgpIHsNCiAgICAgICAgICAgIGNvbnN0IG1ldHJpY0lzSG91cnMgPSBzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIjsNCiAgICAgICAgICAgIGlmIChkb20uc2VyaWVzSGludCkgew0KICAgICAgICAgICAgICBkb20uc2VyaWVzSGludC5oaWRkZW4gPSAhbWV0cmljSXNIb3VyczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IGdldEFjdGl2ZUNhdGVnb3J5U2VsZWN0aW9uKCk7DQogICAgICAgICAgICBzZXJpZXNUb2dnbGVCdXR0b25zLmZvckVhY2goKGJ1dHRvbiwgaWQpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdmlzaWJsZSA9IHNlbGVjdGlvbi5oYXMoaWQpOw0KICAgICAgICAgICAgICBzdGF0ZS5zZXJpZXNWaXNpYmlsaXR5W2lkXSA9IHZpc2libGU7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCB2aXNpYmxlKTsNCiAgICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgU3RyaW5nKHZpc2libGUpKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNlcmllc0RldGFpbE1vZGVCdXR0b24oKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5zZXJpZXNNb2RlVG9nZ2xlKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGlzSGlkZGVuID0gc3RhdGUuc2VyaWVzRGV0YWlsTW9kZSA9PT0gIm5vbmUiOw0KICAgICAgICAgICAgY29uc3QgZGlzYWJsZWQgPSAhc3RhdGUucm93cy5sZW5ndGg7DQogICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIFN0cmluZyhpc0hpZGRlbikpOw0KICAgICAgICAgICAgZG9tLnNlcmllc01vZGVUb2dnbGUudGV4dENvbnRlbnQgPSBpc0hpZGRlbiA/ICJTaG93IGNhcGFiaWxpdHkgbGluZXMiIDogIkhpZGUgY2FwYWJpbGl0eSBsaW5lcyI7DQogICAgICAgICAgICBkb20uc2VyaWVzTW9kZVRvZ2dsZS5kaXNhYmxlZCA9IGRpc2FibGVkOw0KICAgICAgICAgICAgZG9tLnNlcmllc01vZGVUb2dnbGUuY2xhc3NMaXN0LnRvZ2dsZSgiaXMtZGlzYWJsZWQiLCBkaXNhYmxlZCk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlR3JvdXBUYWJsZShncm91cHMsIHRvdGFsTWV0cmljVmFsdWUpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmdyb3VwQm9keSB8fCAhZG9tLmdyb3VwQ2FwdGlvbiB8fCAhZG9tLnZpZXdNb3JlQnV0dG9uKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvbS5ncm91cEJvZHkuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICBpZiAoIWdyb3Vwcy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgZG9tLmdyb3VwQ2FwdGlvbi50ZXh0Q29udGVudCA9ICJObyBncm91cCBkYXRhIGF2YWlsYWJsZSBmb3IgdGhlIGN1cnJlbnQgZmlsdGVycy4iOw0KICAgICAgICAgICAgICBkb20udmlld01vcmVCdXR0b24uaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgZG9tLnZpZXdNb3JlQnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpOw0KICAgICAgICAgICAgICBzdGF0ZS5ncm91cHNFeHBhbmRlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBtYXhSb3dzID0gTUFYX1ZJU0lCTEVfR1JPVVBfUk9XUzsNCiAgICAgICAgICAgIGNvbnN0IG1ldHJpY0xhYmVsID0gc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAiYXNzaXN0ZWQgaG91cnMiIDogImFjdGlvbnMiOw0KICAgICAgICAgICAgZG9tLmdyb3VwQ2FwdGlvbi50ZXh0Q29udGVudCA9IGBUb3AgJHtNYXRoLm1pbihncm91cHMubGVuZ3RoLCBtYXhSb3dzKX0gZ3JvdXBzL29mZmljZXMgYnkgJHttZXRyaWNMYWJlbH0uYDsNCiAgICAgICAgICAgIGNvbnN0IG1ldHJpY0tleSA9IHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiID8gImFzc2lzdGVkSG91cnMiIDogInRvdGFsQWN0aW9ucyI7DQogICAgICAgICAgICBjb25zdCBleHBhbmRlZCA9IHN0YXRlLmdyb3Vwc0V4cGFuZGVkID09PSB0cnVlOw0KICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goKGdyb3VwLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBzaGFyZSA9IHRvdGFsTWV0cmljVmFsdWUgPyBncm91cFttZXRyaWNLZXldIC8gdG90YWxNZXRyaWNWYWx1ZSA6IDA7DQogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7DQogICAgICAgICAgICAgIGNvbnN0IHNob3VsZEhpZGUgPSAhZXhwYW5kZWQgJiYgaW5kZXggPj0gbWF4Um93czsNCiAgICAgICAgICAgICAgaWYgKHNob3VsZEhpZGUpIHsNCiAgICAgICAgICAgICAgICByb3cuZGF0YXNldC5oaWRkZW5Sb3cgPSAidHJ1ZSI7DQogICAgICAgICAgICAgICAgcm93LmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgbmFtZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICBuYW1lQ2VsbC50ZXh0Q29udGVudCA9IGdyb3VwLm5hbWUgfHwgIlVuc3BlY2lmaWVkIjsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCB1c2Vyc0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICB1c2Vyc0NlbGwuY2xhc3NMaXN0LmFkZCgidXNlcnMtY2VsbCIpOw0KICAgICAgICAgICAgICB1c2Vyc0NlbGwudGV4dENvbnRlbnQgPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQoZ3JvdXAudXNlcnMgfHwgMCkpOw0KICAgICAgDQogICAgICAgICAgICAgIGNvbnN0IHZhbHVlQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgICAgICAgICAgIHZhbHVlQ2VsbC5jbGFzc0xpc3QuYWRkKCJ2YWx1ZS1jZWxsIik7DQogICAgICAgICAgICAgIHZhbHVlQ2VsbC50ZXh0Q29udGVudCA9IHN0YXRlLmZpbHRlcnMubWV0cmljID09PSAiaG91cnMiDQogICAgICAgICAgICAgICAgPyBgJHtob3Vyc0Zvcm1hdHRlci5mb3JtYXQoZ3JvdXAuYXNzaXN0ZWRIb3Vycyl9IGhyc2ANCiAgICAgICAgICAgICAgICA6IG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZChncm91cC50b3RhbEFjdGlvbnMpKTsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBhdmdDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgICAgICAgICAgYXZnQ2VsbC5jbGFzc0xpc3QuYWRkKCJhdmctY2VsbCIpOw0KICAgICAgICAgICAgICBhdmdDZWxsLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKGdyb3VwLmF2ZXJhZ2VBY3Rpb25zUGVyVXNlciB8fCAwKSk7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3Qgc2hhcmVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgICAgICAgICAgc2hhcmVDZWxsLmNsYXNzTGlzdC5hZGQoInNoYXJlLWNlbGwiKTsNCiAgICAgICAgICAgICAgc2hhcmVDZWxsLnRleHRDb250ZW50ID0gc2hhcmUgPyBgJHsoc2hhcmUgKiAxMDApLnRvRml4ZWQoMSl9JWAgOiAiMCUiOw0KICAgICAgDQogICAgICAgICAgICAgIGNvbnN0IG1vbWVudHVtQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgICAgICAgICAgIGNvbnN0IGJhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICBiYXIuY2xhc3NOYW1lID0gImdyb3VwLWJhciI7DQogICAgICAgICAgICAgIGNvbnN0IGZpbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgIGZpbGwuc3R5bGUudHJhbnNmb3JtID0gYHNjYWxlWCgke01hdGgubWluKDEsIHNoYXJlICogMS41KX0pYDsNCiAgICAgICAgICAgICAgYmFyLmFwcGVuZChmaWxsKTsNCiAgICAgICAgICAgICAgbW9tZW50dW1DZWxsLmFwcGVuZChiYXIpOw0KICAgICAgDQogICAgICAgICAgICAgIHJvdy5hcHBlbmQobmFtZUNlbGwsIHVzZXJzQ2VsbCwgdmFsdWVDZWxsLCBhdmdDZWxsLCBzaGFyZUNlbGwsIG1vbWVudHVtQ2VsbCk7DQogICAgICAgICAgICAgIGRvbS5ncm91cEJvZHkuYXBwZW5kKHJvdyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGNvbnN0IGhhc092ZXJmbG93ID0gZ3JvdXBzLmxlbmd0aCA+IG1heFJvd3M7DQogICAgICAgICAgICBpZiAoIWhhc092ZXJmbG93KSB7DQogICAgICAgICAgICAgIHN0YXRlLmdyb3Vwc0V4cGFuZGVkID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20udmlld01vcmVCdXR0b24uaGlkZGVuID0gIWhhc092ZXJmbG93Ow0KICAgICAgICAgICAgZG9tLnZpZXdNb3JlQnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsIFN0cmluZyhzdGF0ZS5ncm91cHNFeHBhbmRlZCA9PT0gdHJ1ZSkpOw0KICAgICAgICAgICAgaWYgKGhhc092ZXJmbG93KSB7DQogICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ0NvdW50ID0gTWF0aC5tYXgoMCwgZ3JvdXBzLmxlbmd0aCAtIG1heFJvd3MpOw0KICAgICAgICAgICAgICBjb25zdCBncm91cExhYmVsID0gcmVtYWluaW5nQ291bnQgPT09IDEgPyAiZ3JvdXAvb2ZmaWNlIiA6ICJncm91cHMvb2ZmaWNlcyI7DQogICAgICAgICAgICAgIGRvbS52aWV3TW9yZUJ1dHRvbi50ZXh0Q29udGVudCA9IHN0YXRlLmdyb3Vwc0V4cGFuZGVkDQogICAgICAgICAgICAgICAgPyBgU2hvdyB0b3AgJHttYXhSb3dzfSBncm91cHMvb2ZmaWNlc2ANCiAgICAgICAgICAgICAgICA6IGBTaG93IHJlbWFpbmluZyAke3JlbWFpbmluZ0NvdW50fSAke2dyb3VwTGFiZWx9YDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVDYXRlZ29yeUNhcmRzKGNhdGVnb3J5VG90YWxzKSB7DQogICAgICAgICAgICBPYmplY3QuZW50cmllcyhjYXRlZ29yeUNvbmZpZykuZm9yRWFjaCgoW2tleSwgY29uZmlnXSkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtY2F0ZWdvcnk9IiR7a2V5fSJdYCk7DQogICAgICAgICAgICAgIGlmICghY2FyZCkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBzdGF0c0NvbnRhaW5lciA9IGNhcmQucXVlcnlTZWxlY3RvcihgW2RhdGEtY2F0ZWdvcnktc3RhdHM9IiR7a2V5fSJdYCk7DQogICAgICAgICAgICAgIGlmICghc3RhdHNDb250YWluZXIpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc3RhdHNDb250YWluZXIuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICAgIGNvbnN0IHRvdGFscyA9IGNhdGVnb3J5VG90YWxzID8gY2F0ZWdvcnlUb3RhbHNba2V5XSA6IG51bGw7DQogICAgICAgICAgICAgIGNvbnN0IGxhYmVscyA9IGNhdGVnb3J5TWV0cmljTGFiZWxzW2tleV0gfHwge307DQogICAgICAgICAgICAgIGlmICghdG90YWxzKSB7DQogICAgICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7DQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIuY2xhc3NOYW1lID0gImNhdGVnb3J5LWNhcmRfX3BsYWNlaG9sZGVyIG11dGVkIjsNCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci50ZXh0Q29udGVudCA9ICJVcGxvYWQgZGF0YSB0byB2aWV3IGluc2lnaHRzLiI7DQogICAgICAgICAgICAgICAgc3RhdHNDb250YWluZXIuYXBwZW5kKHBsYWNlaG9sZGVyKTsNCiAgICAgICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoImlzLWVtcHR5Iik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSBbXTsKICAgICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGVWYWx1ZSA9IGdldENhdGVnb3J5VG90YWxWYWx1ZSh0b3RhbHMpOwogICAgICAgICAgICAgIG1ldHJpY3MucHVzaCh7CiAgICAgICAgICAgICAgICBmaWVsZDogYCR7a2V5fS10b3RhbGAsCiAgICAgICAgICAgICAgICBsYWJlbDogYCR7Y2F0ZWdvcnlMYWJlbHNba2V5XSB8fCBrZXl9IGFjdGlvbnNgLAogICAgICAgICAgICAgICAgdmFsdWU6IGFnZ3JlZ2F0ZVZhbHVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY29uc3QgcHJpbWFyeVZhbHVlID0gTnVtYmVyLmlzRmluaXRlKHRvdGFscy5wcmltYXJ5KSA/IHRvdGFscy5wcmltYXJ5IDogMDsKICAgICAgICAgICAgICBtZXRyaWNzLnB1c2goewogICAgICAgICAgICAgICAgZmllbGQ6IGNvbmZpZy5wcmltYXJ5LAogICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsc1tjb25maWcucHJpbWFyeV0gfHwgbGFiZWxzLnByaW1hcnkgfHwgZ2V0TWV0cmljRGlzcGxheUxhYmVsKGNvbmZpZy5wcmltYXJ5KSwKICAgICAgICAgICAgICAgIHZhbHVlOiBwcmltYXJ5VmFsdWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAoY29uZmlnLnNlY29uZGFyeSB8fCBbXSkuZm9yRWFjaCgoZmllbGQsIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBBcnJheS5pc0FycmF5KHRvdGFscy5zZWNvbmRhcnkpID8gdG90YWxzLnNlY29uZGFyeVtpbmRleF0gfHwgMCA6IDA7DQogICAgICAgICAgICAgICAgbWV0cmljcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgIGZpZWxkLA0KICAgICAgICAgICAgICAgICAgbGFiZWw6IGxhYmVsc1tmaWVsZF0gfHwgZ2V0TWV0cmljRGlzcGxheUxhYmVsKGZpZWxkKSwNCiAgICAgICAgICAgICAgICAgIHZhbHVlDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBtZXRyaWNzLnNvcnQoKGEsIGIpID0+IChiLnZhbHVlIHx8IDApIC0gKGEudmFsdWUgfHwgMCkpOw0KICAgICAgICAgICAgICBpZiAoIW1ldHJpY3MubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7DQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXIuY2xhc3NOYW1lID0gImNhdGVnb3J5LWNhcmRfX3BsYWNlaG9sZGVyIG11dGVkIjsNCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlci50ZXh0Q29udGVudCA9ICJObyBkYXRhIGF2YWlsYWJsZSBmb3IgdGhpcyBjYXBhYmlsaXR5LiI7DQogICAgICAgICAgICAgICAgc3RhdHNDb250YWluZXIuYXBwZW5kKHBsYWNlaG9sZGVyKTsNCiAgICAgICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoImlzLWVtcHR5Iik7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIG1ldHJpY3MuZm9yRWFjaCgobWV0cmljLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICBzdGF0LmNsYXNzTmFtZSA9ICJjYXRlZ29yeS1jYXJkX19zdGF0IjsNCiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgIHN0YXQuY2xhc3NMaXN0LmFkZCgiaXMtZW1waGFzaXplZCIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCiAgICAgICAgICAgICAgICB2YWx1ZUVsZW1lbnQuY2xhc3NOYW1lID0gImNhdGVnb3J5LWNhcmRfX3ZhbHVlIjsNCiAgICAgICAgICAgICAgICB2YWx1ZUVsZW1lbnQudGV4dENvbnRlbnQgPSBtZXRyaWMudmFsdWUgPyBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQobWV0cmljLnZhbHVlKSkgOiAiMCI7DQogICAgICAgICAgICAgICAgY29uc3QgbGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LmNsYXNzTmFtZSA9ICJjYXRlZ29yeS1jYXJkX19sYWJlbCI7DQogICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LnRleHRDb250ZW50ID0gbWV0cmljLmxhYmVsIHx8IG1ldHJpYy5maWVsZDsNCiAgICAgICAgICAgICAgICBzdGF0LmFwcGVuZCh2YWx1ZUVsZW1lbnQsIGxhYmVsRWxlbWVudCk7DQogICAgICAgICAgICAgICAgc3RhdHNDb250YWluZXIuYXBwZW5kKHN0YXQpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgY29uc3QgaGFzUG9zaXRpdmUgPSBtZXRyaWNzLnNvbWUobWV0cmljID0+IG1ldHJpYy52YWx1ZSA+IDApOw0KICAgICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC50b2dnbGUoImlzLWVtcHR5IiwgIWhhc1Bvc2l0aXZlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBidWlsZFRvcFVzZXJzTGlzdCh1c2Vycykgew0KICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9tLnRvcFVzZXJzOw0KICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgY29uc3QgdG9nZ2xlQnV0dG9uID0gZG9tLnRvcFVzZXJzVG9nZ2xlOw0KICAgICAgICAgICAgaWYgKCF1c2VycyB8fCAhdXNlcnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIGNvbnN0IGVtcHR5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOw0KICAgICAgICAgICAgICBlbXB0eS5jbGFzc05hbWUgPSAibXV0ZWQiOw0KICAgICAgICAgICAgICBlbXB0eS50ZXh0Q29udGVudCA9ICJObyB1c2VyIGFjdGl2aXR5IGZvciB0aGUgc2VsZWN0ZWQgZmlsdGVycy4iOw0KICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kKGVtcHR5KTsNCiAgICAgICAgICAgICAgc3RhdGUudG9wVXNlcnNFeHBhbmRlZCA9IGZhbHNlOw0KICAgICAgICAgICAgICBpZiAodG9nZ2xlQnV0dG9uKSB7DQogICAgICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRyb2xzV3JhcHBlciA9IHRvZ2dsZUJ1dHRvbi5wYXJlbnRFbGVtZW50Ow0KICAgICAgICAgICAgICAgIGlmIChjb250cm9sc1dyYXBwZXIgJiYgY29udHJvbHNXcmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygiYWRvcHRpb24tY29udHJvbHMiKSkgew0KICAgICAgICAgICAgICAgICAgY29udHJvbHNXcmFwcGVyLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGNhcHBlZFVzZXJzID0gdXNlcnMuc2xpY2UoMCwgMjApOw0KICAgICAgICAgICAgY29uc3QgaGFzT3ZlcmZsb3cgPSBjYXBwZWRVc2Vycy5sZW5ndGggPiBNQVhfVklTSUJMRV9UT1BfVVNFUlM7DQogICAgICAgICAgICBpZiAoIWhhc092ZXJmbG93KSB7DQogICAgICAgICAgICAgIHN0YXRlLnRvcFVzZXJzRXhwYW5kZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGV4cGFuZGVkID0gc3RhdGUudG9wVXNlcnNFeHBhbmRlZCA9PT0gdHJ1ZTsNCiAgICAgICAgICAgIGNvbnN0IHZpc2libGVVc2VycyA9IGV4cGFuZGVkID8gY2FwcGVkVXNlcnMgOiBjYXBwZWRVc2Vycy5zbGljZSgwLCBNQVhfVklTSUJMRV9UT1BfVVNFUlMpOw0KICAgICAgICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9sIik7DQogICAgICAgICAgICBsaXN0LmNsYXNzTmFtZSA9ICJ0b3AtdXNlcnMtbGlzdCI7DQogICAgICAgICAgICB2aXNpYmxlVXNlcnMuZm9yRWFjaChlbnRyeSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOw0KICAgICAgICAgICAgICBpdGVtLmNsYXNzTmFtZSA9ICJ0b3AtdXNlcnMtbGlzdF9faXRlbSI7DQogICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgIG5hbWUuY2xhc3NOYW1lID0gInRvcC11c2Vycy1saXN0X19uYW1lIjsNCiAgICAgICAgICAgICAgbmFtZS50ZXh0Q29udGVudCA9IGVudHJ5Lm5hbWUgfHwgIlVuc3BlY2lmaWVkIjsNCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgIHZhbHVlLmNsYXNzTmFtZSA9ICJ0b3AtdXNlcnMtbGlzdF9fdmFsdWUiOw0KICAgICAgICAgICAgICBjb25zdCBpbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgIGluZm8uY2xhc3NOYW1lID0gInRvcC11c2Vycy1saXN0X19pbmZvIjsNCiAgICAgICAgICAgICAgaW5mby5hcHBlbmQobmFtZSk7DQogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uLmNsYXNzTmFtZSA9ICJ0b3AtdXNlcnMtbGlzdF9fb3JnIjsNCiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uLnRleHRDb250ZW50ID0gZW50cnkub3JnYW5pemF0aW9uIHx8ICJVbnNwZWNpZmllZCI7DQogICAgICAgICAgICAgIGluZm8uYXBwZW5kKG9yZ2FuaXphdGlvbik7DQogICAgICAgICAgICAgIC8vIEtlZXAgdGhlc2UgdGVtcGxhdGUgbGl0ZXJhbHM7IHJlbW92aW5nIHRoZSBiYWNrdGlja3MgY2F1c2VkIHN5bnRheCBlcnJvcnMgdGhhdCBibG9ja2VkIHVwbG9hZHMuDQogICAgICAgICAgICAgIGlmIChzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIikgew0KICAgICAgICAgICAgICAgIHZhbHVlLnRleHRDb250ZW50ID0gYCR7aG91cnNGb3JtYXR0ZXIuZm9ybWF0KGVudHJ5LmFzc2lzdGVkSG91cnMgfHwgMCl9IGhyc2A7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgdmFsdWUudGV4dENvbnRlbnQgPSBgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQoZW50cnkudG90YWxBY3Rpb25zIHx8IDApKX0gYWN0aW9uc2A7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaXRlbS5hcHBlbmQoaW5mbywgdmFsdWUpOw0KICAgICAgICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChsaXN0KTsNCiAgICAgICAgICAgIGlmICh0b2dnbGVCdXR0b24pIHsNCiAgICAgICAgICAgICAgaWYgKGhhc092ZXJmbG93KSB7DQogICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nID0gTWF0aC5tYXgoMCwgY2FwcGVkVXNlcnMubGVuZ3RoIC0gTUFYX1ZJU0lCTEVfVE9QX1VTRVJTKTsNCiAgICAgICAgICAgICAgICBjb25zdCB1c2VyTGFiZWwgPSByZW1haW5pbmcgPT09IDEgPyAidXNlciIgOiAidXNlcnMiOw0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0b2dnbGVCdXR0b24udGV4dENvbnRlbnQgPSBleHBhbmRlZA0KICAgICAgICAgICAgICAgICAgPyBgU2hvdyB0b3AgJHtNQVhfVklTSUJMRV9UT1BfVVNFUlN9IHVzZXJzYA0KICAgICAgICAgICAgICAgICAgOiBgU2hvdyByZW1haW5pbmcgJHtyZW1haW5pbmd9ICR7dXNlckxhYmVsfWA7DQogICAgICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsIFN0cmluZyhleHBhbmRlZCkpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUFkb3B0aW9uQnlBcHAoYWRvcHRpb24pIHsNCiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9tLmFkb3B0aW9uVGFibGU7DQogICAgICAgICAgICBjb25zdCBib2R5ID0gZG9tLmFkb3B0aW9uQm9keTsNCiAgICAgICAgICAgIGNvbnN0IGVtcHR5ID0gZG9tLmFkb3B0aW9uRW1wdHk7DQogICAgICAgICAgICBjb25zdCBjYXB0aW9uID0gZG9tLmFkb3B0aW9uQ2FwdGlvbjsNCiAgICAgICAgICAgIGNvbnN0IHRvdGFsRWxlbWVudCA9IGRvbS5hZG9wdGlvblRvdGFsOw0KICAgICAgICAgICAgY29uc3QgdG9nZ2xlQnV0dG9uID0gZG9tLmFkb3B0aW9uVG9nZ2xlOw0KICAgICAgICAgICAgaWYgKCF0YWJsZSB8fCAhYm9keSkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBib2R5LmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgY29uc3QgdG90YWxBY3RpdmVVc2VycyA9IGFkb3B0aW9uICYmIE51bWJlci5pc0Zpbml0ZShhZG9wdGlvbi50b3RhbEFjdGl2ZVVzZXJzKSA/IGFkb3B0aW9uLnRvdGFsQWN0aXZlVXNlcnMgOiAwOw0KICAgICAgICAgICAgY29uc3QgaGFzQXBwcyA9IGFkb3B0aW9uICYmIEFycmF5LmlzQXJyYXkoYWRvcHRpb24uYXBwcykgJiYgYWRvcHRpb24uYXBwcy5sZW5ndGggPiAwOw0KICAgICAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20uYWRvcHRpb25FeHBvcnRDc3YsIGhhc0FwcHMpOw0KICAgICAgICAgICAgaWYgKCFoYXNBcHBzKSB7DQogICAgICAgICAgICAgIHRhYmxlLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgIGlmIChlbXB0eSkgew0KICAgICAgICAgICAgICAgIGVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGVtcHR5LnRleHRDb250ZW50ID0gYWRvcHRpb24gJiYgYWRvcHRpb24udG90YWxBY3RpdmVVc2Vycw0KICAgICAgICAgICAgICAgICAgPyAiTm8gYXBwIGFkb3B0aW9uIGRldGVjdGVkIGZvciB0aGUgc2VsZWN0ZWQgZmlsdGVycy4iDQogICAgICAgICAgICAgICAgICA6ICJMb2FkIGRhdGEgdG8gdmlldyBhZG9wdGlvbiBieSBhcHAuIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoY2FwdGlvbikgew0KICAgICAgICAgICAgICAgIGNhcHRpb24udGV4dENvbnRlbnQgPSAiVXBsb2FkIGRhdGEgdG8gc2VlIHdoaWNoIGFwcHMgZHJpdmUgQ29waWxvdCB1c2FnZS4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmICh0b3RhbEVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICB0b3RhbEVsZW1lbnQudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKHRvZ2dsZUJ1dHRvbikgew0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIHRhYmxlLmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgaWYgKGVtcHR5KSB7DQogICAgICAgICAgICAgIGVtcHR5LmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY2FwdGlvbikgew0KICAgICAgICAgICAgICBjYXB0aW9uLnRleHRDb250ZW50ID0gYEJhc2VkIG9uICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdCh0b3RhbEFjdGl2ZVVzZXJzKX0gYWN0aXZlIHVzZXJzIGZvciB0aGUgc2VsZWN0ZWQgZmlsdGVycy5gOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRvdGFsRWxlbWVudCkgew0KICAgICAgICAgICAgICB0b3RhbEVsZW1lbnQudGV4dENvbnRlbnQgPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHRvdGFsQWN0aXZlVXNlcnMpOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgICAgICAgIGxldCBoYXNGZWF0dXJlUm93cyA9IGZhbHNlOw0KICAgICAgICAgICAgY29uc3Qgc2hvd0RldGFpbHMgPSBzdGF0ZS5hZG9wdGlvblNob3dEZXRhaWxzID09PSB0cnVlOw0KICAgICAgICAgICAgYWRvcHRpb24uYXBwcy5mb3JFYWNoKGFwcCA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGFjY2VudENvbG9yID0gc2FuaXRpemVIZXhDb2xvcihhcHAuY29sb3IpIHx8IERFRkFVTFRfQURPUFRJT05fQ09MT1I7DQogICAgICAgICAgICAgIGNvbnN0IGFwcFJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7DQogICAgICAgICAgICAgIGFwcFJvdy5jbGFzc05hbWUgPSAiaXMtYXBwIjsNCiAgICAgICAgICAgICAgYXBwUm93LmRhdGFzZXQuYXBwS2V5ID0gYXBwLmtleSB8fCAiIjsNCiAgICAgICAgICAgICAgYXBwUm93LnN0eWxlLnNldFByb3BlcnR5KCItLWFkb3B0aW9uLWFjY2VudCIsIGFjY2VudENvbG9yKTsNCiAgICAgICAgICAgICAgY29uc3QgbmFtZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICBuYW1lQ2VsbC50ZXh0Q29udGVudCA9IGFwcC5sYWJlbCB8fCBhcHAua2V5IHx8ICJVbm5hbWVkIGFwcCI7DQogICAgICAgICAgICAgIGNvbnN0IHVzZXJzQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgICAgICAgICAgIHVzZXJzQ2VsbC5jbGFzc05hbWUgPSAiaXMtbnVtZXJpYyI7DQogICAgICAgICAgICAgIHVzZXJzQ2VsbC50ZXh0Q29udGVudCA9IG51bWJlckZvcm1hdHRlci5mb3JtYXQoYXBwLnVzZXJzIHx8IDApOw0KICAgICAgICAgICAgICBjb25zdCBzaGFyZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICBzaGFyZUNlbGwuY2xhc3NOYW1lID0gImlzLW51bWVyaWMiOw0KICAgICAgICAgICAgICBjb25zdCBhcHBTaGFyZSA9IE51bWJlci5pc0Zpbml0ZShhcHAuc2hhcmUpID8gYXBwLnNoYXJlIDogMDsNCiAgICAgICAgICAgICAgc2hhcmVDZWxsLnRleHRDb250ZW50ID0gYCR7TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBhcHBTaGFyZSkpLnRvRml4ZWQoMSl9JWA7DQogICAgICAgICAgICAgIGFwcFJvdy5hcHBlbmQobmFtZUNlbGwsIHVzZXJzQ2VsbCwgc2hhcmVDZWxsKTsNCiAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kKGFwcFJvdyk7DQogICAgICANCiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXBwLmZlYXR1cmVzKSAmJiBhcHAuZmVhdHVyZXMubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgaGFzRmVhdHVyZVJvd3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGFwcC5mZWF0dXJlcy5mb3JFYWNoKGZlYXR1cmUgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgZmVhdHVyZVJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRyIik7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlUm93LmNsYXNzTmFtZSA9ICJpcy1mZWF0dXJlIjsNCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVSb3cuZGF0YXNldC5hcHBLZXkgPSBhcHAua2V5IHx8ICIiOw0KICAgICAgICAgICAgICAgICAgZmVhdHVyZVJvdy5zdHlsZS5zZXRQcm9wZXJ0eSgiLS1hZG9wdGlvbi1hY2NlbnQiLCBhY2NlbnRDb2xvcik7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlUm93LmhpZGRlbiA9ICFzaG93RGV0YWlsczsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVOYW1lQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRkIik7DQogICAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlTGFiZWwuY2xhc3NOYW1lID0gImFkb3B0aW9uLWxhYmVsIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGJ1bGxldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsNCiAgICAgICAgICAgICAgICAgIGJ1bGxldC5jbGFzc05hbWUgPSAiYWRvcHRpb24tYnVsbGV0IjsNCiAgICAgICAgICAgICAgICAgIGJ1bGxldC5zdHlsZS5zZXRQcm9wZXJ0eSgiYmFja2dyb3VuZC1jb2xvciIsIGFjY2VudENvbG9yKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOw0KICAgICAgICAgICAgICAgICAgZmVhdHVyZVRleHQudGV4dENvbnRlbnQgPSBmZWF0dXJlLmxhYmVsIHx8IGZlYXR1cmUua2V5IHx8ICJDYXBhYmlsaXR5IjsNCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVMYWJlbC5hcHBlbmQoYnVsbGV0LCBmZWF0dXJlVGV4dCk7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlTmFtZUNlbGwuYXBwZW5kKGZlYXR1cmVMYWJlbCk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVVc2Vyc0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICAgICAgZmVhdHVyZVVzZXJzQ2VsbC5jbGFzc05hbWUgPSAiaXMtbnVtZXJpYyI7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlVXNlcnNDZWxsLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKGZlYXR1cmUudXNlcnMgfHwgMCkpOw0KICAgICAgDQogICAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlU2hhcmVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgICAgICAgICAgICAgIGZlYXR1cmVTaGFyZUNlbGwuY2xhc3NOYW1lID0gImlzLW51bWVyaWMiOw0KICAgICAgICAgICAgICAgICAgY29uc3QgZmVhdHVyZVNoYXJlID0gTnVtYmVyLmlzRmluaXRlKGZlYXR1cmUuc2hhcmUpID8gZmVhdHVyZS5zaGFyZSA6IDA7DQogICAgICAgICAgICAgICAgICBmZWF0dXJlU2hhcmVDZWxsLnRleHRDb250ZW50ID0gYCR7TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBmZWF0dXJlU2hhcmUpKS50b0ZpeGVkKDEpfSVgOw0KICAgICAgDQogICAgICAgICAgICAgICAgICBmZWF0dXJlUm93LmFwcGVuZChmZWF0dXJlTmFtZUNlbGwsIGZlYXR1cmVVc2Vyc0NlbGwsIGZlYXR1cmVTaGFyZUNlbGwpOw0KICAgICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kKGZlYXR1cmVSb3cpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgICAgYm9keS5hcHBlbmQoZnJhZ21lbnQpOw0KICAgICAgICAgICAgaWYgKHRvZ2dsZUJ1dHRvbikgew0KICAgICAgICAgICAgICBpZiAoaGFzRmVhdHVyZVJvd3MpIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVCdXR0b24uaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgdG9nZ2xlQnV0dG9uLnRleHRDb250ZW50ID0gc2hvd0RldGFpbHMgPyAiSGlkZSBhcHAgY2FwYWJpbGl0aWVzIiA6ICJTaG93IGFwcCBjYXBhYmlsaXRpZXMiOw0KICAgICAgICAgICAgICAgIHRvZ2dsZUJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCBTdHJpbmcoc2hvd0RldGFpbHMpKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0b2dnbGVCdXR0b24uaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB0b2dnbGVCdXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3QgY29udHJvbHNXcmFwcGVyID0gdG9nZ2xlQnV0dG9uLnBhcmVudEVsZW1lbnQ7DQogICAgICAgICAgICAgIGlmIChjb250cm9sc1dyYXBwZXIgJiYgY29udHJvbHNXcmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygiYWRvcHRpb24tY29udHJvbHMiKSkgew0KICAgICAgICAgICAgICAgIGNvbnRyb2xzV3JhcHBlci5oaWRkZW4gPSB0b2dnbGVCdXR0b24uaGlkZGVuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlVXNhZ2VJbnRlbnNpdHkoYWdncmVnYXRlcykgew0KICAgICAgICAgICAgY29uc3QgY29udHJvbHMgPSBkb20udXNhZ2VNb250aENvbnRyb2xzOw0KICAgICAgICAgICAgY29uc3QgZ3JpZCA9IGRvbS51c2FnZU1vbnRoR3JpZDsNCiAgICAgICAgICAgIGNvbnN0IGVtcHR5U3RhdGUgPSBkb20udXNhZ2VFbXB0eTsNCiAgICAgICAgICAgIGNvbnN0IGNhcHRpb24gPSBkb20udXNhZ2VDYXB0aW9uOw0KICAgICAgICAgICAgY29uc3Qgd2luZG93Q2hpcCA9IGRvbS51c2FnZVdpbmRvdzsNCiAgICAgIA0KICAgICAgICAgICAgaWYgKCFkb20udXNhZ2VDYXJkIHx8ICFjb250cm9scyB8fCAhZ3JpZCkgew0KICAgICAgICAgICAgICB1cGRhdGVVc2FnZVRyZW5kQ2hhcnQobnVsbCk7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgZGVzdHJveVVzYWdlQ2hhcnRzKCk7DQogICAgICAgICAgICBjb250cm9scy5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgICAgIGdyaWQuaW5uZXJIVE1MID0gIiI7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IG1vbnRobHlEYXRhID0gQXJyYXkuaXNBcnJheShhZ2dyZWdhdGVzPy5tb250aGx5VXNhZ2VJbnRlbnNpdHkpID8gYWdncmVnYXRlcy5tb250aGx5VXNhZ2VJbnRlbnNpdHkgOiBbXTsNCiAgICAgICAgICAgIGNvbnN0IG1vbnRoS2V5cyA9IG1vbnRobHlEYXRhLm1hcChlbnRyeSA9PiBlbnRyeS5rZXkpOw0KICAgICAgICAgICAgY29uc3QgbW9udGhNYXAgPSBuZXcgTWFwKG1vbnRobHlEYXRhLm1hcChlbnRyeSA9PiBbZW50cnkua2V5LCBlbnRyeV0pKTsNCiAgICAgIA0KICAgICAgICAgICAgaWYgKCFtb250aGx5RGF0YS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgaWYgKGNhcHRpb24pIHsNCiAgICAgICAgICAgICAgICBjYXB0aW9uLnRleHRDb250ZW50ID0gYWdncmVnYXRlcw0KICAgICAgICAgICAgICAgICAgPyAiTm8gdXNhZ2UgaW50ZW5zaXR5IGRhdGEgZm9yIHRoZSBjdXJyZW50IGZpbHRlcnMuIg0KICAgICAgICAgICAgICAgICAgOiAiVXBsb2FkIGRhdGEgdG8gYnJlYWsgZG93biBhY3RpdmUgdXNlcnMuIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAod2luZG93Q2hpcCkgew0KICAgICAgICAgICAgICAgIHdpbmRvd0NoaXAudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGVtcHR5U3RhdGUpIHsNCiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlLmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGVtcHR5U3RhdGUudGV4dENvbnRlbnQgPSBhZ2dyZWdhdGVzDQogICAgICAgICAgICAgICAgICA/ICJObyBtb250aGx5IHVzYWdlIGludGVuc2l0eSBkYXRhIGF2YWlsYWJsZS4iDQogICAgICAgICAgICAgICAgICA6ICJVcGxvYWQgZGF0YSB0byBicmVhayBkb3duIGFjdGl2ZSB1c2VycyBieSBtb250aC4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24gPSBbXTsNCiAgICAgICAgICAgICAgc3RhdGUubGF0ZXN0VXNhZ2VNb250aHMgPSBbXTsNCiAgICAgICAgICAgICAgdXBkYXRlVXNhZ2VUcmVuZENoYXJ0KG51bGwpOw0KICAgICAgICAgICAgICB1cGRhdGVVc2FnZVRyZW5kVG9nZ2xlU3RhdGUoKTsNCiAgICAgICAgICAgICAgdXBkYXRlVXNhZ2VJbnRlbnNpdHlFeHBvcnRBdmFpbGFiaWxpdHkoKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbikpIHsNCiAgICAgICAgICAgICAgc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbiA9IFtdOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbGV0IHNlbGVjdGlvbiA9IHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24uZmlsdGVyKGtleSA9PiBtb250aEtleXMuaW5jbHVkZXMoa2V5KSk7DQogICAgICAgICAgICBpZiAoIXNlbGVjdGlvbi5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgc2VsZWN0aW9uID0gbW9udGhLZXlzLnNsaWNlKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uID0gc2VsZWN0aW9uOw0KICAgICAgDQogICAgICAgICAgICBpZiAoZW1wdHlTdGF0ZSkgew0KICAgICAgICAgICAgICBlbXB0eVN0YXRlLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGJ1aWxkTW9udGhDb250cm9scygpOw0KICAgICAgICAgICAgdXBkYXRlQ29udHJvbHNBY3RpdmVTdGF0ZSgpOw0KICAgICAgICAgICAgdXBkYXRlQ2FwdGlvbigpOw0KICAgICAgICAgICAgcmVuZGVyQ2FyZHMoKTsNCiAgICAgICAgICAgIGFwcGx5Q2hhcnRUaGVtZVN0eWxlcygpOw0KICAgICAgICAgICAgc3RhdGUubGF0ZXN0VXNhZ2VNb250aHMgPSBtb250aGx5RGF0YS5zbGljZSgpOw0KICAgICAgICAgICAgdXBkYXRlVXNhZ2VUcmVuZFRvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICB1cGRhdGVVc2FnZVRyZW5kQ2hhcnQoc3RhdGUubGF0ZXN0VXNhZ2VNb250aHMpOw0KICAgICAgICAgICAgdXBkYXRlVXNhZ2VJbnRlbnNpdHlFeHBvcnRBdmFpbGFiaWxpdHkoKTsNCiAgICAgIA0KICAgICAgICAgICAgZnVuY3Rpb24gYnVpbGRNb250aENvbnRyb2xzKCkgew0KICAgICAgICAgICAgICBpZiAoIWNvbnRyb2xzKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHNlbGVjdEFsbEJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOw0KICAgICAgICAgICAgICBzZWxlY3RBbGxCdXR0b24udHlwZSA9ICJidXR0b24iOw0KICAgICAgICAgICAgICBzZWxlY3RBbGxCdXR0b24uY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLXV0aWxpdHkiOw0KICAgICAgICAgICAgICBzZWxlY3RBbGxCdXR0b24udGV4dENvbnRlbnQgPSAiU2VsZWN0IGFsbCI7DQogICAgICAgICAgICAgIHNlbGVjdEFsbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgICBzZXRTZWxlY3Rpb24obW9udGhLZXlzLnNsaWNlKCkpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgY29udHJvbHMuYXBwZW5kKHNlbGVjdEFsbEJ1dHRvbik7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3QgY2xlYXJCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsNCiAgICAgICAgICAgICAgY2xlYXJCdXR0b24udHlwZSA9ICJidXR0b24iOw0KICAgICAgICAgICAgICBjbGVhckJ1dHRvbi5jbGFzc05hbWUgPSAidXNhZ2UtbW9udGgtdXRpbGl0eSI7DQogICAgICAgICAgICAgIGNsZWFyQnV0dG9uLnRleHRDb250ZW50ID0gIkNsZWFyIjsNCiAgICAgICAgICAgICAgY2xlYXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgc2V0U2VsZWN0aW9uKFtdKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGNvbnRyb2xzLmFwcGVuZChjbGVhckJ1dHRvbik7DQogICAgICANCiAgICAgICAgICAgICAgbW9udGhseURhdGEuZm9yRWFjaChlbnRyeSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7DQogICAgICAgICAgICAgICAgYnV0dG9uLnR5cGUgPSAiYnV0dG9uIjsNCiAgICAgICAgICAgICAgICBidXR0b24uY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLXRvZ2dsZSI7DQogICAgICAgICAgICAgICAgYnV0dG9uLmRhdGFzZXQubW9udGggPSBlbnRyeS5rZXk7DQogICAgICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gZW50cnkubGFiZWw7DQogICAgICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IG5ldyBTZXQoc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbik7DQogICAgICAgICAgICAgICAgICBpZiAoY3VycmVudC5oYXMoZW50cnkua2V5KSkgew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50LmRlbGV0ZShlbnRyeS5rZXkpOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudC5hZGQoZW50cnkua2V5KTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvbihBcnJheS5mcm9tKGN1cnJlbnQpKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBjb250cm9scy5hcHBlbmQoYnV0dG9uKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFNlbGVjdGlvbihuZXdTZWxlY3Rpb24pIHsNCiAgICAgICAgICAgICAgY29uc3Qgb3JkZXJlZCA9IG1vbnRoS2V5cy5maWx0ZXIoa2V5ID0+IG5ld1NlbGVjdGlvbi5pbmNsdWRlcyhrZXkpKTsNCiAgICAgICAgICAgICAgc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbiA9IG9yZGVyZWQ7DQogICAgICAgICAgICAgIHVwZGF0ZUNvbnRyb2xzQWN0aXZlU3RhdGUoKTsNCiAgICAgICAgICAgICAgdXBkYXRlQ2FwdGlvbigpOw0KICAgICAgICAgICAgICByZW5kZXJDYXJkcygpOw0KICAgICAgICAgICAgICBhcHBseUNoYXJ0VGhlbWVTdHlsZXMoKTsNCiAgICAgICAgICAgICAgdXBkYXRlVXNhZ2VUcmVuZFRvZ2dsZVN0YXRlKCk7DQogICAgICAgICAgICAgIHVwZGF0ZVVzYWdlVHJlbmRDaGFydChzdGF0ZS5sYXRlc3RVc2FnZU1vbnRocyk7DQogICAgICAgICAgICAgIHVwZGF0ZVVzYWdlSW50ZW5zaXR5RXhwb3J0QXZhaWxhYmlsaXR5KCk7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbnRyb2xzQWN0aXZlU3RhdGUoKSB7DQogICAgICAgICAgICAgIGlmICghY29udHJvbHMpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29udHJvbHMucXVlcnlTZWxlY3RvckFsbCgiLnVzYWdlLW1vbnRoLXRvZ2dsZSIpLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBidXR0b24uZGF0YXNldC5tb250aDsNCiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24uaW5jbHVkZXMoa2V5KTsNCiAgICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgiaXMtYWN0aXZlIiwgaXNBY3RpdmUpOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQ2FwdGlvbigpIHsNCiAgICAgICAgICAgICAgaWYgKGNhcHRpb24pIHsNCiAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24ubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICBjYXB0aW9uLnRleHRDb250ZW50ID0gIlNlbGVjdCBtb250aHMgdG8gY29tcGFyZSBDb3BpbG90IHVzYWdlIGludGVuc2l0eS4iOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICBjYXB0aW9uLnRleHRDb250ZW50ID0gYENvbXBhcmluZyAke3N0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb24ubGVuZ3RofSBtb250aCR7c3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5sZW5ndGggPT09IDEgPyAiIiA6ICJzIn0gb2YgQ29waWxvdCBhY3Rpdml0eS5gOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAod2luZG93Q2hpcCkgew0KICAgICAgICAgICAgICAgIGlmICghc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgIHdpbmRvd0NoaXAudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBtb250aE1hcC5nZXQoc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvblswXSk7DQogICAgICAgICAgICAgICAgICB3aW5kb3dDaGlwLnRleHRDb250ZW50ID0gc2VsZWN0ZWQ/Lm1vbnRoUmFuZ2VMYWJlbCB8fCBzZWxlY3RlZD8ubGFiZWwgfHwgIi0iOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdEtleSA9IHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb25bMF07DQogICAgICAgICAgICAgICAgY29uc3QgbGFzdEtleSA9IHN0YXRlLnVzYWdlTW9udGhTZWxlY3Rpb25bc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5sZW5ndGggLSAxXTsNCiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdCA9IG1vbnRoTWFwLmdldChmaXJzdEtleSk7DQogICAgICAgICAgICAgICAgY29uc3QgbGFzdCA9IG1vbnRoTWFwLmdldChsYXN0S2V5KTsNCiAgICAgICAgICAgICAgICBpZiAoZmlyc3QgJiYgbGFzdCkgew0KICAgICAgICAgICAgICAgICAgd2luZG93Q2hpcC50ZXh0Q29udGVudCA9IGAke2ZpcnN0LmxhYmVsfSDihpIgJHtsYXN0LmxhYmVsfWA7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHdpbmRvd0NoaXAudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlckNhcmRzKCkgew0KICAgICAgICAgICAgICBkZXN0cm95VXNhZ2VDaGFydHMoKTsNCiAgICAgICAgICAgICAgaWYgKGdyaWQpIHsNCiAgICAgICAgICAgICAgICBncmlkLmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmICghc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoZW1wdHlTdGF0ZSkgew0KICAgICAgICAgICAgICAgICAgZW1wdHlTdGF0ZS5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIGVtcHR5U3RhdGUudGV4dENvbnRlbnQgPSAiU2VsZWN0IG1vbnRocyBhYm92ZSB0byB2aWV3IHVzYWdlIGludGVuc2l0eS4iOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGVtcHR5U3RhdGUpIHsNCiAgICAgICAgICAgICAgICBlbXB0eVN0YXRlLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbi5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgbW9udGhFbnRyeSA9IG1vbnRoTWFwLmdldChrZXkpOw0KICAgICAgICAgICAgICAgIGlmICghbW9udGhFbnRyeSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBjYXJkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYXJ0aWNsZSIpOw0KICAgICAgICAgICAgICAgIGNhcmQuY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLWNhcmQiOw0KICAgICAgDQogICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgaGVhZGVyLmNsYXNzTmFtZSA9ICJ1c2FnZS1tb250aC1jYXJkX19oZWFkZXIiOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDMiKTsNCiAgICAgICAgICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IG1vbnRoRW50cnkubGFiZWw7DQogICAgICAgICAgICAgICAgaGVhZGVyLmFwcGVuZCh0aXRsZSk7DQogICAgICAgICAgICAgICAgY29uc3Qgc3VtbWFyeSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsNCiAgICAgICAgICAgICAgICBzdW1tYXJ5LnRleHRDb250ZW50ID0gbW9udGhFbnRyeS50b3RhbFVzZXJzDQogICAgICAgICAgICAgICAgICA/IGBCYXNlZCBvbiAke251bWJlckZvcm1hdHRlci5mb3JtYXQobW9udGhFbnRyeS50b3RhbFVzZXJzKX0gdXNlcnMgd2l0aCBDb3BpbG90IGFjdGlvbnMuYA0KICAgICAgICAgICAgICAgICAgOiAiTm8gQ29waWxvdCBhY3Rpb25zIHJlY29yZGVkIHRoaXMgbW9udGguIjsNCiAgICAgICAgICAgICAgICBoZWFkZXIuYXBwZW5kKHN1bW1hcnkpOw0KICAgICAgICAgICAgICAgIGlmIChtb250aEVudHJ5Lm1vbnRoUmFuZ2VMYWJlbCkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7DQogICAgICAgICAgICAgICAgICByYW5nZS50ZXh0Q29udGVudCA9IG1vbnRoRW50cnkubW9udGhSYW5nZUxhYmVsOw0KICAgICAgICAgICAgICAgICAgaGVhZGVyLmFwcGVuZChyYW5nZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhcmQuYXBwZW5kKGhlYWRlcik7DQogICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBjaGFydHNXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgY2hhcnRzV3JhcHBlci5jbGFzc05hbWUgPSAidXNhZ2UtbW9udGgtY2FyZF9fY2hhcnRzIjsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IGZyZXF1ZW5jeVBhbmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICAgICAgICAgICAgZnJlcXVlbmN5UGFuZWwuY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLWNhcmRfX3BhbmVsIjsNCiAgICAgICAgICAgICAgICBjb25zdCBmcmVxdWVuY3lIZWFkaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDQiKTsNCiAgICAgICAgICAgICAgICBmcmVxdWVuY3lIZWFkaW5nLnRleHRDb250ZW50ID0gIkZyZXF1ZW50IHVzYWdlIjsNCiAgICAgICAgICAgICAgICBmcmVxdWVuY3lQYW5lbC5hcHBlbmQoZnJlcXVlbmN5SGVhZGluZyk7DQogICAgICAgICAgICAgICAgY29uc3QgZnJlcXVlbmN5Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7DQogICAgICAgICAgICAgICAgZnJlcXVlbmN5Q2FudmFzLmhlaWdodCA9IDI2MDsNCiAgICAgICAgICAgICAgICBmcmVxdWVuY3lQYW5lbC5hcHBlbmQoZnJlcXVlbmN5Q2FudmFzKTsNCiAgICAgICAgICAgICAgICBjb25zdCBmcmVxdWVuY3lOb3RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOw0KICAgICAgICAgICAgICAgIGZyZXF1ZW5jeU5vdGUuY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLWNhcmRfX25vdGUiOw0KICAgICAgICAgICAgICAgIGlmIChtb250aEVudHJ5LnRvdGFsVXNlcnMpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRIaWdoTGFiZWwgPSBmb3JtYXRVc2FnZUJ1Y2tldExhYmVsKGdldFVzYWdlVGhyZXNob2xkU3RhcnRzKCkuaGlnaCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGhpZ2hMYWJlbCA9IG1vbnRoRW50cnkuaGlnaEJ1Y2tldExhYmVsIHx8IGRlZmF1bHRIaWdoTGFiZWw7DQogICAgICAgICAgICAgICAgICBmcmVxdWVuY3lOb3RlLnRleHRDb250ZW50ID0gYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChtb250aEVudHJ5LnBvd2VyVXNlcnMpfSB1c2VycyAoJHttb250aEVudHJ5LnBvd2VyU2hhcmUudG9GaXhlZCgxKX0lKSBwZXJmb3JtZWQgJHtoaWdoTGFiZWx9LmA7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGZyZXF1ZW5jeU5vdGUudGV4dENvbnRlbnQgPSAiTm8gQ29waWxvdCBhY3Rpb25zIHJlY29yZGVkLiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGZyZXF1ZW5jeVBhbmVsLmFwcGVuZChmcmVxdWVuY3lOb3RlKTsNCiAgICAgICAgICAgICAgICBjaGFydHNXcmFwcGVyLmFwcGVuZChmcmVxdWVuY3lQYW5lbCk7DQogICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBmcmVxdWVuY3lDaGFydCA9IGNyZWF0ZVVzYWdlRnJlcXVlbmN5Q2hhcnQoZnJlcXVlbmN5Q2FudmFzLmdldENvbnRleHQoIjJkIiksIG1vbnRoRW50cnkuZnJlcXVlbmN5QnVja2V0cywgbW9udGhFbnRyeS50b3RhbFVzZXJzKTsNCiAgICAgICAgICAgICAgICBpZiAoZnJlcXVlbmN5Q2hhcnQpIHsNCiAgICAgICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy51c2FnZUZyZXF1ZW5jeS5zZXQoa2V5LCBmcmVxdWVuY3lDaGFydCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICAgICAgY29uc3QgY29uc2lzdGVuY3lQYW5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5UGFuZWwuY2xhc3NOYW1lID0gInVzYWdlLW1vbnRoLWNhcmRfX3BhbmVsIjsNCiAgICAgICAgICAgICAgICBjb25zdCBjb25zaXN0ZW5jeUhlYWRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoNCIpOw0KICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5SGVhZGluZy50ZXh0Q29udGVudCA9ICJDb25zaXN0ZW50IHVzYWdlIjsNCiAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeVBhbmVsLmFwcGVuZChjb25zaXN0ZW5jeUhlYWRpbmcpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbmN5Q2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7DQogICAgICAgICAgICAgICAgY29uc2lzdGVuY3lDYW52YXMuaGVpZ2h0ID0gMjYwOw0KICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5UGFuZWwuYXBwZW5kKGNvbnNpc3RlbmN5Q2FudmFzKTsNCiAgICAgICAgICAgICAgICBjb25zdCBjb25zaXN0ZW5jeU5vdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7DQogICAgICAgICAgICAgICAgY29uc2lzdGVuY3lOb3RlLmNsYXNzTmFtZSA9ICJ1c2FnZS1tb250aC1jYXJkX19ub3RlIjsNCiAgICAgICAgICAgICAgICBpZiAoIW1vbnRoRW50cnkub2JzZXJ2ZWRXZWVrQ291bnQpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5Tm90ZS50ZXh0Q29udGVudCA9ICJOb3QgZW5vdWdoIHdlZWtseSBkYXRhIHRvIG1lYXN1cmUgY29uc2lzdGVuY3kuIjsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFtb250aEVudHJ5LndlZWtseUFjdGl2ZVVzZXJzKSB7DQogICAgICAgICAgICAgICAgICBjb25zaXN0ZW5jeU5vdGUudGV4dENvbnRlbnQgPSAiTm8gQ29waWxvdCB1c2VycyBhY3RpdmUgaW4gdGhlIHdlZWtzIGZvciB0aGlzIG1vbnRoLiI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5Tm90ZS50ZXh0Q29udGVudCA9IGAke251bWJlckZvcm1hdHRlci5mb3JtYXQobW9udGhFbnRyeS5jb25zaXN0ZW50VXNlcnMpfSB1c2VycyAoJHttb250aEVudHJ5LmNvbnNpc3RlbnRTaGFyZS50b0ZpeGVkKDEpfSUpIHdlcmUgYWN0aXZlIGluIGV2ZXJ5IG9ic2VydmVkIHdlZWsgKCR7bW9udGhFbnRyeS5vYnNlcnZlZFdlZWtDb3VudH0pLmA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnNpc3RlbmN5UGFuZWwuYXBwZW5kKGNvbnNpc3RlbmN5Tm90ZSk7DQogICAgICAgICAgICAgICAgY2hhcnRzV3JhcHBlci5hcHBlbmQoY29uc2lzdGVuY3lQYW5lbCk7DQogICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBjb25zaXN0ZW5jeUNoYXJ0ID0gY3JlYXRlVXNhZ2VDb25zaXN0ZW5jeUNoYXJ0KGNvbnNpc3RlbmN5Q2FudmFzLmdldENvbnRleHQoIjJkIiksIG1vbnRoRW50cnkub2JzZXJ2ZWRXZWVrQ291bnQsIG1vbnRoRW50cnkuY29uc2lzdGVuY3lCdWNrZXRzLCBtb250aEVudHJ5LnRvdGFsVXNlcnMpOw0KICAgICAgICAgICAgICAgIGlmIChjb25zaXN0ZW5jeUNoYXJ0KSB7DQogICAgICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudXNhZ2VDb25zaXN0ZW5jeS5zZXQoa2V5LCBjb25zaXN0ZW5jeUNoYXJ0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgICAgICBjYXJkLmFwcGVuZChjaGFydHNXcmFwcGVyKTsNCiAgICAgICAgICAgICAgICBncmlkLmFwcGVuZChjYXJkKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQWN0aXZlRGF5c1RvZ2dsZVN0YXRlKCkgew0KICAgICAgICAgICAgaWYgKCFkb20uYWN0aXZlRGF5c1RvZ2dsZUJ1dHRvbnMgfHwgIWRvbS5hY3RpdmVEYXlzVG9nZ2xlQnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdmlldyA9IHN0YXRlLmFjdGl2ZURheXNWaWV3ID09PSAicHJvbXB0cyIgPyAicHJvbXB0cyIgOiAidXNlcnMiOw0KICAgICAgICAgICAgZG9tLmFjdGl2ZURheXNUb2dnbGVCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgYnV0dG9uVmlldyA9IGJ1dHRvbi5kYXRhc2V0LmFjdGl2ZURheXNWaWV3ID09PSAicHJvbXB0cyIgPyAicHJvbXB0cyIgOiAidXNlcnMiOw0KICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IHZpZXcgPT09IGJ1dHRvblZpZXc7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBpc0FjdGl2ZSk7DQogICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIFN0cmluZyhpc0FjdGl2ZSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUmV0dXJuaW5nSW50ZXJ2YWxUb2dnbGVTdGF0ZSgpIHsNCiAgICAgICAgICAgIGlmICghZG9tLnJldHVybmluZ0ludGVydmFsQnV0dG9ucyB8fCAhZG9tLnJldHVybmluZ0ludGVydmFsQnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCB8fCBERUZBVUxUX1JFVFVSTklOR19JTlRFUlZBTDsNCiAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdJbnRlcnZhbEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGJ1dHRvbi5kYXRhc2V0LnJldHVybmluZ0ludGVydmFsID09PSAibW9udGhseSIgPyAibW9udGhseSIgOiAid2Vla2x5IjsNCiAgICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBpbnRlcnZhbCA9PT0gdmFsdWU7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBpc0FjdGl2ZSk7DQogICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIFN0cmluZyhpc0FjdGl2ZSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUmV0dXJuaW5nTWV0cmljVG9nZ2xlU3RhdGUoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5yZXR1cm5pbmdNZXRyaWNCdXR0b25zIHx8ICFkb20ucmV0dXJuaW5nTWV0cmljQnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG9tLnJldHVybmluZ01ldHJpY0J1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICBjb25zdCBtZXRyaWMgPSBidXR0b24uZGF0YXNldC5yZXR1cm5pbmdNZXRyaWNCdXR0b24gPT09ICJwZXJjZW50YWdlIiA/ICJwZXJjZW50YWdlIiA6ICJ0b3RhbCI7DQogICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gc3RhdGUucmV0dXJuaW5nTWV0cmljID09PSBtZXRyaWM7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBpc0FjdGl2ZSk7DQogICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIFN0cmluZyhpc0FjdGl2ZSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKGRvbS5yZXR1cm5pbmdFeHBvcnRQbmcpIHsNCiAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdFeHBvcnRQbmcuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBleHBvcnRSZXR1cm5pbmdVc2Vyc0ltYWdlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGRvbS5yZXR1cm5pbmdFeHBvcnRDc3YpIHsNCiAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdFeHBvcnRDc3YuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBleHBvcnRSZXR1cm5pbmdVc2Vyc0Nzdik7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChkb20udXNhZ2VUcmVuZEV4cG9ydFBuZykgew0KICAgICAgICAgICAgZG9tLnVzYWdlVHJlbmRFeHBvcnRQbmcuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBleHBvcnRVc2FnZVRyZW5kSW1hZ2UpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAoZG9tLnVzYWdlVHJlbmRFeHBvcnRDc3YpIHsNCiAgICAgICAgICAgIGRvbS51c2FnZVRyZW5kRXhwb3J0Q3N2LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXhwb3J0VXNhZ2VUcmVuZENzdik7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChkb20udXNhZ2VJbnRlbnNpdHlFeHBvcnRDc3YpIHsNCiAgICAgICAgICAgIGRvbS51c2FnZUludGVuc2l0eUV4cG9ydENzdi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV4cG9ydFVzYWdlSW50ZW5zaXR5Q3N2KTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKGRvbS5hZG9wdGlvbkV4cG9ydENzdikgew0KICAgICAgICAgICAgZG9tLmFkb3B0aW9uRXhwb3J0Q3N2LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXhwb3J0QWRvcHRpb25Dc3YpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRyZW5kVmlld1RvZ2dsZVN0YXRlKCkgew0KICAgICAgICAgICAgaWYgKCFkb20udHJlbmRWaWV3QnV0dG9ucyB8fCAhZG9tLnRyZW5kVmlld0J1dHRvbnMubGVuZ3RoKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVZpZXcgPSBzdGF0ZS50cmVuZFZpZXcgPT09ICJhdmVyYWdlIiA/ICJhdmVyYWdlIiA6ICJ0b3RhbCI7DQogICAgICAgICAgICBkb20udHJlbmRWaWV3QnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGJ1dHRvblZpZXcgPSBidXR0b24uZGF0YXNldC50cmVuZFZpZXcgPT09ICJhdmVyYWdlIiA/ICJhdmVyYWdlIiA6ICJ0b3RhbCI7DQogICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gYnV0dG9uVmlldyA9PT0gYWN0aXZlVmlldzsNCiAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoImlzLWFjdGl2ZSIsIGlzQWN0aXZlKTsNCiAgICAgICAgICAgICAgYnV0dG9uLnNldEF0dHJpYnV0ZSgiYXJpYS1wcmVzc2VkIiwgU3RyaW5nKGlzQWN0aXZlKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVVc2FnZVRyZW5kVG9nZ2xlU3RhdGUoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS51c2FnZVRyZW5kVG9nZ2xlQnV0dG9ucyB8fCAhZG9tLnVzYWdlVHJlbmRUb2dnbGVCdXR0b25zLmxlbmd0aCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20udXNhZ2VUcmVuZFRvZ2dsZUJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICBjb25zdCBtb2RlID0gYnV0dG9uLmRhdGFzZXQudXNhZ2VUcmVuZE1vZGUgPT09ICJwZXJjZW50YWdlIiA/ICJwZXJjZW50YWdlIiA6ICJudW1iZXIiOw0KICAgICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgiaXMtYWN0aXZlIiwgbW9kZSA9PT0gKHN0YXRlLnVzYWdlVHJlbmRNb2RlIHx8ICJudW1iZXIiKSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVVc2FnZVRyZW5kQ2hhcnQobW9udGhseURhdGEpIHsNCiAgICAgICAgICAgIGNvbnN0IGNoYXJ0ID0gc3RhdGUuY2hhcnRzLnVzYWdlVHJlbmQ7DQogICAgICAgICAgICBpZiAoIWRvbS51c2FnZVRyZW5kQ2FyZCB8fCAhY2hhcnQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgYWxsRGF0YSA9IEFycmF5LmlzQXJyYXkobW9udGhseURhdGEpID8gbW9udGhseURhdGEgOiBbXTsNCiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUtleXMgPSAoc3RhdGUudXNhZ2VNb250aFNlbGVjdGlvbiAmJiBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uLmxlbmd0aCkNCiAgICAgICAgICAgICAgPyBzdGF0ZS51c2FnZU1vbnRoU2VsZWN0aW9uDQogICAgICAgICAgICAgIDogYWxsRGF0YS5tYXAoZW50cnkgPT4gZW50cnkua2V5KTsNCiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhbGxEYXRhLmZpbHRlcihlbnRyeSA9PiBhY3RpdmVLZXlzLmluY2x1ZGVzKGVudHJ5LmtleSkpOw0KICAgICAgICAgICAgY29uc3QgaGFzRGF0YSA9IGRhdGEubGVuZ3RoID4gMDsNCiAgICAgICAgICAgIHN0YXRlLmxhdGVzdFVzYWdlVHJlbmRSb3dzID0gaGFzRGF0YQ0KICAgICAgICAgICAgICA/IGRhdGEubWFwKGVudHJ5ID0+ICh7DQogICAgICAgICAgICAgICAgICBrZXk6IGVudHJ5LmtleSwNCiAgICAgICAgICAgICAgICAgIGxhYmVsOiBlbnRyeS5sYWJlbCB8fCBlbnRyeS5rZXkgfHwgIiIsDQogICAgICAgICAgICAgICAgICBmcmVxdWVudFVzZXJzOiBOdW1iZXIuaXNGaW5pdGUoZW50cnkucG93ZXJVc2VycykgPyBlbnRyeS5wb3dlclVzZXJzIDogMCwNCiAgICAgICAgICAgICAgICAgIGZyZXF1ZW50U2hhcmU6IE51bWJlci5pc0Zpbml0ZShlbnRyeS5wb3dlclNoYXJlKSA/IGVudHJ5LnBvd2VyU2hhcmUgOiBudWxsLA0KICAgICAgICAgICAgICAgICAgY29uc2lzdGVudFVzZXJzOiBOdW1iZXIuaXNGaW5pdGUoZW50cnkuY29uc2lzdGVudFVzZXJzKSA/IGVudHJ5LmNvbnNpc3RlbnRVc2VycyA6IDAsDQogICAgICAgICAgICAgICAgICBjb25zaXN0ZW50U2hhcmU6IE51bWJlci5pc0Zpbml0ZShlbnRyeS5jb25zaXN0ZW50U2hhcmUpID8gZW50cnkuY29uc2lzdGVudFNoYXJlIDogbnVsbCwNCiAgICAgICAgICAgICAgICAgIHRvdGFsVXNlcnM6IE51bWJlci5pc0Zpbml0ZShlbnRyeS50b3RhbFVzZXJzKSA/IGVudHJ5LnRvdGFsVXNlcnMgOiAwDQogICAgICAgICAgICAgICAgfSkpDQogICAgICAgICAgICAgIDogW107DQogICAgICAgICAgICBzZXRCdXR0b25FbmFibGVkKGRvbS51c2FnZVRyZW5kRXhwb3J0UG5nLCBoYXNEYXRhKTsNCiAgICAgICAgICAgIHNldEJ1dHRvbkVuYWJsZWQoZG9tLnVzYWdlVHJlbmRFeHBvcnRDc3YsIGhhc0RhdGEpOw0KICAgICAgICAgICAgaWYgKGRvbS51c2FnZVRyZW5kQ2FwdGlvbikgew0KICAgICAgICAgICAgICBkb20udXNhZ2VUcmVuZENhcHRpb24udGV4dENvbnRlbnQgPSBoYXNEYXRhDQogICAgICAgICAgICAgICAgPyAiRm91ci13ZWVrIHJvbGxpbmcgdmlldyBvZiBmcmVxdWVudCBhbmQgY29uc2lzdGVudCB1c2FnZS4iDQogICAgICAgICAgICAgICAgOiAiVXBsb2FkIGRhdGEgdG8gY29tcGFyZSBmcmVxdWVudCBhbmQgY29uc2lzdGVudCB1c2FnZS4iOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGRvbS51c2FnZVRyZW5kRW1wdHkpIHsNCiAgICAgICAgICAgICAgZG9tLnVzYWdlVHJlbmRFbXB0eS5oaWRkZW4gPSBoYXNEYXRhOw0KICAgICAgICAgICAgICBpZiAoIWhhc0RhdGEpIHsNCiAgICAgICAgICAgICAgICBkb20udXNhZ2VUcmVuZEVtcHR5LnRleHRDb250ZW50ID0gIlVwbG9hZCBkYXRhIHRvIHZpc3VhbGl6ZSB1c2FnZSBpbnRlbnNpdHkgdHJlbmQuIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCFoYXNEYXRhKSB7DQogICAgICAgICAgICAgIGNoYXJ0LmRhdGEubGFiZWxzID0gW107DQogICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHMuZm9yRWFjaChkYXRhc2V0ID0+IHsNCiAgICAgICAgICAgICAgICBkYXRhc2V0LmRhdGEgPSBbXTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGNoYXJ0LnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBtb2RlID0gc3RhdGUudXNhZ2VUcmVuZE1vZGUgfHwgIm51bWJlciI7DQogICAgICAgICAgICBjb25zdCBsYWJlbHMgPSBkYXRhLm1hcChlbnRyeSA9PiBlbnRyeS5sYWJlbCk7DQogICAgICAgICAgICBjb25zdCBmcmVxdWVudFZhbHVlcyA9IGRhdGEubWFwKGVudHJ5ID0+IG1vZGUgPT09ICJwZXJjZW50YWdlIg0KICAgICAgICAgICAgICA/IChOdW1iZXIuaXNGaW5pdGUoZW50cnkucG93ZXJTaGFyZSkgPyBlbnRyeS5wb3dlclNoYXJlIDogMCkNCiAgICAgICAgICAgICAgOiAoTnVtYmVyLmlzRmluaXRlKGVudHJ5LnBvd2VyVXNlcnMpID8gZW50cnkucG93ZXJVc2VycyA6IDApKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbnRWYWx1ZXMgPSBkYXRhLm1hcChlbnRyeSA9PiBtb2RlID09PSAicGVyY2VudGFnZSINCiAgICAgICAgICAgICAgPyAoTnVtYmVyLmlzRmluaXRlKGVudHJ5LmNvbnNpc3RlbnRTaGFyZSkgPyBlbnRyeS5jb25zaXN0ZW50U2hhcmUgOiAwKQ0KICAgICAgICAgICAgICA6IChOdW1iZXIuaXNGaW5pdGUoZW50cnkuY29uc2lzdGVudFVzZXJzKSA/IGVudHJ5LmNvbnNpc3RlbnRVc2VycyA6IDApKTsNCiAgICAgICAgICAgIGNoYXJ0LmRhdGEubGFiZWxzID0gbGFiZWxzOw0KICAgICAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0pIHsNCiAgICAgICAgICAgICAgY2hhcnQuZGF0YS5kYXRhc2V0c1swXS5kYXRhID0gZnJlcXVlbnRWYWx1ZXM7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoY2hhcnQuZGF0YS5kYXRhc2V0c1sxXSkgew0KICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzFdLmRhdGEgPSBjb25zaXN0ZW50VmFsdWVzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgeVNjYWxlID0gY2hhcnQub3B0aW9ucz8uc2NhbGVzPy55Ow0KICAgICAgICAgICAgaWYgKHlTY2FsZSkgew0KICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gInBlcmNlbnRhZ2UiKSB7DQogICAgICAgICAgICAgICAgeVNjYWxlLnRpY2tzLmNhbGxiYWNrID0gdmFsdWUgPT4gYCR7TnVtYmVyKHZhbHVlKS50b0ZpeGVkKDApfSVgOw0KICAgICAgICAgICAgICAgIHlTY2FsZS5tYXggPSAxMDA7DQogICAgICAgICAgICAgICAgeVNjYWxlLnN1Z2dlc3RlZE1heCA9IDEwMDsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB5U2NhbGUudGlja3MuY2FsbGJhY2sgPSB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKTsNCiAgICAgICAgICAgICAgICBkZWxldGUgeVNjYWxlLm1heDsNCiAgICAgICAgICAgICAgICBkZWxldGUgeVNjYWxlLnN1Z2dlc3RlZE1heDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2hhcnQudXBkYXRlKCJub25lIik7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlRW5hYmxlZExpY2Vuc2VzQ2hhcnQobW9udGhseURhdGEpIHsNCiAgICAgICAgICAgIGNvbnN0IGNoYXJ0ID0gc3RhdGUuY2hhcnRzLmVuYWJsZWRMaWNlbnNlczsNCiAgICAgICAgICAgIGlmICghZG9tLmVuYWJsZWRMaWNlbnNlc0NhcmQgfHwgIWNoYXJ0KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNsZWFyRW5hYmxlZExpY2Vuc2VzR3JhZGllbnRDYWNoZSgpOw0KICAgICAgICAgICAgY29uc3Qgcm93cyA9IEFycmF5LmlzQXJyYXkobW9udGhseURhdGEpID8gbW9udGhseURhdGEgOiBbXTsNCiAgICAgICAgICAgIGNvbnN0IGhhc0RhdGEgPSByb3dzLmxlbmd0aCA+IDA7DQogICAgICAgICAgICBpZiAoZG9tLmVuYWJsZWRMaWNlbnNlc0NhcHRpb24pIHsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0NhcHRpb24udGV4dENvbnRlbnQgPSBoYXNEYXRhDQogICAgICAgICAgICAgICAgPyAiVW5pcXVlIENvcGlsb3QtZW5hYmxlZCB1c2VycyBjYXB0dXJlZCBlYWNoIG1vbnRoLiINCiAgICAgICAgICAgICAgICA6ICJVcGxvYWQgZGF0YSB0byB2aXN1YWxpemUgbGljZW5zZWQgdXNlcnMgYnkgbW9udGguIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzRW1wdHkpIHsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0VtcHR5LmhpZGRlbiA9IGhhc0RhdGE7DQogICAgICAgICAgICAgIGlmICghaGFzRGF0YSkgew0KICAgICAgICAgICAgICAgIGRvbS5lbmFibGVkTGljZW5zZXNFbXB0eS50ZXh0Q29udGVudCA9ICJVcGxvYWQgZGF0YSB0byB2aXN1YWxpemUgbGljZW5zZSBjb3ZlcmFnZS4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIWhhc0RhdGEpIHsNCiAgICAgICAgICAgICAgY29uc3QgeVNjYWxlID0gY2hhcnQub3B0aW9ucyAmJiBjaGFydC5vcHRpb25zLnNjYWxlcyA/IGNoYXJ0Lm9wdGlvbnMuc2NhbGVzLnkgOiBudWxsOw0KICAgICAgICAgICAgICBpZiAoeVNjYWxlKSB7DQogICAgICAgICAgICAgICAgZGVsZXRlIHlTY2FsZS5zdWdnZXN0ZWRNYXg7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY2hhcnQuZGF0YS5sYWJlbHMgPSBbXTsNCiAgICAgICAgICAgICAgaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0pIHsNCiAgICAgICAgICAgICAgICBjaGFydC5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBbXTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjaGFydC51cGRhdGUoIm5vbmUiKTsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gcm93cy5tYXAoZW50cnkgPT4gew0KICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE51bWJlcihlbnRyeS5jb3VudCk7DQogICAgICAgICAgICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpICYmIHZhbHVlID49IDAgPyB2YWx1ZSA6IDA7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGNoYXJ0LmRhdGEubGFiZWxzID0gcm93cy5tYXAoZW50cnkgPT4gZW50cnkubGFiZWwgfHwgZW50cnkua2V5IHx8ICIiKTsNCiAgICAgICAgICAgIGlmIChjaGFydC5kYXRhLmRhdGFzZXRzWzBdKSB7DQogICAgICAgICAgICAgIGNoYXJ0LmRhdGEuZGF0YXNldHNbMF0uZGF0YSA9IHZhbHVlczsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHlTY2FsZSA9IGNoYXJ0Lm9wdGlvbnMgJiYgY2hhcnQub3B0aW9ucy5zY2FsZXMgPyBjaGFydC5vcHRpb25zLnNjYWxlcy55IDogbnVsbDsNCiAgICAgICAgICAgIGlmICh5U2NhbGUpIHsNCiAgICAgICAgICAgICAgY29uc3QgbWF4VmFsdWUgPSB2YWx1ZXMucmVkdWNlKChtYXgsIHZhbHVlKSA9PiBNYXRoLm1heChtYXgsIHZhbHVlIHx8IDApLCAwKTsNCiAgICAgICAgICAgICAgaWYgKHN0YXRlLnNob3dFbmFibGVkTGljZW5zZUxhYmVscyAhPT0gZmFsc2UgJiYgbWF4VmFsdWUgPiAwKSB7DQogICAgICAgICAgICAgICAgeVNjYWxlLnN1Z2dlc3RlZE1heCA9IE1hdGguY2VpbChtYXhWYWx1ZSAqIDEuMSk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgZGVsZXRlIHlTY2FsZS5zdWdnZXN0ZWRNYXg7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNoYXJ0LnVwZGF0ZSgibm9uZSIpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnRNZW51IHx8ICFkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0VHJpZ2dlcikgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBzaG91bGRPcGVuID0gZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUuaGlkZGVuOw0KICAgICAgICAgICAgY2xvc2VFbmFibGVkTGljZW5zZXNFeHBvcnRNZW51KCk7DQogICAgICAgICAgICBpZiAoc2hvdWxkT3Blbikgew0KICAgICAgICAgICAgICBkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudS5oaWRkZW4gPSBmYWxzZTsNCiAgICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydFRyaWdnZXIuc2V0QXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiwgInRydWUiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjbG9zZUVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5lbmFibGVkTGljZW5zZXNFeHBvcnRNZW51KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudS5oaWRkZW4pIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZG9tLmVuYWJsZWRMaWNlbnNlc0V4cG9ydE1lbnUuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIGlmIChkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0VHJpZ2dlcikgew0KICAgICAgICAgICAgICBkb20uZW5hYmxlZExpY2Vuc2VzRXhwb3J0VHJpZ2dlci5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBleHBvcnRFbmFibGVkTGljZW5zZXNDaGFydCh7IGJhY2tncm91bmRDb2xvciA9IG51bGwsIGZpbGVTdWZmaXggPSAiIiwgaW5jbHVkZVZhbHVlcyA9IG51bGwgfSA9IHt9KSB7DQogICAgICAgICAgICBjb25zdCBjaGFydCA9IHN0YXRlLmNoYXJ0cy5lbmFibGVkTGljZW5zZXM7DQogICAgICAgICAgICBpZiAoIWNoYXJ0IHx8ICFjaGFydC5jYW52YXMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc291cmNlQ2FudmFzID0gY2hhcnQuY2FudmFzOw0KICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzb3VyY2VDYW52YXMud2lkdGg7DQogICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBzb3VyY2VDYW52YXMuaGVpZ2h0Ow0KICAgICAgICAgICAgaWYgKCF3aWR0aCB8fCAhaGVpZ2h0KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTaG93VmFsdWVzID0gc3RhdGUuc2hvd0VuYWJsZWRMaWNlbnNlTGFiZWxzICE9PSBmYWxzZTsNCiAgICAgICAgICAgIGNvbnN0IHRhcmdldFNob3dWYWx1ZXMgPSBpbmNsdWRlVmFsdWVzID09IG51bGwgPyBjdXJyZW50U2hvd1ZhbHVlcyA6IGluY2x1ZGVWYWx1ZXM7DQogICAgICAgICAgICBjb25zdCBzaG91bGRUb2dnbGUgPSB0YXJnZXRTaG93VmFsdWVzICE9PSBjdXJyZW50U2hvd1ZhbHVlczsNCiAgICAgICAgICAgIGlmIChzaG91bGRUb2dnbGUpIHsNCiAgICAgICAgICAgICAgc3RhdGUuc2hvd0VuYWJsZWRMaWNlbnNlTGFiZWxzID0gdGFyZ2V0U2hvd1ZhbHVlczsNCiAgICAgICAgICAgICAgdXBkYXRlRW5hYmxlZExpY2Vuc2VzQ2hhcnQoc3RhdGUubGF0ZXN0RW5hYmxlZFRpbWVsaW5lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGV4cG9ydENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOw0KICAgICAgICAgICAgZXhwb3J0Q2FudmFzLndpZHRoID0gd2lkdGg7DQogICAgICAgICAgICBleHBvcnRDYW52YXMuaGVpZ2h0ID0gaGVpZ2h0Ow0KICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IGV4cG9ydENhbnZhcy5nZXRDb250ZXh0KCIyZCIpOw0KICAgICAgICAgICAgaWYgKCFjb250ZXh0KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChiYWNrZ3JvdW5kQ29sb3IpIHsNCiAgICAgICAgICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBiYWNrZ3JvdW5kQ29sb3I7DQogICAgICAgICAgICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShzb3VyY2VDYW52YXMsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgY29uc3QgZGF0YVVybCA9IGV4cG9ydENhbnZhcy50b0RhdGFVUkwoImltYWdlL3BuZyIpOw0KICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCiAgICAgICAgICAgIGNvbnN0IHN1ZmZpeCA9IGZpbGVTdWZmaXggPyBgLSR7ZmlsZVN1ZmZpeH1gIDogIiI7DQogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYGVuYWJsZWQtY29waWxvdC11c2VycyR7c3VmZml4fS5wbmdgOw0KICAgICAgICAgICAgbGluay5ocmVmID0gZGF0YVVybDsNCiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsNCiAgICAgICAgICAgIGNsb3NlRW5hYmxlZExpY2Vuc2VzRXhwb3J0TWVudSgpOw0KICAgICAgICAgICAgaWYgKHNob3VsZFRvZ2dsZSkgew0KICAgICAgICAgICAgICBzdGF0ZS5zaG93RW5hYmxlZExpY2Vuc2VMYWJlbHMgPSBjdXJyZW50U2hvd1ZhbHVlczsNCiAgICAgICAgICAgICAgdXBkYXRlRW5hYmxlZExpY2Vuc2VzQ2hhcnQoc3RhdGUubGF0ZXN0RW5hYmxlZFRpbWVsaW5lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBkZXN0cm95VXNhZ2VDaGFydHMoKSB7DQogICAgICAgICAgICBpZiAoc3RhdGUuY2hhcnRzLnVzYWdlRnJlcXVlbmN5IGluc3RhbmNlb2YgTWFwKSB7DQogICAgICAgICAgICAgIHN0YXRlLmNoYXJ0cy51c2FnZUZyZXF1ZW5jeS5mb3JFYWNoKGNoYXJ0ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoY2hhcnQgJiYgdHlwZW9mIGNoYXJ0LmRlc3Ryb3kgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgIGNoYXJ0LmRlc3Ryb3koKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudXNhZ2VGcmVxdWVuY3kuY2xlYXIoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzdGF0ZS5jaGFydHMudXNhZ2VDb25zaXN0ZW5jeSBpbnN0YW5jZW9mIE1hcCkgew0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudXNhZ2VDb25zaXN0ZW5jeS5mb3JFYWNoKGNoYXJ0ID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoY2hhcnQgJiYgdHlwZW9mIGNoYXJ0LmRlc3Ryb3kgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgICAgIGNoYXJ0LmRlc3Ryb3koKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBzdGF0ZS5jaGFydHMudXNhZ2VDb25zaXN0ZW5jeS5jbGVhcigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVzYWdlRnJlcXVlbmN5Q2hhcnQoY29udGV4dCwgYnVja2V0cywgdG90YWxVc2Vycykgew0KICAgICAgICAgICAgaWYgKCFjb250ZXh0KSB7DQogICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgYXhpc1RpY2tDb2xvciA9IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tdGV4dC1tdXRlZCIsICIjNEQ1NzVEIik7DQogICAgICAgICAgICBjb25zdCBheGlzR3JpZENvbG9yID0gZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS1ncmlkLWNvbG9yIiwgInJnYmEoMTUzLCAyMDgsIDE1MywgMC4xOCkiKTsNCiAgICAgICAgICAgIGNvbnN0IGNvbG9ycyA9IFsNCiAgICAgICAgICAgICAgZ2V0Q3NzVmFyaWFibGVWYWx1ZSgiLS1ncmVlbi0yMDAiLCAiIzk5RDA5OSIpLA0KICAgICAgICAgICAgICBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWdyZWVuLTUwMCIsICIjMDA4QTAwIiksDQogICAgICAgICAgICAgIGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tZ3JlZW4tNzAwIiwgIiMwMDUzMDAiKQ0KICAgICAgICAgICAgXTsNCiAgICAgICAgICAgIGNvbnN0IGxhYmVscyA9IEFycmF5LmlzQXJyYXkoYnVja2V0cykgPyBidWNrZXRzLm1hcChidWNrZXQgPT4gYnVja2V0LmxhYmVsKSA6IFtdOw0KICAgICAgICAgICAgY29uc3QgZGF0YSA9IEFycmF5LmlzQXJyYXkoYnVja2V0cykgPyBidWNrZXRzLm1hcChidWNrZXQgPT4gYnVja2V0LmNvdW50IHx8IDApIDogW107DQogICAgICAgICAgICBjb25zdCBiYWNrZ3JvdW5kQ29sb3IgPSBkYXRhLm1hcCgoXywgaW5kZXgpID0+IGNvbG9yc1tpbmRleF0gfHwgY29sb3JzW2NvbG9ycy5sZW5ndGggLSAxXSk7DQogICAgICAgICAgICBjb25zdCB5TWF4ID0gTnVtYmVyLmlzRmluaXRlKHRvdGFsVXNlcnMpICYmIHRvdGFsVXNlcnMgPiAwID8gdG90YWxVc2VycyA6IG51bGw7DQogICAgICAgICAgICByZXR1cm4gbmV3IENoYXJ0KGNvbnRleHQsIHsNCiAgICAgICAgICAgICAgdHlwZTogImJhciIsDQogICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICBsYWJlbHMsDQogICAgICAgICAgICAgICAgZGF0YXNldHM6IFt7DQogICAgICAgICAgICAgICAgICBsYWJlbDogIkFjdGl2ZSB1c2VycyIsDQogICAgICAgICAgICAgICAgICBkYXRhLA0KICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yLA0KICAgICAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAxMiwNCiAgICAgICAgICAgICAgICAgIGJvcmRlclNraXBwZWQ6IGZhbHNlDQogICAgICAgICAgICAgICAgfV0NCiAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgb3B0aW9uczogew0KICAgICAgICAgICAgICAgIHJlc3BvbnNpdmU6IHRydWUsDQogICAgICAgICAgICAgICAgbWFpbnRhaW5Bc3BlY3RSYXRpbzogZmFsc2UsDQogICAgICAgICAgICAgICAgc2NhbGVzOiB7DQogICAgICAgICAgICAgICAgICB4OiB7DQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsgY29sb3I6IGF4aXNUaWNrQ29sb3IgfQ0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgIHk6IHsNCiAgICAgICAgICAgICAgICAgICAgYmVnaW5BdFplcm86IHRydWUsDQogICAgICAgICAgICAgICAgICAgIG1heDogeU1heCB8fCB1bmRlZmluZWQsDQogICAgICAgICAgICAgICAgICAgIHN1Z2dlc3RlZE1heDogeU1heCB8fCB1bmRlZmluZWQsDQogICAgICAgICAgICAgICAgICAgIGdyaWQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYXhpc0dyaWRDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICBkcmF3Qm9yZGVyOiBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICB0aWNrczogew0KICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBheGlzVGlja0NvbG9yLA0KICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrOiB2YWx1ZSA9PiBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBwbHVnaW5zOiB7DQogICAgICAgICAgICAgICAgICBsZWdlbmQ6IHsgZGlzcGxheTogZmFsc2UgfSwNCiAgICAgICAgICAgICAgICAgIHRvb2x0aXA6IHsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAicmdiYSgzMSwgMzUsIDM3LCAwLjkyKSIsDQogICAgICAgICAgICAgICAgICAgIHRpdGxlQ29sb3I6ICIjZmZmZmZmIiwNCiAgICAgICAgICAgICAgICAgICAgYm9keUNvbG9yOiAiI2ZmZmZmZiIsDQogICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwLA0KICAgICAgICAgICAgICAgICAgICBjb3JuZXJSYWRpdXM6IDEwLA0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q29sb3JzOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzOiB7DQogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGNvbnRleHQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUoY29udGV4dC5wYXJzZWQueSkgPyBjb250ZXh0LnBhcnNlZC55IDogMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKX0gdXNlcnNgOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgaW50ZXJhY3Rpb246IHsNCiAgICAgICAgICAgICAgICAgIG1vZGU6ICJpbmRleCIsDQogICAgICAgICAgICAgICAgICBpbnRlcnNlY3Q6IGZhbHNlDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2FnZUNvbnNpc3RlbmN5Q2hhcnQoY29udGV4dCwgb2JzZXJ2ZWRXZWVrQ291bnQsIGJ1Y2tldERhdGEsIHRvdGFsVXNlcnMpIHsNCiAgICAgICAgICAgIGlmICghY29udGV4dCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGF4aXNUaWNrQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLXRleHQtbXV0ZWQiLCAiIzRENTc1RCIpOw0KICAgICAgICAgICAgY29uc3QgYXhpc0dyaWRDb2xvciA9IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tZ3JpZC1jb2xvciIsICJyZ2JhKDE1MywgMjA4LCAxNTMsIDAuMTgpIik7DQogICAgICAgICAgICBjb25zdCBsYWJlbHMgPSBvYnNlcnZlZFdlZWtDb3VudA0KICAgICAgICAgICAgICA/IEFycmF5LmZyb20oeyBsZW5ndGg6IG9ic2VydmVkV2Vla0NvdW50IH0sIChfLCBpbmRleCkgPT4gYCR7aW5kZXggKyAxfSBvZiAke29ic2VydmVkV2Vla0NvdW50fSB3ZWVrc2ApDQogICAgICAgICAgICAgIDogW107DQogICAgICAgICAgICBjb25zdCBkYXRhID0gQXJyYXkuaXNBcnJheShidWNrZXREYXRhKSA/IGJ1Y2tldERhdGEubWFwKHZhbHVlID0+IHZhbHVlIHx8IDApIDogW107DQogICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBsYWJlbHMubWFwKChfLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBpc0xhc3QgPSBpbmRleCA9PT0gbGFiZWxzLmxlbmd0aCAtIDE7DQogICAgICAgICAgICAgIHJldHVybiBpc0xhc3QNCiAgICAgICAgICAgICAgICA/IGdldENzc1ZhcmlhYmxlVmFsdWUoIi0tYmx1ZS01MDAiLCAiIzNBODRDMSIpDQogICAgICAgICAgICAgICAgOiBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWluZGlnby01MDAiLCAiIzUxNDZENiIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBjb25zdCB5TWF4ID0gTnVtYmVyLmlzRmluaXRlKHRvdGFsVXNlcnMpICYmIHRvdGFsVXNlcnMgPiAwID8gdG90YWxVc2VycyA6IG51bGw7DQogICAgICAgICAgICByZXR1cm4gbmV3IENoYXJ0KGNvbnRleHQsIHsNCiAgICAgICAgICAgICAgdHlwZTogImJhciIsDQogICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICBsYWJlbHMsDQogICAgICAgICAgICAgICAgZGF0YXNldHM6IFt7DQogICAgICAgICAgICAgICAgICBsYWJlbDogIlVzZXJzIiwNCiAgICAgICAgICAgICAgICAgIGRhdGEsDQogICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9ycywNCiAgICAgICAgICAgICAgICAgIGJvcmRlclJhZGl1czogMTIsDQogICAgICAgICAgICAgICAgICBib3JkZXJTa2lwcGVkOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH1dDQogICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgIG9wdGlvbnM6IHsNCiAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLA0KICAgICAgICAgICAgICAgIG1haW50YWluQXNwZWN0UmF0aW86IGZhbHNlLA0KICAgICAgICAgICAgICAgIHNjYWxlczogew0KICAgICAgICAgICAgICAgICAgeDogew0KICAgICAgICAgICAgICAgICAgICBncmlkOiB7IGRpc3BsYXk6IGZhbHNlIH0sDQogICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7IGNvbG9yOiBheGlzVGlja0NvbG9yIH0NCiAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICB5OiB7DQogICAgICAgICAgICAgICAgICAgIGJlZ2luQXRaZXJvOiB0cnVlLA0KICAgICAgICAgICAgICAgICAgICBtYXg6IHlNYXggfHwgdW5kZWZpbmVkLA0KICAgICAgICAgICAgICAgICAgICBzdWdnZXN0ZWRNYXg6IHlNYXggfHwgdW5kZWZpbmVkLA0KICAgICAgICAgICAgICAgICAgICBncmlkOiB7DQogICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGF4aXNHcmlkQ29sb3IsDQogICAgICAgICAgICAgICAgICAgICAgZHJhd0JvcmRlcjogZmFsc2UNCiAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYXhpc1RpY2tDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogdmFsdWUgPT4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdCh2YWx1ZSkNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgcGx1Z2luczogew0KICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7IGRpc3BsYXk6IGZhbHNlIH0sDQogICAgICAgICAgICAgICAgICB0b29sdGlwOiB7DQogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogInJnYmEoMzEsIDM1LCAzNywgMC45MikiLA0KICAgICAgICAgICAgICAgICAgICB0aXRsZUNvbG9yOiAiI2ZmZmZmZiIsDQogICAgICAgICAgICAgICAgICAgIGJvZHlDb2xvcjogIiNmZmZmZmYiLA0KICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMCwNCiAgICAgICAgICAgICAgICAgICAgY29ybmVyUmFkaXVzOiAxMCwNCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUNvbG9yczogZmFsc2UsDQogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrczogew0KICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBjb250ZXh0ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyLmlzRmluaXRlKGNvbnRleHQucGFyc2VkLnkpID8gY29udGV4dC5wYXJzZWQueSA6IDA7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdCh2YWx1ZSl9IHVzZXJzYDsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGludGVyYWN0aW9uOiB7DQogICAgICAgICAgICAgICAgICBtb2RlOiAiaW5kZXgiLA0KICAgICAgICAgICAgICAgICAgaW50ZXJzZWN0OiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQWN0aXZlRGF5c0NhcmQoc3RhdHMpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmFjdGl2ZURheXNDYXJkKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBzdGF0ZS5hY3RpdmVEYXlzVmlldyA9PT0gInByb21wdHMiID8gInByb21wdHMiIDogInVzZXJzIjsNCiAgICAgICAgICAgIGNvbnN0IHRvdGFscyA9IHN0YXRzDQogICAgICAgICAgICAgID8gKHZpZXcgPT09ICJwcm9tcHRzIiA/IHN0YXRzLnByb21wdFRvdGFscyA6IHN0YXRzLnVuaXF1ZVVzZXJzKQ0KICAgICAgICAgICAgICA6IG51bGw7DQogICAgICAgICAgICBjb25zdCByYW5nZUxhYmVsID0gc3RhdHMgJiYgc3RhdHMucmFuZ2VMYWJlbCA/IHN0YXRzLnJhbmdlTGFiZWwgOiBudWxsOw0KICAgICAgICAgICAgbGV0IGhhc1ZhbHVlcyA9IGZhbHNlOw0KICAgICAgICAgICAgYWN0aXZlRGF5S2V5cy5mb3JFYWNoKGtleSA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gYWN0aXZlRGF5c0VsZW1lbnRzW2tleV07DQogICAgICAgICAgICAgIGlmICghZW50cnkgfHwgIWVudHJ5LnZhbHVlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmICghdG90YWxzKSB7DQogICAgICAgICAgICAgICAgZW50cnkudmFsdWUudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdG90YWxzW2tleV0gfHwgMDsNCiAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7DQogICAgICAgICAgICAgICAgaGFzVmFsdWVzID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCByb3VuZGVkID0gTWF0aC5yb3VuZCh2YWx1ZSk7DQogICAgICAgICAgICAgIGVudHJ5LnZhbHVlLnRleHRDb250ZW50ID0gdmFsdWUgPyBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHJvdW5kZWQpIDogIjAiOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBpZiAoZG9tLmFjdGl2ZURheXNHcmlkKSB7DQogICAgICAgICAgICAgIGNvbnN0IGVudHJpZXMgPSBhY3RpdmVEYXlLZXlzLm1hcChrZXkgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IGFjdGl2ZURheXNFbGVtZW50c1trZXldOw0KICAgICAgICAgICAgICAgIGlmICghcmVjb3JkIHx8ICFyZWNvcmQuaXRlbSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdG90YWxzID8gTnVtYmVyKHRvdGFsc1trZXldIHx8IDApIDogMDsNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgcmVjb3JkLA0KICAgICAgICAgICAgICAgICAgdmFsdWUNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICB9KS5maWx0ZXIoQm9vbGVhbik7DQogICAgICAgICAgICAgIGNvbnN0IHNvcnRlciA9IHRvdGFscw0KICAgICAgICAgICAgICAgID8gKGEsIGIpID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRpZmYgPSBiLnZhbHVlIC0gYS52YWx1ZTsNCiAgICAgICAgICAgICAgICAgIGlmIChkaWZmICE9PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkaWZmOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgcmV0dXJuIChhLnJlY29yZC5vcmRlciA/PyAwKSAtIChiLnJlY29yZC5vcmRlciA/PyAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgOiAoYSwgYikgPT4gKGEucmVjb3JkLm9yZGVyID8/IDApIC0gKGIucmVjb3JkLm9yZGVyID8/IDApOw0KICAgICAgICAgICAgICBlbnRyaWVzLnNvcnQoc29ydGVyKTsNCiAgICAgICAgICAgICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7DQogICAgICAgICAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGVudHJ5LnJlY29yZC5pdGVtKSB7DQogICAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChlbnRyeS5yZWNvcmQuaXRlbSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgZG9tLmFjdGl2ZURheXNHcmlkLmFwcGVuZENoaWxkKGZyYWdtZW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uYWN0aXZlRGF5c0NhcHRpb24pIHsNCiAgICAgICAgICAgICAgaWYgKCF0b3RhbHMpIHsNCiAgICAgICAgICAgICAgICBkb20uYWN0aXZlRGF5c0NhcHRpb24udGV4dENvbnRlbnQgPSAiVXBsb2FkIGRhdGEgdG8gcmV2aWV3IENvcGlsb3QgYWN0aXZpdHkgZm9yIHRoZSBsYXN0IDMwIGRheXMuIjsNCiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNWYWx1ZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAodmlldyA9PT0gInByb21wdHMiKSB7DQogICAgICAgICAgICAgICAgICBkb20uYWN0aXZlRGF5c0NhcHRpb24udGV4dENvbnRlbnQgPSByYW5nZUxhYmVsDQogICAgICAgICAgICAgICAgICAgID8gYFRvdGFsIENvcGlsb3QgcHJvbXB0cyBnZW5lcmF0ZWQgcGVyIGFwcCBpbiB0aGUgbGFzdCAzMCBkYXlzICgke3JhbmdlTGFiZWx9KS5gDQogICAgICAgICAgICAgICAgICAgIDogIlRvdGFsIENvcGlsb3QgcHJvbXB0cyBnZW5lcmF0ZWQgcGVyIGFwcCBpbiB0aGUgbGFzdCAzMCBkYXlzLiI7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGRvbS5hY3RpdmVEYXlzQ2FwdGlvbi50ZXh0Q29udGVudCA9IHJhbmdlTGFiZWwNCiAgICAgICAgICAgICAgICAgICAgPyBgVW5pcXVlIENvcGlsb3QgdXNlcnMgYWN0aXZlIGF0IGxlYXN0IG9uY2UgcGVyIGFwcCBpbiB0aGUgbGFzdCAzMCBkYXlzICgke3JhbmdlTGFiZWx9KS5gDQogICAgICAgICAgICAgICAgICAgIDogIlVuaXF1ZSBDb3BpbG90IHVzZXJzIGFjdGl2ZSBhdCBsZWFzdCBvbmNlIHBlciBhcHAgaW4gdGhlIGxhc3QgMzAgZGF5cy4iOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkb20uYWN0aXZlRGF5c0NhcHRpb24udGV4dENvbnRlbnQgPSB2aWV3ID09PSAicHJvbXB0cyINCiAgICAgICAgICAgICAgICAgID8gIk5vIENvcGlsb3QgcHJvbXB0cyByZWNvcmRlZCBmb3IgdGhlIHNlbGVjdGVkIGZpbHRlcnMgaW4gdGhlIGxhc3QgMzAgZGF5cy4iDQogICAgICAgICAgICAgICAgICA6ICJObyBDb3BpbG90IHVzZXJzIHJlY29yZGVkIGZvciB0aGUgc2VsZWN0ZWQgZmlsdGVycyBpbiB0aGUgbGFzdCAzMCBkYXlzLiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVBZ2VudFVzYWdlQ2FyZChhZ2VudFJvd3MpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmFnZW50Q2FyZCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCByb3dzID0gQXJyYXkuaXNBcnJheShhZ2VudFJvd3MpID8gYWdlbnRSb3dzIDogW107DQogICAgICAgICAgICBpZiAoZG9tLmFnZW50VGFibGVCb2R5KSB7DQogICAgICAgICAgICAgIGRvbS5hZ2VudFRhYmxlQm9keS5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghcm93cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFRhYmxlV3JhcHBlcikgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFRhYmxlV3JhcHBlci5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkb20uYWdlbnRFbXB0eSkgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudEVtcHR5LnRleHRDb250ZW50ID0gIlVwbG9hZCBhZ2VudCB1c2FnZSBDU1YgdG8gdmlldyBpbnNpZ2h0cy4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkb20uYWdlbnRTdGF0dXMpIHsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRTdGF0dXMudGV4dENvbnRlbnQgPSAiQXdhaXRpbmcgYWdlbnQgdXNhZ2UgQ1NWLiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudENhcHRpb24pIHsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRDYXB0aW9uLnRleHRDb250ZW50ID0gIlVwbG9hZCBhbiBhZ2VudCB1c2FnZSBleHBvcnQgdG8gc3BvdGxpZ2h0IHRoZSBtb3N0IGFjdGl2ZSBDb3BpbG90IGFnZW50cy4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkb20uYWdlbnRWaWV3VG9nZ2xlKSB7DQogICAgICAgICAgICAgICAgZG9tLmFnZW50Vmlld1RvZ2dsZS5oaWRkZW4gPSB0cnVlOw0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUuc2V0QXR0cmlidXRlKCJhcmlhLWV4cGFuZGVkIiwgImZhbHNlIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFZpZXdBbGwpIHsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRWaWV3QWxsLmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFNvcnRCdXR0b25zICYmIGRvbS5hZ2VudFNvcnRCdXR0b25zLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFNvcnRCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJpcy1hY3RpdmUiKTsNCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsICJmYWxzZSIpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBidXR0b24uZGF0YXNldC5zb3J0TGFiZWwgfHwgYnV0dG9uLnRleHRDb250ZW50LnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHREaXJlY3Rpb24gPSBidXR0b24uZGF0YXNldC5hZ2VudFNvcnQgPT09ICJuYW1lIiB8fCBidXR0b24uZGF0YXNldC5hZ2VudFNvcnQgPT09ICJjcmVhdG9yVHlwZSIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIjsNCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBgJHtsYWJlbH0uIENsaWNrIHRvIHNvcnQgJHtkZWZhdWx0RGlyZWN0aW9ufS5gKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGljYXRvciA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zb3J0LWluZGljYXRvcl0iKTsNCiAgICAgICAgICAgICAgICAgIGlmIChpbmRpY2F0b3IpIHsNCiAgICAgICAgICAgICAgICAgICAgaW5kaWNhdG9yLnRleHRDb250ZW50ID0gIiI7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBjb25zdCBzb3J0Q29uZmlnID0gc3RhdGUuYWdlbnRTb3J0ICYmIHN0YXRlLmFnZW50U29ydC5jb2x1bW4NCiAgICAgICAgICAgICAgPyBzdGF0ZS5hZ2VudFNvcnQNCiAgICAgICAgICAgICAgOiB7IGNvbHVtbjogInJlc3BvbnNlcyIsIGRpcmVjdGlvbjogImRlc2MiIH07DQogICAgICAgICAgICBjb25zdCBjb2x1bW4gPSBzb3J0Q29uZmlnLmNvbHVtbjsNCiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbk11bHRpcGxpZXIgPSBzb3J0Q29uZmlnLmRpcmVjdGlvbiA9PT0gImFzYyIgPyAxIDogLTE7DQogICAgICAgICAgICBjb25zdCBnZXRTb3J0VmFsdWUgPSBhZ2VudCA9PiB7DQogICAgICAgICAgICAgIHN3aXRjaCAoY29sdW1uKSB7DQogICAgICAgICAgICAgICAgY2FzZSAibmFtZSI6DQogICAgICAgICAgICAgICAgICByZXR1cm4gKGFnZW50Lm5hbWUgfHwgIiIpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgY2FzZSAiY3JlYXRvclR5cGUiOg0KICAgICAgICAgICAgICAgICAgcmV0dXJuIChhZ2VudC5jcmVhdG9yVHlwZSB8fCAiIikudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgICBjYXNlICJ0b3RhbEFjdGl2ZSI6DQogICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGFnZW50LnRvdGFsQWN0aXZlIHx8IDApOw0KICAgICAgICAgICAgICAgIGNhc2UgInJlc3BvbnNlcyI6DQogICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGFnZW50LnJlc3BvbnNlcyB8fCAwKTsNCiAgICAgICAgICAgICAgICBjYXNlICJsYXN0QWN0aXZpdHkiOg0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGFnZW50Lmxhc3RBY3Rpdml0eSBpbnN0YW5jZW9mIERhdGUgPyBhZ2VudC5sYXN0QWN0aXZpdHkuZ2V0VGltZSgpIDogMDsNCiAgICAgICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcihhZ2VudC5yZXNwb25zZXMgfHwgMCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBjb25zdCBzb3J0ZWQgPSByb3dzLnNsaWNlKCkuc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgICBjb25zdCBhVmFsdWUgPSBnZXRTb3J0VmFsdWUoYSk7DQogICAgICAgICAgICAgIGNvbnN0IGJWYWx1ZSA9IGdldFNvcnRWYWx1ZShiKTsNCiAgICAgICAgICAgICAgaWYgKGNvbHVtbiA9PT0gIm5hbWUiIHx8IGNvbHVtbiA9PT0gImNyZWF0b3JUeXBlIikgew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBhcmUgPSBTdHJpbmcoYVZhbHVlKS5sb2NhbGVDb21wYXJlKFN0cmluZyhiVmFsdWUpKTsNCiAgICAgICAgICAgICAgICBpZiAoY29tcGFyZSAhPT0gMCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmUgKiBkaXJlY3Rpb25NdWx0aXBsaWVyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zdCBkaWZmID0gTnVtYmVyKGFWYWx1ZSkgLSBOdW1iZXIoYlZhbHVlKTsNCiAgICAgICAgICAgICAgICBpZiAoZGlmZiAhPT0gMCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpZmYgKiBkaXJlY3Rpb25NdWx0aXBsaWVyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gKGEubmFtZSB8fCAiIikubG9jYWxlQ29tcGFyZShiLm5hbWUgfHwgIiIpOw0KICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gc29ydGVkLmxlbmd0aDsNCiAgICAgICAgICAgIGNvbnN0IGhhc1VubGltaXRlZCA9IHN0YXRlLmFnZW50RGlzcGxheUxpbWl0ID09PSBJbmZpbml0eTsNCiAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUxpbWl0ID0gaGFzVW5saW1pdGVkDQogICAgICAgICAgICAgID8gdG90YWwNCiAgICAgICAgICAgICAgOiBNYXRoLm1pbih0b3RhbCwgTWF0aC5tYXgoc3RhdGUuYWdlbnREaXNwbGF5TGltaXQgfHwgNSwgNSkpOw0KICAgICAgICAgICAgY29uc3QgdmlzaWJsZVJvd3MgPSBzb3J0ZWQuc2xpY2UoMCwgaGFzVW5saW1pdGVkID8gdG90YWwgOiBlZmZlY3RpdmVMaW1pdCk7DQogICAgICAgICAgICBjb25zdCBkaXNwbGF5ZWRDb3VudCA9IHZpc2libGVSb3dzLmxlbmd0aDsNCiAgICAgICAgICAgIGNvbnN0IGhhc092ZXJmbG93ID0gZGlzcGxheWVkQ291bnQgPCB0b3RhbDsNCiAgICAgICAgICAgIGNvbnN0IGV4cGFuZGVkID0gaGFzVW5saW1pdGVkIHx8ICFoYXNPdmVyZmxvdzsNCiAgICAgIA0KICAgICAgICAgICAgaWYgKGRvbS5hZ2VudFRhYmxlV3JhcHBlcikgew0KICAgICAgICAgICAgICBkb20uYWdlbnRUYWJsZVdyYXBwZXIuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLmFnZW50RW1wdHkpIHsNCiAgICAgICAgICAgICAgZG9tLmFnZW50RW1wdHkuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgY29uc3Qgc29ydExhYmVsID0gYWdlbnRTb3J0TGFiZWxzW3NvcnRDb25maWcuY29sdW1uXSB8fCAicmVzcG9uc2VzIjsNCiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbkxhYmVsID0gc29ydENvbmZpZy5kaXJlY3Rpb24gPT09ICJhc2MiID8gImFzY2VuZGluZyIgOiAiZGVzY2VuZGluZyI7DQogICAgICAgICAgICBpZiAoZG9tLmFnZW50Q2FwdGlvbikgew0KICAgICAgICAgICAgICBkb20uYWdlbnRDYXB0aW9uLnRleHRDb250ZW50ID0gYFRvcCBDb3BpbG90IGFnZW50cyBzb3J0ZWQgYnkgJHtzb3J0TGFiZWwudG9Mb3dlckNhc2UoKX0gKCR7ZGlyZWN0aW9uTGFiZWx9KS5gOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoZG9tLmFnZW50U3RhdHVzKSB7DQogICAgICAgICAgICAgIGNvbnN0IG1ldGEgPSBzdGF0ZS5hZ2VudFVzYWdlTWV0YSB8fCB7fTsNCiAgICAgICAgICAgICAgY29uc3QgdG90YWxBZ2VudHMgPSBtZXRhLnRvdGFsUm93cyB8fCB0b3RhbDsNCiAgICAgICAgICAgICAgY29uc3Qgc2tpcHBlZCA9IG1ldGEuc2tpcHBlZCB8fCAwOw0KICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IFtdOw0KICAgICAgICAgICAgICBpZiAobWV0YS5zb3VyY2VOYW1lKSB7DQogICAgICAgICAgICAgICAgcGFydHMucHVzaChgQWdlbnQgZXhwb3J0OiAke21ldGEuc291cmNlTmFtZX1gKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBwYXJ0cy5wdXNoKGBTaG93aW5nICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChkaXNwbGF5ZWRDb3VudCl9IG9mICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdCh0b3RhbEFnZW50cyl9IGFnZW50c2ApOw0KICAgICAgICAgICAgICBpZiAoc2tpcHBlZCkgew0KICAgICAgICAgICAgICAgIHBhcnRzLnB1c2goYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChza2lwcGVkKX0gcm93cyBza2lwcGVkYCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5wZXJzaXN0RGF0YXNldHMpIHsNCiAgICAgICAgICAgICAgICBwYXJ0cy5wdXNoKCJTZXNzaW9uIG9ubHkgKG5vdCBjYWNoZWQpIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcGFydHMucHVzaChgU29ydGVkIGJ5ICR7c29ydExhYmVsLnRvTG93ZXJDYXNlKCl9ICgke2RpcmVjdGlvbkxhYmVsfSlgKTsNCiAgICAgICAgICAgICAgZG9tLmFnZW50U3RhdHVzLnRleHRDb250ZW50ID0gcGFydHMuam9pbigiIMK3ICIpOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoZG9tLmFnZW50Vmlld1RvZ2dsZSkgew0KICAgICAgICAgICAgICBpZiAodG90YWwgPD0gNSkgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRWaWV3VG9nZ2xlLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJmYWxzZSIpOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgICAgZG9tLmFnZW50Vmlld1RvZ2dsZS5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCBTdHJpbmcoZXhwYW5kZWQpKTsNCiAgICAgICAgICAgICAgICBpZiAoZXhwYW5kZWQpIHsNCiAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUudGV4dENvbnRlbnQgPSAiU2hvdyB0b3AgNSBhZ2VudHMiOw0KICAgICAgICAgICAgICAgICAgZG9tLmFnZW50Vmlld1RvZ2dsZS5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCAiU2hvdyB0b3AgNSBhZ2VudHMiKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVtYWluaW5nID0gdG90YWwgLSBkaXNwbGF5ZWRDb3VudDsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRDaHVuayA9IE1hdGgubWluKDUwLCByZW1haW5pbmcpOw0KICAgICAgICAgICAgICAgICAgZG9tLmFnZW50Vmlld1RvZ2dsZS50ZXh0Q29udGVudCA9IHJlbWFpbmluZyA+IDUwDQogICAgICAgICAgICAgICAgICAgID8gYFNob3cgbmV4dCAke251bWJlckZvcm1hdHRlci5mb3JtYXQobmV4dENodW5rKX0gYWdlbnRzYA0KICAgICAgICAgICAgICAgICAgICA6IGBTaG93IHJlbWFpbmluZyAke251bWJlckZvcm1hdHRlci5mb3JtYXQocmVtYWluaW5nKX0gYWdlbnRzYDsNCiAgICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdUb2dnbGUuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgZG9tLmFnZW50Vmlld1RvZ2dsZS50ZXh0Q29udGVudCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGlmIChkb20uYWdlbnRWaWV3QWxsKSB7DQogICAgICAgICAgICAgIGlmICh0b3RhbCA8PSA1IHx8IGhhc1VubGltaXRlZCB8fCBleHBhbmRlZCkgew0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdBbGwuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkb20uYWdlbnRWaWV3QWxsLmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGRvbS5hZ2VudFZpZXdBbGwuc2V0QXR0cmlidXRlKCJhcmlhLWxhYmVsIiwgIlNob3cgYWxsIGFnZW50cyIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGlmIChkb20uYWdlbnRTb3J0QnV0dG9ucyAmJiBkb20uYWdlbnRTb3J0QnV0dG9ucy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgZG9tLmFnZW50U29ydEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IGJ1dHRvbi5kYXRhc2V0LmFnZW50U29ydDsNCiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbCA9IGJ1dHRvbi5kYXRhc2V0LnNvcnRMYWJlbCB8fCBidXR0b24udGV4dENvbnRlbnQudHJpbSgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGljYXRvciA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCJbZGF0YS1zb3J0LWluZGljYXRvcl0iKTsNCiAgICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGNvbHVtbiA9PT0gc29ydENvbmZpZy5jb2x1bW47DQogICAgICAgICAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoImlzLWFjdGl2ZSIsIGlzQWN0aXZlKTsNCiAgICAgICAgICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLXByZXNzZWQiLCBTdHJpbmcoaXNBY3RpdmUpKTsNCiAgICAgICAgICAgICAgICBpZiAoaW5kaWNhdG9yKSB7DQogICAgICAgICAgICAgICAgICBpbmRpY2F0b3IudGV4dENvbnRlbnQgPSBpc0FjdGl2ZSA/IChzb3J0Q29uZmlnLmRpcmVjdGlvbiA9PT0gImFzYyIgPyAi4payIiA6ICLilrwiKSA6ICIiOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBpZiAoaXNBY3RpdmUpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHREaXJlY3Rpb24gPSBzb3J0Q29uZmlnLmRpcmVjdGlvbiA9PT0gImFzYyIgPyAiZGVzY2VuZGluZyIgOiAiYXNjZW5kaW5nIjsNCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBgJHtsYWJlbH0gc29ydGVkICR7ZGlyZWN0aW9uTGFiZWx9LiBDbGljayB0byBzb3J0ICR7bmV4dERpcmVjdGlvbn0uYCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRlZmF1bHREaXJlY3Rpb24gPSBjb2x1bW4gPT09ICJuYW1lIiB8fCBjb2x1bW4gPT09ICJjcmVhdG9yVHlwZSIgPyAiYXNjZW5kaW5nIiA6ICJkZXNjZW5kaW5nIjsNCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtbGFiZWwiLCBgJHtsYWJlbH0uIENsaWNrIHRvIHNvcnQgJHtkZWZhdWx0RGlyZWN0aW9ufS5gKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoZG9tLmFnZW50VGFibGVCb2R5KSB7DQogICAgICAgICAgICAgIGNvbnN0IGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgICAgICAgICAgICB2aXNpYmxlUm93cy5mb3JFYWNoKGFnZW50ID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ciIpOw0KICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgICAgICAgICAgICBuYW1lQ2VsbC50ZXh0Q29udGVudCA9IGFnZW50Lm5hbWUgfHwgIlVubmFtZWQgYWdlbnQiOw0KICAgICAgICAgICAgICAgIHJvdy5hcHBlbmQobmFtZUNlbGwpOw0KICAgICAgDQogICAgICAgICAgICAgICAgY29uc3QgY3JlYXRvckNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICAgIGNyZWF0b3JDZWxsLnRleHRDb250ZW50ID0gYWdlbnQuY3JlYXRvclR5cGUgfHwgIlVuc3BlY2lmaWVkIjsNCiAgICAgICAgICAgICAgICByb3cuYXBwZW5kKGNyZWF0b3JDZWxsKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICAgIGFjdGl2ZUNlbGwuY2xhc3NOYW1lID0gImlzLW51bWVyaWMiOw0KICAgICAgICAgICAgICAgIGFjdGl2ZUNlbGwudGV4dENvbnRlbnQgPSBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KE1hdGgucm91bmQoYWdlbnQudG90YWxBY3RpdmUgfHwgMCkpOw0KICAgICAgICAgICAgICAgIHJvdy5hcHBlbmQoYWN0aXZlQ2VsbCk7DQogICAgICANCiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZXNDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGQiKTsNCiAgICAgICAgICAgICAgICByZXNwb25zZXNDZWxsLmNsYXNzTmFtZSA9ICJpcy1udW1lcmljIjsNCiAgICAgICAgICAgICAgICByZXNwb25zZXNDZWxsLnRleHRDb250ZW50ID0gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKGFnZW50LnJlc3BvbnNlcyB8fCAwKSk7DQogICAgICAgICAgICAgICAgcm93LmFwcGVuZChyZXNwb25zZXNDZWxsKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RBY3Rpdml0eUNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZCIpOw0KICAgICAgICAgICAgICAgIGlmIChhZ2VudC5sYXN0QWN0aXZpdHkgaW5zdGFuY2VvZiBEYXRlKSB7DQogICAgICAgICAgICAgICAgICBsYXN0QWN0aXZpdHlDZWxsLnRleHRDb250ZW50ID0gZm9ybWF0U2hvcnREYXRlKGFnZW50Lmxhc3RBY3Rpdml0eSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGxhc3RBY3Rpdml0eUNlbGwudGV4dENvbnRlbnQgPSAiLSI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJvdy5hcHBlbmQobGFzdEFjdGl2aXR5Q2VsbCk7DQogICAgICANCiAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmQocm93KTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGRvbS5hZ2VudFRhYmxlQm9keS5hcHBlbmQoZnJhZ21lbnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmV0dXJuaW5nU2VyaWVzKGFnZ3JlZ2F0ZXMsIGludGVydmFsKSB7DQogICAgICAgICAgICBjb25zdCBub3JtYWxpemVkSW50ZXJ2YWwgPSBpbnRlcnZhbCA9PT0gIm1vbnRobHkiID8gIm1vbnRobHkiIDogIndlZWtseSI7DQogICAgICAgICAgICBpZiAoIWFnZ3JlZ2F0ZXMpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLA0KICAgICAgICAgICAgICAgIHRvdGFsczogW10sDQogICAgICAgICAgICAgICAgcmV0dXJuaW5nQ291bnRzOiBbXSwNCiAgICAgICAgICAgICAgICB1bml0TGFiZWw6IG5vcm1hbGl6ZWRJbnRlcnZhbCA9PT0gIm1vbnRobHkiID8gIm1vbnRoIiA6ICJ3ZWVrIg0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG5vcm1hbGl6ZWRJbnRlcnZhbCA9PT0gIm1vbnRobHkiKSB7DQogICAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gQXJyYXkuaXNBcnJheShhZ2dyZWdhdGVzLndlZWtseVRpbWVsaW5lKSA/IGFnZ3JlZ2F0ZXMud2Vla2x5VGltZWxpbmUgOiBbXTsNCiAgICAgICAgICAgICAgaWYgKCF0aW1lbGluZS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgbGFiZWxzOiBbXSwNCiAgICAgICAgICAgICAgICAgIHRvdGFsczogW10sDQogICAgICAgICAgICAgICAgICByZXR1cm5pbmdDb3VudHM6IFtdLA0KICAgICAgICAgICAgICAgICAgdW5pdExhYmVsOiAibW9udGgiDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjb25zdCBtb250aE1hcCA9IG5ldyBNYXAoKTsNCiAgICAgICAgICAgICAgdGltZWxpbmUuZm9yRWFjaChlbnRyeSA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgZW50cnlEYXRlID0gZW50cnkgJiYgZW50cnkuZGF0ZSBpbnN0YW5jZW9mIERhdGUgPyBlbnRyeS5kYXRlIDogbnVsbDsNCiAgICAgICAgICAgICAgICBpZiAoIWVudHJ5RGF0ZSkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjb25zdCBtb250aEtleSA9IGAke2VudHJ5RGF0ZS5nZXRVVENGdWxsWWVhcigpfS0ke3BhZChlbnRyeURhdGUuZ2V0VVRDTW9udGgoKSArIDEpfWA7DQogICAgICAgICAgICAgICAgbGV0IGFjY3VtdWxhdG9yID0gbW9udGhNYXAuZ2V0KG1vbnRoS2V5KTsNCiAgICAgICAgICAgICAgICBpZiAoIWFjY3VtdWxhdG9yKSB7DQogICAgICAgICAgICAgICAgICBhY2N1bXVsYXRvciA9IHsNCiAgICAgICAgICAgICAgICAgICAga2V5OiBtb250aEtleSwNCiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IGZvcm1hdE1vbnRoWWVhcihlbnRyeURhdGUpLA0KICAgICAgICAgICAgICAgICAgICB1c2VyczogbmV3IFNldCgpDQogICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgICAgbW9udGhNYXAuc2V0KG1vbnRoS2V5LCBhY2N1bXVsYXRvcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJTZXQgPSBlbnRyeSAmJiBlbnRyeS51c2VycyBpbnN0YW5jZW9mIFNldCA/IGVudHJ5LnVzZXJzIDogbmV3IFNldCgpOw0KICAgICAgICAgICAgICAgIHVzZXJTZXQuZm9yRWFjaCh1c2VyID0+IGFjY3VtdWxhdG9yLnVzZXJzLmFkZCh1c2VyKSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBjb25zdCBtb250aHMgPSBBcnJheS5mcm9tKG1vbnRoTWFwLnZhbHVlcygpKS5zb3J0KChhLCBiKSA9PiBhLmtleS5sb2NhbGVDb21wYXJlKGIua2V5KSk7DQogICAgICAgICAgICAgIGNvbnN0IHRvdGFscyA9IG1vbnRocy5tYXAobW9udGggPT4gbW9udGgudXNlcnMuc2l6ZSk7DQogICAgICAgICAgICAgIGNvbnN0IHJldHVybmluZ0NvdW50cyA9IG1vbnRocy5tYXAoKG1vbnRoLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxldCByZXR1cm5pbmcgPSAwOw0KICAgICAgICAgICAgICAgIG1vbnRoLnVzZXJzLmZvckVhY2godXNlciA9PiB7DQogICAgICAgICAgICAgICAgICBpZiAobW9udGhzW2luZGV4IC0gMV0udXNlcnMuaGFzKHVzZXIpKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybmluZyArPSAxOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHJldHVybiByZXR1cm5pbmc7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgIGxhYmVsczogbW9udGhzLm1hcChtb250aCA9PiBtb250aC5sYWJlbCksDQogICAgICAgICAgICAgICAgdG90YWxzLA0KICAgICAgICAgICAgICAgIHJldHVybmluZ0NvdW50cywNCiAgICAgICAgICAgICAgICB1bml0TGFiZWw6ICJtb250aCINCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRpbWVsaW5lID0gQXJyYXkuaXNBcnJheShhZ2dyZWdhdGVzLndlZWtseVRpbWVsaW5lKSAmJiBhZ2dyZWdhdGVzLndlZWtseVRpbWVsaW5lLmxlbmd0aA0KICAgICAgICAgICAgICA/IGFnZ3JlZ2F0ZXMud2Vla2x5VGltZWxpbmUNCiAgICAgICAgICAgICAgOiAoQXJyYXkuaXNBcnJheShhZ2dyZWdhdGVzLnBlcmlvZHMpID8gYWdncmVnYXRlcy5wZXJpb2RzIDogW10pOw0KICAgICAgICAgICAgaWYgKCF0aW1lbGluZS5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLA0KICAgICAgICAgICAgICAgIHRvdGFsczogW10sDQogICAgICAgICAgICAgICAgcmV0dXJuaW5nQ291bnRzOiBbXSwNCiAgICAgICAgICAgICAgICB1bml0TGFiZWw6ICJ3ZWVrIg0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgd2Vla3MgPSB0aW1lbGluZS5tYXAoZW50cnkgPT4gew0KICAgICAgICAgICAgICBjb25zdCBkYXRlID0gZW50cnkgJiYgZW50cnkuZGF0ZSBpbnN0YW5jZW9mIERhdGUgPyBlbnRyeS5kYXRlIDogbnVsbDsNCiAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBlbnRyeSAmJiB0eXBlb2YgZW50cnkubGFiZWwgPT09ICJzdHJpbmciICYmIGVudHJ5LmxhYmVsLnRyaW0oKQ0KICAgICAgICAgICAgICAgID8gZW50cnkubGFiZWwNCiAgICAgICAgICAgICAgICA6IChkYXRlID8gZm9ybWF0U2hvcnREYXRlKGRhdGUpIDogIiIpOw0KICAgICAgICAgICAgICBjb25zdCB1c2VycyA9IGVudHJ5ICYmIGVudHJ5LnVzZXJzIGluc3RhbmNlb2YgU2V0ID8gZW50cnkudXNlcnMgOiBuZXcgU2V0KCk7DQogICAgICAgICAgICAgIHJldHVybiB7IGxhYmVsLCB1c2VycyB9Ow0KICAgICAgICAgICAgfSkuZmlsdGVyKGVudHJ5ID0+IGVudHJ5LmxhYmVsKTsNCiAgICAgICAgICAgIGNvbnN0IHRvdGFscyA9IHdlZWtzLm1hcCh3ZWVrID0+IHdlZWsudXNlcnMuc2l6ZSk7DQogICAgICAgICAgICBjb25zdCByZXR1cm5pbmdDb3VudHMgPSB3ZWVrcy5tYXAoKHdlZWssIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCByZXR1cm5pbmcgPSAwOw0KICAgICAgICAgICAgICB3ZWVrLnVzZXJzLmZvckVhY2godXNlciA9PiB7DQogICAgICAgICAgICAgICAgaWYgKHdlZWtzW2luZGV4IC0gMV0udXNlcnMuaGFzKHVzZXIpKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm5pbmcgKz0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuaW5nOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICBsYWJlbHM6IHdlZWtzLm1hcCh3ZWVrID0+IHdlZWsubGFiZWwpLA0KICAgICAgICAgICAgICB0b3RhbHMsDQogICAgICAgICAgICAgIHJldHVybmluZ0NvdW50cywNCiAgICAgICAgICAgICAgdW5pdExhYmVsOiAid2VlayINCiAgICAgICAgICAgIH07DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUmV0dXJuaW5nVXNlcnMoYWdncmVnYXRlcykgew0KICAgICAgICAgICAgY29uc3QgcmV0dXJuaW5nQ2hhcnQgPSBzdGF0ZS5jaGFydHMucmV0dXJuaW5nVXNlcnM7DQogICAgICAgICAgY29uc3QgbWV0cmljID0gc3RhdGUucmV0dXJuaW5nTWV0cmljIHx8ICJ0b3RhbCI7DQogICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCB8fCBERUZBVUxUX1JFVFVSTklOR19JTlRFUlZBTDsNCiAgICAgICAgICBjb25zdCBzZXJpZXMgPSBnZW5lcmF0ZVJldHVybmluZ1NlcmllcyhhZ2dyZWdhdGVzLCBpbnRlcnZhbCk7DQogICAgICAgICAgY29uc3QgaGFzRGF0YSA9IEJvb2xlYW4oc2VyaWVzLmxhYmVscy5sZW5ndGgpOw0KICAgICAgICAgIHNldEJ1dHRvbkVuYWJsZWQoZG9tLnJldHVybmluZ0V4cG9ydFBuZywgaGFzRGF0YSk7DQogICAgICAgICAgc2V0QnV0dG9uRW5hYmxlZChkb20ucmV0dXJuaW5nRXhwb3J0Q3N2LCBoYXNEYXRhKTsNCiAgICAgICAgICBpZiAoIWhhc0RhdGEpIHsNCiAgICAgICAgICAgICAgaWYgKGRvbS5yZXR1cm5pbmdDYXB0aW9uKSB7DQogICAgICAgICAgICAgICAgZG9tLnJldHVybmluZ0NhcHRpb24udGV4dENvbnRlbnQgPSAiVXBsb2FkIGRhdGEgdG8gbW9uaXRvciByZWN1cnJpbmcgYWRvcHRpb24uIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoZG9tLnJldHVybmluZ1N1bW1hcnkpIHsNCiAgICAgICAgICAgICAgICBkb20ucmV0dXJuaW5nU3VtbWFyeS50ZXh0Q29udGVudCA9ICItIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoZG9tLnJldHVybmluZ0VtcHR5KSB7DQogICAgICAgICAgICAgICAgZG9tLnJldHVybmluZ0VtcHR5LmhpZGRlbiA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdFbXB0eS50ZXh0Q29udGVudCA9IGludGVydmFsID09PSAibW9udGhseSINCiAgICAgICAgICAgICAgICAgID8gIlVwbG9hZCBkYXRhIHRvIHZpZXcgcmV0dXJuaW5nIHVzZXJzIG1vbnRoIG92ZXIgbW9udGguIg0KICAgICAgICAgICAgICAgICAgOiAiVXBsb2FkIGRhdGEgdG8gdmlldyByZXR1cm5pbmcgdXNlcnMgd2VlayBvdmVyIHdlZWsuIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAocmV0dXJuaW5nQ2hhcnQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm5pbmdDaGFydC5kYXRhLmxhYmVscyA9IFtdOw0KICAgICAgICAgICAgICAgIGlmIChyZXR1cm5pbmdDaGFydC5kYXRhLmRhdGFzZXRzWzBdKSB7DQogICAgICAgICAgICAgICAgICByZXR1cm5pbmdDaGFydC5kYXRhLmRhdGFzZXRzWzBdLmRhdGEgPSBbXTsNCiAgICAgICAgICAgICAgICAgIHJldHVybmluZ0NoYXJ0LmRhdGEuZGF0YXNldHNbMF0ubGFiZWwgPSAiUmV0dXJuaW5nIHVzZXJzIjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuaW5nQ2hhcnQudXBkYXRlKCJub25lIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBjb25zdCB1bml0TGFiZWwgPSBzZXJpZXMudW5pdExhYmVsIHx8IChpbnRlcnZhbCA9PT0gIm1vbnRobHkiID8gIm1vbnRoIiA6ICJ3ZWVrIik7DQogICAgICAgICAgICBjb25zdCBsYWJlbHMgPSBzZXJpZXMubGFiZWxzOw0KICAgICAgICAgICAgY29uc3QgdG90YWxzID0gc2VyaWVzLnRvdGFsczsNCiAgICAgICAgICAgIGNvbnN0IHJldHVybmluZ0NvdW50cyA9IHNlcmllcy5yZXR1cm5pbmdDb3VudHM7DQogICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlcyA9IHJldHVybmluZ0NvdW50cy5tYXAoKHZhbHVlLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICBjb25zdCB0b3RhbCA9IHRvdGFsc1tpbmRleF0gfHwgMDsNCiAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsID8gKHZhbHVlIC8gdG90YWwpICogMTAwIDogMDsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgY29uc3QgZGF0YXNldFZhbHVlcyA9IG1ldHJpYyA9PT0gInBlcmNlbnRhZ2UiID8gcGVyY2VudGFnZXMgOiByZXR1cm5pbmdDb3VudHM7DQogICAgICAgICAgICBjb25zdCBkYXRhc2V0TGFiZWwgPSBtZXRyaWMgPT09ICJwZXJjZW50YWdlIiA/ICJSZXR1cm5pbmcgdXNlcnMgKCUpIiA6ICJSZXR1cm5pbmcgdXNlcnMiOw0KICAgICAgICAgICAgY29uc3QgaGFzUmV0dXJuaW5nVmFsdWVzID0gZGF0YXNldFZhbHVlcy5zb21lKHZhbHVlID0+IE51bWJlci5pc0Zpbml0ZSh2YWx1ZSkgJiYgdmFsdWUgPiAwKTsNCiAgICAgICAgICAgIGlmIChyZXR1cm5pbmdDaGFydCkgew0KICAgICAgICAgICAgICBjb25zdCBsaW5lQ29sb3IgPSBnZXRDc3NWYXJpYWJsZVZhbHVlKCItLWJsdWUtNTAwIiwgIiMzQTg0QzEiKTsNCiAgICAgICAgICAgICAgY29uc3QgZmlsbENvbG9yID0gaGV4VG9SZ2JhKGNvbG9yU3RyaW5nVG9IZXgobGluZUNvbG9yKSB8fCAiIzNBODRDMSIsIDAuMTUpIHx8ICJyZ2JhKDU4LCAxMzIsIDE5MywgMC4xNSkiOw0KICAgICAgICAgICAgICByZXR1cm5pbmdDaGFydC5kYXRhLmxhYmVscyA9IGxhYmVsczsNCiAgICAgICAgICAgICAgY29uc3QgZGF0YXNldCA9IHJldHVybmluZ0NoYXJ0LmRhdGEuZGF0YXNldHNbMF07DQogICAgICAgICAgICAgIGlmIChkYXRhc2V0KSB7DQogICAgICAgICAgICAgICAgZGF0YXNldC5sYWJlbCA9IGRhdGFzZXRMYWJlbDsNCiAgICAgICAgICAgICAgICBkYXRhc2V0LmRhdGEgPSBkYXRhc2V0VmFsdWVzOw0KICAgICAgICAgICAgICAgIGRhdGFzZXQuYm9yZGVyQ29sb3IgPSBsaW5lQ29sb3I7DQogICAgICAgICAgICAgICAgZGF0YXNldC5iYWNrZ3JvdW5kQ29sb3IgPSBmaWxsQ29sb3I7DQogICAgICAgICAgICAgICAgZGF0YXNldC5maWxsID0gbWV0cmljID09PSAicGVyY2VudGFnZSI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuaW5nQ2hhcnQudXBkYXRlKCJub25lIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLnJldHVybmluZ0VtcHR5KSB7DQogICAgICAgICAgICAgIGRvbS5yZXR1cm5pbmdFbXB0eS5oaWRkZW4gPSBoYXNSZXR1cm5pbmdWYWx1ZXM7DQogICAgICAgICAgICAgIGlmICghaGFzUmV0dXJuaW5nVmFsdWVzKSB7DQogICAgICAgICAgICAgICAgZG9tLnJldHVybmluZ0VtcHR5LnRleHRDb250ZW50ID0gaW50ZXJ2YWwgPT09ICJtb250aGx5Ig0KICAgICAgICAgICAgICAgICAgPyAiTm8gcmV0dXJuaW5nIHVzZXJzIGRldGVjdGVkIGZvciBjb25zZWN1dGl2ZSBtb250aHMgeWV0LiINCiAgICAgICAgICAgICAgICAgIDogIk5vIHJldHVybmluZyB1c2VycyBkZXRlY3RlZCBmb3IgY29uc2VjdXRpdmUgd2Vla3MgeWV0LiI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20ucmV0dXJuaW5nQ2FwdGlvbikgew0KICAgICAgICAgICAgICBkb20ucmV0dXJuaW5nQ2FwdGlvbi50ZXh0Q29udGVudCA9IGhhc1JldHVybmluZ1ZhbHVlcw0KICAgICAgICAgICAgICAgID8gKGludGVydmFsID09PSAibW9udGhseSINCiAgICAgICAgICAgICAgICAgID8gIldoaWNoIGNvaG9ydHMgcmV0dXJuIHRvIENvcGlsb3QgbW9udGggb3ZlciBtb250aD8iDQogICAgICAgICAgICAgICAgICA6ICJXaGljaCBjb2hvcnRzIHJldHVybiB0byBDb3BpbG90IHdlZWsgb3ZlciB3ZWVrPyIpDQogICAgICAgICAgICAgICAgOiBgUmV0dXJuaW5nIHVzZXJzIGFwcGVhciBvbmNlIHRoZSBzYW1lIHBlb3BsZSBhcmUgYWN0aXZlIGluIGNvbnNlY3V0aXZlICR7dW5pdExhYmVsfXMuYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20ucmV0dXJuaW5nU3VtbWFyeSkgew0KICAgICAgICAgICAgICBjb25zdCBsYXN0SW5kZXggPSBkYXRhc2V0VmFsdWVzLmxlbmd0aCAtIDE7DQogICAgICAgICAgICAgIGlmIChsYXN0SW5kZXggPj0gMCkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGxhdGVzdExhYmVsID0gbGFiZWxzW2xhc3RJbmRleF07DQogICAgICAgICAgICAgICAgY29uc3QgbGF0ZXN0UmV0dXJuaW5nID0gcmV0dXJuaW5nQ291bnRzW2xhc3RJbmRleF0gfHwgMDsNCiAgICAgICAgICAgICAgICBjb25zdCBsYXRlc3RUb3RhbCA9IHRvdGFsc1tsYXN0SW5kZXhdIHx8IDA7DQogICAgICAgICAgICAgICAgY29uc3QgbGF0ZXN0UGVyY2VudGFnZSA9IHBlcmNlbnRhZ2VzW2xhc3RJbmRleF0gfHwgMDsNCiAgICAgICAgICAgICAgICBpZiAoaGFzUmV0dXJuaW5nVmFsdWVzKSB7DQogICAgICAgICAgICAgICAgICBkb20ucmV0dXJuaW5nU3VtbWFyeS50ZXh0Q29udGVudCA9IGAke2xhdGVzdExhYmVsfTogJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KGxhdGVzdFJldHVybmluZyl9IHJldHVybmluZyBvZiAke251bWJlckZvcm1hdHRlci5mb3JtYXQobGF0ZXN0VG90YWwpfSBhY3RpdmUgKCR7bGF0ZXN0UGVyY2VudGFnZS50b0ZpeGVkKDEpfSUpYDsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgZG9tLnJldHVybmluZ1N1bW1hcnkudGV4dENvbnRlbnQgPSBgJHtsYXRlc3RMYWJlbH06IDAgcmV0dXJuaW5nIG9mICR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChsYXRlc3RUb3RhbCl9IGFjdGl2ZSAoMC4wJSlgOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkb20ucmV0dXJuaW5nU3VtbWFyeS50ZXh0Q29udGVudCA9ICItIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBleHBvcnRSZXR1cm5pbmdVc2Vyc0ltYWdlKCkgew0KICAgICAgICAgIGNvbnN0IGNoYXJ0ID0gc3RhdGUuY2hhcnRzLnJldHVybmluZ1VzZXJzOw0KICAgICAgICAgIGlmICghY2hhcnQpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzdGF0ZS5yZXR1cm5pbmdJbnRlcnZhbCB8fCBERUZBVUxUX1JFVFVSTklOR19JTlRFUlZBTDsNCiAgICAgICAgICBkb3dubG9hZENoYXJ0SW1hZ2UoY2hhcnQsIGBjb3BpbG90LXJldHVybmluZy0ke2ludGVydmFsfS5wbmdgKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGV4cG9ydFJldHVybmluZ1VzZXJzQ3N2KCkgew0KICAgICAgICAgIGlmICghc3RhdGUubGF0ZXN0UmV0dXJuaW5nQWdncmVnYXRlcykgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHN0YXRlLnJldHVybmluZ0ludGVydmFsIHx8IERFRkFVTFRfUkVUVVJOSU5HX0lOVEVSVkFMOw0KICAgICAgICAgIGNvbnN0IHNlcmllcyA9IGdlbmVyYXRlUmV0dXJuaW5nU2VyaWVzKHN0YXRlLmxhdGVzdFJldHVybmluZ0FnZ3JlZ2F0ZXMsIGludGVydmFsKTsNCiAgICAgICAgICBpZiAoIXNlcmllcyB8fCAhQXJyYXkuaXNBcnJheShzZXJpZXMubGFiZWxzKSB8fCAhc2VyaWVzLmxhYmVscy5sZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgY29uc3Qgcm93cyA9IHNlcmllcy5sYWJlbHMubWFwKChsYWJlbCwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgIGNvbnN0IHJldHVybmluZyA9IE51bWJlci5pc0Zpbml0ZShzZXJpZXMucmV0dXJuaW5nQ291bnRzW2luZGV4XSkgPyBzZXJpZXMucmV0dXJuaW5nQ291bnRzW2luZGV4XSA6IDA7DQogICAgICAgICAgICBjb25zdCB0b3RhbCA9IE51bWJlci5pc0Zpbml0ZShzZXJpZXMudG90YWxzW2luZGV4XSkgPyBzZXJpZXMudG90YWxzW2luZGV4XSA6IDA7DQogICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gdG90YWwgPyAocmV0dXJuaW5nIC8gdG90YWwpICogMTAwIDogMDsNCiAgICAgICAgICAgIHJldHVybiBbDQogICAgICAgICAgICAgIGxhYmVsLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKHJldHVybmluZyksDQogICAgICAgICAgICAgIE1hdGgucm91bmQodG90YWwpLA0KICAgICAgICAgICAgICBgJHtwZXJjZW50YWdlLnRvRml4ZWQoMSl9JWANCiAgICAgICAgICAgIF07DQogICAgICAgICAgfSk7DQogICAgICAgICAgZG93bmxvYWRDc3YoDQogICAgICAgICAgICBgY29waWxvdC1yZXR1cm5pbmctJHtpbnRlcnZhbH0uY3N2YCwNCiAgICAgICAgICAgIFsiUGVyaW9kIiwgIlJldHVybmluZyB1c2VycyIsICJBY3RpdmUgdXNlcnMiLCAiUmV0dXJuaW5nICUiXSwNCiAgICAgICAgICAgIHJvd3MNCiAgICAgICAgICApOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0VXNhZ2VUcmVuZEltYWdlKCkgew0KICAgICAgICAgIGNvbnN0IGNoYXJ0ID0gc3RhdGUuY2hhcnRzLnVzYWdlVHJlbmQ7DQogICAgICAgICAgaWYgKCFjaGFydCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCBtb2RlID0gc3RhdGUudXNhZ2VUcmVuZE1vZGUgPT09ICJwZXJjZW50YWdlIiA/ICJwZXJjZW50YWdlIiA6ICJudW1iZXIiOw0KICAgICAgICAgIGRvd25sb2FkQ2hhcnRJbWFnZShjaGFydCwgYGNvcGlsb3QtdXNhZ2UtdHJlbmQtJHttb2RlfS5wbmdgKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGV4cG9ydFVzYWdlVHJlbmRDc3YoKSB7DQogICAgICAgICAgY29uc3Qgcm93cyA9IEFycmF5LmlzQXJyYXkoc3RhdGUubGF0ZXN0VXNhZ2VUcmVuZFJvd3MpID8gc3RhdGUubGF0ZXN0VXNhZ2VUcmVuZFJvd3MgOiBbXTsNCiAgICAgICAgICBpZiAoIXJvd3MubGVuZ3RoKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IGNzdlJvd3MgPSByb3dzLm1hcChyb3cgPT4gew0KICAgICAgICAgICAgY29uc3QgZnJlcXVlbnRTaGFyZSA9IE51bWJlci5pc0Zpbml0ZShyb3cuZnJlcXVlbnRTaGFyZSkgPyBgJHtyb3cuZnJlcXVlbnRTaGFyZS50b0ZpeGVkKDEpfSVgIDogIiI7DQogICAgICAgICAgICBjb25zdCBjb25zaXN0ZW50U2hhcmUgPSBOdW1iZXIuaXNGaW5pdGUocm93LmNvbnNpc3RlbnRTaGFyZSkgPyBgJHtyb3cuY29uc2lzdGVudFNoYXJlLnRvRml4ZWQoMSl9JWAgOiAiIjsNCiAgICAgICAgICAgIHJldHVybiBbDQogICAgICAgICAgICAgIHJvdy5sYWJlbCB8fCByb3cua2V5IHx8ICIiLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKE51bWJlci5pc0Zpbml0ZShyb3cuZnJlcXVlbnRVc2VycykgPyByb3cuZnJlcXVlbnRVc2VycyA6IDApLA0KICAgICAgICAgICAgICBmcmVxdWVudFNoYXJlLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKE51bWJlci5pc0Zpbml0ZShyb3cuY29uc2lzdGVudFVzZXJzKSA/IHJvdy5jb25zaXN0ZW50VXNlcnMgOiAwKSwNCiAgICAgICAgICAgICAgY29uc2lzdGVudFNoYXJlLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKE51bWJlci5pc0Zpbml0ZShyb3cudG90YWxVc2VycykgPyByb3cudG90YWxVc2VycyA6IDApDQogICAgICAgICAgICBdOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGRvd25sb2FkQ3N2KA0KICAgICAgICAgICAgYGNvcGlsb3QtdXNhZ2UtdHJlbmQtJHtzdGF0ZS51c2FnZVRyZW5kTW9kZSA9PT0gInBlcmNlbnRhZ2UiID8gInBlcmNlbnRhZ2UiIDogIm51bWJlciJ9LmNzdmAsDQogICAgICAgICAgICBbIlBlcmlvZCIsICJGcmVxdWVudCB1c2VycyIsICJGcmVxdWVudCAlIiwgIkNvbnNpc3RlbnQgdXNlcnMiLCAiQ29uc2lzdGVudCAlIiwgIlRvdGFsIGFjdGl2ZSB1c2VycyJdLA0KICAgICAgICAgICAgY3N2Um93cw0KICAgICAgICAgICk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBleHBvcnRVc2FnZUludGVuc2l0eUNzdigpIHsNCiAgICAgICAgICBjb25zdCByb3dzID0gY29sbGVjdFVzYWdlSW50ZW5zaXR5Um93cygpOw0KICAgICAgICAgIGlmICghcm93cy5sZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgY29uc3QgY3N2Um93cyA9IHJvd3MubWFwKHJvdyA9PiB7DQogICAgICAgICAgICBjb25zdCBmcmVxdWVudFNoYXJlID0gTnVtYmVyLmlzRmluaXRlKHJvdy5mcmVxdWVudFNoYXJlKSA/IGAke3Jvdy5mcmVxdWVudFNoYXJlLnRvRml4ZWQoMSl9JWAgOiAiIjsNCiAgICAgICAgICAgIGNvbnN0IGNvbnNpc3RlbnRTaGFyZSA9IE51bWJlci5pc0Zpbml0ZShyb3cuY29uc2lzdGVudFNoYXJlKSA/IGAke3Jvdy5jb25zaXN0ZW50U2hhcmUudG9GaXhlZCgxKX0lYCA6ICIiOw0KICAgICAgICAgICAgcmV0dXJuIFsNCiAgICAgICAgICAgICAgcm93LmxhYmVsLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKHJvdy50b3RhbFVzZXJzIHx8IDApLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKHJvdy5mcmVxdWVudFVzZXJzIHx8IDApLA0KICAgICAgICAgICAgICBmcmVxdWVudFNoYXJlLA0KICAgICAgICAgICAgICBNYXRoLnJvdW5kKHJvdy5jb25zaXN0ZW50VXNlcnMgfHwgMCksDQogICAgICAgICAgICAgIGNvbnNpc3RlbnRTaGFyZSwNCiAgICAgICAgICAgICAgcm93LnJhbmdlIHx8ICIiDQogICAgICAgICAgICBdOw0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGRvd25sb2FkQ3N2KA0KICAgICAgICAgICAgImNvcGlsb3QtdXNhZ2UtaW50ZW5zaXR5LmNzdiIsDQogICAgICAgICAgICBbIlBlcmlvZCIsICJUb3RhbCBhY3RpdmUgdXNlcnMiLCAiRnJlcXVlbnQgdXNlcnMiLCAiRnJlcXVlbnQgJSIsICJDb25zaXN0ZW50IHVzZXJzIiwgIkNvbnNpc3RlbnQgJSIsICJPYnNlcnZlZCByYW5nZSJdLA0KICAgICAgICAgICAgY3N2Um93cw0KICAgICAgICAgICk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBleHBvcnRBZG9wdGlvbkNzdigpIHsNCiAgICAgICAgICBjb25zdCBhZG9wdGlvbiA9IHN0YXRlLmxhdGVzdEFkb3B0aW9uOw0KICAgICAgICAgIGNvbnN0IGFwcHMgPSBhZG9wdGlvbiAmJiBBcnJheS5pc0FycmF5KGFkb3B0aW9uLmFwcHMpID8gYWRvcHRpb24uYXBwcyA6IFtdOw0KICAgICAgICAgIGlmICghYXBwcy5sZW5ndGgpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgICAgY29uc3Qgcm93cyA9IFtdOw0KICAgICAgICAgIGFwcHMuZm9yRWFjaChhcHAgPT4gew0KICAgICAgICAgICAgY29uc3QgYXBwTGFiZWwgPSBhcHAubGFiZWwgfHwgYXBwLmtleSB8fCAiVW5uYW1lZCBhcHAiOw0KICAgICAgICAgICAgY29uc3QgYXBwVXNlcnMgPSBOdW1iZXIuaXNGaW5pdGUoYXBwLnVzZXJzKSA/IGFwcC51c2VycyA6IDA7DQogICAgICAgICAgICBjb25zdCBhcHBTaGFyZVZhbHVlID0gTnVtYmVyLmlzRmluaXRlKGFwcC5zaGFyZSkgPyBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIGFwcC5zaGFyZSkpIDogMDsNCiAgICAgICAgICAgIHJvd3MucHVzaChbDQogICAgICAgICAgICAgICJBcHAiLA0KICAgICAgICAgICAgICBhcHBMYWJlbCwNCiAgICAgICAgICAgICAgIiIsDQogICAgICAgICAgICAgIE1hdGgucm91bmQoYXBwVXNlcnMpLA0KICAgICAgICAgICAgICBgJHthcHBTaGFyZVZhbHVlLnRvRml4ZWQoMSl9JWANCiAgICAgICAgICAgIF0pOw0KICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXBwLmZlYXR1cmVzKSkgew0KICAgICAgICAgICAgICBhcHAuZmVhdHVyZXMuZm9yRWFjaChmZWF0dXJlID0+IHsNCiAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlTGFiZWwgPSBmZWF0dXJlLmxhYmVsIHx8IGZlYXR1cmUua2V5IHx8ICJDYXBhYmlsaXR5IjsNCiAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlVXNlcnMgPSBOdW1iZXIuaXNGaW5pdGUoZmVhdHVyZS51c2VycykgPyBmZWF0dXJlLnVzZXJzIDogMDsNCiAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlU2hhcmVWYWx1ZSA9IE51bWJlci5pc0Zpbml0ZShmZWF0dXJlLnNoYXJlKSA/IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgZmVhdHVyZS5zaGFyZSkpIDogMDsNCiAgICAgICAgICAgICAgICByb3dzLnB1c2goWw0KICAgICAgICAgICAgICAgICAgIkNhcGFiaWxpdHkiLA0KICAgICAgICAgICAgICAgICAgZmVhdHVyZUxhYmVsLA0KICAgICAgICAgICAgICAgICAgYXBwTGFiZWwsDQogICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGZlYXR1cmVVc2VycyksDQogICAgICAgICAgICAgICAgICBgJHtmZWF0dXJlU2hhcmVWYWx1ZS50b0ZpeGVkKDEpfSVgDQogICAgICAgICAgICAgICAgXSk7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGRvd25sb2FkQ3N2KA0KICAgICAgICAgICAgImNvcGlsb3QtYWRvcHRpb24tYnktYXBwLmNzdiIsDQogICAgICAgICAgICBbIlR5cGUiLCAiTmFtZSIsICJQYXJlbnQgYXBwIiwgIkFjdGl2ZSB1c2VycyIsICIlIG9mIGFjdGl2ZSB1c2VycyJdLA0KICAgICAgICAgICAgcm93cw0KICAgICAgICAgICk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBib290c3RyYXBFbWJlZGRlZFNuYXBzaG90KG9wdGlvbnMpIHsNCiAgICAgICAgICBpZiAoIW9wdGlvbnMgfHwgdHlwZW9mIG9wdGlvbnMgIT09ICJvYmplY3QiKSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IHNuYXBzaG90ID0gdHlwZW9mIG9wdGlvbnMuc25hcHNob3QgPT09ICJzdHJpbmciID8gb3B0aW9ucy5zbmFwc2hvdC50cmltKCkgOiAiIjsNCiAgICAgICAgICBpZiAoIXNuYXBzaG90KSB7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvbnN0IHByb21wdE1lc3NhZ2UgPSBvcHRpb25zLm1lc3NhZ2UgfHwgIkVudGVyIHRoZSBzaGFyZWQgcGFzc3dvcmQgdG8gdW5sb2NrIHRoaXMgZGFzaGJvYXJkLiI7DQogICAgICAgICAgaWYgKGRvbS5kYXRhc2V0TWVzc2FnZSkgew0KICAgICAgICAgICAgZG9tLmRhdGFzZXRNZXNzYWdlLnRleHRDb250ZW50ID0gcHJvbXB0TWVzc2FnZTsNCiAgICAgICAgICB9DQogICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gew0KICAgICAgICAgICAgaWYgKCFkb20uc25hcHNob3RJbXBvcnREaWFsb2cgfHwgdHlwZW9mIGRvbS5zbmFwc2hvdEltcG9ydERpYWxvZy5zaG93TW9kYWwgIT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJTbmFwc2hvdCBpbXBvcnQgZGlhbG9nIGlzIHVuYXZhaWxhYmxlIGZvciBlbWJlZGRlZCBleHBvcnRzLiIpOw0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXNldFNuYXBzaG90SW1wb3J0RGlhbG9nKCk7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBkb20uc25hcHNob3RJbXBvcnREaWFsb2cuc2hvd01vZGFsKCk7DQogICAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRUZXh0KSB7DQogICAgICAgICAgICAgICAgZG9tLnNuYXBzaG90SW1wb3J0VGV4dC52YWx1ZSA9IHNuYXBzaG90Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChkb20uc25hcHNob3RJbXBvcnRQYXNzd29yZCkgew0KICAgICAgICAgICAgICAgIGRvbS5zbmFwc2hvdEltcG9ydFBhc3N3b3JkLmZvY3VzKCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGRvbS5zbmFwc2hvdEltcG9ydEVycm9yKSB7DQogICAgICAgICAgICAgICAgc2V0U25hcHNob3ROb3RpY2UoZG9tLnNuYXBzaG90SW1wb3J0RXJyb3IsIHByb21wdE1lc3NhZ2UsICJpbmZvIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgIGNvbnNvbGUud2FybigiVW5hYmxlIHRvIG9wZW4gc25hcHNob3QgaW1wb3J0IGRpYWxvZyIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9LCAxMjApOw0KICAgICAgICB9DQoNCiAgICAgICAgbGV0IGV4cG9ydEhpbnRUaW1lb3V0ID0gbnVsbDsNCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUV4cG9ydE1lbnUoKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5leHBvcnRNZW51IHx8ICFkb20uZXhwb3J0VHJpZ2dlcikgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBzaG91bGRPcGVuID0gZG9tLmV4cG9ydE1lbnUuaGlkZGVuOw0KICAgICAgICAgICAgZG9tLmV4cG9ydE1lbnUuaGlkZGVuID0gIXNob3VsZE9wZW47DQogICAgICAgICAgICBkb20uZXhwb3J0VHJpZ2dlci5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCBTdHJpbmcoc2hvdWxkT3BlbikpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlRXhwb3J0TWVudSgpIHsNCiAgICAgICAgICAgIGlmICghZG9tLmV4cG9ydE1lbnUgfHwgIWRvbS5leHBvcnRUcmlnZ2VyKSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRvbS5leHBvcnRNZW51LmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICBkb20uZXhwb3J0VHJpZ2dlci5zZXRBdHRyaWJ1dGUoImFyaWEtZXhwYW5kZWQiLCAiZmFsc2UiKTsNCiAgICAgICAgICAgIGlmIChleHBvcnRIaW50VGltZW91dCkgew0KICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoZXhwb3J0SGludFRpbWVvdXQpOw0KICAgICAgICAgICAgICBleHBvcnRIaW50VGltZW91dCA9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZG9tLmV4cG9ydEhpbnQpIHsNCiAgICAgICAgICAgICAgZG9tLmV4cG9ydEhpbnQuaGlkZGVuID0gdHJ1ZTsNCiAgICAgICAgICAgICAgZG9tLmV4cG9ydEhpbnQudGV4dENvbnRlbnQgPSAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzaG93RXhwb3J0SGludChtZXNzYWdlLCBpc0Vycm9yKSB7DQogICAgICAgICAgICBpZiAoIWRvbS5leHBvcnRIaW50KSB7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChkb20uZXhwb3J0TWVudSAmJiBkb20uZXhwb3J0VHJpZ2dlciAmJiBkb20uZXhwb3J0TWVudS5oaWRkZW4pIHsNCiAgICAgICAgICAgICAgZG9tLmV4cG9ydE1lbnUuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICAgIGRvbS5leHBvcnRUcmlnZ2VyLnNldEF0dHJpYnV0ZSgiYXJpYS1leHBhbmRlZCIsICJ0cnVlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBkb20uZXhwb3J0SGludC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7DQogICAgICAgICAgICBkb20uZXhwb3J0SGludC5zdHlsZS5jb2xvciA9IGlzRXJyb3IgPyAidmFyKC0tYmx1ZS01MDApIiA6ICJ2YXIoLS1ncmV5LTUwMCkiOw0KICAgICAgICAgICAgZG9tLmV4cG9ydEhpbnQuaGlkZGVuID0gZmFsc2U7DQogICAgICAgICAgICBpZiAoZXhwb3J0SGludFRpbWVvdXQpIHsNCiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGV4cG9ydEhpbnRUaW1lb3V0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGV4cG9ydEhpbnRUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICAgIGlmIChkb20uZXhwb3J0SGludCkgew0KICAgICAgICAgICAgICAgIGRvbS5leHBvcnRIaW50LmhpZGRlbiA9IHRydWU7DQogICAgICAgICAgICAgICAgZG9tLmV4cG9ydEhpbnQudGV4dENvbnRlbnQgPSAiIjsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBjbG9zZUV4cG9ydE1lbnUoKTsNCiAgICAgICAgICAgIH0sIDYwMDApOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIHdhaXRGb3JOZXh0RnJhbWUoKSB7DQogICAgICANCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiByZXNvbHZlKCkpKTsNCiAgICAgIA0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgDQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIaWRkZW5UcmVuZENoYXJ0KGRldGFpbE1vZGUsIHNjYWxlID0gMikgew0KICAgICAgDQogICAgICAgICAgICBjb25zdCBiYXNlQ2hhcnQgPSBzdGF0ZS5jaGFydHMudHJlbmQ7DQogICAgICANCiAgICAgICAgICAgIGlmICghYmFzZUNoYXJ0KSB7DQogICAgICANCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUcmVuZCBjaGFydCBpcyBub3QgcmVhZHkuIik7DQogICAgICANCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgY29uc3QgcGVyaW9kcyA9IEFycmF5LmlzQXJyYXkoc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzKSA/IHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA6IFtdOw0KICAgICAgDQogICAgICAgICAgICBpZiAoIXBlcmlvZHMubGVuZ3RoKSB7DQogICAgICANCiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyB0cmVuZCBkYXRhIGF2YWlsYWJsZSBmb3IgZXhwb3J0LiIpOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGxhYmVscyA9IHBlcmlvZHMubWFwKGl0ZW0gPT4gaXRlbS5sYWJlbCk7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IG1ldHJpYyA9IHN0YXRlLmZpbHRlcnMubWV0cmljOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCBkYXRhc2V0cyA9IGJ1aWxkVHJlbmREYXRhc2V0cyhwZXJpb2RzLCBtZXRyaWMsIGRldGFpbE1vZGUpOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCBvcHRpb25zID0gY3JlYXRlVHJlbmRDaGFydE9wdGlvbnMoKTsNCiAgICAgIA0KICAgICAgICAgICAgb3B0aW9ucy5hbmltYXRpb24gPSBmYWxzZTsNCiAgICAgIA0KICAgICAgICAgICAgb3B0aW9ucy5yZXNwb25zaXZlID0gZmFsc2U7DQogICAgICANCiAgICAgICAgICAgIG9wdGlvbnMubWFpbnRhaW5Bc3BlY3RSYXRpbyA9IGZhbHNlOw0KICAgICAgDQogICAgICAgICAgICBpZiAob3B0aW9ucy5wbHVnaW5zICYmIG9wdGlvbnMucGx1Z2lucy50b29sdGlwKSB7DQogICAgICANCiAgICAgICAgICAgICAgb3B0aW9ucy5wbHVnaW5zLnRvb2x0aXAuZW5hYmxlZCA9IGZhbHNlOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGJhc2VXaWR0aCA9IGJhc2VDaGFydC53aWR0aCB8fCBiYXNlQ2hhcnQuY2FudmFzPy5jbGllbnRXaWR0aCB8fCA4MDA7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGJhc2VIZWlnaHQgPSBiYXNlQ2hhcnQuaGVpZ2h0IHx8IGJhc2VDaGFydC5jYW52YXM/LmNsaWVudEhlaWdodCB8fCA0ODA7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHRhcmdldFdpZHRoID0gTWF0aC5tYXgoTWF0aC5yb3VuZChiYXNlV2lkdGggKiBzY2FsZSksIDIpOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCB0YXJnZXRIZWlnaHQgPSBNYXRoLm1heChNYXRoLnJvdW5kKGJhc2VIZWlnaHQgKiBzY2FsZSksIDIpOw0KICAgICAgDQogICAgICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJjYW52YXMiKTsNCiAgICAgIA0KICAgICAgICAgICAgY2FudmFzLndpZHRoID0gdGFyZ2V0V2lkdGg7DQogICAgICANCiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB0YXJnZXRIZWlnaHQ7DQogICAgICANCiAgICAgICAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IGAke2Jhc2VXaWR0aH1weGA7DQogICAgICANCiAgICAgICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBgJHtiYXNlSGVpZ2h0fXB4YDsNCiAgICAgIA0KICAgICAgICAgICAgY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIjsNCiAgICAgIA0KICAgICAgICAgICAgY2FudmFzLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAibm9uZSI7DQogICAgICANCiAgICAgICAgICAgIGNhbnZhcy5zdHlsZS5vcGFjaXR5ID0gIjAiOw0KICAgICAgDQogICAgICAgICAgICBjYW52YXMuc3R5bGUubGVmdCA9ICItOTk5OXB4IjsNCiAgICAgIA0KICAgICAgICAgICAgY2FudmFzLnN0eWxlLnRvcCA9ICItOTk5OXB4IjsNCiAgICAgIA0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoY2FudmFzKTsNCiAgICAgIA0KICAgICAgICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOw0KICAgICAgDQogICAgICAgICAgICBjb250ZXh0LmltYWdlU21vb3RoaW5nUXVhbGl0eSA9ICJoaWdoIjsNCiAgICAgIA0KICAgICAgICAgICAgY29uc3QgZXhwb3J0Q2hhcnQgPSBuZXcgQ2hhcnQoY29udGV4dCwgew0KICAgICAgDQogICAgICAgICAgICAgIHR5cGU6ICJsaW5lIiwNCiAgICAgIA0KICAgICAgICAgICAgICBkYXRhOiB7DQogICAgICANCiAgICAgICAgICAgICAgICBsYWJlbHMsDQogICAgICANCiAgICAgICAgICAgICAgICBkYXRhc2V0cw0KICAgICAgDQogICAgICAgICAgICAgIH0sDQogICAgICANCiAgICAgICAgICAgICAgb3B0aW9ucw0KICAgICAgDQogICAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgICAgZXhwb3J0Q2hhcnQub3B0aW9ucy5kZXZpY2VQaXhlbFJhdGlvID0gKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDEpICogc2NhbGU7DQogICAgICANCiAgICAgICAgICAgIGV4cG9ydENoYXJ0LnJlc2l6ZSh0YXJnZXRXaWR0aCwgdGFyZ2V0SGVpZ2h0KTsNCiAgICAgIA0KICAgICAgICAgICAgZXhwb3J0Q2hhcnQudXBkYXRlKCk7DQogICAgICANCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICANCiAgICAgICAgICAgICAgY2FudmFzLA0KICAgICAgDQogICAgICAgICAgICAgIGNoYXJ0OiBleHBvcnRDaGFydCwNCiAgICAgIA0KICAgICAgICAgICAgICB3aWR0aDogdGFyZ2V0V2lkdGgsDQogICAgICANCiAgICAgICAgICAgICAgaGVpZ2h0OiB0YXJnZXRIZWlnaHQsDQogICAgICANCiAgICAgICAgICAgICAgZGVzdHJveSgpIHsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGV4cG9ydENoYXJ0LmRlc3Ryb3koKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGNhbnZhcy5yZW1vdmUoKTsNCiAgICAgIA0KICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIH07DQogICAgICANCiAgICAgICAgICB9DQogICAgICANCiAgICAgIA0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZ2V0R2lmV29ya2VyVXJsKCkgew0KICAgICAgDQogICAgICAgICAgICBpZiAoIWdpZldvcmtlclVybFByb21pc2UpIHsNCiAgICAgIA0KICAgICAgICAgICAgICBnaWZXb3JrZXJVcmxQcm9taXNlID0gZmV0Y2goR0lGX1dPUktFUl9TT1VSQ0VfVVJMKQ0KICAgICAgDQogICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7DQogICAgICANCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBHSUYgd29ya2VyICgke3Jlc3BvbnNlLnN0YXR1c30pYCk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIH0pDQogICAgICANCiAgICAgICAgICAgICAgICAudGhlbihzb3VyY2UgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3NvdXJjZV0sIHsgdHlwZTogImFwcGxpY2F0aW9uL2phdmFzY3JpcHQiIH0pOw0KICAgICAgDQogICAgICAgICAgICAgICAgICByZXR1cm4gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIH0pDQogICAgICANCiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJHSUYgd29ya2VyIGZhaWxlZCB0byBsb2FkIiwgZXJyb3IpOw0KICAgICAgDQogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIHJldHVybiBnaWZXb3JrZXJVcmxQcm9taXNlOw0KICAgICAgDQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsICgpID0+IHsKICAgICAgICAgICAgaWYgKGdpZldvcmtlclVybFByb21pc2UpIHsKICAgICAgICAgICAgICBnaWZXb3JrZXJVcmxQcm9taXNlLnRoZW4odXJsID0+IHsKICAgICAgICAgICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICBmdW5jdGlvbiBidWlsZFRyZW5kVG90YWxzUm93cyhwZXJpb2RzKSB7CiAgICAgICAgICAgIGNvbnN0IGFnZ3JlZ2F0ZSA9IHN0YXRlLmZpbHRlcnMuYWdncmVnYXRlID09PSAid2Vla2x5IiA/ICJ3ZWVrbHkiIDogc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGU7CiAgICAgICAgICAgIGNvbnN0IGRhdGVIZWFkaW5nID0gYWdncmVnYXRlID09PSAid2Vla2x5IiA/ICJXZWVrIGVuZGluZyIgOiAiUGVyaW9kIGVuZGluZyI7CiAgICAgICAgICAgIGNvbnN0IHJvd3MgPSBbWyJQZXJpb2QiLCBkYXRlSGVhZGluZywgIlRvdGFsIGFjdGlvbnMiXV07CiAgICAgICAgICAgIHBlcmlvZHMuZm9yRWFjaChwZXJpb2QgPT4gewogICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gcGVyaW9kICYmIHR5cGVvZiBwZXJpb2QubGFiZWwgPT09ICJzdHJpbmciID8gcGVyaW9kLmxhYmVsIDogIiI7CiAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IHBlcmlvZCAmJiBwZXJpb2QuZGF0ZSBpbnN0YW5jZW9mIERhdGUgPyBmb3JtYXRTaG9ydERhdGUocGVyaW9kLmRhdGUpIDogIiI7CiAgICAgICAgICAgICAgY29uc3QgdG90YWwgPSBNYXRoLnJvdW5kKHBlcmlvZCAmJiBOdW1iZXIuaXNGaW5pdGUocGVyaW9kLnRvdGFsQWN0aW9ucykgPyBwZXJpb2QudG90YWxBY3Rpb25zIDogMCk7CiAgICAgICAgICAgICAgcm93cy5wdXNoKFtsYWJlbCwgZGF0ZSwgdG90YWxdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByb3dzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGF1dG9TaXplV29ya3NoZWV0Q29sdW1ucyh3b3Jrc2hlZXQsIHJvd3MpIHsKICAgICAgICAgICAgaWYgKCF3b3Jrc2hlZXQgfHwgIUFycmF5LmlzQXJyYXkocm93cykgfHwgIXJvd3MubGVuZ3RoIHx8ICFyb3dzWzBdKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gcm93c1swXS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGNvbHVtbldpZHRocyA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBjb2x1bW5JbmRleCA9IDA7IGNvbHVtbkluZGV4IDwgY29sdW1uQ291bnQ7IGNvbHVtbkluZGV4ICs9IDEpIHsKICAgICAgICAgICAgICBsZXQgbWF4TGVuZ3RoID0gMTA7CiAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHJvd1tjb2x1bW5JbmRleF07CiAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBTdHJpbmcodmFsdWUgPz8gIiIpLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmIChsZW5ndGggPiBtYXhMZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgbWF4TGVuZ3RoID0gbGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGNvbHVtbldpZHRocy5wdXNoKHsgd2NoOiBNYXRoLm1pbihNYXRoLm1heChtYXhMZW5ndGggKyAyLCAxMiksIDQwKSB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3b3Jrc2hlZXRbIiFjb2xzIl0gPSBjb2x1bW5XaWR0aHM7CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGV4cG9ydFRyZW5kVG90YWxzVG9FeGNlbCgpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBYTFNYID09PSAidW5kZWZpbmVkIiB8fCAhWExTWC51dGlscyB8fCAhWExTWC53cml0ZUZpbGUpIHsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiRXhjZWwgZXhwb3J0IGxpYnJhcnkgbm90IGF2YWlsYWJsZS4iLCB0cnVlKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcGVyaW9kcyA9IEFycmF5LmlzQXJyYXkoc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzKSA/IHN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcyA6IFtdOwogICAgICAgICAgICBpZiAoIXBlcmlvZHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIkxvYWQgZGF0YSB0byBleHBvcnQgdG90YWxzLiIsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCByb3dzID0gYnVpbGRUcmVuZFRvdGFsc1Jvd3MocGVyaW9kcyk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc3Qgd29ya3NoZWV0ID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQocm93cyk7CiAgICAgICAgICAgICAgYXV0b1NpemVXb3Jrc2hlZXRDb2x1bW5zKHdvcmtzaGVldCwgcm93cyk7CiAgICAgICAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CiAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3b3JrYm9vaywgd29ya3NoZWV0LCAiVHJlbmQgdG90YWxzIik7CiAgICAgICAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBgY29waWxvdC10cmVuZC10b3RhbHMtJHtmb3JtYXRUaW1lc3RhbXAoKX0ueGxzeGA7CiAgICAgICAgICAgICAgWExTWC53cml0ZUZpbGUod29ya2Jvb2ssIGZpbGVuYW1lLCB7IGNvbXByZXNzaW9uOiB0cnVlIH0pOwogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KGBTYXZlZCB0b3RhbHMgYXMgJHtmaWxlbmFtZX0uYCwgZmFsc2UpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkV4Y2VsIGV4cG9ydCBmYWlsZWQiLCBlcnJvcik7CiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIlVuYWJsZSB0byBleHBvcnQgdG90YWxzIGluIHRoaXMgYnJvd3Nlci4iLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGV4cG9ydEZ1bGxSZXBvcnRUb0V4Y2VsKCkgewogICAgICAgICAgICBpZiAodHlwZW9mIFhMU1ggPT09ICJ1bmRlZmluZWQiIHx8ICFYTFNYLnV0aWxzIHx8ICFYTFNYLndyaXRlRmlsZSkgewogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJFeGNlbCBleHBvcnQgbGlicmFyeSBub3QgYXZhaWxhYmxlLiIsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3RhdGUucm93cykgfHwgIXN0YXRlLnJvd3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIkxvYWQgZGF0YSB0byBleHBvcnQgYSBmdWxsIHJlcG9ydC4iLCB0cnVlKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBhcHBseUZpbHRlcnMoc3RhdGUucm93cyk7CiAgICAgICAgICAgIGlmIChzdGF0ZS5maWx0ZXJzLnRpbWVmcmFtZSA9PT0gImN1c3RvbSIgJiYgc3RhdGUuZmlsdGVycy5jdXN0b21SYW5nZUludmFsaWQpIHsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiRml4IHRoZSBjdXN0b20gZGF0ZSByYW5nZSBiZWZvcmUgZXhwb3J0aW5nLiIsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWZpbHRlcmVkLmxlbmd0aCkgewogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJObyBkYXRhIG1hdGNoZXMgdGhlIGN1cnJlbnQgZmlsdGVycy4iLCB0cnVlKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGVzID0gY29tcHV0ZUFnZ3JlZ2F0ZXMoZmlsdGVyZWQpOwogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbkFnZ3JlZ2F0ZXMgPSBjb21wdXRlQWdncmVnYXRlcyhmaWx0ZXJlZCwgIm9yZ2FuaXphdGlvbiIpOwogICAgICAgICAgICAgIGNvbnN0IGNvdW50cnlBZ2dyZWdhdGVzID0gY29tcHV0ZUFnZ3JlZ2F0ZXMoZmlsdGVyZWQsICJjb3VudHJ5Iik7CiAgICAgICAgICAgICAgY29uc3Qgc3VwcGxlbWVudGFsID0gYnVpbGRTdXBwbGVtZW50YWxJbnNpZ2h0cyhmaWx0ZXJlZCk7CiAgICAgICAgICAgICAgY29uc3QgcGVyQXBwQWN0aW9ucyA9IHN1cHBsZW1lbnRhbCAmJiBBcnJheS5pc0FycmF5KHN1cHBsZW1lbnRhbC5wZXJBcHBBY3Rpb25zKQogICAgICAgICAgICAgICAgPyBzdXBwbGVtZW50YWwucGVyQXBwQWN0aW9ucwogICAgICAgICAgICAgICAgOiBbXTsKCiAgICAgICAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7CgogICAgICAgICAgICAgIGNvbnN0IG92ZXJ2aWV3Um93cyA9IFtdOwogICAgICAgICAgICAgIG92ZXJ2aWV3Um93cy5wdXNoKFsiQ29waWxvdCBpbXBhY3QgZGFzaGJvYXJkIGV4cG9ydCIsICIiLCAiIl0pOwogICAgICAgICAgICAgIG92ZXJ2aWV3Um93cy5wdXNoKFsiRXhwb3J0IHRpbWVzdGFtcCAobG9jYWwpIiwgbmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpLCAiIl0pOwogICAgICAgICAgICAgIGNvbnN0IHdpbmRvd0xhYmVsID0gdHlwZW9mIGFnZ3JlZ2F0ZXMud2luZG93TGFiZWwgPT09ICJzdHJpbmciICYmIGFnZ3JlZ2F0ZXMud2luZG93TGFiZWwKICAgICAgICAgICAgICAgID8gYWdncmVnYXRlcy53aW5kb3dMYWJlbAogICAgICAgICAgICAgICAgOiAoZG9tLnRyZW5kV2luZG93ICYmIHR5cGVvZiBkb20udHJlbmRXaW5kb3cudGV4dENvbnRlbnQgPT09ICJzdHJpbmciID8gZG9tLnRyZW5kV2luZG93LnRleHRDb250ZW50IDogIiIpOwogICAgICAgICAgICAgIGlmICh3aW5kb3dMYWJlbCkgewogICAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJUaW1lIHdpbmRvdyIsIHdpbmRvd0xhYmVsLCAiUmFuZ2Ugb2YgZGF0ZXMgaW5jbHVkZWQgaW4gdGhpcyB2aWV3LiJdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgbWV0cmljTGFiZWwgPSBzdGF0ZS5maWx0ZXJzLm1ldHJpYyA9PT0gImhvdXJzIiA/ICJBc3Npc3RlZCBob3VycyIgOiAiQWN0aW9ucyI7CiAgICAgICAgICAgICAgY29uc3QgYWdncmVnYXRlTGFiZWwgPSBzdGF0ZS5maWx0ZXJzLmFnZ3JlZ2F0ZSA9PT0gIndlZWtseSIKICAgICAgICAgICAgICAgID8gIldlZWtseSIKICAgICAgICAgICAgICAgIDogKHN0YXRlLmZpbHRlcnMuYWdncmVnYXRlID09PSAibW9udGhseSIgPyAiTW9udGhseSIgOiBTdHJpbmcoc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGUgfHwgIiIpKTsKICAgICAgICAgICAgICBvdmVydmlld1Jvd3MucHVzaChbIk1ldHJpYyBpbiBjaGFydHMiLCBtZXRyaWNMYWJlbCwgIlByaW1hcnkgbWV0cmljIHVzZWQgaW4gdGhlIGltcGFjdCB0cmVuZCBjaGFydC4iXSk7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJBZ2dyZWdhdGlvbiBpbiBjaGFydHMiLCBhZ2dyZWdhdGVMYWJlbCwgIkhvdyB2YWx1ZXMgYXJlIGdyb3VwZWQgb3ZlciB0aW1lLiJdKTsKICAgICAgICAgICAgICBjb25zdCB0aW1lZnJhbWVMYWJlbCA9IHN0YXRlLmZpbHRlcnMudGltZWZyYW1lID09PSAiY3VzdG9tIiA/ICJDdXN0b20gcmFuZ2UiIDogc3RhdGUuZmlsdGVycy50aW1lZnJhbWU7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJUaW1lZnJhbWUgZmlsdGVyIiwgdGltZWZyYW1lTGFiZWwsICJQb3J0aW9uIG9mIHRoZSBkYXRhc2V0IGluY2x1ZGVkIGluIHRoaXMgZXhwb3J0LiJdKTsKICAgICAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25GaWx0ZXIgPSBzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbiBpbnN0YW5jZW9mIFNldCA/IHN0YXRlLmZpbHRlcnMub3JnYW5pemF0aW9uIDogbmV3IFNldCgpOwogICAgICAgICAgICAgIGNvbnN0IGNvdW50cnlGaWx0ZXIgPSBzdGF0ZS5maWx0ZXJzLmNvdW50cnkgaW5zdGFuY2VvZiBTZXQgPyBzdGF0ZS5maWx0ZXJzLmNvdW50cnkgOiBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uRmlsdGVyTGFiZWwgPSBvcmdhbml6YXRpb25GaWx0ZXIuc2l6ZQogICAgICAgICAgICAgICAgPyBBcnJheS5mcm9tKG9yZ2FuaXphdGlvbkZpbHRlcikuc29ydCgpLmpvaW4oIiwgIikKICAgICAgICAgICAgICAgIDogIkFsbCBvcmdhbml6YXRpb25zIjsKICAgICAgICAgICAgICBjb25zdCBjb3VudHJ5RmlsdGVyTGFiZWwgPSBjb3VudHJ5RmlsdGVyLnNpemUKICAgICAgICAgICAgICAgID8gQXJyYXkuZnJvbShjb3VudHJ5RmlsdGVyKS5zb3J0KCkuam9pbigiLCAiKQogICAgICAgICAgICAgICAgOiAiQWxsIGNvdW50cmllcyI7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJPcmdhbml6YXRpb24gZmlsdGVyIiwgb3JnYW5pemF0aW9uRmlsdGVyTGFiZWwsICJPcmdhbml6YXRpb25zIG9yIG9mZmljZXMgaW5jbHVkZWQgaW4gdGhpcyB2aWV3LiJdKTsKICAgICAgICAgICAgICBvdmVydmlld1Jvd3MucHVzaChbIkNvdW50cnkgZmlsdGVyIiwgY291bnRyeUZpbHRlckxhYmVsLCAiQ291bnRyaWVzIGluY2x1ZGVkIGluIHRoaXMgdmlldy4iXSk7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyIiLCAiIiwgIiJdKTsKICAgICAgICAgICAgICBvdmVydmlld1Jvd3MucHVzaChbIk1ldHJpYyIsICJWYWx1ZSIsICJFeHBsYW5hdGlvbiJdKTsKCiAgICAgICAgICAgICAgY29uc3QgdG90YWxBY3Rpb25zID0gTWF0aC5yb3VuZChhZ2dyZWdhdGVzLnRvdGFscyAmJiBOdW1iZXIuaXNGaW5pdGUoYWdncmVnYXRlcy50b3RhbHMudG90YWxBY3Rpb25zKSA/IGFnZ3JlZ2F0ZXMudG90YWxzLnRvdGFsQWN0aW9ucyA6IDApOwogICAgICAgICAgICAgIGNvbnN0IHRvdGFsSG91cnMgPSBhZ2dyZWdhdGVzLnRvdGFscyAmJiBOdW1iZXIuaXNGaW5pdGUoYWdncmVnYXRlcy50b3RhbHMuYXNzaXN0ZWRIb3VycykgPyBhZ2dyZWdhdGVzLnRvdGFscy5hc3Npc3RlZEhvdXJzIDogMDsKICAgICAgICAgICAgICBjb25zdCBhY3RpdmVVc2VycyA9IGFnZ3JlZ2F0ZXMuYWN0aXZlVXNlcnMgaW5zdGFuY2VvZiBTZXQgPyBhZ2dyZWdhdGVzLmFjdGl2ZVVzZXJzLnNpemUgOiAwOwogICAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRVc2VycyA9IGFnZ3JlZ2F0ZXMuZW5hYmxlZFVzZXJzIGluc3RhbmNlb2YgU2V0ID8gYWdncmVnYXRlcy5lbmFibGVkVXNlcnMuc2l6ZSA6IDA7CiAgICAgICAgICAgICAgY29uc3QgYXZlcmFnZUFjdGlvbnNQZXJVc2VyID0gTnVtYmVyLmlzRmluaXRlKGFnZ3JlZ2F0ZXMuYXZlcmFnZUFjdGlvbnNQZXJVc2VyKSA/IGFnZ3JlZ2F0ZXMuYXZlcmFnZUFjdGlvbnNQZXJVc2VyIDogMDsKICAgICAgICAgICAgICBjb25zdCBhdmVyYWdlSG91cnNQZXJVc2VyID0gTnVtYmVyLmlzRmluaXRlKGFnZ3JlZ2F0ZXMuYXZlcmFnZUhvdXJzUGVyVXNlcikgPyBhZ2dyZWdhdGVzLmF2ZXJhZ2VIb3Vyc1BlclVzZXIgOiAwOwoKICAgICAgICAgICAgICBvdmVydmlld1Jvd3MucHVzaChbIlRvdGFsIENvcGlsb3QgYWN0aW9ucyAoYWxsIHVzZXJzKSIsIHRvdGFsQWN0aW9ucywgIkFsbCBDb3BpbG90IGFjdGlvbnMgaW4gdGhlIGZpbHRlcmVkIGRhdGFzZXQuIl0pOwogICAgICAgICAgICAgIG92ZXJ2aWV3Um93cy5wdXNoKFsiVG90YWwgYXNzaXN0ZWQgaG91cnMiLCB0b3RhbEhvdXJzLCAiRXN0aW1hdGVkIGhvdXJzIHdoZXJlIENvcGlsb3QgYXNzaXN0ZWQgd29yay4iXSk7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJBY3RpdmUgdXNlcnMgd2l0aCBhY3Rpb25zIiwgYWN0aXZlVXNlcnMsICJVbmlxdWUgdXNlcnMgd2l0aCBhdCBsZWFzdCBvbmUgQ29waWxvdCBhY3Rpb24uIl0pOwogICAgICAgICAgICAgIG92ZXJ2aWV3Um93cy5wdXNoKFsiVXNlcnMgd2l0aCBDb3BpbG90IGxpY2Vuc2UiLCBlbmFibGVkVXNlcnMsICJVbmlxdWUgdXNlcnMgZW5hYmxlZCBmb3IgQ29waWxvdCBpbiB0aGlzIHBlcmlvZC4iXSk7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJBdmVyYWdlIGFjdGlvbnMgcGVyIGFjdGl2ZSB1c2VyIiwgYXZlcmFnZUFjdGlvbnNQZXJVc2VyLCAiVG90YWwgYWN0aW9ucyBkaXZpZGVkIGJ5IGFjdGl2ZSB1c2Vycy4iXSk7CiAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJBdmVyYWdlIGFzc2lzdGVkIGhvdXJzIHBlciBhY3RpdmUgdXNlciIsIGF2ZXJhZ2VIb3Vyc1BlclVzZXIsICJUb3RhbCBhc3Npc3RlZCBob3VycyBkaXZpZGVkIGJ5IGFjdGl2ZSB1c2Vycy4iXSk7CgogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbkdyb3VwcyA9IEFycmF5LmlzQXJyYXkob3JnYW5pemF0aW9uQWdncmVnYXRlcy5ncm91cHMpID8gb3JnYW5pemF0aW9uQWdncmVnYXRlcy5ncm91cHMgOiBbXTsKICAgICAgICAgICAgICBpZiAob3JnYW5pemF0aW9uR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgdG9wT3JnYW5pemF0aW9ucyA9IG9yZ2FuaXphdGlvbkdyb3Vwcy5zbGljZSgwLCA1KTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdG9wT3JnYW5pemF0aW9ucy5tYXAoZ3JvdXAgPT4gewogICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoZ3JvdXAgJiYgTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke2dyb3VwLm5hbWUgfHwgIlVuc3BlY2lmaWVkIn0gKCR7dmFsdWV9IGFjdGlvbnMpYDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgb3ZlcnZpZXdSb3dzLnB1c2goWyJUb3Agb3JnYW5pemF0aW9ucyBieSBhY3Rpb25zIiwgcGFydHMuam9pbihCVUxMRVRfU0VQQVJBVE9SKSwgIlRvcCBncm91cHMvb2ZmaWNlcyBpbiB0aGlzIHZpZXcuIl0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc3QgY291bnRyeUdyb3VwcyA9IEFycmF5LmlzQXJyYXkoY291bnRyeUFnZ3JlZ2F0ZXMuZ3JvdXBzKSA/IGNvdW50cnlBZ2dyZWdhdGVzLmdyb3VwcyA6IFtdOwogICAgICAgICAgICAgIGlmIChjb3VudHJ5R3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgdG9wQ291bnRyaWVzID0gY291bnRyeUdyb3Vwcy5zbGljZSgwLCA1KTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gdG9wQ291bnRyaWVzLm1hcChncm91cCA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTWF0aC5yb3VuZChncm91cCAmJiBOdW1iZXIuaXNGaW5pdGUoZ3JvdXAudG90YWxBY3Rpb25zKSA/IGdyb3VwLnRvdGFsQWN0aW9ucyA6IDApOwogICAgICAgICAgICAgICAgICByZXR1cm4gYCR7Z3JvdXAubmFtZSB8fCAiVW5zcGVjaWZpZWQifSAoJHt2YWx1ZX0gYWN0aW9ucylgOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBvdmVydmlld1Jvd3MucHVzaChbIlRvcCBjb3VudHJpZXMgYnkgYWN0aW9ucyIsIHBhcnRzLmpvaW4oQlVMTEVUX1NFUEFSQVRPUiksICJDb3VudHJpZXMgd2l0aCB0aGUgaGlnaGVzdCB0b3RhbCBhY3Rpb25zLiJdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IG92ZXJ2aWV3U2hlZXQgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChvdmVydmlld1Jvd3MpOwogICAgICAgICAgICAgIGF1dG9TaXplV29ya3NoZWV0Q29sdW1ucyhvdmVydmlld1NoZWV0LCBvdmVydmlld1Jvd3MpOwogICAgICAgICAgICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod29ya2Jvb2ssIG92ZXJ2aWV3U2hlZXQsICJPdmVydmlldyIpOwoKICAgICAgICAgICAgICBjb25zdCB0cmVuZFBlcmlvZHMgPSBBcnJheS5pc0FycmF5KGFnZ3JlZ2F0ZXMucGVyaW9kcykgPyBhZ2dyZWdhdGVzLnBlcmlvZHMgOiBbXTsKICAgICAgICAgICAgICBpZiAodHJlbmRQZXJpb2RzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3QgdHJlbmRSb3dzID0gYnVpbGRUcmVuZFRvdGFsc1Jvd3ModHJlbmRQZXJpb2RzKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyZW5kU2hlZXQgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldCh0cmVuZFJvd3MpOwogICAgICAgICAgICAgICAgYXV0b1NpemVXb3Jrc2hlZXRDb2x1bW5zKHRyZW5kU2hlZXQsIHRyZW5kUm93cyk7CiAgICAgICAgICAgICAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdvcmtib29rLCB0cmVuZFNoZWV0LCAiVHJlbmQgdG90YWxzIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAob3JnYW5pemF0aW9uR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgY29uc3Qgb3JnUm93cyA9IFtdOwogICAgICAgICAgICAgICAgb3JnUm93cy5wdXNoKFsiRWFjaCByb3cgc2hvd3MgQ29waWxvdCBhY3Rpdml0eSBwZXIgb3JnYW5pemF0aW9uIG9yIG9mZmljZS4iLCAiIiwgIiIsICIiLCAiIiwgIiJdKTsKICAgICAgICAgICAgICAgIG9yZ1Jvd3MucHVzaChbIk9yZ2FuaXphdGlvbiAvIGdyb3VwIiwgIlRvdGFsIGFjdGlvbnMiLCAiQXNzaXN0ZWQgaG91cnMiLCAiQWN0aXZlIHVzZXJzIiwgIkF2ZyBhY3Rpb25zIHBlciB1c2VyIiwgIlNoYXJlIG9mIHRvdGFsIGFjdGlvbnMiXSk7CiAgICAgICAgICAgICAgICBjb25zdCBvcmdUb3RhbEFjdGlvbnMgPSBvcmdhbml6YXRpb25Hcm91cHMucmVkdWNlKChzdW0sIGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwOwogICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgdmFsdWU7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbkdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBBY3Rpb25zID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwOwogICAgICAgICAgICAgICAgICBjb25zdCBncm91cEhvdXJzID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLmFzc2lzdGVkSG91cnMpID8gZ3JvdXAuYXNzaXN0ZWRIb3VycyA6IDA7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwVXNlcnMgPSBOdW1iZXIuaXNGaW5pdGUoZ3JvdXAudXNlcnMpID8gZ3JvdXAudXNlcnMgOiAwOwogICAgICAgICAgICAgICAgICBjb25zdCBncm91cEF2ZXJhZ2UgPSBOdW1iZXIuaXNGaW5pdGUoZ3JvdXAuYXZlcmFnZUFjdGlvbnNQZXJVc2VyKSA/IGdyb3VwLmF2ZXJhZ2VBY3Rpb25zUGVyVXNlciA6IDA7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHNoYXJlID0gb3JnVG90YWxBY3Rpb25zID8gKGdyb3VwQWN0aW9ucyAvIG9yZ1RvdGFsQWN0aW9ucykgKiAxMDAgOiAwOwogICAgICAgICAgICAgICAgICBvcmdSb3dzLnB1c2goWwogICAgICAgICAgICAgICAgICAgIGdyb3VwLm5hbWUgfHwgIlVuc3BlY2lmaWVkIiwKICAgICAgICAgICAgICAgICAgICBncm91cEFjdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBIb3VycywKICAgICAgICAgICAgICAgICAgICBncm91cFVzZXJzLAogICAgICAgICAgICAgICAgICAgIGdyb3VwQXZlcmFnZSwKICAgICAgICAgICAgICAgICAgICBzaGFyZQogICAgICAgICAgICAgICAgICBdKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3Qgb3JnU2hlZXQgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChvcmdSb3dzKTsKICAgICAgICAgICAgICAgIGF1dG9TaXplV29ya3NoZWV0Q29sdW1ucyhvcmdTaGVldCwgb3JnUm93cyk7CiAgICAgICAgICAgICAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdvcmtib29rLCBvcmdTaGVldCwgIkJ5IG9yZ2FuaXphdGlvbiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvdW50cnlHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb3VudHJ5Um93cyA9IFtdOwogICAgICAgICAgICAgICAgY291bnRyeVJvd3MucHVzaChbIkVhY2ggcm93IHNob3dzIENvcGlsb3QgYWN0aXZpdHkgcGVyIGNvdW50cnkuIiwgIiIsICIiLCAiIiwgIiIsICIiXSk7CiAgICAgICAgICAgICAgICBjb3VudHJ5Um93cy5wdXNoKFsiQ291bnRyeSIsICJUb3RhbCBhY3Rpb25zIiwgIkFzc2lzdGVkIGhvdXJzIiwgIkFjdGl2ZSB1c2VycyIsICJBdmcgYWN0aW9ucyBwZXIgdXNlciIsICJTaGFyZSBvZiB0b3RhbCBhY3Rpb25zIl0pOwogICAgICAgICAgICAgICAgY29uc3QgdG90YWxDb3VudHJ5QWN0aW9ucyA9IGNvdW50cnlHcm91cHMucmVkdWNlKChzdW0sIGdyb3VwKSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwOwogICAgICAgICAgICAgICAgICByZXR1cm4gc3VtICsgdmFsdWU7CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIGNvdW50cnlHcm91cHMuZm9yRWFjaChncm91cCA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwQWN0aW9ucyA9IE51bWJlci5pc0Zpbml0ZShncm91cC50b3RhbEFjdGlvbnMpID8gZ3JvdXAudG90YWxBY3Rpb25zIDogMDsKICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBIb3VycyA9IE51bWJlci5pc0Zpbml0ZShncm91cC5hc3Npc3RlZEhvdXJzKSA/IGdyb3VwLmFzc2lzdGVkSG91cnMgOiAwOwogICAgICAgICAgICAgICAgICBjb25zdCBncm91cFVzZXJzID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLnVzZXJzKSA/IGdyb3VwLnVzZXJzIDogMDsKICAgICAgICAgICAgICAgICAgY29uc3QgZ3JvdXBBdmVyYWdlID0gTnVtYmVyLmlzRmluaXRlKGdyb3VwLmF2ZXJhZ2VBY3Rpb25zUGVyVXNlcikgPyBncm91cC5hdmVyYWdlQWN0aW9uc1BlclVzZXIgOiAwOwogICAgICAgICAgICAgICAgICBjb25zdCBzaGFyZSA9IHRvdGFsQ291bnRyeUFjdGlvbnMgPyAoZ3JvdXBBY3Rpb25zIC8gdG90YWxDb3VudHJ5QWN0aW9ucykgKiAxMDAgOiAwOwogICAgICAgICAgICAgICAgICBjb3VudHJ5Um93cy5wdXNoKFsKICAgICAgICAgICAgICAgICAgICBncm91cC5uYW1lIHx8ICJVbnNwZWNpZmllZCIsCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBBY3Rpb25zLAogICAgICAgICAgICAgICAgICAgIGdyb3VwSG91cnMsCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBVc2VycywKICAgICAgICAgICAgICAgICAgICBncm91cEF2ZXJhZ2UsCiAgICAgICAgICAgICAgICAgICAgc2hhcmUKICAgICAgICAgICAgICAgICAgXSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50cnlTaGVldCA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGNvdW50cnlSb3dzKTsKICAgICAgICAgICAgICAgIGF1dG9TaXplV29ya3NoZWV0Q29sdW1ucyhjb3VudHJ5U2hlZXQsIGNvdW50cnlSb3dzKTsKICAgICAgICAgICAgICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod29ya2Jvb2ssIGNvdW50cnlTaGVldCwgIkJ5IGNvdW50cnkiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IG1vbnRobHlFbmFibGVkID0gQXJyYXkuaXNBcnJheShhZ2dyZWdhdGVzLm1vbnRobHlFbmFibGVkVXNlcnMpCiAgICAgICAgICAgICAgICA/IGFnZ3JlZ2F0ZXMubW9udGhseUVuYWJsZWRVc2VycwogICAgICAgICAgICAgICAgOiAoQXJyYXkuaXNBcnJheShzdGF0ZS5sYXRlc3RFbmFibGVkVGltZWxpbmUpID8gc3RhdGUubGF0ZXN0RW5hYmxlZFRpbWVsaW5lIDogW10pOwogICAgICAgICAgICAgIGlmIChtb250aGx5RW5hYmxlZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpY2Vuc2VSb3dzID0gW107CiAgICAgICAgICAgICAgICBsaWNlbnNlUm93cy5wdXNoKFsiTW9udGgiLCAiRW5hYmxlZCBDb3BpbG90IHVzZXJzIiwgIkV4cGxhbmF0aW9uIl0pOwogICAgICAgICAgICAgICAgbW9udGhseUVuYWJsZWQuZm9yRWFjaChlbnRyeSA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gZW50cnkubGFiZWwgfHwgZW50cnkua2V5IHx8ICIiOwogICAgICAgICAgICAgICAgICBjb25zdCBjb3VudCA9IE51bWJlci5pc0Zpbml0ZShlbnRyeS5jb3VudCkgPyBlbnRyeS5jb3VudCA6IDA7CiAgICAgICAgICAgICAgICAgIGxpY2Vuc2VSb3dzLnB1c2goW2xhYmVsLCBjb3VudCwgIlVuaXF1ZSB1c2VycyBlbmFibGVkIGZvciBDb3BpbG90IGluIHRoZSByZXByZXNlbnRhdGl2ZSB3ZWVrIGZvciB0aGlzIG1vbnRoLiJdKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29uc3QgbGljZW5zZVNoZWV0ID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQobGljZW5zZVJvd3MpOwogICAgICAgICAgICAgICAgYXV0b1NpemVXb3Jrc2hlZXRDb2x1bW5zKGxpY2Vuc2VTaGVldCwgbGljZW5zZVJvd3MpOwogICAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3b3JrYm9vaywgbGljZW5zZVNoZWV0LCAiTGljZW5zZXMiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IGFkb3B0aW9uID0gYWdncmVnYXRlcy5hZG9wdGlvbjsKICAgICAgICAgICAgICBjb25zdCBhZG9wdGlvbkFwcHMgPSBhZG9wdGlvbiAmJiBBcnJheS5pc0FycmF5KGFkb3B0aW9uLmFwcHMpID8gYWRvcHRpb24uYXBwcyA6IFtdOwogICAgICAgICAgICAgIGlmIChhZG9wdGlvbkFwcHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhZG9wdGlvblJvd3MgPSBbXTsKICAgICAgICAgICAgICAgIGFkb3B0aW9uUm93cy5wdXNoKFsiVHlwZSIsICJOYW1lIiwgIlBhcmVudCBhcHAiLCAiQWN0aXZlIHVzZXJzIiwgIiUgb2YgYWN0aXZlIHVzZXJzIl0pOwogICAgICAgICAgICAgICAgYWRvcHRpb25BcHBzLmZvckVhY2goYXBwID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgYXBwTGFiZWwgPSBhcHAubGFiZWwgfHwgYXBwLmtleSB8fCAiQXBwIjsKICAgICAgICAgICAgICAgICAgY29uc3QgYXBwVXNlcnMgPSBOdW1iZXIuaXNGaW5pdGUoYXBwLnVzZXJzKSA/IGFwcC51c2VycyA6IDA7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGFwcFNoYXJlVmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUoYXBwLnNoYXJlKSA/IGFwcC5zaGFyZSA6IDA7CiAgICAgICAgICAgICAgICAgIGFkb3B0aW9uUm93cy5wdXNoKFsiQXBwIiwgYXBwTGFiZWwsICIiLCBhcHBVc2VycywgYXBwU2hhcmVWYWx1ZV0pOwogICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcHAuZmVhdHVyZXMpKSB7CiAgICAgICAgICAgICAgICAgICAgYXBwLmZlYXR1cmVzLmZvckVhY2goZmVhdHVyZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmZWF0dXJlTGFiZWwgPSBmZWF0dXJlLmxhYmVsIHx8IGZlYXR1cmUua2V5IHx8ICJDYXBhYmlsaXR5IjsKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZlYXR1cmVVc2VycyA9IE51bWJlci5pc0Zpbml0ZShmZWF0dXJlLnVzZXJzKSA/IGZlYXR1cmUudXNlcnMgOiAwOwogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmVhdHVyZVNoYXJlVmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUoZmVhdHVyZS5zaGFyZSkgPyBmZWF0dXJlLnNoYXJlIDogMDsKICAgICAgICAgICAgICAgICAgICAgIGFkb3B0aW9uUm93cy5wdXNoKFsiQ2FwYWJpbGl0eSIsIGZlYXR1cmVMYWJlbCwgYXBwTGFiZWwsIGZlYXR1cmVVc2VycywgZmVhdHVyZVNoYXJlVmFsdWVdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBhZG9wdGlvblNoZWV0ID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoYWRvcHRpb25Sb3dzKTsKICAgICAgICAgICAgICAgIGF1dG9TaXplV29ya3NoZWV0Q29sdW1ucyhhZG9wdGlvblNoZWV0LCBhZG9wdGlvblJvd3MpOwogICAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3b3JrYm9vaywgYWRvcHRpb25TaGVldCwgIkFkb3B0aW9uIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGVyQXBwQWN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFwcFJvd3MgPSBbXTsKICAgICAgICAgICAgICAgIGFwcFJvd3MucHVzaChbIkFwcCIsICJUb3RhbCBhY3Rpb25zIiwgIk5vdGVzIl0pOwogICAgICAgICAgICAgICAgcGVyQXBwQWN0aW9ucy5mb3JFYWNoKGFwcCA9PiB7CiAgICAgICAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gYXBwLmxhYmVsIHx8IGFwcC5rZXkgfHwgIkFwcCI7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gTnVtYmVyLmlzRmluaXRlKGFwcC50b3RhbCkgPyBhcHAudG90YWwgOiAwOwogICAgICAgICAgICAgICAgICBhcHBSb3dzLnB1c2goW2xhYmVsLCB0b3RhbCwgIlRvdGFsIENvcGlsb3QgYWN0aW9ucyBhdHRyaWJ1dGVkIHRvIHRoaXMgYXBwIGluIHRoZSBjdXJyZW50IGZpbHRlcnMuIl0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBhcHBTaGVldCA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGFwcFJvd3MpOwogICAgICAgICAgICAgICAgYXV0b1NpemVXb3Jrc2hlZXRDb2x1bW5zKGFwcFNoZWV0LCBhcHBSb3dzKTsKICAgICAgICAgICAgICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod29ya2Jvb2ssIGFwcFNoZWV0LCAiQXBwIGFjdGlvbnMiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gYGNvcGlsb3QtZnVsbC1yZXBvcnQtJHtmb3JtYXRUaW1lc3RhbXAoKX0ueGxzeGA7CiAgICAgICAgICAgICAgWExTWC53cml0ZUZpbGUod29ya2Jvb2ssIGZpbGVuYW1lLCB7IGNvbXByZXNzaW9uOiB0cnVlIH0pOwogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KGBTYXZlZCBmdWxsIHJlcG9ydCBhcyAke2ZpbGVuYW1lfS5gLCBmYWxzZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRnVsbCBFeGNlbCBleHBvcnQgZmFpbGVkIiwgZXJyb3IpOwogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJVbmFibGUgdG8gZXhwb3J0IGZ1bGwgcmVwb3J0IGluIHRoaXMgYnJvd3Nlci4iLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICANCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBleHBvcnREYXNoYm9hcmRUb1BERigpIHsKICAgICAgICAgICAgY2xvc2VFeHBvcnRNZW51KCk7CiAgICAgICAgICAgIGlmICghd2luZG93LmpzcGRmIHx8ICF3aW5kb3cuanNwZGYuanNQREYpIHsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiUERGIGV4cG9ydCBsaWJyYXJpZXMgYXJlIG5vdCBhdmFpbGFibGUuIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZS5yb3dzKSB8fCAhc3RhdGUucm93cy5sZW5ndGgpIHsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiTG9hZCBkYXRhIGJlZm9yZSBleHBvcnRpbmcgYSBQREYgcmVwb3J0LiIsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBmaWx0ZXJlZCA9IGFwcGx5RmlsdGVycyhzdGF0ZS5yb3dzKTsKICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlcnMudGltZWZyYW1lID09PSAiY3VzdG9tIiAmJiBzdGF0ZS5maWx0ZXJzLmN1c3RvbVJhbmdlSW52YWxpZCkgewogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJGaXggdGhlIGN1c3RvbSBkYXRlIHJhbmdlIGJlZm9yZSBleHBvcnRpbmcuIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghZmlsdGVyZWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIk5vIGRhdGEgbWF0Y2hlcyB0aGUgY3VycmVudCBmaWx0ZXJzLiIsIHRydWUpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJQcmVwYXJpbmcgUERGIHJlcG9ydC4uLiIsIGZhbHNlKTsKICAgICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGVzID0gY29tcHV0ZUFnZ3JlZ2F0ZXMoZmlsdGVyZWQpOwogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbkFnZ3JlZ2F0ZXMgPSBjb21wdXRlQWdncmVnYXRlcyhmaWx0ZXJlZCwgIm9yZ2FuaXphdGlvbiIpOwogICAgICAgICAgICAgIGNvbnN0IGNvdW50cnlBZ2dyZWdhdGVzID0gY29tcHV0ZUFnZ3JlZ2F0ZXMoZmlsdGVyZWQsICJjb3VudHJ5Iik7CiAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgICAgICAgICAgIGNvbnN0IHBkZiA9IG5ldyBqc1BERih7CiAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogImxhbmRzY2FwZSIsCiAgICAgICAgICAgICAgICB1bml0OiAicHQiLAogICAgICAgICAgICAgICAgZm9ybWF0OiAiYTQiCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY29uc3QgcGFnZVdpZHRoID0gcGRmLmludGVybmFsLnBhZ2VTaXplLmdldFdpZHRoKCk7CiAgICAgICAgICAgICAgY29uc3QgcGFnZUhlaWdodCA9IHBkZi5pbnRlcm5hbC5wYWdlU2l6ZS5nZXRIZWlnaHQoKTsKICAgICAgICAgICAgICBjb25zdCBtYXJnaW4gPSA0MDsKICAgICAgICAgICAgICBsZXQgeSA9IG1hcmdpbjsKCiAgICAgICAgICAgICAgcGRmLnNldEZvbnRTaXplKDE4KTsKICAgICAgICAgICAgICBwZGYudGV4dCgiQ29waWxvdCBpbXBhY3QgcmVwb3J0IiwgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICB5ICs9IDI2OwoKICAgICAgICAgICAgICBwZGYuc2V0Rm9udFNpemUoMTApOwogICAgICAgICAgICAgIGNvbnN0IGV4cG9ydGVkQXQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICAgIHBkZi50ZXh0KGBHZW5lcmF0ZWQgJHtleHBvcnRlZEF0LnRvTG9jYWxlU3RyaW5nKCl9YCwgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICB5ICs9IDE2OwoKICAgICAgICAgICAgICBjb25zdCB3aW5kb3dMYWJlbCA9IHR5cGVvZiBhZ2dyZWdhdGVzLndpbmRvd0xhYmVsID09PSAic3RyaW5nIiAmJiBhZ2dyZWdhdGVzLndpbmRvd0xhYmVsCiAgICAgICAgICAgICAgICA/IGFnZ3JlZ2F0ZXMud2luZG93TGFiZWwKICAgICAgICAgICAgICAgIDogKGRvbS50cmVuZFdpbmRvdyAmJiB0eXBlb2YgZG9tLnRyZW5kV2luZG93LnRleHRDb250ZW50ID09PSAic3RyaW5nIiA/IGRvbS50cmVuZFdpbmRvdy50ZXh0Q29udGVudCA6ICIiKTsKICAgICAgICAgICAgICBpZiAod2luZG93TGFiZWwpIHsKICAgICAgICAgICAgICAgIHBkZi50ZXh0KGBUaW1lIHdpbmRvdzogJHt3aW5kb3dMYWJlbH1gLCBtYXJnaW4sIHkpOwogICAgICAgICAgICAgICAgeSArPSAxNjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHRpbWVmcmFtZUxhYmVsID0gc3RhdGUuZmlsdGVycy50aW1lZnJhbWUgPT09ICJjdXN0b20iID8gIkN1c3RvbSByYW5nZSIgOiBzdGF0ZS5maWx0ZXJzLnRpbWVmcmFtZTsKICAgICAgICAgICAgICBjb25zdCBhZ2dyZWdhdGVMYWJlbCA9IHN0YXRlLmZpbHRlcnMuYWdncmVnYXRlID09PSAid2Vla2x5IgogICAgICAgICAgICAgICAgPyAiV2Vla2x5IgogICAgICAgICAgICAgICAgOiAoc3RhdGUuZmlsdGVycy5hZ2dyZWdhdGUgPT09ICJtb250aGx5IiA/ICJNb250aGx5IiA6IFN0cmluZyhzdGF0ZS5maWx0ZXJzLmFnZ3JlZ2F0ZSB8fCAiIikpOwogICAgICAgICAgICAgIGNvbnN0IG1ldHJpY0xhYmVsID0gc3RhdGUuZmlsdGVycy5tZXRyaWMgPT09ICJob3VycyIgPyAiQXNzaXN0ZWQgaG91cnMiIDogIkFjdGlvbnMiOwogICAgICAgICAgICAgIGNvbnN0IGZpbHRlcnNMaW5lID0gYE1ldHJpYzogJHttZXRyaWNMYWJlbH0gXHUwMGI3IEFnZ3JlZ2F0aW9uOiAke2FnZ3JlZ2F0ZUxhYmVsfSBcdTAwYjcgVGltZWZyYW1lOiAke3RpbWVmcmFtZUxhYmVsfWA7CiAgICAgICAgICAgICAgY29uc3Qgd3JhcHBlZEZpbHRlcnMgPSBwZGYuc3BsaXRUZXh0VG9TaXplKGZpbHRlcnNMaW5lLCBwYWdlV2lkdGggLSBtYXJnaW4gKiAyKTsKICAgICAgICAgICAgICBwZGYudGV4dCh3cmFwcGVkRmlsdGVycywgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICB5ICs9IHdyYXBwZWRGaWx0ZXJzLmxlbmd0aCAqIDEyICsgNjsKCiAgICAgICAgICAgICAgY29uc3QgdG90YWxBY3Rpb25zID0gTWF0aC5yb3VuZChhZ2dyZWdhdGVzLnRvdGFscyAmJiBOdW1iZXIuaXNGaW5pdGUoYWdncmVnYXRlcy50b3RhbHMudG90YWxBY3Rpb25zKSA/IGFnZ3JlZ2F0ZXMudG90YWxzLnRvdGFsQWN0aW9ucyA6IDApOwogICAgICAgICAgICAgIGNvbnN0IHRvdGFsSG91cnMgPSBhZ2dyZWdhdGVzLnRvdGFscyAmJiBOdW1iZXIuaXNGaW5pdGUoYWdncmVnYXRlcy50b3RhbHMuYXNzaXN0ZWRIb3VycykgPyBhZ2dyZWdhdGVzLnRvdGFscy5hc3Npc3RlZEhvdXJzIDogMDsKICAgICAgICAgICAgICBjb25zdCBhY3RpdmVVc2VycyA9IGFnZ3JlZ2F0ZXMuYWN0aXZlVXNlcnMgaW5zdGFuY2VvZiBTZXQgPyBhZ2dyZWdhdGVzLmFjdGl2ZVVzZXJzLnNpemUgOiAwOwogICAgICAgICAgICAgIGNvbnN0IGVuYWJsZWRVc2VycyA9IGFnZ3JlZ2F0ZXMuZW5hYmxlZFVzZXJzIGluc3RhbmNlb2YgU2V0ID8gYWdncmVnYXRlcy5lbmFibGVkVXNlcnMuc2l6ZSA6IDA7CiAgICAgICAgICAgICAgY29uc3QgYXZlcmFnZUFjdGlvbnNQZXJVc2VyID0gTnVtYmVyLmlzRmluaXRlKGFnZ3JlZ2F0ZXMuYXZlcmFnZUFjdGlvbnNQZXJVc2VyKSA/IGFnZ3JlZ2F0ZXMuYXZlcmFnZUFjdGlvbnNQZXJVc2VyIDogMDsKICAgICAgICAgICAgICBjb25zdCBhdmVyYWdlSG91cnNQZXJVc2VyID0gTnVtYmVyLmlzRmluaXRlKGFnZ3JlZ2F0ZXMuYXZlcmFnZUhvdXJzUGVyVXNlcikgPyBhZ2dyZWdhdGVzLmF2ZXJhZ2VIb3Vyc1BlclVzZXIgOiAwOwoKICAgICAgICAgICAgICBwZGYuc2V0Rm9udFNpemUoMTIpOwogICAgICAgICAgICAgIGNvbnN0IGxhYmVsQ29sdW1uV2lkdGggPSAyMzA7CiAgICAgICAgICAgICAgY29uc3QgdmFsdWVDb2x1bW5YID0gbWFyZ2luICsgbGFiZWxDb2x1bW5XaWR0aDsKICAgICAgICAgICAgICBjb25zdCBtZXRyaWNzID0gWwogICAgICAgICAgICAgICAgWyJUb3RhbCBDb3BpbG90IGFjdGlvbnMgKGFsbCB1c2VycykiLCBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KHRvdGFsQWN0aW9ucyldLAogICAgICAgICAgICAgICAgWyJUb3RhbCBhc3Npc3RlZCBob3VycyIsIGAke2hvdXJzRm9ybWF0dGVyLmZvcm1hdCh0b3RhbEhvdXJzKX0gaHJzYF0sCiAgICAgICAgICAgICAgICBbIkFjdGl2ZSB1c2VycyB3aXRoIGFjdGlvbnMiLCBudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KGFjdGl2ZVVzZXJzKV0sCiAgICAgICAgICAgICAgICBbIlVzZXJzIHdpdGggQ29waWxvdCBsaWNlbnNlIiwgbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChlbmFibGVkVXNlcnMpXSwKICAgICAgICAgICAgICAgIFsiQXZlcmFnZSBhY3Rpb25zIHBlciBhY3RpdmUgdXNlciIsIG51bWJlckZvcm1hdHRlci5mb3JtYXQoTWF0aC5yb3VuZChhdmVyYWdlQWN0aW9uc1BlclVzZXIgfHwgMCkpXSwKICAgICAgICAgICAgICAgIFsiQXZlcmFnZSBhc3Npc3RlZCBob3VycyBwZXIgYWN0aXZlIHVzZXIiLCBgJHtob3Vyc0Zvcm1hdHRlci5mb3JtYXQoYXZlcmFnZUhvdXJzUGVyVXNlciB8fCAwKX0gaHJzYF0KICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgIG1ldHJpY3MuZm9yRWFjaCgoW2xhYmVsLCB2YWx1ZV0pID0+IHsKICAgICAgICAgICAgICAgIGlmICh5ID4gcGFnZUhlaWdodCAtIG1hcmdpbikgewogICAgICAgICAgICAgICAgICBwZGYuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICB5ID0gbWFyZ2luOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGRmLnRleHQoU3RyaW5nKGxhYmVsKSwgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICAgIHBkZi50ZXh0KFN0cmluZyh2YWx1ZSksIHZhbHVlQ29sdW1uWCwgeSk7CiAgICAgICAgICAgICAgICB5ICs9IDE2OwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjb25zdCBleHBsYW5hdGlvbiA9ICJNZXRyaWNzIHN1bW1hcml6ZSB0aGUgZmlsdGVyZWQgQ29waWxvdCBkYXRhc2V0LiBUb3RhbCBhY3Rpb25zIGNvdW50IGV2ZXJ5IENvcGlsb3QgaW50ZXJhY3Rpb247IGFzc2lzdGVkIGhvdXJzIGVzdGltYXRlIHRpbWUgd2hlcmUgQ29waWxvdCB3YXMgZW5nYWdlZC4gQWN0aXZlIHVzZXJzIGhhdmUgYXQgbGVhc3Qgb25lIGFjdGlvbjsgbGljZW5zZWQgdXNlcnMgYXJlIGVuYWJsZWQgZm9yIENvcGlsb3QuIjsKICAgICAgICAgICAgICBjb25zdCB3cmFwcGVkRXhwbGFuYXRpb24gPSBwZGYuc3BsaXRUZXh0VG9TaXplKGV4cGxhbmF0aW9uLCBwYWdlV2lkdGggLSBtYXJnaW4gKiAyKTsKICAgICAgICAgICAgICBpZiAoeSArIHdyYXBwZWRFeHBsYW5hdGlvbi5sZW5ndGggKiAxMiA+IHBhZ2VIZWlnaHQgLSBtYXJnaW4pIHsKICAgICAgICAgICAgICAgIHBkZi5hZGRQYWdlKCk7CiAgICAgICAgICAgICAgICB5ID0gbWFyZ2luOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBwZGYuc2V0Rm9udFNpemUoMTApOwogICAgICAgICAgICAgIHBkZi50ZXh0KHdyYXBwZWRFeHBsYW5hdGlvbiwgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICB5ICs9IHdyYXBwZWRFeHBsYW5hdGlvbi5sZW5ndGggKiAxMiArIDE4OwoKICAgICAgICAgICAgICBwZGYuc2V0Rm9udFNpemUoMTIpOwogICAgICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbkdyb3VwcyA9IEFycmF5LmlzQXJyYXkob3JnYW5pemF0aW9uQWdncmVnYXRlcy5ncm91cHMpID8gb3JnYW5pemF0aW9uQWdncmVnYXRlcy5ncm91cHMgOiBbXTsKICAgICAgICAgICAgICBpZiAob3JnYW5pemF0aW9uR3JvdXBzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKHkgKyA4MCA+IHBhZ2VIZWlnaHQgLSBtYXJnaW4pIHsKICAgICAgICAgICAgICAgICAgcGRmLmFkZFBhZ2UoKTsKICAgICAgICAgICAgICAgICAgeSA9IG1hcmdpbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBkZi50ZXh0KCJUb3Agb3JnYW5pemF0aW9ucyBieSBhY3Rpb25zIiwgbWFyZ2luLCB5KTsKICAgICAgICAgICAgICAgIHkgKz0gMTY7CiAgICAgICAgICAgICAgICBjb25zdCB0b3BPcmdhbml6YXRpb25zID0gb3JnYW5pemF0aW9uR3JvdXBzLnNsaWNlKDAsIDUpOwogICAgICAgICAgICAgICAgdG9wT3JnYW5pemF0aW9ucy5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aW9ucyA9IE1hdGgucm91bmQoZ3JvdXAgJiYgTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBNYXRoLnJvdW5kKGdyb3VwICYmIE51bWJlci5pc0Zpbml0ZShncm91cC51c2VycykgPyBncm91cC51c2VycyA6IDApOwogICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gYCR7Z3JvdXAubmFtZSB8fCAiVW5zcGVjaWZpZWQifSBcdTAwYjcgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KGFjdGlvbnMpfSBhY3Rpb25zIFx1MDBiNyAke251bWJlckZvcm1hdHRlci5mb3JtYXQodXNlcnMpfSB1c2Vyc2A7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHdyYXBwZWQgPSBwZGYuc3BsaXRUZXh0VG9TaXplKGxpbmUsIHBhZ2VXaWR0aCAtIG1hcmdpbiAqIDIpOwogICAgICAgICAgICAgICAgICB3cmFwcGVkLmZvckVhY2godGV4dExpbmUgPT4gewogICAgICAgICAgICAgICAgICAgIHBkZi50ZXh0KHRleHRMaW5lLCBtYXJnaW4sIHkpOwogICAgICAgICAgICAgICAgICAgIHkgKz0gMTQ7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCBjb3VudHJ5R3JvdXBzID0gQXJyYXkuaXNBcnJheShjb3VudHJ5QWdncmVnYXRlcy5ncm91cHMpID8gY291bnRyeUFnZ3JlZ2F0ZXMuZ3JvdXBzIDogW107CiAgICAgICAgICAgICAgaWYgKGNvdW50cnlHcm91cHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoeSArIDgwID4gcGFnZUhlaWdodCAtIG1hcmdpbikgewogICAgICAgICAgICAgICAgICBwZGYuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICB5ID0gbWFyZ2luOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcGRmLnRleHQoIlRvcCBjb3VudHJpZXMgYnkgYWN0aW9ucyIsIG1hcmdpbiwgeSk7CiAgICAgICAgICAgICAgICB5ICs9IDE2OwogICAgICAgICAgICAgICAgY29uc3QgdG9wQ291bnRyaWVzID0gY291bnRyeUdyb3Vwcy5zbGljZSgwLCA1KTsKICAgICAgICAgICAgICAgIHRvcENvdW50cmllcy5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aW9ucyA9IE1hdGgucm91bmQoZ3JvdXAgJiYgTnVtYmVyLmlzRmluaXRlKGdyb3VwLnRvdGFsQWN0aW9ucykgPyBncm91cC50b3RhbEFjdGlvbnMgOiAwKTsKICAgICAgICAgICAgICAgICAgY29uc3QgdXNlcnMgPSBNYXRoLnJvdW5kKGdyb3VwICYmIE51bWJlci5pc0Zpbml0ZShncm91cC51c2VycykgPyBncm91cC51c2VycyA6IDApOwogICAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gYCR7Z3JvdXAubmFtZSB8fCAiVW5zcGVjaWZpZWQifSBcdTAwYjcgJHtudW1iZXJGb3JtYXR0ZXIuZm9ybWF0KGFjdGlvbnMpfSBhY3Rpb25zIFx1MDBiNyAke251bWJlckZvcm1hdHRlci5mb3JtYXQodXNlcnMpfSB1c2Vyc2A7CiAgICAgICAgICAgICAgICAgIGNvbnN0IHdyYXBwZWQgPSBwZGYuc3BsaXRUZXh0VG9TaXplKGxpbmUsIHBhZ2VXaWR0aCAtIG1hcmdpbiAqIDIpOwogICAgICAgICAgICAgICAgICB3cmFwcGVkLmZvckVhY2godGV4dExpbmUgPT4gewogICAgICAgICAgICAgICAgICAgIHBkZi50ZXh0KHRleHRMaW5lLCBtYXJnaW4sIHkpOwogICAgICAgICAgICAgICAgICAgIHkgKz0gMTQ7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwZGYuYWRkUGFnZSgpOwogICAgICAgICAgICAgIGxldCBjaGFydFkgPSBtYXJnaW47CiAgICAgICAgICAgICAgcGRmLnNldEZvbnRTaXplKDE0KTsKICAgICAgICAgICAgICBwZGYudGV4dCgiS2V5IGNoYXJ0cyIsIG1hcmdpbiwgY2hhcnRZKTsKICAgICAgICAgICAgICBjaGFydFkgKz0gMjI7CgogICAgICAgICAgICAgIHBkZi5zZXRGb250U2l6ZSgxMik7CiAgICAgICAgICAgICAgY29uc3QgY2hhcnRXaWR0aCA9IHBhZ2VXaWR0aCAtIG1hcmdpbiAqIDI7CgogICAgICAgICAgICAgIGNvbnN0IHRyZW5kQ2hhcnQgPSBzdGF0ZS5jaGFydHMudHJlbmQ7CiAgICAgICAgICAgICAgaWYgKHRyZW5kQ2hhcnQgJiYgdHJlbmRDaGFydC5jYW52YXMgJiYgdHlwZW9mIHRyZW5kQ2hhcnQudG9CYXNlNjRJbWFnZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gdHJlbmRDaGFydC5jYW52YXM7CiAgICAgICAgICAgICAgICBjb25zdCBhc3BlY3RSYXRpbyA9IGNhbnZhcy5oZWlnaHQgJiYgY2FudmFzLndpZHRoID8gY2FudmFzLmhlaWdodCAvIGNhbnZhcy53aWR0aCA6IDAuNTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoYXJ0SGVpZ2h0ID0gY2hhcnRXaWR0aCAqIChhc3BlY3RSYXRpbyB8fCAwLjUpOwogICAgICAgICAgICAgICAgcGRmLnRleHQoIkltcGFjdCB0cmVuZCIsIG1hcmdpbiwgY2hhcnRZKTsKICAgICAgICAgICAgICAgIGNoYXJ0WSArPSAxNDsKICAgICAgICAgICAgICAgIGNvbnN0IHRyZW5kSW1hZ2UgPSB0cmVuZENoYXJ0LnRvQmFzZTY0SW1hZ2UoImltYWdlL3BuZyIpOwogICAgICAgICAgICAgICAgcGRmLmFkZEltYWdlKHRyZW5kSW1hZ2UsICJQTkciLCBtYXJnaW4sIGNoYXJ0WSwgY2hhcnRXaWR0aCwgY2hhcnRIZWlnaHQpOwogICAgICAgICAgICAgICAgY2hhcnRZICs9IGNoYXJ0SGVpZ2h0ICsgMjA7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCBlbmFibGVkQ2hhcnQgPSBzdGF0ZS5jaGFydHMuZW5hYmxlZExpY2Vuc2VzOwogICAgICAgICAgICAgIGlmIChlbmFibGVkQ2hhcnQgJiYgZW5hYmxlZENoYXJ0LmNhbnZhcyAmJiB0eXBlb2YgZW5hYmxlZENoYXJ0LnRvQmFzZTY0SW1hZ2UgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IGVuYWJsZWRDaGFydC5jYW52YXM7CiAgICAgICAgICAgICAgICBjb25zdCBhc3BlY3RSYXRpbyA9IGNhbnZhcy5oZWlnaHQgJiYgY2FudmFzLndpZHRoID8gY2FudmFzLmhlaWdodCAvIGNhbnZhcy53aWR0aCA6IDAuNTsKICAgICAgICAgICAgICAgIGNvbnN0IGNoYXJ0SGVpZ2h0ID0gY2hhcnRXaWR0aCAqIChhc3BlY3RSYXRpbyB8fCAwLjUpOwogICAgICAgICAgICAgICAgaWYgKGNoYXJ0WSArIGNoYXJ0SGVpZ2h0ICsgbWFyZ2luID4gcGFnZUhlaWdodCkgewogICAgICAgICAgICAgICAgICBwZGYuYWRkUGFnZSgpOwogICAgICAgICAgICAgICAgICBjaGFydFkgPSBtYXJnaW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwZGYudGV4dCgiTGljZW5zZWQgdXNlcnMgb3ZlciB0aW1lIiwgbWFyZ2luLCBjaGFydFkpOwogICAgICAgICAgICAgICAgY2hhcnRZICs9IDE0OwogICAgICAgICAgICAgICAgY29uc3QgbGljZW5zZXNJbWFnZSA9IGVuYWJsZWRDaGFydC50b0Jhc2U2NEltYWdlKCJpbWFnZS9wbmciKTsKICAgICAgICAgICAgICAgIHBkZi5hZGRJbWFnZShsaWNlbnNlc0ltYWdlLCAiUE5HIiwgbWFyZ2luLCBjaGFydFksIGNoYXJ0V2lkdGgsIGNoYXJ0SGVpZ2h0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IGZpbGVuYW1lID0gYGNvcGlsb3QtZGFzaGJvYXJkLXJlcG9ydC0ke2Zvcm1hdFRpbWVzdGFtcCgpfS5wZGZgOwogICAgICAgICAgICAgIHBkZi5zYXZlKGZpbGVuYW1lKTsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludChgU2F2ZWQgUERGIGFzICR7ZmlsZW5hbWV9LmAsIGZhbHNlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJQREYgZXhwb3J0IGZhaWxlZCIsIGVycm9yKTsKICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiVW5hYmxlIHRvIGV4cG9ydCBQREYgcmVwb3J0LiIsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgIA0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4cG9ydENoYXJ0QXNQTkcoKSB7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGNoYXJ0ID0gc3RhdGUuY2hhcnRzLnRyZW5kOw0KICAgICAgDQogICAgICAgICAgICBpZiAoIWNoYXJ0KSB7DQogICAgICANCiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIkxvYWQgZGF0YSB0byBleHBvcnQgdGhlIGNoYXJ0LiIsIHRydWUpOw0KICAgICAgDQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgIA0KICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICBpZiAoIXN0YXRlLmxhdGVzdFRyZW5kUGVyaW9kcy5sZW5ndGgpIHsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiTG9hZCBkYXRhIHRvIGV4cG9ydCB0aGUgY2hhcnQuIiwgdHJ1ZSk7DQogICAgICANCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGluY2x1ZGVEZXRhaWxzID0gc3RhdGUuZXhwb3J0UHJlZmVyZW5jZXMuaW5jbHVkZURldGFpbHMgIT09IGZhbHNlICYmIHN0YXRlLnNlcmllc0RldGFpbE1vZGUgIT09ICJub25lIjsNCiAgICAgICAgICAgIGNvbnN0IGRldGFpbE1vZGUgPSBzdGF0ZS5zZXJpZXNEZXRhaWxNb2RlID09PSAibm9uZSIgPyAibm9uZSIgOiAoaW5jbHVkZURldGFpbHMgPyAiYWxsIiA6ICJyZXNwZWN0Iik7DQogICAgICANCiAgICAgICAgICAgIGxldCBoaWRkZW5DaGFydDsNCiAgICAgIA0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgIA0KICAgICAgICAgICAgICBoaWRkZW5DaGFydCA9IGNyZWF0ZUhpZGRlblRyZW5kQ2hhcnQoZGV0YWlsTW9kZSwgMik7DQogICAgICANCiAgICAgICAgICAgICAgaGlkZGVuQ2hhcnQuY2hhcnQudXBkYXRlKCk7DQogICAgICANCiAgICAgICAgICAgICAgYXdhaXQgd2FpdEZvck5leHRGcmFtZSgpOw0KICAgICAgDQogICAgICAgICAgICAgIGNvbnN0IGRhdGFVcmwgPSBoaWRkZW5DaGFydC5jYW52YXMudG9EYXRhVVJMKCJpbWFnZS9wbmciLCAxKTsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IGBjb3BpbG90LXRyZW5kLSR7Zm9ybWF0VGltZXN0YW1wKCl9LnBuZ2A7DQogICAgICANCiAgICAgICAgICAgICAgZG93bmxvYWREYXRhVVJMKGRhdGFVcmwsIGZpbGVuYW1lKTsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludChgU2F2ZWQgaW1hZ2UgYXMgJHtmaWxlbmFtZX0uYCwgZmFsc2UpOw0KICAgICAgDQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgDQogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlBORyBleHBvcnQgZmFpbGVkIiwgZXJyb3IpOw0KICAgICAgDQogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJVbmFibGUgdG8gZXhwb3J0IFBORyBpbiB0aGlzIGJyb3dzZXIuIiwgdHJ1ZSk7DQogICAgICANCiAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICANCiAgICAgICAgICAgICAgaWYgKGhpZGRlbkNoYXJ0KSB7DQogICAgICANCiAgICAgICAgICAgICAgICBoaWRkZW5DaGFydC5kZXN0cm95KCk7DQogICAgICANCiAgICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBsZXQgaXNFeHBvcnRpbmdHaWYgPSBmYWxzZTsNCiAgICAgIA0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGV4cG9ydFRyZW5kQ2hhcnRHaWYoeyBkZXRhaWxNb2RlID0gInJlc3BlY3QiLCBzY2FsZSA9IDIsIGZyYW1lRGVsYXkgPSA5MCwgZnJhbWVzUGVyUG9pbnQgPSA2LCBob2xkRGVsYXlNdWx0aXBsaWVyID0gMTIgfSA9IHt9KSB7DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHdvcmtlclVybCA9IGF3YWl0IGdldEdpZldvcmtlclVybCgpOw0KICAgICAgDQogICAgICAgICAgICBpZiAoIXdvcmtlclVybCkgew0KICAgICAgDQogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiR0lGIHdvcmtlciBjb3VsZCBub3QgYmUgbG9hZGVkLiIpOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGhpZGRlbkNoYXJ0ID0gY3JlYXRlSGlkZGVuVHJlbmRDaGFydChkZXRhaWxNb2RlLCBzY2FsZSk7DQogICAgICANCiAgICAgICAgICAgIHRyeSB7DQogICAgICANCiAgICAgICAgICAgICAgaGlkZGVuQ2hhcnQuY2hhcnQub3B0aW9ucy5hbmltYXRpb24gPSBmYWxzZTsNCiAgICAgIA0KICAgICAgICAgICAgICBoaWRkZW5DaGFydC5jaGFydC51cGRhdGUoKTsNCiAgICAgIA0KICAgICAgICAgICAgICBhd2FpdCB3YWl0Rm9yTmV4dEZyYW1lKCk7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3QgZ2lmID0gbmV3IEdJRih7DQogICAgICANCiAgICAgICAgICAgICAgICB3b3JrZXJTY3JpcHQ6IHdvcmtlclVybCwNCiAgICAgIA0KICAgICAgICAgICAgICAgIHdvcmtlcnM6IDIsDQogICAgICANCiAgICAgICAgICAgICAgICBxdWFsaXR5OiA4LA0KICAgICAgDQogICAgICAgICAgICAgICAgd2lkdGg6IGhpZGRlbkNoYXJ0LmNhbnZhcy53aWR0aCwNCiAgICAgIA0KICAgICAgICAgICAgICAgIGhlaWdodDogaGlkZGVuQ2hhcnQuY2FudmFzLmhlaWdodCwNCiAgICAgIA0KICAgICAgICAgICAgICAgIHRyYW5zcGFyZW50OiAweDAwMDAwMA0KICAgICAgDQogICAgICAgICAgICAgIH0pOw0KICAgICAgDQogICAgICAgICAgICAgIGNvbnN0IGZyYW1lQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7DQogICAgICANCiAgICAgICAgICAgICAgZnJhbWVDYW52YXMud2lkdGggPSBoaWRkZW5DaGFydC5jYW52YXMud2lkdGg7DQogICAgICANCiAgICAgICAgICAgICAgZnJhbWVDYW52YXMuaGVpZ2h0ID0gaGlkZGVuQ2hhcnQuY2FudmFzLmhlaWdodDsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBmcmFtZUN0eCA9IGZyYW1lQ2FudmFzLmdldENvbnRleHQoIjJkIik7DQogICAgICANCiAgICAgICAgICAgICAgZnJhbWVDdHguaW1hZ2VTbW9vdGhpbmdRdWFsaXR5ID0gImhpZ2giOw0KICAgICAgDQogICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZEZyYW1lKGRlbGF5KSB7DQogICAgICANCiAgICAgICAgICAgICAgICBmcmFtZUN0eC5maWxsU3R5bGUgPSAiI2ZmZmZmZiI7DQogICAgICANCiAgICAgICAgICAgICAgICBmcmFtZUN0eC5maWxsUmVjdCgwLCAwLCBmcmFtZUNhbnZhcy53aWR0aCwgZnJhbWVDYW52YXMuaGVpZ2h0KTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGZyYW1lQ3R4LmRyYXdJbWFnZShoaWRkZW5DaGFydC5jYW52YXMsIDAsIDApOw0KICAgICAgDQogICAgICAgICAgICAgICAgZ2lmLmFkZEZyYW1lKGZyYW1lQ3R4LCB7IGNvcHk6IHRydWUsIGRlbGF5IH0pOw0KICAgICAgDQogICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBkYXRhc2V0cyA9IGhpZGRlbkNoYXJ0LmNoYXJ0LmRhdGEuZGF0YXNldHM7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RGF0YSA9IGRhdGFzZXRzLm1hcChkYXRhc2V0ID0+IGRhdGFzZXQuZGF0YS5zbGljZSgpKTsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBsYWJlbENvdW50ID0gaGlkZGVuQ2hhcnQuY2hhcnQuZGF0YS5sYWJlbHMubGVuZ3RoOw0KICAgICAgDQogICAgICAgICAgICAgIGRhdGFzZXRzLmZvckVhY2goZGF0YXNldCA9PiB7DQogICAgICANCiAgICAgICAgICAgICAgICBkYXRhc2V0LmRhdGEgPSBuZXcgQXJyYXkobGFiZWxDb3VudCkuZmlsbChudWxsKTsNCiAgICAgIA0KICAgICAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgICAgICBoaWRkZW5DaGFydC5jaGFydC51cGRhdGUoKTsNCiAgICAgIA0KICAgICAgICAgICAgICBhd2FpdCB3YWl0Rm9yTmV4dEZyYW1lKCk7DQogICAgICANCiAgICAgICAgICAgICAgYWRkRnJhbWUoZnJhbWVEZWxheSAqIGhvbGREZWxheU11bHRpcGxpZXIpOw0KICAgICAgDQogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBsYWJlbENvdW50OyBpbmRleCArPSAxKSB7DQogICAgICANCiAgICAgICAgICAgICAgICBjb25zdCBzdGVwcyA9IE1hdGgubWF4KDIsIGZyYW1lc1BlclBvaW50KTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGZvciAobGV0IHN0ZXAgPSAxOyBzdGVwIDw9IHN0ZXBzOyBzdGVwICs9IDEpIHsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBzdGVwIC8gc3RlcHM7DQogICAgICANCiAgICAgICAgICAgICAgICAgIGRhdGFzZXRzLmZvckVhY2goKGRhdGFzZXQsIGRhdGFzZXRJbmRleCkgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlcyA9IHRhcmdldERhdGFbZGF0YXNldEluZGV4XTsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwcmV2ID0gMDsgcHJldiA8IGluZGV4OyBwcmV2ICs9IDEpIHsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgIGRhdGFzZXQuZGF0YVtwcmV2XSA9IHRhcmdldFZhbHVlc1twcmV2XTsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF3VGFyZ2V0ID0gdGFyZ2V0VmFsdWVzW2luZGV4XTsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgICBjb25zdCByYXdQcmV2aW91cyA9IGluZGV4ID09PSAwID8gMCA6IHRhcmdldFZhbHVlc1tpbmRleCAtIDFdOw0KICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFZhbHVlID0gTnVtYmVyLmlzRmluaXRlKHJhd1RhcmdldCkgPyByYXdUYXJnZXQgOiAwOw0KICAgICAgDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzVmFsdWUgPSBOdW1iZXIuaXNGaW5pdGUocmF3UHJldmlvdXMpID8gcmF3UHJldmlvdXMgOiB0YXJnZXRWYWx1ZTsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgICBkYXRhc2V0LmRhdGFbaW5kZXhdID0gcHJldmlvdXNWYWx1ZSArICh0YXJnZXRWYWx1ZSAtIHByZXZpb3VzVmFsdWUpICogcHJvZ3Jlc3M7DQogICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZnV0dXJlID0gaW5kZXggKyAxOyBmdXR1cmUgPCBsYWJlbENvdW50OyBmdXR1cmUgKz0gMSkgew0KICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgZGF0YXNldC5kYXRhW2Z1dHVyZV0gPSBudWxsOw0KICAgICAgDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIGhpZGRlbkNoYXJ0LmNoYXJ0LnVwZGF0ZSgpOw0KICAgICAgDQogICAgICAgICAgICAgICAgICBhd2FpdCB3YWl0Rm9yTmV4dEZyYW1lKCk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIGFkZEZyYW1lKGZyYW1lRGVsYXkpOw0KICAgICAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgICAgICAgZGF0YXNldHMuZm9yRWFjaCgoZGF0YXNldCwgZGF0YXNldEluZGV4KSA9PiB7DQogICAgICANCiAgICAgICAgICAgICAgICAgIGRhdGFzZXQuZGF0YVtpbmRleF0gPSB0YXJnZXREYXRhW2RhdGFzZXRJbmRleF1baW5kZXhdOw0KICAgICAgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgICAgICBoaWRkZW5DaGFydC5jaGFydC51cGRhdGUoKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGF3YWl0IHdhaXRGb3JOZXh0RnJhbWUoKTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGFkZEZyYW1lKGZyYW1lRGVsYXkpOw0KICAgICAgDQogICAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgICBhZGRGcmFtZShmcmFtZURlbGF5ICogaG9sZERlbGF5TXVsdGlwbGllcik7DQogICAgICANCiAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGdpZi5vbigiZmluaXNoZWQiLCBibG9iID0+IHsNCiAgICAgIA0KICAgICAgICAgICAgICAgICAgaGlkZGVuQ2hhcnQuZGVzdHJveSgpOw0KICAgICAgDQogICAgICAgICAgICAgICAgICByZXNvbHZlKGJsb2IpOw0KICAgICAgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgICAgICBnaWYub24oImFib3J0IiwgKCkgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICBoaWRkZW5DaGFydC5kZXN0cm95KCk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoIkdJRiBleHBvcnQgd2FzIGFib3J0ZWQuIikpOw0KICAgICAgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICANCiAgICAgICAgICAgICAgICBnaWYub24oImVycm9yIiwgZXJyb3IgPT4gew0KICAgICAgDQogICAgICAgICAgICAgICAgICBoaWRkZW5DaGFydC5kZXN0cm95KCk7DQogICAgICANCiAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7DQogICAgICANCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgICAgICAgIGdpZi5yZW5kZXIoKTsNCiAgICAgIA0KICAgICAgICAgICAgICB9KTsNCiAgICAgIA0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIA0KICAgICAgICAgICAgICBoaWRkZW5DaGFydC5kZXN0cm95KCk7DQogICAgICANCiAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7DQogICAgICANCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgDQogICAgICANCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBleHBvcnRDaGFydEFuaW1hdGlvbigpIHsNCiAgICAgIA0KICAgICAgICAgICAgY29uc3QgY2hhcnQgPSBzdGF0ZS5jaGFydHMudHJlbmQ7DQogICAgICANCiAgICAgICAgICAgIGlmICghY2hhcnQpIHsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiTG9hZCBkYXRhIHRvIGV4cG9ydCB0aGUgY2hhcnQuIiwgdHJ1ZSk7DQogICAgICANCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGlmICghc3RhdGUubGF0ZXN0VHJlbmRQZXJpb2RzLmxlbmd0aCkgew0KICAgICAgDQogICAgICAgICAgICAgIHNob3dFeHBvcnRIaW50KCJMb2FkIGRhdGEgdG8gZXhwb3J0IHRoZSBjaGFydC4iLCB0cnVlKTsNCiAgICAgIA0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICANCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKHR5cGVvZiBHSUYgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICANCiAgICAgICAgICAgICAgc2hvd0V4cG9ydEhpbnQoIkdJRiBleHBvcnQgbGlicmFyeSBpcyB1bmF2YWlsYWJsZS4iLCB0cnVlKTsNCiAgICAgIA0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICANCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgaWYgKGlzRXhwb3J0aW5nR2lmKSB7DQogICAgICANCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgDQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGlzRXhwb3J0aW5nR2lmID0gdHJ1ZTsNCiAgICAgIA0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiUmVuZGVyaW5nIEdJRiBhbmltYXRpb24uLi4iLCBmYWxzZSk7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3QgaW5jbHVkZURldGFpbHMgPSBzdGF0ZS5leHBvcnRQcmVmZXJlbmNlcy5pbmNsdWRlRGV0YWlscyAhPT0gZmFsc2UgJiYgc3RhdGUuc2VyaWVzRGV0YWlsTW9kZSAhPT0gIm5vbmUiOw0KICAgICAgDQogICAgICAgICAgICAgIGNvbnN0IGRldGFpbE1vZGUgPSBzdGF0ZS5zZXJpZXNEZXRhaWxNb2RlID09PSAibm9uZSIgPyAibm9uZSIgOiAoaW5jbHVkZURldGFpbHMgPyAiYWxsIiA6ICJyZXNwZWN0Iik7DQogICAgICANCiAgICAgICAgICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IGV4cG9ydFRyZW5kQ2hhcnRHaWYoeyBkZXRhaWxNb2RlLCBzY2FsZTogMiwgZnJhbWVEZWxheTogOTAsIGZyYW1lc1BlclBvaW50OiA2LCBob2xkRGVsYXlNdWx0aXBsaWVyOiAxNCB9KTsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IGBjb3BpbG90LXRyZW5kLSR7Zm9ybWF0VGltZXN0YW1wKCl9LmdpZmA7DQogICAgICANCiAgICAgICAgICAgICAgZG93bmxvYWRCbG9iKGJsb2IsIGZpbGVuYW1lKTsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludChgU2F2ZWQgYW5pbWF0aW9uIGFzICR7ZmlsZW5hbWV9LmAsIGZhbHNlKTsNCiAgICAgIA0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgIA0KICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJBbmltYXRpb24gZXhwb3J0IGZhaWxlZCIsIGVycm9yKTsNCiAgICAgIA0KICAgICAgICAgICAgICBzaG93RXhwb3J0SGludCgiQ291bGQgbm90IHJlbmRlciBHSUYgYW5pbWF0aW9uLiIsIHRydWUpOw0KICAgICAgDQogICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgDQogICAgICAgICAgICAgIGlzRXhwb3J0aW5nR2lmID0gZmFsc2U7DQogICAgICANCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkRGF0YVVSTChkYXRhVXJsLCBmaWxlbmFtZSkgew0KICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCiAgICAgICAgICAgIGxpbmsuaHJlZiA9IGRhdGFVcmw7DQogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gZmlsZW5hbWU7DQogICAgICAgICAgICBsaW5rLnJlbCA9ICJub29wZW5lciI7DQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZChsaW5rKTsNCiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsNCiAgICAgICAgICAgIGxpbmsucmVtb3ZlKCk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkQmxvYihibG9iLCBmaWxlbmFtZSkgew0KICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsNCiAgICAgICAgICBsaW5rLmhyZWYgPSB1cmw7DQogICAgICAgICAgbGluay5kb3dubG9hZCA9IGZpbGVuYW1lOw0KICAgICAgICAgICAgbGluay5yZWwgPSAibm9vcGVuZXIiOw0KICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQobGluayk7DQogICAgICAgICAgbGluay5jbGljaygpOw0KICAgICAgICAgIGxpbmsucmVtb3ZlKCk7DQogICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gc2V0dXBGaWx0ZXJUb2dnbGVHcm91cChidXR0b25zLCBzZWxlY3QsIGRhdGFzZXRLZXkpIHsNCiAgICAgICAgICBpZiAoIWJ1dHRvbnMgfHwgIWJ1dHRvbnMubGVuZ3RoIHx8ICFzZWxlY3QpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCB1cGRhdGVBY3RpdmUgPSAoKSA9PiB7DQogICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gc2VsZWN0LnZhbHVlOw0KICAgICAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiB7DQogICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYnV0dG9uLmRhdGFzZXRbZGF0YXNldEtleV07DQogICAgICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdmFsdWUgPT09IGN1cnJlbnQ7DQogICAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCJpcy1hY3RpdmUiLCBpc0FjdGl2ZSk7DQogICAgICAgICAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImFyaWEtcHJlc3NlZCIsIFN0cmluZyhpc0FjdGl2ZSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfTsNCiAgICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IHsNCiAgICAgICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBidXR0b24uZGF0YXNldFtkYXRhc2V0S2V5XTsNCiAgICAgICAgICAgICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PT0gc2VsZWN0LnZhbHVlKSB7DQogICAgICAgICAgICAgICAgdXBkYXRlQWN0aXZlKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHNlbGVjdC52YWx1ZSA9IHZhbHVlOw0KICAgICAgICAgICAgICB1cGRhdGVBY3RpdmUoKTsNCiAgICAgICAgICAgICAgc2VsZWN0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJjaGFuZ2UiLCB7IGJ1YmJsZXM6IHRydWUgfSkpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSk7DQogICAgICAgICAgdXBkYXRlQWN0aXZlKCk7DQogICAgICAgICAgcmV0dXJuIHVwZGF0ZUFjdGl2ZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHJlZnJlc2hGaWx0ZXJUb2dnbGVTdGF0ZXMoKSB7DQogICAgICAgICAgZmlsdGVyVG9nZ2xlVXBkYXRlcnMuZm9yRWFjaCh1cGRhdGUgPT4gew0KICAgICAgICAgICAgaWYgKHR5cGVvZiB1cGRhdGUgPT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICB1cGRhdGUoKTsNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byByZWZyZXNoIGZpbHRlciB0b2dnbGUgc3RhdGUiLCBlcnJvcik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGV4dHJhY3RNdWx0aVNlbGVjdFZhbHVlcyhzZWxlY3QpIHsNCiAgICAgICAgICBpZiAoIXNlbGVjdCkgew0KICAgICAgICAgICAgcmV0dXJuIFtdOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShzZWxlY3Quc2VsZWN0ZWRPcHRpb25zKQ0KICAgICAgICAgICAgLm1hcChvcHRpb24gPT4gb3B0aW9uLnZhbHVlKQ0KICAgICAgICAgICAgLmZpbHRlcih2YWx1ZSA9PiB2YWx1ZSAmJiB2YWx1ZSAhPT0gImFsbCIpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gc3luY011bHRpU2VsZWN0KHNlbGVjdCwgc2VsZWN0ZWRTZXQpIHsNCiAgICAgICAgICBpZiAoIXNlbGVjdCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCBoYXNTZWxlY3Rpb24gPSBzZWxlY3RlZFNldCBpbnN0YW5jZW9mIFNldCAmJiBzZWxlY3RlZFNldC5zaXplID4gMDsNCiAgICAgICAgICBBcnJheS5mcm9tKHNlbGVjdC5vcHRpb25zKS5mb3JFYWNoKG9wdGlvbiA9PiB7DQogICAgICAgICAgICBpZiAob3B0aW9uLnZhbHVlID09PSAiYWxsIikgew0KICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSAhaGFzU2VsZWN0aW9uOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNTZWxlY3Rpb24pIHsNCiAgICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gc2VsZWN0ZWRTZXQuaGFzKG9wdGlvbi52YWx1ZSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGZvcm1hdFRpbWVzdGFtcCgpIHsNCiAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgY29uc3QgcGFydHMgPSBbDQogICAgICAgICAgICAgIG5vdy5nZXRVVENGdWxsWWVhcigpLA0KICAgICAgICAgICAgICBTdHJpbmcobm93LmdldFVUQ01vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAiMCIpLA0KICAgICAgICAgICAgICBTdHJpbmcobm93LmdldFVUQ0RhdGUoKSkucGFkU3RhcnQoMiwgIjAiKSwNCiAgICAgICAgICAgICAgU3RyaW5nKG5vdy5nZXRVVENIb3VycygpKS5wYWRTdGFydCgyLCAiMCIpLA0KICAgICAgICAgICAgICBTdHJpbmcobm93LmdldFVUQ01pbnV0ZXMoKSkucGFkU3RhcnQoMiwgIjAiKSwNCiAgICAgICAgICAgICAgU3RyaW5nKG5vdy5nZXRVVENTZWNvbmRzKCkpLnBhZFN0YXJ0KDIsICIwIikNCiAgICAgICAgICAgIF07DQogICAgICAgICAgICByZXR1cm4gcGFydHMuam9pbigiIik7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2VsZWN0T3B0aW9ucyhzZWxlY3QsIHZhbHVlcywgZGVmYXVsdExhYmVsKSB7DQogICAgICAgICAgICBpZiAoIXNlbGVjdCkgew0KICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB0YXJnZXRTZXQgPSBzZWxlY3QgPT09IGRvbS5vcmdhbml6YXRpb25GaWx0ZXIgPyBzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbiA6IHN0YXRlLmZpbHRlcnMuY291bnRyeTsNCiAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRWYWx1ZXMgPSBBcnJheS5mcm9tKHZhbHVlcykNCiAgICAgICAgICAgICAgLmZpbHRlcih2YWx1ZSA9PiB2YWx1ZSAmJiB2YWx1ZSAhPT0gIlVuc3BlY2lmaWVkIikNCiAgICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGEubG9jYWxlQ29tcGFyZShiKSk7DQogICAgICAgICAgICBjb25zdCB2YWxpZFZhbHVlcyA9IG5ldyBTZXQobm9ybWFsaXplZFZhbHVlcyk7DQogICAgICAgICAgICBjb25zdCBhY3RpdmVTZXQgPSB0YXJnZXRTZXQgaW5zdGFuY2VvZiBTZXQgPyB0YXJnZXRTZXQgOiBuZXcgU2V0KCk7DQogICAgICAgICAgICBpZiAoISh0YXJnZXRTZXQgaW5zdGFuY2VvZiBTZXQpKSB7DQogICAgICAgICAgICAgIGlmIChzZWxlY3QgPT09IGRvbS5vcmdhbml6YXRpb25GaWx0ZXIpIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLm9yZ2FuaXphdGlvbiA9IGFjdGl2ZVNldDsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5maWx0ZXJzLmNvdW50cnkgPSBhY3RpdmVTZXQ7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFycmF5LmZyb20oYWN0aXZlU2V0KS5mb3JFYWNoKHZhbHVlID0+IHsNCiAgICAgICAgICAgICAgaWYgKCF2YWxpZFZhbHVlcy5oYXModmFsdWUpKSB7DQogICAgICAgICAgICAgICAgYWN0aXZlU2V0LmRlbGV0ZSh2YWx1ZSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgc2VsZWN0LmlubmVySFRNTCA9ICIiOw0KICAgICAgICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpOw0KICAgICAgICAgICAgZGVmYXVsdE9wdGlvbi52YWx1ZSA9ICJhbGwiOw0KICAgICAgICAgICAgZGVmYXVsdE9wdGlvbi50ZXh0Q29udGVudCA9IGRlZmF1bHRMYWJlbDsNCiAgICAgICAgICAgIHNlbGVjdC5hcHBlbmQoZGVmYXVsdE9wdGlvbik7DQogICAgICAgICAgICBub3JtYWxpemVkVmFsdWVzLmZvckVhY2godmFsdWUgPT4gew0KICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJvcHRpb24iKTsNCiAgICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gdmFsdWU7DQogICAgICAgICAgICAgIG9wdGlvbi50ZXh0Q29udGVudCA9IHZhbHVlOw0KICAgICAgICAgICAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHN5bmNNdWx0aVNlbGVjdChzZWxlY3QsIGFjdGl2ZVNldCk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZm9ybWF0TnVtYmVyKHZhbHVlKSB7DQogICAgICAgICAgICByZXR1cm4gbnVtYmVyRm9ybWF0dGVyLmZvcm1hdChNYXRoLnJvdW5kKHZhbHVlKSk7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gcGFyc2VOdW1iZXIodmFsdWUpIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IHZhbHVlID09PSAiIikgew0KICAgICAgICAgICAgICByZXR1cm4gMDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7DQogICAgICAgICAgICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpID8gdmFsdWUgOiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IFN0cmluZyh2YWx1ZSkucmVwbGFjZSgvLC9nLCAiIikudHJpbSgpOw0KICAgICAgICAgICAgaWYgKCFub3JtYWxpemVkKSB7DQogICAgICAgICAgICAgIHJldHVybiAwOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gTnVtYmVyKG5vcm1hbGl6ZWQpOw0KICAgICAgICAgICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZShwYXJzZWQpID8gcGFyc2VkIDogMDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZU1ldHJpY0RhdGUodmFsdWUpIHsNCiAgICAgICAgICAgIGlmICghdmFsdWUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCB0cmltbWVkID0gU3RyaW5nKHZhbHVlKS50cmltKCk7DQogICAgICAgICAgICBpZiAoIXRyaW1tZWQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGlzb01hdGNoID0gdHJpbW1lZC5tYXRjaCgvXihcZHs0fSktKFxkezJ9KS0oXGR7Mn0pLyk7DQogICAgICAgICAgICBpZiAoaXNvTWF0Y2gpIHsNCiAgICAgICAgICAgICAgY29uc3QgeWVhciA9IE51bWJlcihpc29NYXRjaFsxXSk7DQogICAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gTnVtYmVyKGlzb01hdGNoWzJdKTsNCiAgICAgICAgICAgICAgY29uc3QgZGF5ID0gTnVtYmVyKGlzb01hdGNoWzNdKTsNCiAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoeWVhcikgfHwgIU51bWJlci5pc0Zpbml0ZShtb250aCkgfHwgIU51bWJlci5pc0Zpbml0ZShkYXkpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoIC0gMSwgZGF5KSk7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IHNsYXNoTWF0Y2ggPSB0cmltbWVkLm1hdGNoKC9eKFxkezEsMn0pXC8oXGR7MSwyfSlcLyhcZHsyLDR9KS8pOw0KICAgICAgICAgICAgaWYgKHNsYXNoTWF0Y2gpIHsNCiAgICAgICAgICAgICAgbGV0IG1vbnRoID0gTnVtYmVyKHNsYXNoTWF0Y2hbMV0pOw0KICAgICAgICAgICAgICBsZXQgZGF5ID0gTnVtYmVyKHNsYXNoTWF0Y2hbMl0pOw0KICAgICAgICAgICAgICBsZXQgeWVhciA9IE51bWJlcihzbGFzaE1hdGNoWzNdKTsNCiAgICAgICAgICAgICAgaWYgKHllYXIgPCAxMDApIHsNCiAgICAgICAgICAgICAgICB5ZWFyICs9IDIwMDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoeWVhcikgfHwgIU51bWJlci5pc0Zpbml0ZShtb250aCkgfHwgIU51bWJlci5pc0Zpbml0ZShkYXkpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoIC0gMSwgZGF5KSk7DQogICAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICAgIGNvbnN0IGRvdHRlZE1hdGNoID0gdHJpbW1lZC5tYXRjaCgvXihcZHsxLDJ9KVwuKFxkezEsMn0pXC4oXGR7Miw0fSkvKTsNCiAgICAgICAgICAgIGlmIChkb3R0ZWRNYXRjaCkgew0KICAgICAgICAgICAgICBsZXQgZGF5ID0gTnVtYmVyKGRvdHRlZE1hdGNoWzFdKTsNCiAgICAgICAgICAgICAgbGV0IG1vbnRoID0gTnVtYmVyKGRvdHRlZE1hdGNoWzJdKTsNCiAgICAgICAgICAgICAgbGV0IHllYXIgPSBOdW1iZXIoZG90dGVkTWF0Y2hbM10pOw0KICAgICAgICAgICAgICBpZiAoeWVhciA8IDEwMCkgew0KICAgICAgICAgICAgICAgIHllYXIgKz0gMjAwMDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh5ZWFyKSB8fCAhTnVtYmVyLmlzRmluaXRlKG1vbnRoKSB8fCAhTnVtYmVyLmlzRmluaXRlKGRheSkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoeWVhciwgbW9udGggLSAxLCBkYXkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tUaW1lc3RhbXAgPSBEYXRlLnBhcnNlKHRyaW1tZWQpOw0KICAgICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShmYWxsYmFja1RpbWVzdGFtcCkpIHsNCiAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2sgPSBuZXcgRGF0ZShmYWxsYmFja1RpbWVzdGFtcCk7DQogICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyhmYWxsYmFjay5nZXRVVENGdWxsWWVhcigpLCBmYWxsYmFjay5nZXRVVENNb250aCgpLCBmYWxsYmFjay5nZXRVVENEYXRlKCkpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgIH0NCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUFnZW50RGF0ZSh2YWx1ZSkgew0KICAgICAgICAgICAgaWYgKCF2YWx1ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBTdHJpbmcodmFsdWUpLnRyaW0oKTsNCiAgICAgICAgICAgIGlmICghdHJpbW1lZCkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IGRpcmVjdFRpbWVzdGFtcCA9IERhdGUucGFyc2UodHJpbW1lZCk7DQogICAgICAgICAgICBpZiAoTnVtYmVyLmlzRmluaXRlKGRpcmVjdFRpbWVzdGFtcCkpIHsNCiAgICAgICAgICAgICAgY29uc3QgcGFyc2VkID0gbmV3IERhdGUoZGlyZWN0VGltZXN0YW1wKTsNCiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHBhcnNlZC5nZXRVVENGdWxsWWVhcigpLCBwYXJzZWQuZ2V0VVRDTW9udGgoKSwgcGFyc2VkLmdldFVUQ0RhdGUoKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc2hvcnRNYXRjaCA9IHRyaW1tZWQubWF0Y2goL14oXGR7MSwyfSktKFtBLVphLXpdezN9KS0oXGR7Miw0fSkkLyk7DQogICAgICAgICAgICBpZiAoc2hvcnRNYXRjaCkgew0KICAgICAgICAgICAgICBjb25zdCBkYXkgPSBOdW1iZXIoc2hvcnRNYXRjaFsxXSk7DQogICAgICAgICAgICAgIGNvbnN0IG1vbnRoTmFtZSA9IHNob3J0TWF0Y2hbMl0udG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgY29uc3QgcmF3WWVhciA9IE51bWJlcihzaG9ydE1hdGNoWzNdKTsNCiAgICAgICAgICAgICAgY29uc3QgbW9udGhJbmRleCA9IE1PTlRIX05BTUVfVE9fSU5ERVhbbW9udGhOYW1lXTsNCiAgICAgICAgICAgICAgY29uc3QgeWVhciA9IHJhd1llYXIgPCAxMDAgPyAyMDAwICsgcmF3WWVhciA6IHJhd1llYXI7DQogICAgICAgICAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoZGF5KSAmJiBOdW1iZXIuaXNGaW5pdGUoeWVhcikgJiYgbW9udGhJbmRleCAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKERhdGUuVVRDKHllYXIsIG1vbnRoSW5kZXgsIGRheSkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICB9DQogICAgICAgICAgZnVuY3Rpb24gY29tcHV0ZVdlZWtFbmRpbmdEYXRlKGRhdGUpIHsNCiAgICAgICAgICAgIGlmICghZGF0ZSkgew0KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHdlZWtFbmQgPSBuZXcgRGF0ZShEYXRlLlVUQyhkYXRlLmdldFVUQ0Z1bGxZZWFyKCksIGRhdGUuZ2V0VVRDTW9udGgoKSwgZGF0ZS5nZXRVVENEYXRlKCkpKTsNCiAgICAgICAgICAgIGNvbnN0IGRheSA9IHdlZWtFbmQuZ2V0VVRDRGF5KCk7DQogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSAoNiAtIGRheSArIDcpICUgNzsNCiAgICAgICAgICAgIHdlZWtFbmQuc2V0VVRDRGF0ZSh3ZWVrRW5kLmdldFVUQ0RhdGUoKSArIG9mZnNldCk7DQogICAgICAgICAgICByZXR1cm4gd2Vla0VuZDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiB0b0lzb1dlZWsoZGF0ZSkgew0KICAgICAgICAgICAgY29uc3QgY29weSA9IG5ldyBEYXRlKERhdGUuVVRDKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwgZGF0ZS5nZXRVVENNb250aCgpLCBkYXRlLmdldFVUQ0RhdGUoKSkpOw0KICAgICAgICAgICAgY29uc3QgZGF5ID0gY29weS5nZXRVVENEYXkoKSB8fCA3Ow0KICAgICAgICAgICAgY29weS5zZXRVVENEYXRlKGNvcHkuZ2V0VVRDRGF0ZSgpICsgNCAtIGRheSk7DQogICAgICAgICAgICBjb25zdCB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShEYXRlLlVUQyhjb3B5LmdldFVUQ0Z1bGxZZWFyKCksIDAsIDEpKTsNCiAgICAgICAgICAgIGNvbnN0IHdlZWsgPSBNYXRoLmNlaWwoKCgoY29weSAtIHllYXJTdGFydCkgLyA4NjQwMDAwMCkgKyAxKSAvIDcpOw0KICAgICAgICAgICAgcmV0dXJuIHsgeWVhcjogY29weS5nZXRVVENGdWxsWWVhcigpLCB3ZWVrIH07DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZm9ybWF0UmFuZ2VMYWJlbChzdGFydCwgZW5kKSB7DQogICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuICItIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHNhbWVNb250aCA9IHN0YXJ0LmdldFVUQ0Z1bGxZZWFyKCkgPT09IGVuZC5nZXRVVENGdWxsWWVhcigpICYmIHN0YXJ0LmdldFVUQ01vbnRoKCkgPT09IGVuZC5nZXRVVENNb250aCgpOw0KICAgICAgICAgICAgaWYgKHNhbWVNb250aCkgew0KICAgICAgICAgICAgICByZXR1cm4gYCR7Zm9ybWF0TW9udGhZZWFyKHN0YXJ0KX0gJHtzdGFydC5nZXRVVENEYXRlKCl9LSR7ZW5kLmdldFVUQ0RhdGUoKX1gOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGAke2Zvcm1hdFNob3J0RGF0ZShzdGFydCl9IHRvICR7Zm9ybWF0U2hvcnREYXRlKGVuZCl9YDsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBmb3JtYXRQZXJpb2RMYWJlbChsYWJlbCwgZGF0ZSkgew0KICAgICAgICAgICAgaWYgKHN0YXRlLmZpbHRlcnMuYWdncmVnYXRlID09PSAid2Vla2x5Iikgew0KICAgICAgICAgICAgICByZXR1cm4gbGFiZWw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZm9ybWF0TW9udGhZZWFyKGRhdGUpOw0KICAgICAgICAgIH0NCiAgICAgIA0KICAgICAgICAgIGZ1bmN0aW9uIGZvcm1hdE1vbnRoWWVhcihkYXRlKSB7DQogICAgICAgICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVN0cmluZygiZW4tVVMiLCB7IG1vbnRoOiAic2hvcnQiLCB5ZWFyOiAibnVtZXJpYyIsIHRpbWVab25lOiAiVVRDIiB9KTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBmb3JtYXRTaG9ydERhdGUoZGF0ZSkgewogICAgICAgICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVN0cmluZygiZW4tVVMiLCB7IG1vbnRoOiAic2hvcnQiLCBkYXk6ICJudW1lcmljIiwgeWVhcjogIm51bWVyaWMiLCB0aW1lWm9uZTogIlVUQyIgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGF0YXNldEV4Y2VlZHNDYWNoZUxpbWl0KHNpemVJbkJ5dGVzKSB7CiAgICAgICAgICAgIC8vIFByZXZlbnRzIGF0dGVtcHRpbmcgdG8gbWlycm9yIHZlcnkgbGFyZ2UgZGF0YXNldHMgaW50byBJbmRleGVkREIvbG9jYWxTdG9yYWdlLCB3aGljaCByZXBlYXRlZGx5IGZhaWxlZCBpbiBsb3ctbWVtb3J5IGJyb3dzZXJzLgogICAgICAgICAgICByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHNpemVJbkJ5dGVzKSAmJiBzaXplSW5CeXRlcyA+IERBVEFTRVRfQ0FDSEVfTElNSVRfQllURVM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YXNldENhY2hlTGltaXRNZXNzYWdlKCkgewogICAgICAgICAgICAvLyBTdXJmYWNlIGEgY2xlYXIgaGludCBzbyBmdXR1cmUgZGVidWdnaW5nIHNlc3Npb25zIGtub3cgd2h5IHBlcnNpc3RlbmNlIGZlbGwgYmFjayB0byBzZXNzaW9uLW9ubHkuCiAgICAgICAgICAgIHJldHVybiBgRGF0YXNldHMgbGFyZ2VyIHRoYW4gJHtmb3JtYXRGaWxlU2l6ZShEQVRBU0VUX0NBQ0hFX0xJTUlUX0JZVEVTKX0gc3RheSBpbiB0aGlzIHNlc3Npb24gb25seS5gOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGZvcm1hdEZpbGVTaXplKGJ5dGVDb3VudCkgewogICAgICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZShieXRlQ291bnQpIHx8IGJ5dGVDb3VudCA8PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuICIwIEIiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHVuaXRzID0gWyJCIiwgIktCIiwgIk1CIiwgIkdCIiwgIlRCIl07CiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGJ5dGVDb3VudDsKICAgICAgICAgICAgbGV0IHVuaXRJbmRleCA9IDA7CiAgICAgICAgICAgIHdoaWxlICh2YWx1ZSA+PSAxMDI0ICYmIHVuaXRJbmRleCA8IHVuaXRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICB2YWx1ZSAvPSAxMDI0OwogICAgICAgICAgICAgIHVuaXRJbmRleCArPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHJvdW5kZWQgPSB1bml0SW5kZXggPT09IDAgfHwgdmFsdWUgPj0gMTAwCiAgICAgICAgICAgICAgPyBNYXRoLnJvdW5kKHZhbHVlKQogICAgICAgICAgICAgIDogTWF0aC5yb3VuZCh2YWx1ZSAqIDEwKSAvIDEwOwogICAgICAgICAgICByZXR1cm4gYCR7bnVtYmVyRm9ybWF0dGVyLmZvcm1hdChyb3VuZGVkKX0gJHt1bml0c1t1bml0SW5kZXhdfWA7CiAgICAgICAgICB9Cg0KICAgICAgICAgIGZ1bmN0aW9uIGRldGVjdERlbGltaXRlckZyb21TYW1wbGUoc2FtcGxlVGV4dCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBzYW1wbGVUZXh0ICE9PSAic3RyaW5nIiB8fCAhc2FtcGxlVGV4dC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3Qgc25pcHBldCA9IHNhbXBsZVRleHQuc2xpY2UoMCwgODE5Mik7DQogICAgICAgICAgICBjb25zdCB0YXJnZXRMaW5lID0gc25pcHBldC5zcGxpdCgvXHI/XG4vKS5maW5kKGxpbmUgPT4gbGluZS50cmltKCkubGVuZ3RoKSB8fCBzbmlwcGV0Ow0KICAgICAgICAgICAgbGV0IGJlc3QgPSB7IGRlbGltaXRlcjogIiIsIGNvdW50OiAwLCBwcmlvcml0eTogQ1NWX0RFTElNSVRFUl9DQU5ESURBVEVTLmxlbmd0aCB9Ow0KICAgICAgICAgICAgQ1NWX0RFTElNSVRFUl9DQU5ESURBVEVTLmZvckVhY2goKGRlbGltaXRlciwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ0V4cChkZWxpbWl0ZXIpLCAiZyIpOw0KICAgICAgICAgICAgICBjb25zdCBjb3VudCA9ICh0YXJnZXRMaW5lLm1hdGNoKHJlZ2V4KSB8fCBbXSkubGVuZ3RoOw0KICAgICAgICAgICAgICBpZiAoY291bnQgPiBiZXN0LmNvdW50IHx8IChjb3VudCA9PT0gYmVzdC5jb3VudCAmJiBjb3VudCA+IDAgJiYgaW5kZXggPCBiZXN0LnByaW9yaXR5KSkgew0KICAgICAgICAgICAgICAgIGJlc3QgPSB7IGRlbGltaXRlciwgY291bnQsIHByaW9yaXR5OiBpbmRleCB9Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIHJldHVybiBiZXN0LmNvdW50ID4gMCA/IGJlc3QuZGVsaW1pdGVyIDogIiI7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gZGV0ZWN0RGVsaW1pdGVyRm9yRmlsZShmaWxlKSB7DQogICAgICAgICAgICBpZiAoIWZpbGUgfHwgdHlwZW9mIGZpbGUuc2xpY2UgIT09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgiIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICBjb25zdCBzbmlwcGV0ID0gZmlsZS5zbGljZSgwLCAxNjM4NCk7DQogICAgICAgICAgICAgIGlmICghc25pcHBldCB8fCB0eXBlb2Ygc25pcHBldC50ZXh0ICE9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgiIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgcmV0dXJuIHNuaXBwZXQudGV4dCgpLnRoZW4odGV4dCA9PiBkZXRlY3REZWxpbWl0ZXJGcm9tU2FtcGxlKHRleHQpKS5jYXRjaCgoKSA9PiAiIik7DQogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBpbnNwZWN0IENTViBzbmlwcGV0IGZvciBkZWxpbWl0ZXIiLCBlcnJvcik7DQogICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoIiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cCh2YWx1ZSkgew0KICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSkucmVwbGFjZSgvWy4qK1wtP14ke30oKXxbXF1cXF0vZywgIlxcJCYiKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBlbnN1cmVEYXRhc2V0RmllbGRMb29rdXAoZmllbGRzLCBzYW1wbGVSb3cpIHsNCiAgICAgICAgICAgIGlmIChjdXJyZW50Q3N2RmllbGRMb29rdXAgJiYgY3VycmVudENzdkZpZWxkTG9va3VwLnNpemUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgZnJvbUZpZWxkcyA9IGJ1aWxkRmllbGRMb29rdXAoZmllbGRzKTsNCiAgICAgICAgICAgIGlmIChmcm9tRmllbGRzKSB7DQogICAgICAgICAgICAgIGN1cnJlbnRDc3ZGaWVsZExvb2t1cCA9IGZyb21GaWVsZHM7DQogICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzYW1wbGVSb3cgJiYgdHlwZW9mIHNhbXBsZVJvdyA9PT0gIm9iamVjdCIgJiYgc2FtcGxlUm93ICE9PSBudWxsKSB7DQogICAgICAgICAgICAgIGNvbnN0IGxvb2t1cCA9IGJ1aWxkRmllbGRMb29rdXAoT2JqZWN0LmtleXMoc2FtcGxlUm93KSk7DQogICAgICAgICAgICAgIGlmIChsb29rdXApIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50Q3N2RmllbGRMb29rdXAgPSBsb29rdXA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBmdW5jdGlvbiBidWlsZEZpZWxkTG9va3VwKGZpZWxkcykgew0KICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGZpZWxkcykpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb25zdCBsb29rdXAgPSBuZXcgTWFwKCk7DQogICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmllbGRzLmxlbmd0aDsgaW5kZXggKz0gMSkgew0KICAgICAgICAgICAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tpbmRleF07DQogICAgICAgICAgICAgIGlmICh0eXBlb2YgZmllbGQgIT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZUhlYWRlcktleShmaWVsZCk7DQogICAgICAgICAgICAgIGlmIChub3JtYWxpemVkICYmICFsb29rdXAuaGFzKG5vcm1hbGl6ZWQpKSB7DQogICAgICAgICAgICAgICAgbG9va3VwLnNldChub3JtYWxpemVkLCBmaWVsZCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBsb29rdXAuc2l6ZSA/IGxvb2t1cCA6IG51bGw7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplSGVhZGVyS2V5KHZhbHVlKSB7DQogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgew0KICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsZXQgbm9ybWFsaXplZCA9IFN0cmluZyh2YWx1ZSkucmVwbGFjZSgvXHVGRUZGL2csICIiKS50cmltKCk7DQogICAgICAgICAgICBpZiAoIW5vcm1hbGl6ZWQpIHsNCiAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHR5cGVvZiBub3JtYWxpemVkLm5vcm1hbGl6ZSA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5ub3JtYWxpemUoIk5GS0QiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2UoL1tcdTAzMDAtXHUwMzZmXS9nLCAiIik7DQogICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1teYS16MC05XSsvZywgIl8iKS5yZXBsYWNlKC9eXyt8XyskL2csICIiKTsNCiAgICAgICAgICAgIHJldHVybiBub3JtYWxpemVkOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHBhZCh2YWx1ZSkgew0KICAgICAgICAgICAgcmV0dXJuIFN0cmluZyh2YWx1ZSkucGFkU3RhcnQoMiwgIjAiKTsNCiAgICAgICAgICB9DQogICAgICANCiAgICAgICAgICBmdW5jdGlvbiBzYW5pdGl6ZUxhYmVsKHZhbHVlKSB7DQogICAgICAgICAgICBpZiAoIXZhbHVlKSB7DQogICAgICAgICAgICAgIHJldHVybiAiIjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWQgPSBTdHJpbmcodmFsdWUpLnRyaW0oKTsNCiAgICAgICAgICAgIHJldHVybiB0cmltbWVkIHx8ICIiOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGZ1bmN0aW9uIHNob3J0ZW5MYWJlbCh2YWx1ZSwgbWF4TGVuZ3RoID0gNDgpIHsNCiAgICAgICAgICAgIGlmICghdmFsdWUpIHsNCiAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBTdHJpbmcodmFsdWUpOw0KICAgICAgICAgICAgaWYgKGxhYmVsLmxlbmd0aCA8PSBtYXhMZW5ndGgpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGxhYmVsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIGAke2xhYmVsLnNsaWNlKDAsIG1heExlbmd0aCAtIDEpfeKApmA7DQogICAgICAgICAgfQ0KICAgICAgDQogICAgICAgICAgZnVuY3Rpb24gZ2V0R3JvdXBLZXkocm93LCBncm91cGluZykgew0KICAgICAgICAgICAgaWYgKGdyb3VwaW5nID09PSAiY291bnRyeSIpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHJvdy5jb3VudHJ5IHx8ICJVbnNwZWNpZmllZCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoZ3JvdXBpbmcgPT09ICJkb21haW4iKSB7DQogICAgICAgICAgICAgIHJldHVybiByb3cuZG9tYWluIHx8ICJVbnNwZWNpZmllZCI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gcm93Lm9yZ2FuaXphdGlvbiB8fCAiVW5zcGVjaWZpZWQiOw0KICAgICAgICAgIH0NCiAgfQ0KfSkoKTsNCg==
`;
const SHAREPOINT_HTML_BASE64 = `
CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSIgLz4KICA8bWV0YQogICAgaHR0cC1lcXVpdj0iQ29udGVudC1TZWN1cml0eS1Qb2xpY3kiCiAgICBjb250ZW50PSJkZWZhdWx0LXNyYyAnc2VsZic7CiAgICAgICAgICAgICAgICAgc2NyaXB0LXNyYyAnc2VsZicgaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0OwogICAgICAgICAgICAgICAgIHN0eWxlLXNyYyAnc2VsZicgaHR0cHM6Ly9yc21zLm1lOwogICAgICAgICAgICAgICAgIGltZy1zcmMgJ3NlbGYnIGRhdGE6OwogICAgICAgICAgICAgICAgIGZvbnQtc3JjIGh0dHBzOi8vcnNtcy5tZTsKICAgICAgICAgICAgICAgICBjb25uZWN0LXNyYyAnc2VsZicgaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0OwogICAgICAgICAgICAgICAgIHdvcmtlci1zcmMgJ3NlbGYnIGJsb2I6OwogICAgICAgICAgICAgICAgIG9iamVjdC1zcmMgJ25vbmUnOwogICAgICAgICAgICAgICAgIGJhc2UtdXJpICdzZWxmJzsKICAgICAgICAgICAgICAgICB1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzIgogIC8+CiAgPG1ldGEgbmFtZT0icmVmZXJyZXIiIGNvbnRlbnQ9Im5vLXJlZmVycmVyIiAvPgogIDx0aXRsZT5Db3BpbG90IEltcGFjdCBEYXNoYm9hcmQ8L3RpdGxlPgogIDxsaW5rIHJlbD0icHJlY29ubmVjdCIgaHJlZj0iaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbSIgY3Jvc3NvcmlnaW4gLz4KICA8bGluawogICAgcmVsPSJzdHlsZXNoZWV0IgogICAgaHJlZj0iaHR0cHM6Ly9yc21zLm1lL2ludGVyL2ludGVyLmNzcyIKICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICBpbnRlZ3JpdHk9InNoYTM4NC1TVGlUWjJramRuYy9lbTRqU0VMWlo2VnlwUlRvYzkyY0EwbTZOcHB4M0o4QzRtdDBmak1OVW0xeG5tMXlvUDk2IgogIC8+CiAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJhc3NldHMvY29waWxvdC1kYXNoYm9hcmQuY3NzIiAvPgogIDxzY3JpcHQKICAgIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9wYXBhcGFyc2VANS40LjEvcGFwYXBhcnNlLm1pbi5qcyIKICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICBpbnRlZ3JpdHk9InNoYTM4NC1EL3QwWk1xUVczMUgzYXo4a3RFaU5iMzl3eUtuUzgyaUZZNTJRUEFDTStJaktXM2pEVWh5SWdoMlBBcFJxSlpzIgogID48L3NjcmlwdD4KICA8c2NyaXB0CiAgICBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vY2hhcnQuanNANC40LjcvZGlzdC9jaGFydC51bWQubWluLmpzIgogICAgY3Jvc3NvcmlnaW49ImFub255bW91cyIKICAgIGludGVncml0eT0ic2hhMzg0LXZzcmZlTE9PWTZLdUlZS0RsbVZINVVpQm1nSWRCMW9FZjdwMDFZZ1dIdXFtT0hmWnIzNzQrb2RFdjk2bjl0TkMiCiAgPjwvc2NyaXB0PgoKICA8c2NyaXB0CiAgICBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vZ2lmLmpzLm9wdGltaXplZEAxLjAuMS9kaXN0L2dpZi5qcyIKICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICBpbnRlZ3JpdHk9InNoYTM4NC1OUkJ1ZFM4ajBDNG4xenQ2WnBpZFJqSDcyNFFUN1ZYQVJ5ZUdESTlTWW40YjBYN0pVeEJJUDBKbFV4WFh5WlBjIgogID48L3NjcmlwdD4KICA8c2NyaXB0CiAgICBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0veGxzeEAwLjE4LjUvZGlzdC94bHN4LmZ1bGwubWluLmpzIgogICAgY3Jvc3NvcmlnaW49ImFub255bW91cyIKICAgIGludGVncml0eT0ic2hhMzg0LXZ0amFzeWlkVW8wa1c5NEs1TVhEWG50ek9KcFFnQktYbUU3ZTJHYTRMRzBza1RUTGVCaTk3ZUZBWHNxZXdKanciCiAgPjwvc2NyaXB0PgogIDxzY3JpcHQKICAgIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9odG1sMmNhbnZhc0AxLjQuMS9kaXN0L2h0bWwyY2FudmFzLm1pbi5qcyIKICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICBpbnRlZ3JpdHk9InNoYTM4NC1aWjFwbmNVM2JRZTh5MzF5ZlpkTUZkU3B0dERvUG1PWmcyd2d1Vks5YWxtVW9kaXIxUGdoZ1QwZVk3TXJ0eThIIgogID48L3NjcmlwdD4KICA8c2NyaXB0CiAgICBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vanNwZGZAMi41LjEvZGlzdC9qc3BkZi51bWQubWluLmpzIgogICAgY3Jvc3NvcmlnaW49ImFub255bW91cyIKICAgIGludGVncml0eT0ic2hhMzg0LUpjbnNqVVBQeWxuYTFzMWZ2aTF1MTJYNXFqWTVPTDU2aXlTaDc1RmR0cndoTy9TV1hnTWpvVnFjS3lJSVdPTGsiCiAgPjwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogIDxhIGhyZWY9IiNpbXBhY3QiIGNsYXNzPSJza2lwLWxpbmsiPlNraXAgdG8gbWFpbiBjb250ZW50PC9hPgogIDxkaXYgY2xhc3M9InRvYXN0LWNvbnRhaW5lciIgZGF0YS10b2FzdC1jb250YWluZXI+PC9kaXY+CiAgPG1haW4+CiAgICA8aGVhZGVyIGNsYXNzPSJwYWdlLWhlYWRlciIgaWQ9ImltcGFjdCI+CiAgICAgIDxhcnRpY2xlIGNsYXNzPSJpbnRyby1jYXJkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJpbnRyby1oZWFkZXIiPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImRhc2hib2FyZC1waWxsIj5NaWNyb3NvZnQgQ29waWxvdCBEYXNoYm9hcmQ8L3NwYW4+CiAgICAgICAgICA8cCBjbGFzcz0iaW50cm8iPlVwbG9hZCB0aGUgQ29waWxvdCBDU1YgZXhwb3J0IGZyb20gVml2YSBJbnNpZ2h0cy48L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idXBsb2FkLXpvbmUiIGRhdGEtZHJvcC16b25lIHJvbGU9InJlZ2lvbiIgYXJpYS1sYWJlbD0iRmlsZSB1cGxvYWQgYXJlYSI+CiAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZpbGVJbnB1dCIgYWNjZXB0PSIuY3N2IiBkYXRhLWZpbGUtaW5wdXQgaGlkZGVuIGFyaWEtZGVzY3JpYmVkYnk9InVwbG9hZEhpbnQiIC8+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ1cGxvYWQtYWN0aW9ucyI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InVwbG9hZC1idXR0b25zIj4KICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJmaWxlSW5wdXQiIGNsYXNzPSJ1cGxvYWQtYnV0dG9uIj5TZWxlY3QgQ1NWIGZpbGU8L2xhYmVsPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InVwbG9hZC1idXR0b24tZ3JvdXAiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ1cGxvYWQtYnV0dG9uIHVwbG9hZC1idXR0b24tLWdob3N0IiBkYXRhLWxvYWQtc2FtcGxlPkxvYWQgc2FtcGxlIGRhdGFzZXQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic3RvcmFnZS1idXR0b24gc3RvcmFnZS1idXR0b24tLWlubGluZSIgZGF0YS1jbGVhci1zdG9yYWdlIGhpZGRlbj5DbGVhciBzYXZlZCBkYXRhc2V0PC9idXR0b24+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8c3BhbiBjbGFzcz0idXBsb2FkLWhpbnQgbXV0ZWQiIGlkPSJ1cGxvYWRIaW50Ij5vciBkcm9wIHRoZSBmaWxlIGFueXdoZXJlIGluIHRoaXMgcGFuZWw8L3NwYW4+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InVwbG9hZC1wcm9ncmVzcyIgZGF0YS11cGxvYWQtcHJvZ3Jlc3MgaGlkZGVuPgogICAgICAgICAgICA8cHJvZ3Jlc3MgY2xhc3M9InVwbG9hZC1wcm9ncmVzc19fYmFyIiB2YWx1ZT0iMCIgbWF4PSIxMDAiIGRhdGEtdXBsb2FkLXByb2dyZXNzLWJhcj48L3Byb2dyZXNzPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVwbG9hZC1jYW5jZWwiIGRhdGEtdXBsb2FkLWNhbmNlbD5DYW5jZWwgaW1wb3J0PC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InN0b3JhZ2UtY29udHJvbHMiIGRhdGEtc3RvcmFnZS1jb250cm9scz4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJzdG9yYWdlLWNvbnNlbnQiPgogICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGF0YS1jb25zZW50LXBlcnNpc3QgLz4KICAgICAgICAgICAgICBTYXZlIGRhdGFzZXQgb24gdGhpcyBkZXZpY2UKICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgPHAgY2xhc3M9InN0b3JhZ2UtaGludCIgZGF0YS1zdG9yYWdlLWhpbnQ+RGF0YXNldHMgc3RheSBvbiB0aGlzIGRldmljZSBvbmx5IHdoZW4geW91IG9wdCBpbi48L3A+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxwIGNsYXNzPSJ1cGxvYWQtbWV0YSIgZGF0YS11cGxvYWQtbWV0YT5ObyBmaWxlIGNob3NlbiB5ZXQuPC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InVwbG9hZC1zdGF0dXMiIHJvbGU9InN0YXR1cyIgYXJpYS1saXZlPSJwb2xpdGUiIGRhdGEtdXBsb2FkLXN0YXR1cz5XYWl0aW5nIGZvciB5b3VyIGRhdGEuPC9kaXY+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAgPGFzaWRlIGNsYXNzPSJkYXRhc2V0LWNhcmQiIHJvbGU9ImNvbXBsZW1lbnRhcnkiIGFyaWEtbGFiZWw9IkRhdGFzZXQgaW5mb3JtYXRpb24iPgogICAgICA8aDI+RGF0YXNldCBzdGF0dXM8L2gyPgogICAgICA8cCBjbGFzcz0ibXV0ZWQiIGRhdGEtZGF0YXNldC1tZXNzYWdlPkxvYWQgYSBDU1YgZXhwb3J0IHRvIHVubG9jayB0aGUgZnVsbCBkYXNoYm9hcmQgZXhwZXJpZW5jZS48L3A+CiAgICAgIDxkaXYgY2xhc3M9ImRhdGFzZXQtbWV0YS1ncmlkIiBkYXRhLWRhdGFzZXQtbWV0YSBoaWRkZW4+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJtZXRhLWl0ZW0iPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXV0ZWQiPlJlY29yZHMgcHJvY2Vzc2VkPC9zcGFuPgogICAgICAgICAgICA8c3Ryb25nIGRhdGEtbWV0YS1yZWNvcmRzPjA8L3N0cm9uZz4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ibWV0YS1pdGVtIj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im11dGVkIj5BY3RpdmUgY29udHJpYnV0b3JzPC9zcGFuPgogICAgICAgICAgICA8c3Ryb25nIGRhdGEtbWV0YS11c2Vycz4wPC9zdHJvbmc+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9Im1ldGEtaXRlbSI+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtdXRlZCI+RGF0ZSBjb3ZlcmFnZTwvc3Bhbj4KICAgICAgICAgICAgPHN0cm9uZyBkYXRhLW1ldGEtcmFuZ2U+LTwvc3Ryb25nPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZGF0YXNldC1hY3Rpb25zIj4KICAgICAgICAgIDxkaXYgY2xhc3M9InRoZW1lLXRvZ2dsZSI+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtdG9nZ2xlX19idXR0b24iIGRhdGEtdGhlbWUtdG9nZ2xlIGFyaWEtcHJlc3NlZD0iZmFsc2UiIGFyaWEtaGFzcG9wdXA9Im1lbnUiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIj4KICAgICAgICAgICAgICA8c3BhbiBkYXRhLXRoZW1lLWxhYmVsPkNob29zZSB0aGVtZTwvc3Bhbj4KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRoZW1lLW1lbnUiIGRhdGEtdGhlbWUtbWVudSBoaWRkZW4gcm9sZT0ibWVudSI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGhlbWUtbWVudS1oZWFkZXIiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRoZW1lLW1lbnUtdGl0bGUiPlNlbGVjdCB0aGVtZTwvc3Bhbj4KICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idGhlbWUtbWVudS1jbG9zZSIgZGF0YS10aGVtZS1tZW51LWNsb3NlIGFyaWEtbGFiZWw9IkNsb3NlIHRoZW1lIG1lbnUiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0aGVtZS1tZW51LWdyaWQiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1vcHRpb24iIGRhdGEtdGhlbWU9ImxpZ2h0IiByb2xlPSJtZW51aXRlbSI+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0aGVtZS1vcHRpb24tcHJldmlldyB0aGVtZS1vcHRpb24tcHJldmlldy0tbGlnaHQiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRoZW1lLW9wdGlvbi1uYW1lIj5MaWdodDwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1vcHRpb24iIGRhdGEtdGhlbWU9ImxpZ2h0LWNvb2wiIHJvbGU9Im1lbnVpdGVtIj4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRoZW1lLW9wdGlvbi1wcmV2aWV3IHRoZW1lLW9wdGlvbi1wcmV2aWV3LS1saWdodC1jb29sIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0aGVtZS1vcHRpb24tbmFtZSI+Q29vbCBMaWdodDwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1vcHRpb24iIGRhdGEtdGhlbWU9ImRhcmstbWlkbmlnaHQiIHJvbGU9Im1lbnVpdGVtIj4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRoZW1lLW9wdGlvbi1wcmV2aWV3IHRoZW1lLW9wdGlvbi1wcmV2aWV3LS1kYXJrLW1pZG5pZ2h0Ij48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0aGVtZS1vcHRpb24tbmFtZSI+TWlkbmlnaHQgRGFyazwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0aGVtZS1vcHRpb24iIGRhdGEtdGhlbWU9ImRhcmstY2FyYm9uIiByb2xlPSJtZW51aXRlbSI+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0aGVtZS1vcHRpb24tcHJldmlldyB0aGVtZS1vcHRpb24tcHJldmlldy0tZGFyay1jYXJib24iPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRoZW1lLW9wdGlvbi1uYW1lIj5DYXJib24gQmxhY2s8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InNuYXBzaG90LWNvbnRyb2xzIiBkYXRhLXNuYXBzaG90LWNvbnRyb2xzIGhpZGRlbj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic25hcHNob3QtY29udHJvbHNfX2J1dHRvbnMiPgogICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic3RvcmFnZS1idXR0b24iIGRhdGEtc25hcHNob3Qtc2F2ZSBkaXNhYmxlZD5TYXZlIGVuY3J5cHRlZCBzbmFwc2hvdDwvYnV0dG9uPgogICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic3RvcmFnZS1idXR0b24gc3RvcmFnZS1idXR0b24tLWdob3N0IiBkYXRhLXNuYXBzaG90LWxvYWQ+TG9hZCBlbmNyeXB0ZWQgc25hcHNob3Q8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzPSJzbmFwc2hvdC1jb250cm9sc19faGludCBtdXRlZCIgZGF0YS1zbmFwc2hvdC1oaW50PkVuY3J5cHRlZCBzbmFwc2hvdHMgbGV0IHRydXN0ZWQgY29sbGVhZ3VlcyByZXByb2R1Y2UgdGhpcyB2aWV3IHdpdGhvdXQgc2VuZGluZyByYXcgZmlsZXMuPC9wPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvYXNpZGU+CiAgICA8L2hlYWRlcj4KCiAgICA8c2VjdGlvbiBjbGFzcz0iY29udHJvbC1wYW5lbCIgYXJpYS1sYWJlbD0iRGFzaGJvYXJkIGZpbHRlcnMiPgogICAgICA8ZGl2IGNsYXNzPSJhY3RpdmUtZmlsdGVycy1zdW1tYXJ5IiBkYXRhLWFjdGl2ZS1maWx0ZXJzLXN1bW1hcnkgaGlkZGVuPgogICAgICAgIDxkaXYgY2xhc3M9ImFjdGl2ZS1maWx0ZXJzLWhlYWRlciI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iYWN0aXZlLWZpbHRlcnMtbGFiZWwiPkFjdGl2ZSBmaWx0ZXJzOjwvc3Bhbj4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iY2xlYXItYWxsLWZpbHRlcnMiIGRhdGEtY2xlYXItYWxsLWZpbHRlcnMgYXJpYS1sYWJlbD0iQ2xlYXIgYWxsIGFjdGl2ZSBmaWx0ZXJzIj4KICAgICAgICAgICAgPHNwYW4gYXJpYS1oaWRkZW49InRydWUiPuKclTwvc3Bhbj4gQ2xlYXIgYWxsCiAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJhY3RpdmUtZmlsdGVycy1saXN0IiBkYXRhLWFjdGl2ZS1maWx0ZXJzLWxpc3Q+PC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9sLXNlbGVjdCBjb250cm9sLXNlbGVjdC0tbXVsdGkiPgogICAgICAgIDxsYWJlbCBmb3I9Im9yZ2FuaXphdGlvbkZpbHRlciI+Rm9jdXMgb3JnYW5pemF0aW9uPC9sYWJlbD4KICAgICAgICA8c2VsZWN0IGlkPSJvcmdhbml6YXRpb25GaWx0ZXIiIGRhdGEtZmlsdGVyLW9yZ2FuaXphdGlvbiBtdWx0aXBsZSBzaXplPSI3IiBjbGFzcz0ibXVsdGktc2VsZWN0Ij4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImFsbCI+QWxsIG9yZ2FuaXphdGlvbnM8L29wdGlvbj4KICAgICAgICA8L3NlbGVjdD4KICAgICAgICA8cCBjbGFzcz0iY29udHJvbC1oaW50Ij5Ib2xkIEN0cmwgKFdpbmRvd3MpIC8gQ21kIChNYWMpIHRvIGNob29zZSBtdWx0aXBsZSBvcmdhbml6YXRpb25zLjwvcD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2wtc2VsZWN0IGNvbnRyb2wtc2VsZWN0LS1tdWx0aSI+CiAgICAgICAgPGxhYmVsIGZvcj0iY291bnRyeUZpbHRlciI+UmVnaW9uPC9sYWJlbD4KICAgICAgICA8c2VsZWN0IGlkPSJjb3VudHJ5RmlsdGVyIiBkYXRhLWZpbHRlci1jb3VudHJ5IG11bHRpcGxlIHNpemU9IjciIGNsYXNzPSJtdWx0aS1zZWxlY3QiPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iYWxsIj5BbGwgcmVnaW9uczwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICAgIDxwIGNsYXNzPSJjb250cm9sLWhpbnQiPkhvbGQgQ3RybCAoV2luZG93cykgLyBDbWQgKE1hYykgdG8gY2hvb3NlIG11bHRpcGxlIHJlZ2lvbnMuPC9wPgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1zZWxlY3QgY29udHJvbC1zZWxlY3QtLXRvZ2dsZSI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImNvbnRyb2wtbGFiZWwiPlRpbWUgcGVyaW9kPC9zcGFuPgogICAgICAgIDxkaXYgY2xhc3M9ImZpbHRlci10b2dnbGUiIGRhdGEtZmlsdGVyLXRpbWVmcmFtZS1ncm91cCByb2xlPSJncm91cCIgYXJpYS1sYWJlbD0iVGltZSBwZXJpb2QiPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJmaWx0ZXItcGlsbCBpcy1hY3RpdmUiIGRhdGEtZmlsdGVyLXRpbWVmcmFtZS1idXR0b249ImFsbCI+RW50aXJlIGRhdGFzZXQ8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iZmlsdGVyLXBpbGwiIGRhdGEtZmlsdGVyLXRpbWVmcmFtZS1idXR0b249IjNtIj5QYXN0IDMgbW9udGhzPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIiBkYXRhLWZpbHRlci10aW1lZnJhbWUtYnV0dG9uPSI2bSI+UGFzdCA2IG1vbnRoczwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJmaWx0ZXItcGlsbCIgZGF0YS1maWx0ZXItdGltZWZyYW1lLWJ1dHRvbj0iMTJtIj5QYXN0IDEyIG1vbnRoczwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJmaWx0ZXItcGlsbCIgZGF0YS1maWx0ZXItdGltZWZyYW1lLWJ1dHRvbj0iY3VzdG9tIj5DdXN0b20gcmFuZ2U8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c2VsZWN0IGlkPSJ0aW1lZnJhbWVGaWx0ZXIiIGRhdGEtZmlsdGVyLXRpbWVmcmFtZSBoaWRkZW4gYXJpYS1sYWJlbD0iVGltZWZyYW1lIGZpbHRlciI+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJhbGwiIHNlbGVjdGVkPkVudGlyZSBkYXRhc2V0PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSIzbSI+UGFzdCAzIG1vbnRoczwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iNm0iPlBhc3QgNiBtb250aHM8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9IjEybSI+UGFzdCAxMiBtb250aHM8L29wdGlvbj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImN1c3RvbSI+Q3VzdG9tIHJhbmdlPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJjb250cm9sLXNlbGVjdCIgZGF0YS1jdXN0b20tcmFuZ2UgaGlkZGVuPgogICAgICAgIDxsYWJlbCBmb3I9ImN1c3RvbVJhbmdlU3RhcnQiPkN1c3RvbSByYW5nZTwvbGFiZWw+CiAgICAgICAgPGRpdiBjbGFzcz0iY3VzdG9tLXJhbmdlLWlucHV0cyI+CiAgICAgICAgICA8aW5wdXQgdHlwZT0iZGF0ZSIgaWQ9ImN1c3RvbVJhbmdlU3RhcnQiIGRhdGEtZmlsdGVyLWN1c3RvbS1zdGFydCBhcmlhLWxhYmVsPSJDdXN0b20gcmFuZ2Ugc3RhcnQgZGF0ZSIgLz4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJyYW5nZS1zZXBhcmF0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj50bzwvc3Bhbj4KICAgICAgICAgIDxpbnB1dCB0eXBlPSJkYXRlIiBpZD0iY3VzdG9tUmFuZ2VFbmQiIGRhdGEtZmlsdGVyLWN1c3RvbS1lbmQgYXJpYS1sYWJlbD0iQ3VzdG9tIHJhbmdlIGVuZCBkYXRlIiAvPgogICAgICAgIDwvZGl2PgogICAgICAgIDxwIGNsYXNzPSJyYW5nZS1oaW50IiBkYXRhLWN1c3RvbS1yYW5nZS1oaW50IGhpZGRlbj5TZWxlY3Qgc3RhcnQgYW5kIGVuZCBkYXRlcyB3aXRoaW4gdGhlIGRhdGFzZXQgcmFuZ2UuPC9wPgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1zZWxlY3QgY29udHJvbC1zZWxlY3QtLXRvZ2dsZSI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImNvbnRyb2wtbGFiZWwiPkRhdGEgYWdncmVnYXRlZCBieTwvc3Bhbj4KICAgICAgICA8ZGl2IGNsYXNzPSJmaWx0ZXItdG9nZ2xlIiBkYXRhLWZpbHRlci1hZ2dyZWdhdGUtZ3JvdXAgcm9sZT0iZ3JvdXAiIGFyaWEtbGFiZWw9IkRhdGEgYWdncmVnYXRlZCBieSI+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIiBkYXRhLWZpbHRlci1hZ2dyZWdhdGUtYnV0dG9uPSJtb250aGx5Ij5Nb250aGx5PC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIGlzLWFjdGl2ZSIgZGF0YS1maWx0ZXItYWdncmVnYXRlLWJ1dHRvbj0id2Vla2x5Ij5XZWVrbHk8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c2VsZWN0IGlkPSJhZ2dyZWdhdGVGaWx0ZXIiIGRhdGEtZmlsdGVyLWFnZ3JlZ2F0ZSBoaWRkZW4gYXJpYS1sYWJlbD0iQWdncmVnYXRlIGZpbHRlciI+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJtb250aGx5Ij5Nb250aGx5PC9vcHRpb24+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJ3ZWVrbHkiIHNlbGVjdGVkPldlZWtseTwvb3B0aW9uPgogICAgICAgIDwvc2VsZWN0PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0iY29udHJvbC1zZWxlY3QgY29udHJvbC1zZWxlY3QtLXRvZ2dsZSI+CiAgICAgICAgPHNwYW4gY2xhc3M9ImNvbnRyb2wtbGFiZWwiPk1ldHJpYzwvc3Bhbj4KICAgICAgICA8ZGl2IGNsYXNzPSJmaWx0ZXItdG9nZ2xlIiBkYXRhLWZpbHRlci1tZXRyaWMtZ3JvdXAgcm9sZT0iZ3JvdXAiIGFyaWEtbGFiZWw9Ik1ldHJpYyI+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIGlzLWFjdGl2ZSIgZGF0YS1maWx0ZXItbWV0cmljLWJ1dHRvbj0iYWN0aW9ucyI+Q29waWxvdCBhY3Rpb25zIHRha2VuPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIiBkYXRhLWZpbHRlci1tZXRyaWMtYnV0dG9uPSJob3VycyI+Q29waWxvdCBhc3Npc3RlZCBob3VyczwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxzZWxlY3QgaWQ9Im1ldHJpY0ZpbHRlciIgZGF0YS1maWx0ZXItbWV0cmljIGhpZGRlbiBhcmlhLWxhYmVsPSJNZXRyaWMgZmlsdGVyIj4KICAgICAgICAgIDxvcHRpb24gdmFsdWU9ImFjdGlvbnMiIHNlbGVjdGVkPkNvcGlsb3QgYWN0aW9ucyB0YWtlbjwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iaG91cnMiPkNvcGlsb3QgYXNzaXN0ZWQgaG91cnM8L29wdGlvbj4KICAgICAgICA8L3NlbGVjdD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2wtc2VsZWN0IGNvbnRyb2wtc2VsZWN0LS10b2dnbGUiPgogICAgICAgIDxzcGFuIGNsYXNzPSJjb250cm9sLWxhYmVsIj5WaWV3IGJ5PC9zcGFuPgogICAgICAgIDxkaXYgY2xhc3M9ImZpbHRlci10b2dnbGUiIGRhdGEtZmlsdGVyLWdyb3VwLWdyb3VwIHJvbGU9Imdyb3VwIiBhcmlhLWxhYmVsPSJWaWV3IGJ5Ij4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iZmlsdGVyLXBpbGwgaXMtYWN0aXZlIiBkYXRhLWZpbHRlci1ncm91cC1idXR0b249Im9yZ2FuaXphdGlvbiI+T3JnYW5pemF0aW9uPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZpbHRlci1waWxsIiBkYXRhLWZpbHRlci1ncm91cC1idXR0b249ImNvdW50cnkiPkNvdW50cnk8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iZmlsdGVyLXBpbGwiIGRhdGEtZmlsdGVyLWdyb3VwLWJ1dHRvbj0iZG9tYWluIj5Eb21haW48L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c2VsZWN0IGlkPSJncm91cEZpbHRlciIgZGF0YS1maWx0ZXItZ3JvdXAgaGlkZGVuIGFyaWEtbGFiZWw9Ikdyb3VwIGZpbHRlciI+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJvcmdhbml6YXRpb24iIHNlbGVjdGVkPk9yZ2FuaXphdGlvbjwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iY291bnRyeSI+Q291bnRyeTwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iZG9tYWluIj5Eb21haW48L29wdGlvbj4KICAgICAgICA8L3NlbGVjdD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNvbnRyb2wtYWN0aW9ucyI+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJyZXNldC1idXR0b24iIGRhdGEtcmVzZXQtZmlsdGVycz5SZXNldCBmaWx0ZXJzPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9zZWN0aW9uPgogICAgPHNlY3Rpb24gY2xhc3M9InN1bW1hcnktZ3JpZCIgYXJpYS1sYWJlbD0iS2V5IG1ldHJpY3MiPgogICAgICA8YXJ0aWNsZSBjbGFzcz0ic3VtbWFyeS1jYXJkIHN1bW1hcnktY2FyZC0tYWN0aW9ucyI+CiAgICAgICAgPGRpdiBjbGFzcz0ic3VtbWFyeS1jYXJkX19tZXRhIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LWljb24iIGFyaWEtaGlkZGVuPSJ0cnVlIj4KICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHJvbGU9ImltZyIgZm9jdXNhYmxlPSJmYWxzZSI+CiAgICAgICAgICAgICAgPHBhdGggZD0iTTEzIDIuNUw2IDEzLjVoNC4ybC0xIDggOC0xMmgtNC4yTDEzIDIuNVoiIC8+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9InN1bW1hcnktbGFiZWwiPkNvcGlsb3QgYWN0aW9ucyB0YWtlbjwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS12YWx1ZSIgZGF0YS1zdW1tYXJ5LWFjdGlvbnM+LTwvc3Bhbj4KICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS1ub3RlIiBkYXRhLXN1bW1hcnktYWN0aW9ucy1ub3RlPkF3YWl0aW5nIGRhdGFzZXQuPC9zcGFuPgogICAgICA8L2FydGljbGU+CiAgICAgIDxhcnRpY2xlIGNsYXNzPSJzdW1tYXJ5LWNhcmQgc3VtbWFyeS1jYXJkLS1ob3VycyI+CiAgICAgICAgPGRpdiBjbGFzcz0ic3VtbWFyeS1jYXJkX19tZXRhIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LWljb24iIGFyaWEtaGlkZGVuPSJ0cnVlIj4KICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHJvbGU9ImltZyIgZm9jdXNhYmxlPSJmYWxzZSI+CiAgICAgICAgICAgICAgPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iNi41IiAvPgogICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMiA4LjI1djQuMjVsMi41IDEuNiIgLz4KICAgICAgICAgICAgPC9zdmc+CiAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS1sYWJlbCI+Q29waWxvdCBhc3Npc3RlZCBob3Vyczwvc3Bhbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS12YWx1ZSIgZGF0YS1zdW1tYXJ5LWhvdXJzPi08L3NwYW4+CiAgICAgICAgPHNwYW4gY2xhc3M9InN1bW1hcnktbm90ZSIgZGF0YS1zdW1tYXJ5LWhvdXJzLW5vdGU+QXdhaXRpbmcgZGF0YXNldC48L3NwYW4+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAgPGFydGljbGUgY2xhc3M9InN1bW1hcnktY2FyZCBzdW1tYXJ5LWNhcmQtLXVzZXJzIj4KICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWNhcmRfX21ldGEiPgogICAgICAgICAgPHNwYW4gY2xhc3M9InN1bW1hcnktaWNvbiIgYXJpYS1oaWRkZW49InRydWUiPgogICAgICAgICAgICA8c3ZnIHZpZXdCb3g9IjAgMCAyNCAyNCIgcm9sZT0iaW1nIiBmb2N1c2FibGU9ImZhbHNlIj4KICAgICAgICAgICAgICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEwLjUiIHI9IjIuNiIgLz4KICAgICAgICAgICAgICA8cGF0aCBkPSJNNi41IDE4LjVjMC0yLjYgMi41LTQuNyA1LjUtNC43czUuNSAyLjEgNS41IDQuNyIgLz4KICAgICAgICAgICAgICA8Y2lyY2xlIGN4PSIxNy41IiBjeT0iOS4yIiByPSIxLjgiIC8+CiAgICAgICAgICAgICAgPHBhdGggZD0iTTE2LjIgMTQuN2EzLjMgMy4zIDAgMCAxIDIuOCAzLjMiIC8+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9InN1bW1hcnktbGFiZWwiPkFjdGl2ZSBDb3BpbG90IHVzZXJzPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LXZhbHVlIiBkYXRhLXN1bW1hcnktdXNlcnM+LTwvc3Bhbj4KICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS1ub3RlIiBkYXRhLXN1bW1hcnktdXNlcnMtbm90ZT5VcGxvYWQgZGF0YSB0byBjYWxjdWxhdGUgZW5nYWdlbWVudCBkZXB0aC48L3NwYW4+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAgPGFydGljbGUgY2xhc3M9InN1bW1hcnktY2FyZCBzdW1tYXJ5LWNhcmQtLXBlcmlvZCI+CiAgICAgICAgPGRpdiBjbGFzcz0ic3VtbWFyeS1jYXJkX19tZXRhIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LWljb24iIGFyaWEtaGlkZGVuPSJ0cnVlIj4KICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIHJvbGU9ImltZyIgZm9jdXNhYmxlPSJmYWxzZSI+CiAgICAgICAgICAgICAgPHJlY3QgeD0iNC41IiB5PSI2LjUiIHdpZHRoPSIxNSIgaGVpZ2h0PSIxMi41IiByeD0iMiIgLz4KICAgICAgICAgICAgICA8cGF0aCBkPSJNOCA0LjV2NCIgLz4KICAgICAgICAgICAgICA8cGF0aCBkPSJNMTYgNC41djQiIC8+CiAgICAgICAgICAgICAgPGxpbmUgeDE9IjQuNSIgeTE9IjEwLjUiIHgyPSIxOS41IiB5Mj0iMTAuNSIgLz4KICAgICAgICAgICAgICA8cGF0aCBkPSJNOS41IDE0aDIiIC8+CiAgICAgICAgICAgICAgPHBhdGggZD0iTTEyLjUgMTdoMi41IiAvPgogICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LWxhYmVsIj5MYXRlc3QgcGVyaW9kPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LXZhbHVlIHN1bW1hcnktdmFsdWUtLWxhdGVzdCIgZGF0YS1zdW1tYXJ5LWxhdGVzdD4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LWxhdGVzdC1wZXJpb2QtbGFiZWwiIGRhdGEtc3VtbWFyeS1sYXRlc3QtcGVyaW9kPi08L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0ic3VtbWFyeS1sYXRlc3QtbWV0cmljIiBkYXRhLXN1bW1hcnktbGF0ZXN0LW1ldHJpYz48L3NwYW4+CiAgICAgICAgPC9zcGFuPgogICAgICAgIDxzcGFuIGNsYXNzPSJzdW1tYXJ5LW5vdGUiIGRhdGEtc3VtbWFyeS1sYXRlc3Qtbm90ZT5SZWFkeSBhZnRlciBwYXJzaW5nLjwvc3Bhbj4KICAgICAgPC9hcnRpY2xlPgogICAgPC9zZWN0aW9uPgoKICAgIDxzZWN0aW9uIGNsYXNzPSJ0cmVuZC1jYXJkIiBhcmlhLWxhYmVsPSJJbXBhY3QgdHJlbmQiPgogICAgICA8aGVhZGVyPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8aDIgY2xhc3M9ImNoYXJ0LXRpdGxlIj5JbXBhY3QgdHJlbmQgZm9yIHRoZSBzZWxlY3RlZCBwZXJpb2Q8L2gyPgogICAgICA8cCBjbGFzcz0iY2hhcnQtc3VidGl0bGUiIGRhdGEtdHJlbmQtY2FwdGlvbj5VcGxvYWQgZGF0YSB0byB2aXN1YWxpemUgbW9tZW50dW0uPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjaGlwIGlzLW11dGVkIiBkYXRhLXRyZW5kLXdpbmRvdz4tPC9kaXY+CiAgPC9oZWFkZXI+CiAgPGRpdiBjbGFzcz0iY2hhcnQtYWN0aW9ucyI+CiAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InNlcmllcy1idWxrLXRvZ2dsZSIgZGF0YS10b2dnbGUtc2VyaWVzLW1vZGUgYXJpYS1wcmVzc2VkPSJmYWxzZSI+SGlkZSBjYXBhYmlsaXR5IGxpbmVzPC9idXR0b24+CiAgICA8ZGl2IGNsYXNzPSJ0cmVuZC12aWV3LXRvZ2dsZSIgcm9sZT0iZ3JvdXAiIGFyaWEtbGFiZWw9IlRyZW5kIHZhbHVlIHZpZXciPgogICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRyZW5kLXZpZXctYnV0dG9uIGlzLWFjdGl2ZSIgZGF0YS10cmVuZC12aWV3PSJ0b3RhbCIgYXJpYS1wcmVzc2VkPSJ0cnVlIj5Ub3RhbHM8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0cmVuZC12aWV3LWJ1dHRvbiIgZGF0YS10cmVuZC12aWV3PSJhdmVyYWdlIiBhcmlhLXByZXNzZWQ9ImZhbHNlIj5BdmcgcGVyIHVzZXI8L2J1dHRvbj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0ic2VyaWVzLXRvZ2dsZS1yYWlsIiBkYXRhLXNlcmllcy10b2dnbGUtZ3JvdXAgYXJpYS1sYWJlbD0iU2VyaWVzIHZpc2liaWxpdHkgdG9nZ2xlcyI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZXhwb3J0LWNvbnRyb2xzIiBkYXRhLWV4cG9ydC1jb250cm9scz4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImV4cG9ydC10cmlnZ2VyIiBkYXRhLWV4cG9ydC10cmlnZ2VyIGFyaWEtaGFzcG9wdXA9InRydWUiIGFyaWEtZXhwYW5kZWQ9ImZhbHNlIj5FeHBvcnQ8L2J1dHRvbj4KICAgICAgICA8ZGl2IGNsYXNzPSJleHBvcnQtbWVudSIgZGF0YS1leHBvcnQtbWVudSBoaWRkZW4gcm9sZT0ibWVudSI+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgZGF0YS1leHBvcnQtcGRmIHJvbGU9Im1lbnVpdGVtIj5Eb3dubG9hZCBQREYgcmVwb3J0PC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgZGF0YS1leHBvcnQtcG5nIHJvbGU9Im1lbnVpdGVtIj5Eb3dubG9hZCBQTkc8L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBkYXRhLWV4cG9ydC12aWRlbyByb2xlPSJtZW51aXRlbSI+RG93bmxvYWQgYW5pbWF0aW9uPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgZGF0YS1leHBvcnQtZXhjZWwgcm9sZT0ibWVudWl0ZW0iPkRvd25sb2FkIHRvdGFscyAoRXhjZWwpPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgZGF0YS1leHBvcnQtZXhjZWwtZnVsbCByb2xlPSJtZW51aXRlbSI+RG93bmxvYWQgZnVsbCByZXBvcnQgKEV4Y2VsKTwvYnV0dG9uPgogICAgICAgICAgPGxhYmVsIGNsYXNzPSJleHBvcnQtb3B0aW9uIiBkYXRhLWV4cG9ydC1pbmNsdWRlLWRldGFpbHMtd3JhcHBlcj4KICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLWV4cG9ydC1pbmNsdWRlLWRldGFpbHMgY2hlY2tlZCAvPgogICAgICAgICAgICBJbmNsdWRlIGNhdGVnb3J5IGRldGFpbCBsaW5lcwogICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgIDxwIGNsYXNzPSJleHBvcnQtaGludCIgZGF0YS1leHBvcnQtaGludCBoaWRkZW4+PC9wPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJ0cmVuZC1jb2xvci1jb250cm9scyIgZGF0YS10cmVuZC1jb2xvcnMgaGlkZGVuPgoKICAgICAgICA8ZGl2IGNsYXNzPSJ0cmVuZC1jb2xvci1jb250cm9sc19fZ3JvdXAiPgoKICAgICAgICAgIDxsYWJlbCBmb3I9InRyZW5kQ29sb3JTdGFydCI+U3RhcnQgY29sb3I8L2xhYmVsPgoKICAgICAgICAgIDxpbnB1dCB0eXBlPSJjb2xvciIgaWQ9InRyZW5kQ29sb3JTdGFydCIgZGF0YS10cmVuZC1jb2xvci1zdGFydCBhcmlhLWxhYmVsPSJDaG9vc2Ugc3RhcnQgY29sb3IiIC8+CgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJ0cmVuZC1jb2xvci1jb250cm9sc19fZ3JvdXAiPgoKICAgICAgICAgIDxsYWJlbCBmb3I9InRyZW5kQ29sb3JFbmQiPkVuZCBjb2xvcjwvbGFiZWw+CgogICAgICAgICAgPGlucHV0IHR5cGU9ImNvbG9yIiBpZD0idHJlbmRDb2xvckVuZCIgZGF0YS10cmVuZC1jb2xvci1lbmQgYXJpYS1sYWJlbD0iQ2hvb3NlIGVuZCBjb2xvciIgLz4KCiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9InRyZW5kLWNvbG9yLWNvbnRyb2xzX19hY3Rpb25zIj4KCiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRyZW5kLWNvbG9yLWJ1dHRvbiIgZGF0YS1hcHBseS10cmVuZC1jb2xvcnM+QXBwbHkgZ3JhZGllbnQ8L2J1dHRvbj4KCiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRyZW5kLWNvbG9yLWJ1dHRvbiBpcy1zZWNvbmRhcnkiIGRhdGEtcmVzZXQtdHJlbmQtY29sb3JzPlJlc2V0IGNvbG9yczwvYnV0dG9uPgoKICAgICAgICA8L2Rpdj4KCiAgICAgICAgPHAgY2xhc3M9InRyZW5kLWNvbG9yLWNvbnRyb2xzX19oaW50IiBkYXRhLXRyZW5kLWNvbG9yLWhpbnQ+Q29sb3IgY2hvaWNlcyBzdGF5IG9uIHRoaXMgZGV2aWNlLjwvcD4KCiAgICAgIDwvZGl2PgoKICAgICAgPHAgY2xhc3M9ImNoYXJ0LWhpbnQiIGRhdGEtc2VyaWVzLWhpbnQgaGlkZGVuPlN3aXRjaCB0byBhY3Rpb25zIG1ldHJpYyB0byBjb21wYXJlIGNhcGFiaWxpdHkgbGluZXMuPC9wPgogICAgICA8ZGl2IGNsYXNzPSJjaGFydC13cmFwcGVyIj4KICAgICAgICA8Y2FudmFzIGlkPSJ0cmVuZENoYXJ0IiByb2xlPSJpbWciIGFyaWEtbGFiZWw9IkxpbmUgY2hhcnQgc2hvd2luZyBDb3BpbG90IG1ldHJpYyBvdmVyIHRpbWUiPjwvY2FudmFzPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWVtcHR5IiBkYXRhLXRyZW5kLWVtcHR5PkxvYWQgYSBDU1YgZmlsZSB0byByZW5kZXIgdGhlIHRyZW5kLjwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvc2VjdGlvbj4KCiAgICA8c2VjdGlvbiBjbGFzcz0iZ3JvdXAtY2FyZCIgYXJpYS1sYWJlbD0iR3JvdXAgYnJlYWtkb3duIj4KICAgICAgPGRpdiBjbGFzcz0iZ3JvdXAtaGVhZGVyIj4KICAgICAgICA8aDI+SW1wYWN0IHRyZW5kIGJyZWFrZG93bjwvaDI+CiAgICAgICAgPHAgY2xhc3M9Im11dGVkIiBkYXRhLWdyb3VwLWNhcHRpb24+U2VsZWN0IGEgbWV0cmljIGFuZCB2aWV3IHRvIGNvbXBhcmUgZ3JvdXBzLjwvcD4KICAgICAgPC9kaXY+CiAgICAgIDx0YWJsZSBjbGFzcz0iZ3JvdXAtdGFibGUiPgogICAgICAgIDx0aGVhZD4KICAgICAgICAgIDx0cj4KICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiPkdyb3VwPC90aD4KICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGNsYXNzPSJ1c2Vycy1jb2wiPlVzZXJzPC90aD4KICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGNsYXNzPSJ2YWx1ZS1jb2wiPk1ldHJpYyB2YWx1ZTwvdGg+CiAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iYXZnLWNvbCI+QXZnIGFjdGlvbnMvdXNlcjwvdGg+CiAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0ic2hhcmUtY29sIj5TaGFyZTwvdGg+CiAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIj5Nb21lbnR1bTwvdGg+CiAgICAgICAgICA8L3RyPgogICAgICAgIDwvdGhlYWQ+CiAgICAgICAgPHRib2R5IGRhdGEtZ3JvdXAtYm9keT48L3Rib2R5PgogICAgICA8L3RhYmxlPgogICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InZpZXctbW9yZS1idXR0b24iIGRhdGEtdmlldy1tb3JlIGhpZGRlbiBhcmlhLWV4cGFuZGVkPSJmYWxzZSI+U2hvdyByZW1haW5pbmcgZ3JvdXBzL29mZmljZXM8L2J1dHRvbj4KICAgIDwvc2VjdGlvbj4KCiAgICA8c2VjdGlvbiBjbGFzcz0idHJlbmQtY2FyZCBhZ2VudC1odWIiIGFyaWEtbGFiZWw9IkNvcGlsb3QgYWdlbnQgZXhwb3J0cyIgZGF0YS1hZ2VudC1odWI+CiAgICAgIDxoZWFkZXIgY2xhc3M9ImNhcmQtaGVhZGVyLXdpdGgtYWN0aW9ucyI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMiBjbGFzcz0iY2hhcnQtdGl0bGUiPlRvcCBDb3BpbG90IGFnZW50czwvaDI+CiAgICAgICAgICA8cCBjbGFzcz0iY2hhcnQtc3VidGl0bGUiPlVwbG9hZCB0aGUgdGhyZWUgVml2YSBJbnNpZ2h0cyBleHBvcnRzIHRvIGZsaXAgYmV0d2VlbiB1c2VyLCBhZ2VudCwgYW5kIGNvbWJpbmVkIHZpZXdzLjwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1naG9zdCIgZGF0YS1hZ2VudC1yZXNldCBoaWRkZW4+UmVzZXQgdXBsb2FkZWQgZGF0YTwvYnV0dG9uPgogICAgICA8L2hlYWRlcj4KCiAgICAgIDxkaXYgY2xhc3M9ImFnZW50LXRhYmxpc3QiIHJvbGU9InRhYmxpc3QiIGFyaWEtbGFiZWw9IkFnZW50IGRhdGEgdmlld3MiIGRhdGEtYWdlbnQtdGFicz4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXRhYiBpcy1hY3RpdmUiIHJvbGU9InRhYiIgYXJpYS1zZWxlY3RlZD0idHJ1ZSIgZGF0YS1hZ2VudC10YWI9InVzZXJzIj5Vc2VyczwvYnV0dG9uPgogICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtdGFiIiByb2xlPSJ0YWIiIGFyaWEtc2VsZWN0ZWQ9ImZhbHNlIiBkYXRhLWFnZW50LXRhYj0iYWdlbnRzIj5BZ2VudHM8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXRhYiIgcm9sZT0idGFiIiBhcmlhLXNlbGVjdGVkPSJmYWxzZSIgZGF0YS1hZ2VudC10YWI9ImNvbWJpbmVkIj5Vc2VycyAmYW1wOyBhZ2VudHM8L2J1dHRvbj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1wYW5lbCIgZGF0YS1hZ2VudC1wYW5lbD0idXNlcnMiIHJvbGU9InRhYnBhbmVsIj4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1kcm9wem9uZSIgZGF0YS1hZ2VudC1odWItZHJvcHpvbmU9InVzZXJzIj4KICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgIDxzdHJvbmc+VXNlcnMgQ1NWPC9zdHJvbmc+CiAgICAgICAgICAgIDxwPkRyb3AgPGNvZGU+RGVjbGFyYXRpdmVBZ2VudHNfVXNlcnNfKi5jc3Y8L2NvZGU+IG9yIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtaW5saW5lLXVwbG9hZCIgZGF0YS1hZ2VudC1odWItdXBsb2FkPSJ1c2VycyI+YnJvd3NlPC9idXR0b24+IHRvIHJlcGxhY2UgdGhpcyB0YWJsZS48L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdXRlZCI+Q29sdW1ucyByZXF1aXJlZDogVXNlcm5hbWUsIERpc3BsYXkgbmFtZSwgTnVtYmVyIG9mIGFnZW50cyB1c2VkLCBBZ2VudCByZXNwb25zZXMgcmVjZWl2ZWQsIExhc3QgYWN0aXZpdHkgZGF0ZSAoVVRDKS48L3A+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICB0eXBlPSJmaWxlIgogICAgICAgICAgICBhY2NlcHQ9Ii5jc3YiCiAgICAgICAgICAgIGRhdGEtYWdlbnQtaHViLWlucHV0PSJ1c2VycyIKICAgICAgICAgICAgbXVsdGlwbGUKICAgICAgICAgICAgaGlkZGVuCiAgICAgICAgICAgIGFyaWEtbGFiZWw9IlVwbG9hZCBVc2VycyBDU1YiCiAgICAgICAgICAvPgogICAgICAgIDwvZGl2PgogICAgICAgIDxwIGNsYXNzPSJhZ2VudC1zdGF0dXMiIGRhdGEtYWdlbnQtaHViLXN0YXR1cz0idXNlcnMiPlVwbG9hZCBhIENTViB0byBwb3B1bGF0ZSB0aGUgdXNlcnMgdGFibGUuPC9wPgogICAgICAgIDxwIGNsYXNzPSJhZ2VudC1tZXRhIiBkYXRhLWFnZW50LWh1Yi1tZXRhPSJ1c2VycyI+Tm8gZmlsZSB1cGxvYWRlZCB5ZXQuPC9wPgogICAgICAgIDxkaXYgY2xhc3M9ImFnZW50LWZpbHRlci1iYXIiIGRhdGEtYWdlbnQtaHViLWZpbHRlci1iYXI9InVzZXJzIiBoaWRkZW4+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1maWx0ZXItc2VhcmNoIj4KICAgICAgICAgICAgPGlucHV0CiAgICAgICAgICAgICAgdHlwZT0ic2VhcmNoIgogICAgICAgICAgICAgIGNsYXNzPSJhZ2VudC1zZWFyY2gtaW5wdXQiCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IkZpbHRlciBieSB1c2VybmFtZSBvciBkaXNwbGF5IG5hbWUiCiAgICAgICAgICAgICAgZGF0YS1hZ2VudC1odWItZmlsdGVyLWlucHV0PSJ1c2VycyIKICAgICAgICAgICAgICBhcmlhLWxhYmVsPSJGaWx0ZXIgdXNlcnMiCiAgICAgICAgICAgICAgaWQ9ImFnZW50VXNlcnNGaWx0ZXIiCiAgICAgICAgICAgICAgbmFtZT0iYWdlbnRVc2Vyc0ZpbHRlciIKICAgICAgICAgICAgLz4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1jbGVhci1idXR0b24iIGRhdGEtYWdlbnQtaHViLWZpbHRlci1jbGVhcj0idXNlcnMiIGhpZGRlbj5DbGVhcjwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYWdlbnQtdGFibGUtd3JhcHBlciIgZGF0YS1hZ2VudC1odWItdGFibGUtd3JhcHBlcj0idXNlcnMiIGhpZGRlbj4KICAgICAgICAgIDx0YWJsZSBjbGFzcz0iYWdlbnQtZGF0YS10YWJsZSI+CiAgICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICA8dGggc2NvcGU9ImNvbCIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJ1c2VycyIgZGF0YS1hZ2VudC1odWItc29ydC1rZXk9InVzZXJuYW1lIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1sYWJlbCI+VXNlcm5hbWU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtaW5kaWNhdG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICA8dGggc2NvcGU9ImNvbCIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJ1c2VycyIgZGF0YS1hZ2VudC1odWItc29ydC1rZXk9ImRpc3BsYXlOYW1lIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1sYWJlbCI+RGlzcGxheSBuYW1lPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGNsYXNzPSJpcy1udW1lcmljIiBhcmlhLXNvcnQ9Im5vbmUiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXNvcnQtYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWNvbnRleHQ9InVzZXJzIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0iYWdlbnRDb3VudCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPk51bWJlciBvZiBhZ2VudHMgdXNlZDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iaXMtbnVtZXJpYyIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJ1c2VycyIgZGF0YS1hZ2VudC1odWItc29ydC1rZXk9InJlc3BvbnNlcyI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPkFnZW50IHJlc3BvbnNlcyByZWNlaXZlZDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBhcmlhLXNvcnQ9Im5vbmUiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXNvcnQtYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWNvbnRleHQ9InVzZXJzIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0ibGFzdEFjdGl2aXR5Ij4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1sYWJlbCI+TGFzdCBhY3Rpdml0eSBkYXRlIChVVEMpPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgIDx0Ym9keSBkYXRhLWFnZW50LWh1Yi10Ym9keT0idXNlcnMiPjwvdGJvZHk+CiAgICAgICAgICA8L3RhYmxlPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImFnZW50LWVtcHR5IiBkYXRhLWFnZW50LWh1Yi1lbXB0eT0idXNlcnMiPlVwbG9hZCBhIFVzZXJzIENTViB0byBnZXQgc3RhcnRlZC48L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1wYW5lbCIgZGF0YS1hZ2VudC1wYW5lbD0iYWdlbnRzIiByb2xlPSJ0YWJwYW5lbCIgaGlkZGVuPgogICAgICAgIDxkaXYgY2xhc3M9ImFnZW50LWRyb3B6b25lIiBkYXRhLWFnZW50LWh1Yi1kcm9wem9uZT0iYWdlbnRzIj4KICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgIDxzdHJvbmc+QWdlbnRzIENTVjwvc3Ryb25nPgogICAgICAgICAgICA8cD5Ecm9wIDxjb2RlPkRlY2xhcmF0aXZlQWdlbnRzX0FnZW50c18qLmNzdjwvY29kZT4gb3IgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1pbmxpbmUtdXBsb2FkIiBkYXRhLWFnZW50LWh1Yi11cGxvYWQ9ImFnZW50cyI+YnJvd3NlPC9idXR0b24+IHRvIHVwZGF0ZSB0aGlzIHRhYmxlLjwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9Im11dGVkIj5Db2x1bW5zIHJlcXVpcmVkOiBBZ2VudCBJRCwgQWdlbnQgbmFtZSwgQ3JlYXRvciB0eXBlLCBBY3RpdmUgdXNlcnMgKGxpY2Vuc2VkL3VubGljZW5zZWQpLCBSZXNwb25zZXMgc2VudCB0byB1c2VycywgTGFzdCBhY3Rpdml0eSBkYXRlIChVVEMpLjwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGlucHV0CiAgICAgICAgICAgIHR5cGU9ImZpbGUiCiAgICAgICAgICAgIGFjY2VwdD0iLmNzdiIKICAgICAgICAgICAgZGF0YS1hZ2VudC1odWItaW5wdXQ9ImFnZW50cyIKICAgICAgICAgICAgbXVsdGlwbGUKICAgICAgICAgICAgaGlkZGVuCiAgICAgICAgICAgIGFyaWEtbGFiZWw9IlVwbG9hZCBBZ2VudHMgQ1NWIgogICAgICAgICAgLz4KICAgICAgICA8L2Rpdj4KICAgICAgICA8cCBjbGFzcz0iYWdlbnQtc3RhdHVzIiBkYXRhLWFnZW50LWh1Yi1zdGF0dXM9ImFnZW50cyI+VXBsb2FkIGEgQ1NWIHRvIHBvcHVsYXRlIHRoZSBhZ2VudHMgdGFibGUuPC9wPgogICAgICAgIDxwIGNsYXNzPSJhZ2VudC1tZXRhIiBkYXRhLWFnZW50LWh1Yi1tZXRhPSJhZ2VudHMiPk5vIGZpbGUgdXBsb2FkZWQgeWV0LjwvcD4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1maWx0ZXItYmFyIiBkYXRhLWFnZW50LWh1Yi1maWx0ZXItYmFyPSJhZ2VudHMiIGhpZGRlbj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImFnZW50LWZpbHRlci1zZWFyY2giPgogICAgICAgICAgICA8aW5wdXQKICAgICAgICAgICAgICB0eXBlPSJzZWFyY2giCiAgICAgICAgICAgICAgY2xhc3M9ImFnZW50LXNlYXJjaC1pbnB1dCIKICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0iRmlsdGVyIGJ5IGFnZW50IG5hbWUsIElELCBvciBjcmVhdG9yIHR5cGUiCiAgICAgICAgICAgICAgZGF0YS1hZ2VudC1odWItZmlsdGVyLWlucHV0PSJhZ2VudHMiCiAgICAgICAgICAgICAgYXJpYS1sYWJlbD0iRmlsdGVyIGFnZW50cyIKICAgICAgICAgICAgICBpZD0iYWdlbnRBZ2VudHNGaWx0ZXIiCiAgICAgICAgICAgICAgbmFtZT0iYWdlbnRBZ2VudHNGaWx0ZXIiCiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtY2xlYXItYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1maWx0ZXItY2xlYXI9ImFnZW50cyIgaGlkZGVuPkNsZWFyPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC10YWJsZS13cmFwcGVyIiBkYXRhLWFnZW50LWh1Yi10YWJsZS13cmFwcGVyPSJhZ2VudHMiIGhpZGRlbj4KICAgICAgICAgIDx0YWJsZSBjbGFzcz0iYWdlbnQtZGF0YS10YWJsZSI+CiAgICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICA8dGggc2NvcGU9ImNvbCIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJhZ2VudHMiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJhZ2VudElkIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1sYWJlbCI+QWdlbnQgSUQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtaW5kaWNhdG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICA8dGggc2NvcGU9ImNvbCIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJhZ2VudHMiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJhZ2VudE5hbWUiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5BZ2VudCBuYW1lPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGFyaWEtc29ydD0ibm9uZSI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtc29ydC1idXR0b24iIGRhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iYWdlbnRzIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0iY3JlYXRvclR5cGUiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5DcmVhdG9yIHR5cGU8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtaW5kaWNhdG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgICA8dGggc2NvcGU9ImNvbCIgY2xhc3M9ImlzLW51bWVyaWMiIGFyaWEtc29ydD0ibm9uZSI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtc29ydC1idXR0b24iIGRhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iYWdlbnRzIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0iYWN0aXZlTGljZW5zZWQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5BY3RpdmUgdXNlcnMgKGxpY2Vuc2VkKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iaXMtbnVtZXJpYyIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJhZ2VudHMiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJhY3RpdmVVbmxpY2Vuc2VkIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1sYWJlbCI+QWN0aXZlIHVzZXJzICh1bmxpY2Vuc2VkKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iaXMtbnVtZXJpYyIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJhZ2VudHMiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJyZXNwb25zZXMiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5SZXNwb25zZXMgc2VudCB0byB1c2Vyczwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBhcmlhLXNvcnQ9Im5vbmUiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXNvcnQtYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWNvbnRleHQ9ImFnZW50cyIgZGF0YS1hZ2VudC1odWItc29ydC1rZXk9Imxhc3RBY3Rpdml0eSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPkxhc3QgYWN0aXZpdHkgZGF0ZSAoVVRDKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICA8dGJvZHkgZGF0YS1hZ2VudC1odWItdGJvZHk9ImFnZW50cyI+PC90Ym9keT4KICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYWdlbnQtZW1wdHkiIGRhdGEtYWdlbnQtaHViLWVtcHR5PSJhZ2VudHMiPlVwbG9hZCBhbiBBZ2VudHMgQ1NWIHRvIHZpZXcgdGhpcyBkYXRhLjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9ImFnZW50LXBhbmVsIiBkYXRhLWFnZW50LXBhbmVsPSJjb21iaW5lZCIgcm9sZT0idGFicGFuZWwiIGhpZGRlbj4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1kcm9wem9uZSIgZGF0YS1hZ2VudC1odWItZHJvcHpvbmU9ImNvbWJpbmVkIj4KICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgIDxzdHJvbmc+VXNlcnMgJmFtcDsgYWdlbnRzIENTVjwvc3Ryb25nPgogICAgICAgICAgICA8cD5Ecm9wIDxjb2RlPkRlY2xhcmF0aXZlQWdlbnRzX1VzZXJzX19fYWdlbnRzXyouY3N2PC9jb2RlPiBvciA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LWlubGluZS11cGxvYWQiIGRhdGEtYWdlbnQtaHViLXVwbG9hZD0iY29tYmluZWQiPmJyb3dzZTwvYnV0dG9uPiB0byByZWZyZXNoIHRoaXMgdGFibGUuPC9wPgogICAgICAgICAgICA8cCBjbGFzcz0ibXV0ZWQiPkNvbHVtbnMgcmVxdWlyZWQ6IEFnZW50IElELCBBZ2VudCBuYW1lLCBDcmVhdG9yIHR5cGUsIFVzZXJuYW1lLCBSZXNwb25zZXMgc2VudCB0byB1c2VycywgTGFzdCBhY3Rpdml0eSBkYXRlIChVVEMpLjwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGlucHV0CiAgICAgICAgICAgIHR5cGU9ImZpbGUiCiAgICAgICAgICAgIGFjY2VwdD0iLmNzdiIKICAgICAgICAgICAgZGF0YS1hZ2VudC1odWItaW5wdXQ9ImNvbWJpbmVkIgogICAgICAgICAgICBtdWx0aXBsZQogICAgICAgICAgICBoaWRkZW4KICAgICAgICAgICAgYXJpYS1sYWJlbD0iVXBsb2FkIFVzZXJzIGFuZCBBZ2VudHMgQ1NWIgogICAgICAgICAgLz4KICAgICAgICA8L2Rpdj4KICAgICAgICA8cCBjbGFzcz0iYWdlbnQtc3RhdHVzIiBkYXRhLWFnZW50LWh1Yi1zdGF0dXM9ImNvbWJpbmVkIj5VcGxvYWQgYSBDU1YgdG8gcG9wdWxhdGUgdGhlIGNvbWJpbmVkIHRhYmxlLjwvcD4KICAgICAgICA8cCBjbGFzcz0iYWdlbnQtbWV0YSIgZGF0YS1hZ2VudC1odWItbWV0YT0iY29tYmluZWQiPk5vIGZpbGUgdXBsb2FkZWQgeWV0LjwvcD4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC1maWx0ZXItYmFyIiBkYXRhLWFnZW50LWh1Yi1maWx0ZXItYmFyPSJjb21iaW5lZCIgaGlkZGVuPgogICAgICAgICAgPGRpdiBjbGFzcz0iYWdlbnQtZmlsdGVyLXNlYXJjaCI+CiAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgIHR5cGU9InNlYXJjaCIKICAgICAgICAgICAgICBjbGFzcz0iYWdlbnQtc2VhcmNoLWlucHV0IgogICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJGaWx0ZXIgYnkgYWdlbnQsIGNyZWF0b3IgdHlwZSwgb3IgdXNlcm5hbWUiCiAgICAgICAgICAgICAgZGF0YS1hZ2VudC1odWItZmlsdGVyLWlucHV0PSJjb21iaW5lZCIKICAgICAgICAgICAgICBhcmlhLWxhYmVsPSJGaWx0ZXIgY29tYmluZWQgcm93cyIKICAgICAgICAgICAgICBpZD0iYWdlbnRDb21iaW5lZEZpbHRlciIKICAgICAgICAgICAgICBuYW1lPSJhZ2VudENvbWJpbmVkRmlsdGVyIgogICAgICAgICAgICAvPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LWNsZWFyLWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItZmlsdGVyLWNsZWFyPSJjb21iaW5lZCIgaGlkZGVuPkNsZWFyPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJhZ2VudC10YWJsZS13cmFwcGVyIiBkYXRhLWFnZW50LWh1Yi10YWJsZS13cmFwcGVyPSJjb21iaW5lZCIgaGlkZGVuPgogICAgICAgICAgPHRhYmxlIGNsYXNzPSJhZ2VudC1kYXRhLXRhYmxlIj4KICAgICAgICAgICAgPHRoZWFkPgogICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBhcmlhLXNvcnQ9Im5vbmUiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXNvcnQtYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWNvbnRleHQ9ImNvbWJpbmVkIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0iYWdlbnRJZCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPkFnZW50IElEPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGFyaWEtc29ydD0ibm9uZSI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtc29ydC1idXR0b24iIGRhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iY29tYmluZWQiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJhZ2VudE5hbWUiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5BZ2VudCBuYW1lPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGFyaWEtc29ydD0ibm9uZSI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtc29ydC1idXR0b24iIGRhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iY29tYmluZWQiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJjcmVhdG9yVHlwZSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPkNyZWF0b3IgdHlwZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBhcmlhLXNvcnQ9Im5vbmUiPgogICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImFnZW50LXNvcnQtYnV0dG9uIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWNvbnRleHQ9ImNvbWJpbmVkIiBkYXRhLWFnZW50LWh1Yi1zb3J0LWtleT0idXNlcm5hbWUiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5Vc2VybmFtZTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYWdlbnQtc29ydC1pbmRpY2F0b3IiIGFyaWEtaGlkZGVuPSJ0cnVlIj48L3NwYW4+CiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iaXMtbnVtZXJpYyIgYXJpYS1zb3J0PSJub25lIj4KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJhZ2VudC1zb3J0LWJ1dHRvbiIgZGF0YS1hZ2VudC1odWItc29ydC1jb250ZXh0PSJjb21iaW5lZCIgZGF0YS1hZ2VudC1odWItc29ydC1rZXk9InJlc3BvbnNlcyI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtbGFiZWwiPlJlc3BvbnNlcyBzZW50IHRvIHVzZXJzPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWluZGljYXRvciIgYXJpYS1oaWRkZW49InRydWUiPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L3RoPgogICAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGFyaWEtc29ydD0ibm9uZSI+CiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iYWdlbnQtc29ydC1idXR0b24iIGRhdGEtYWdlbnQtaHViLXNvcnQtY29udGV4dD0iY29tYmluZWQiIGRhdGEtYWdlbnQtaHViLXNvcnQta2V5PSJsYXN0QWN0aXZpdHkiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJhZ2VudC1zb3J0LWxhYmVsIj5MYXN0IGFjdGl2aXR5IGRhdGUgKFVUQyk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImFnZW50LXNvcnQtaW5kaWNhdG9yIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PC9zcGFuPgogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgPHRib2R5IGRhdGEtYWdlbnQtaHViLXRib2R5PSJjb21iaW5lZCI+PC90Ym9keT4KICAgICAgICAgIDwvdGFibGU+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYWdlbnQtZW1wdHkiIGRhdGEtYWdlbnQtaHViLWVtcHR5PSJjb21iaW5lZCI+VXBsb2FkIHRoZSBVc2VycyAmYW1wOyBBZ2VudHMgQ1NWIHRvIHZpZXcgbWF0Y2hpbmcgcm93cy48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CgogICAgPHNlY3Rpb24gY2xhc3M9Imdyb3VwLWNhcmQiIGFyaWEtbGFiZWw9IlRvcCB1c2VycyI+CiAgICAgIDxkaXYgY2xhc3M9Imdyb3VwLWhlYWRlciI+CiAgICAgICAgPGgyPlRvcCB1c2VycyBieSB0b3RhbCBhY3Rpb25zPC9oMj4KICAgICAgICA8cCBjbGFzcz0ibXV0ZWQiPlJlZmxlY3RzIGN1cnJlbnQgZmlsdGVyczsgY2FwcGVkIGF0IDIwIHVzZXJzLjwvcD4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InRvcC11c2VycyIgZGF0YS10b3AtdXNlcnM+PC9kaXY+CiAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idmlldy1tb3JlLWJ1dHRvbiIgZGF0YS10b3AtdXNlcnMtdG9nZ2xlIGhpZGRlbiBhcmlhLWV4cGFuZGVkPSJmYWxzZSI+U2hvdyByZW1haW5pbmcgdXNlcnM8L2J1dHRvbj4KICAgIDwvc2VjdGlvbj4KICAgIDxzZWN0aW9uIGNsYXNzPSJ0cmVuZC1jYXJkIGFjdGl2ZS1kYXlzLWNhcmQiIGFyaWEtbGFiZWw9IkNvcGlsb3QgYWN0aXZpdHkgbGFzdCAzMCBkYXlzIiBkYXRhLWFjdGl2ZS1kYXlzLWNhcmQ+CiAgICAgIDxoZWFkZXI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMiBjbGFzcz0iY2hhcnQtdGl0bGUiPkNvcGlsb3QgYWN0aXZpdHkgKGxhc3QgMzAgZGF5cyk8L2gyPgogICAgICAgICAgPHAgY2xhc3M9ImNoYXJ0LXN1YnRpdGxlIiBkYXRhLWFjdGl2ZS1kYXlzLWNhcHRpb24+VXBsb2FkIGRhdGEgdG8gcmV2aWV3IENvcGlsb3QgYWN0aXZpdHkgZm9yIHRoZSBsYXN0IDMwIGRheXMuPC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InVzYWdlLXRyZW5kLWNvbnRyb2xzIiByb2xlPSJncm91cCIgYXJpYS1sYWJlbD0iQWN0aXZlIHVzYWdlIHZpZXciIGRhdGEtYWN0aXZlLWRheXMtY29udHJvbHM+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVzYWdlLXRyZW5kLXRvZ2dsZSBpcy1hY3RpdmUiIGRhdGEtYWN0aXZlLWRheXMtdmlldz0idXNlcnMiPlVuaXF1ZSB1c2VyczwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ1c2FnZS10cmVuZC10b2dnbGUiIGRhdGEtYWN0aXZlLWRheXMtdmlldz0icHJvbXB0cyI+VG90YWwgcHJvbXB0czwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2hlYWRlcj4KICAgICAgPGRpdiBjbGFzcz0iYWN0aXZlLWRheXMtZ3JpZCIgZGF0YS1hY3RpdmUtZGF5cy1ncmlkPgogICAgICAgIDxhcnRpY2xlIGNsYXNzPSJhY3RpdmUtZGF5cy1pdGVtIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy1sYWJlbCI+V29yZDwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy12YWx1ZSIgZGF0YS1hY3RpdmUtZGF5cy12YWx1ZT0id29yZCI+LTwvc3Bhbj4KICAgICAgICA8L2FydGljbGU+CiAgICAgICAgPGFydGljbGUgY2xhc3M9ImFjdGl2ZS1kYXlzLWl0ZW0iPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLWxhYmVsIj5UZWFtczwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy12YWx1ZSIgZGF0YS1hY3RpdmUtZGF5cy12YWx1ZT0idGVhbXMiPi08L3NwYW4+CiAgICAgICAgPC9hcnRpY2xlPgogICAgICAgIDxhcnRpY2xlIGNsYXNzPSJhY3RpdmUtZGF5cy1pdGVtIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy1sYWJlbCI+T3V0bG9vazwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy12YWx1ZSIgZGF0YS1hY3RpdmUtZGF5cy12YWx1ZT0ib3V0bG9vayI+LTwvc3Bhbj4KICAgICAgICA8L2FydGljbGU+CiAgICAgICAgPGFydGljbGUgY2xhc3M9ImFjdGl2ZS1kYXlzLWl0ZW0iPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLWxhYmVsIj5Qb3dlclBvaW50PC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLXZhbHVlIiBkYXRhLWFjdGl2ZS1kYXlzLXZhbHVlPSJwb3dlcnBvaW50Ij4tPC9zcGFuPgogICAgICAgIDwvYXJ0aWNsZT4KICAgICAgICA8YXJ0aWNsZSBjbGFzcz0iYWN0aXZlLWRheXMtaXRlbSI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iYWN0aXZlLWRheXMtbGFiZWwiPkV4Y2VsPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLXZhbHVlIiBkYXRhLWFjdGl2ZS1kYXlzLXZhbHVlPSJleGNlbCI+LTwvc3Bhbj4KICAgICAgICA8L2FydGljbGU+CiAgICAgICAgPGFydGljbGUgY2xhc3M9ImFjdGl2ZS1kYXlzLWl0ZW0iPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLWxhYmVsIj5PbmVOb3RlPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLXZhbHVlIiBkYXRhLWFjdGl2ZS1kYXlzLXZhbHVlPSJvbmVub3RlIj4tPC9zcGFuPgogICAgICAgIDwvYXJ0aWNsZT4KICAgICAgICA8YXJ0aWNsZSBjbGFzcz0iYWN0aXZlLWRheXMtaXRlbSI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iYWN0aXZlLWRheXMtbGFiZWwiPkxvb3A8L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iYWN0aXZlLWRheXMtdmFsdWUiIGRhdGEtYWN0aXZlLWRheXMtdmFsdWU9Imxvb3AiPi08L3NwYW4+CiAgICAgICAgPC9hcnRpY2xlPgogICAgICAgIDxhcnRpY2xlIGNsYXNzPSJhY3RpdmUtZGF5cy1pdGVtIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy1sYWJlbCI+Q29waWxvdCBjaGF0ICh3b3JrKTwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy12YWx1ZSIgZGF0YS1hY3RpdmUtZGF5cy12YWx1ZT0iY2hhdFdvcmsiPi08L3NwYW4+CiAgICAgICAgPC9hcnRpY2xlPgogICAgICAgIDxhcnRpY2xlIGNsYXNzPSJhY3RpdmUtZGF5cy1pdGVtIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJhY3RpdmUtZGF5cy1sYWJlbCI+Q29waWxvdCBDaGF0ICh3ZWIpPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImFjdGl2ZS1kYXlzLXZhbHVlIiBkYXRhLWFjdGl2ZS1kYXlzLXZhbHVlPSJjaGF0V2ViIj4tPC9zcGFuPgogICAgICAgIDwvYXJ0aWNsZT4KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CiAgICA8c2VjdGlvbiBjbGFzcz0idHJlbmQtY2FyZCBpbnNpZ2h0LWNhcmQiIGFyaWEtbGFiZWw9IkFkb3B0aW9uIGJ5IGFwcCIgZGF0YS1hZG9wdGlvbi1jYXJkPgogICAgICA8aGVhZGVyIGNsYXNzPSJjYXJkLWhlYWRlci13aXRoLWFjdGlvbnMiPgogICAgICAgIDxkaXY+CiAgICAgICAgICA8aDIgY2xhc3M9ImNoYXJ0LXRpdGxlIj5BZG9wdGlvbiBieSBhcHA8L2gyPgogICAgICAgICAgPHAgY2xhc3M9ImNoYXJ0LXN1YnRpdGxlIiBkYXRhLWFkb3B0aW9uLWNhcHRpb24+VXBsb2FkIGRhdGEgdG8gc2VlIHdoaWNoIGFwcHMgZHJpdmUgQ29waWxvdCB1c2FnZS48L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXItYWN0aW9ucyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1leHBvcnQtZ3JvdXAiPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1pbmxpbmUiIGRhdGEtYWRvcHRpb24tZXhwb3J0LWNzdj5Eb3dubG9hZCBDU1Y8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iYWRvcHRpb24tY29udHJvbHMiPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InZpZXctbW9yZS1idXR0b24iIGRhdGEtYWRvcHRpb24tdG9nZ2xlIGhpZGRlbj5TaG93IGFwcCBjYXBhYmlsaXRpZXM8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2hlYWRlcj4KICAgICAgPGRpdiBjbGFzcz0iYWRvcHRpb24tdGFibGUtd3JhcHBlciI+CiAgICAgICAgPHRhYmxlIGNsYXNzPSJhZG9wdGlvbi10YWJsZSIgZGF0YS1hZG9wdGlvbi10YWJsZT4KICAgICAgICAgIDx0aGVhZD4KICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIj5BcHBzICZhbXA7IGNhcGFiaWxpdGllczwvdGg+CiAgICAgICAgICAgICAgPHRoIHNjb3BlPSJjb2wiIGNsYXNzPSJpcy1udW1lcmljIj5BY3RpdmUgdXNlcnM8L3RoPgogICAgICAgICAgICAgIDx0aCBzY29wZT0iY29sIiBjbGFzcz0iaXMtbnVtZXJpYyI+JSBvZiBhY3RpdmUgdXNlcnM8L3RoPgogICAgICAgICAgICA8L3RyPgogICAgICAgICAgPC90aGVhZD4KICAgICAgICAgIDx0Ym9keSBkYXRhLWFkb3B0aW9uLWJvZHk+PC90Ym9keT4KICAgICAgICA8L3RhYmxlPgogICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWVtcHR5IiBkYXRhLWFkb3B0aW9uLWVtcHR5IGhpZGRlbj5Mb2FkIGRhdGEgdG8gdmlldyBhZG9wdGlvbiBieSBhcHAuPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8Zm9vdGVyIGNsYXNzPSJhZG9wdGlvbi1mb290ZXIiPgogICAgICAgIDxkaXYgY2xhc3M9Im11dGVkIj5BY3RpdmUgQ29waWxvdCB1c2VycyBpbiB2aWV3PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iYWRvcHRpb24tdG90YWwiIGRhdGEtYWRvcHRpb24tdG90YWw+LTwvZGl2PgogICAgICA8L2Zvb3Rlcj4KICAgIDwvc2VjdGlvbj4KICAgIDxzZWN0aW9uIGNsYXNzPSJ0cmVuZC1jYXJkIGluc2lnaHQtY2FyZCIgYXJpYS1sYWJlbD0iVXNhZ2UgaW50ZW5zaXR5IGluc2lnaHRzIiBkYXRhLXVzYWdlLWNhcmQ+CiAgICAgIDxoZWFkZXIgY2xhc3M9ImNhcmQtaGVhZGVyLXdpdGgtYWN0aW9ucyI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMiBjbGFzcz0iY2hhcnQtdGl0bGUiPlVzYWdlIGludGVuc2l0eTwvaDI+CiAgICAgICAgICA8cCBjbGFzcz0iY2hhcnQtc3VidGl0bGUiIGRhdGEtdXNhZ2UtY2FwdGlvbj5VcGxvYWQgZGF0YSB0byBicmVhayBkb3duIGFjdGl2ZSB1c2Vycy48L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXItYWN0aW9ucyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGlwIGlzLW11dGVkIiBkYXRhLXVzYWdlLXdpbmRvdz4tPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1leHBvcnQtZ3JvdXAiPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1pbmxpbmUiIGRhdGEtdXNhZ2UtaW50ZW5zaXR5LWV4cG9ydC1jc3Y+RG93bmxvYWQgQ1NWPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9oZWFkZXI+CiAgICAgIDxkaXYgY2xhc3M9InVzYWdlLXRocmVzaG9sZHMiIGRhdGEtdXNhZ2UtdGhyZXNob2xkcz4KICAgICAgICA8ZGl2IGNsYXNzPSJ1c2FnZS10aHJlc2hvbGRzX19maWVsZCI+CiAgICAgICAgICA8bGFiZWwgZm9yPSJ1c2FnZVRocmVzaG9sZE1pZGRsZSI+TWlkZGxlIHRocmVzaG9sZDwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0idXNhZ2VUaHJlc2hvbGRNaWRkbGUiIGRhdGEtdXNhZ2UtdGhyZXNob2xkLW1pZGRsZSBtaW49IjEiIHN0ZXA9IjEiIC8+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idXNhZ2UtdGhyZXNob2xkc19fZmllbGQiPgogICAgICAgICAgPGxhYmVsIGZvcj0idXNhZ2VUaHJlc2hvbGRIaWdoIj5IaWdoIHRocmVzaG9sZDwvbGFiZWw+CiAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0idXNhZ2VUaHJlc2hvbGRIaWdoIiBkYXRhLXVzYWdlLXRocmVzaG9sZC1oaWdoIG1pbj0iMSIgc3RlcD0iMSIgLz4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InVzYWdlLW1vbnRoLWNvbnRyb2xzIiBkYXRhLXVzYWdlLW1vbnRoLWNvbnRyb2xzPjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJ1c2FnZS1tb250aC1ncmlkIiBkYXRhLXVzYWdlLW1vbnRoLWdyaWQ+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWVtcHR5IiBkYXRhLXVzYWdlLWVtcHR5IGhpZGRlbj5VcGxvYWQgZGF0YSB0byBicmVhayBkb3duIGFjdGl2ZSB1c2VycyBieSBtb250aC48L2Rpdj4KICAgIDwvc2VjdGlvbj4KICAgIDxzZWN0aW9uIGNsYXNzPSJ0cmVuZC1jYXJkIGluc2lnaHQtY2FyZCIgYXJpYS1sYWJlbD0iVXNhZ2UgaW50ZW5zaXR5IHRyZW5kIiBkYXRhLXVzYWdlLXRyZW5kLWNhcmQ+CiAgICAgIDxoZWFkZXIgY2xhc3M9ImNhcmQtaGVhZGVyLXdpdGgtYWN0aW9ucyI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxoMiBjbGFzcz0iY2hhcnQtdGl0bGUiPlVzYWdlIGludGVuc2l0eSBjb21wYXJpc29uPC9oMj4KICAgICAgICAgIDxwIGNsYXNzPSJjaGFydC1zdWJ0aXRsZSIgZGF0YS11c2FnZS10cmVuZC1jYXB0aW9uPlVwbG9hZCBkYXRhIHRvIGNvbXBhcmUgZnJlcXVlbnQgYW5kIGNvbnNpc3RlbnQgdXNhZ2UuPC9wPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImNhcmQtaGVhZGVyLWFjdGlvbnMiPgogICAgICAgICAgPGRpdiBjbGFzcz0idXNhZ2UtdHJlbmQtY29udHJvbHMiIHJvbGU9Imdyb3VwIiBhcmlhLWxhYmVsPSJVc2FnZSBpbnRlbnNpdHkgbWV0cmljIHZpZXciPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVzYWdlLXRyZW5kLXRvZ2dsZSBpcy1hY3RpdmUiIGRhdGEtdXNhZ2UtdHJlbmQtbW9kZT0ibnVtYmVyIj5TaG93IG51bWJlcnM8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ1c2FnZS10cmVuZC10b2dnbGUiIGRhdGEtdXNhZ2UtdHJlbmQtbW9kZT0icGVyY2VudGFnZSI+U2hvdyBwZXJjZW50YWdlczwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1leHBvcnQtZ3JvdXAiPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1pbmxpbmUiIGRhdGEtdXNhZ2UtZXhwb3J0LXBuZz5Eb3dubG9hZCBQTkc8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJzdG9yYWdlLWJ1dHRvbiBzdG9yYWdlLWJ1dHRvbi0taW5saW5lIiBkYXRhLXVzYWdlLWV4cG9ydC1jc3Y+RG93bmxvYWQgQ1NWPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9oZWFkZXI+CiAgICAgIDxkaXYgY2xhc3M9InVzYWdlLXJlZ2lvbi1jb250cm9scyIgZGF0YS11c2FnZS10cmVuZC1yZWdpb24tY29udHJvbHM+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InVzYWdlLXRyZW5kLWNoYXJ0Ij4KICAgICAgICA8Y2FudmFzIGlkPSJ1c2FnZVRyZW5kQ2hhcnQiIGRhdGEtdXNhZ2UtdHJlbmQtY2hhcnQgYXJpYS1sYWJlbD0iVXNhZ2UgaW50ZW5zaXR5IHRyZW5kIj48L2NhbnZhcz4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1lbXB0eSIgZGF0YS11c2FnZS10cmVuZC1lbXB0eSBoaWRkZW4+VXBsb2FkIGRhdGEgdG8gdmlzdWFsaXplIHVzYWdlIGludGVuc2l0eSB0cmVuZC48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CiAgICA8c2VjdGlvbiBjbGFzcz0idHJlbmQtY2FyZCBpbnNpZ2h0LWNhcmQiIGFyaWEtbGFiZWw9IkxpY2Vuc2VkIHVzZXJzIHRyZW5kIiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtY2FyZD4KICAgICAgPGhlYWRlcj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGgyIGNsYXNzPSJjaGFydC10aXRsZSI+RW5hYmxlZCBDb3BpbG90IHVzZXJzPC9oMj4KICAgICAgICAgIDxwIGNsYXNzPSJjaGFydC1zdWJ0aXRsZSIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWNhcHRpb24+VXBsb2FkIGRhdGEgdG8gdmlzdWFsaXplIGxpY2Vuc2VkIHVzZXJzIGJ5IG1vbnRoLjwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9oZWFkZXI+CiAgICAgIDxkaXYgY2xhc3M9ImVuYWJsZWQtbGljZW5zZXMtY29udHJvbHMiPgogICAgICAgIDxkaXYgY2xhc3M9ImV4cG9ydC1jb250cm9scyIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWV4cG9ydC1jb250cm9scz4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0iZXhwb3J0LXRyaWdnZXIiIGRhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtdHJpZ2dlciBhcmlhLWhhc3BvcHVwPSJ0cnVlIiBhcmlhLWV4cGFuZGVkPSJmYWxzZSI+RXhwb3J0PC9idXR0b24+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJleHBvcnQtbWVudSIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWV4cG9ydC1tZW51IGhpZGRlbiByb2xlPSJtZW51Ij4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGRhdGEtZW5hYmxlZC1saWNlbnNlcy1leHBvcnQtdHJhbnNwYXJlbnQgcm9sZT0ibWVudWl0ZW0iPlBORyAodHJhbnNwYXJlbnQpPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtZXhwb3J0LXdoaXRlIHJvbGU9Im1lbnVpdGVtIj5QTkcgKHdoaXRlIGJnKTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWV4cG9ydC1uby12YWx1ZXMgcm9sZT0ibWVudWl0ZW0iPlBORyAobm8gdmFsdWVzKTwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9scyIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWNvbG9yLWNvbnRyb2xzPgogICAgICAgICAgPGRpdiBjbGFzcz0iZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9sc19fZ3JvdXAiPgogICAgICAgICAgICA8bGFiZWwgZm9yPSJlbmFibGVkTGljZW5zZXNDb2xvclN0YXJ0Ij5TdGFydCBjb2xvcjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjb2xvciIgaWQ9ImVuYWJsZWRMaWNlbnNlc0NvbG9yU3RhcnQiIGRhdGEtZW5hYmxlZC1saWNlbnNlcy1jb2xvci1zdGFydCBhcmlhLWxhYmVsPSJDaG9vc2Ugc3RhcnQgY29sb3IiIC8+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImVuYWJsZWQtbGljZW5zZXMtY29sb3ItY29udHJvbHNfX2dyb3VwIj4KICAgICAgICAgICAgPGxhYmVsIGZvcj0iZW5hYmxlZExpY2Vuc2VzQ29sb3JFbmQiPkVuZCBjb2xvcjwvbGFiZWw+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjb2xvciIgaWQ9ImVuYWJsZWRMaWNlbnNlc0NvbG9yRW5kIiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtY29sb3ItZW5kIGFyaWEtbGFiZWw9IkNob29zZSBlbmQgY29sb3IiIC8+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZW5hYmxlZC1saWNlbnNlcy1ncmFkaWVudC10b2dnbGUiPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGRhdGEtZW5hYmxlZC1saWNlbnNlcy1ncmFkaWVudCAvPgogICAgICAgICAgICBVc2UgZ3JhZGllbnQKICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICA8bGFiZWwgY2xhc3M9ImVuYWJsZWQtbGljZW5zZXMtdmFsdWUtdG9nZ2xlIj4KICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtc2hvdy12YWx1ZXMgY2hlY2tlZCAvPgogICAgICAgICAgICBTaG93IHZhbHVlcyBvbiBiYXJzCiAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgPGRpdiBjbGFzcz0iZW5hYmxlZC1saWNlbnNlcy1jb2xvci1jb250cm9sc19fZ3JvdXAgZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZSIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlIGhpZGRlbj4KICAgICAgICAgICAgPGxhYmVsIGZvcj0iZW5hYmxlZExpY2Vuc2VzT3ZlcnJpZGUiPk92ZXJyaWRlIGxhc3QgbW9udGg8L2xhYmVsPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJlbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19pbnB1dHMiPgogICAgICAgICAgICAgIDxpbnB1dAogICAgICAgICAgICAgICAgdHlwZT0ibnVtYmVyIgogICAgICAgICAgICAgICAgaWQ9ImVuYWJsZWRMaWNlbnNlc092ZXJyaWRlIgogICAgICAgICAgICAgICAgaW5wdXRtb2RlPSJudW1lcmljIgogICAgICAgICAgICAgICAgbWluPSIwIgogICAgICAgICAgICAgICAgc3RlcD0iMSIKICAgICAgICAgICAgICAgIGRhdGEtZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZS1pbnB1dAogICAgICAgICAgICAgICAgYXJpYS1kZXNjcmliZWRieT0iZW5hYmxlZExpY2Vuc2VzT3ZlcnJpZGVIaW50IgogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZW5hYmxlZC1saWNlbnNlcy1vdmVycmlkZV9fYnV0dG9ucyI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRyZW5kLWNvbG9yLWJ1dHRvbiIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlLWFwcGx5PlNldDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ0cmVuZC1jb2xvci1idXR0b24gaXMtc2Vjb25kYXJ5IiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtb3ZlcnJpZGUtY2xlYXI+Q2xlYXI8L2J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzPSJlbmFibGVkLWxpY2Vuc2VzLW92ZXJyaWRlX19oaW50IiBpZD0iZW5hYmxlZExpY2Vuc2VzT3ZlcnJpZGVIaW50IiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtb3ZlcnJpZGUtaGludD48L3A+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImVuYWJsZWQtbGljZW5zZXMtY29sb3ItY29udHJvbHNfX2FjdGlvbnMiPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InRyZW5kLWNvbG9yLWJ1dHRvbiIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWFwcGx5PkFwcGx5PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idHJlbmQtY29sb3ItYnV0dG9uIGlzLXNlY29uZGFyeSIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLXJlc2V0PlJlc2V0PC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9ImVuYWJsZWQtbGljZW5zZXMtY2hhcnQiPgogICAgICAgIDxjYW52YXMgaWQ9ImVuYWJsZWRMaWNlbnNlc0NoYXJ0IiBkYXRhLWVuYWJsZWQtbGljZW5zZXMtY2hhcnQgYXJpYS1sYWJlbD0iQmFyIGNoYXJ0IHNob3dpbmcgZW5hYmxlZCBDb3BpbG90IHVzZXJzIGJ5IG1vbnRoIj48L2NhbnZhcz4KICAgICAgICA8ZGl2IGNsYXNzPSJjaGFydC1lbXB0eSIgZGF0YS1lbmFibGVkLWxpY2Vuc2VzLWVtcHR5IGhpZGRlbj5VcGxvYWQgZGF0YSB0byB2aXN1YWxpemUgbGljZW5zZSBjb3ZlcmFnZS48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CiAgICA8c2VjdGlvbiBjbGFzcz0idHJlbmQtY2FyZCBpbnNpZ2h0LWNhcmQiIGFyaWEtbGFiZWw9IlJldHVybmluZyB1c2VycyIgZGF0YS1yZXR1cm5pbmctY2FyZD4KICAgICAgPGhlYWRlciBjbGFzcz0iY2FyZC1oZWFkZXItd2l0aC1hY3Rpb25zIj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPGgyIGNsYXNzPSJjaGFydC10aXRsZSI+UmV0dXJuaW5nIHVzZXJzPC9oMj4KICAgICAgICAgIDxwIGNsYXNzPSJjaGFydC1zdWJ0aXRsZSIgZGF0YS1yZXR1cm5pbmctY2FwdGlvbj5VcGxvYWQgZGF0YSB0byBtb25pdG9yIHJlY3VycmluZyBhZG9wdGlvbi48L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZC1oZWFkZXItYWN0aW9ucyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ1c2FnZS10cmVuZC1jb250cm9scyIgcm9sZT0iZ3JvdXAiIGFyaWEtbGFiZWw9IlJldHVybmluZyB1c2VycyBtZXRyaWMgdmlldyIgZGF0YS1yZXR1cm5pbmctbWV0cmljLWNvbnRyb2xzPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVzYWdlLXRyZW5kLXRvZ2dsZSBpcy1hY3RpdmUiIGRhdGEtcmV0dXJuaW5nLW1ldHJpYy1idXR0b249InRvdGFsIj5Ub3RhbCB1c2VyczwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVzYWdlLXRyZW5kLXRvZ2dsZSIgZGF0YS1yZXR1cm5pbmctbWV0cmljLWJ1dHRvbj0icGVyY2VudGFnZSI+UGVyY2VudGFnZTwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ1c2FnZS10cmVuZC1jb250cm9scyIgcm9sZT0iZ3JvdXAiIGFyaWEtbGFiZWw9IlJldHVybmluZyB1c2VycyBpbnRlcnZhbCB2aWV3IiBkYXRhLXJldHVybmluZy1pbnRlcnZhbC1jb250cm9scz4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ1c2FnZS10cmVuZC10b2dnbGUgaXMtYWN0aXZlIiBkYXRhLXJldHVybmluZy1pbnRlcnZhbD0id2Vla2x5Ij5XZWVrbHk8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJ1c2FnZS10cmVuZC10b2dnbGUiIGRhdGEtcmV0dXJuaW5nLWludGVydmFsPSJtb250aGx5Ij5Nb250aGx5PC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNoYXJ0LWV4cG9ydC1ncm91cCI+CiAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic3RvcmFnZS1idXR0b24gc3RvcmFnZS1idXR0b24tLWlubGluZSIgZGF0YS1yZXR1cm5pbmctZXhwb3J0LXBuZz5Eb3dubG9hZCBQTkc8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJzdG9yYWdlLWJ1dHRvbiBzdG9yYWdlLWJ1dHRvbi0taW5saW5lIiBkYXRhLXJldHVybmluZy1leHBvcnQtY3N2PkRvd25sb2FkIENTVjwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJyZXR1cm5pbmctcmVnaW9uLWNvbnRyb2xzIiBkYXRhLXJldHVybmluZy1yZWdpb24tY29udHJvbHM+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InJldHVybmluZy1jaGFydCI+CiAgICAgICAgPGNhbnZhcyBpZD0icmV0dXJuaW5nVXNlcnNDaGFydCIgZGF0YS1yZXR1cm5pbmctY2hhcnQgYXJpYS1sYWJlbD0iUmV0dXJuaW5nIHVzZXJzIGJ5IHBlcmlvZCI+PC9jYW52YXM+CiAgICAgICAgPGRpdiBjbGFzcz0iY2hhcnQtZW1wdHkiIGRhdGEtcmV0dXJuaW5nLWVtcHR5IGhpZGRlbj5Mb2FkIGRhdGEgdG8gdmlldyByZXR1cm5pbmcgdXNlcnMuPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJyZXR1cm5pbmctc3VtbWFyeSI+CiAgICAgICAgPGRpdiBjbGFzcz0iaW5zaWdodC1zdW1tYXJ5IiBkYXRhLXJldHVybmluZy1zdW1tYXJ5Pi08L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L3NlY3Rpb24+CiAgICA8c2VjdGlvbiBjbGFzcz0iY2F0ZWdvcnktZ3JpZCIgYXJpYS1sYWJlbD0iQ29waWxvdCBjYXBhYmlsaXR5IGhpZ2hsaWdodHMiPgogICAgICA8YXJ0aWNsZSBjbGFzcz0iY2F0ZWdvcnktY2FyZCIgZGF0YS1jYXRlZ29yeT0ibWVldGluZ3MiPgogICAgICAgIDxoZWFkZXIgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlciI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iY2F0ZWdvcnktaWNvbiIgZGF0YS1sZXR0ZXI9Ik0iPjwvc3Bhbj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlci10ZXh0Ij4KICAgICAgICAgICAgPGgzPk1lZXRpbmdzPC9oMz4KICAgICAgICAgICAgPHA+V2hlcmUgQ29waWxvdCBhY2NlbGVyYXRlcyBtZWV0aW5nIHJlY2FwcyBhbmQgZm9sbG93LXVwcy48L3A+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2hlYWRlcj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXRlZ29yeS1jYXJkX19zdGF0cyIgZGF0YS1jYXRlZ29yeS1zdGF0cz0ibWVldGluZ3MiPgogICAgICAgICAgPHAgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX3BsYWNlaG9sZGVyIG11dGVkIj5VcGxvYWQgZGF0YSB0byB2aWV3IGluc2lnaHRzLjwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9hcnRpY2xlPgogICAgICA8YXJ0aWNsZSBjbGFzcz0iY2F0ZWdvcnktY2FyZCIgZGF0YS1jYXRlZ29yeT0iZW1haWxzIj4KICAgICAgICA8aGVhZGVyIGNsYXNzPSJjYXRlZ29yeS1jYXJkX19oZWFkZXIiPgogICAgICAgICAgPHNwYW4gY2xhc3M9ImNhdGVnb3J5LWljb24iIGRhdGEtbGV0dGVyPSJFIj48L3NwYW4+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXRlZ29yeS1jYXJkX19oZWFkZXItdGV4dCI+CiAgICAgICAgICAgIDxoMz5FbWFpbHM8L2gzPgogICAgICAgICAgICA8cD5EcmFmdGluZywgY29hY2hpbmcsIGFuZCBzdW1tYXJpemluZyBpbiBPdXRsb29rLjwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvaGVhZGVyPgogICAgICAgIDxkaXYgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX3N0YXRzIiBkYXRhLWNhdGVnb3J5LXN0YXRzPSJlbWFpbHMiPgogICAgICAgICAgPHAgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX3BsYWNlaG9sZGVyIG11dGVkIj5VcGxvYWQgZGF0YSB0byB2aWV3IGluc2lnaHRzLjwvcD4KICAgICAgICA8L2Rpdj4KICAgICAgPC9hcnRpY2xlPgogICAgICA8YXJ0aWNsZSBjbGFzcz0iY2F0ZWdvcnktY2FyZCIgZGF0YS1jYXRlZ29yeT0iY2hhdHMiPgogICAgICAgIDxoZWFkZXIgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlciI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iY2F0ZWdvcnktaWNvbiIgZGF0YS1sZXR0ZXI9IlQiPjwvc3Bhbj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlci10ZXh0Ij4KICAgICAgICAgICAgPGgzPlRlYW1zPC9oMz4KICAgICAgICAgICAgPHA+Qm9vc3RpbmcgY29sbGFib3JhdGlvbiBpbiBUZWFtcyBjb252ZXJzYXRpb25zLjwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvaGVhZGVyPgogICAgICAgIDxkaXYgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX3N0YXRzIiBkYXRhLWNhdGVnb3J5LXN0YXRzPSJjaGF0cyI+CiAgICAgICAgICA8cCBjbGFzcz0iY2F0ZWdvcnktY2FyZF9fcGxhY2Vob2xkZXIgbXV0ZWQiPlVwbG9hZCBkYXRhIHRvIHZpZXcgaW5zaWdodHMuPC9wPgogICAgICAgIDwvZGl2PgogICAgICA8L2FydGljbGU+CiAgICAgIDxhcnRpY2xlIGNsYXNzPSJjYXRlZ29yeS1jYXJkIiBkYXRhLWNhdGVnb3J5PSJkb2N1bWVudHMiPgogICAgICAgIDxoZWFkZXIgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlciI+CiAgICAgICAgICA8c3BhbiBjbGFzcz0iY2F0ZWdvcnktaWNvbiIgZGF0YS1sZXR0ZXI9IkQiPjwvc3Bhbj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImNhdGVnb3J5LWNhcmRfX2hlYWRlci10ZXh0Ij4KICAgICAgICAgICAgPGgzPkRvY3VtZW50czwvaDM+CiAgICAgICAgICAgIDxwPlN1bW1hcmllcyBhbmQgY3JlYXRpb24gYWNyb3NzIFdvcmQsIEV4Y2VsLCBhbmQgUG93ZXJQb2ludC48L3A+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2hlYWRlcj4KICAgICAgICA8ZGl2IGNsYXNzPSJjYXRlZ29yeS1jYXJkX19zdGF0cyIgZGF0YS1jYXRlZ29yeS1zdGF0cz0iZG9jdW1lbnRzIj4KICAgICAgICAgIDxwIGNsYXNzPSJjYXRlZ29yeS1jYXJkX19wbGFjZWhvbGRlciBtdXRlZCI+VXBsb2FkIGRhdGEgdG8gdmlldyBpbnNpZ2h0cy48L3A+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvYXJ0aWNsZT4KICAgICAgPGFydGljbGUgY2xhc3M9ImNhdGVnb3J5LWNhcmQiIGRhdGEtY2F0ZWdvcnk9ImNvcGlsb3QtY2hhdCI+CiAgICAgICAgPGhlYWRlciBjbGFzcz0iY2F0ZWdvcnktY2FyZF9faGVhZGVyIj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJjYXRlZ29yeS1pY29uIiBkYXRhLWxldHRlcj0iQyI+PC9zcGFuPgogICAgICAgICAgPGRpdiBjbGFzcz0iY2F0ZWdvcnktY2FyZF9faGVhZGVyLXRleHQiPgogICAgICAgICAgICA8aDM+Q29waWxvdCBjaGF0PC9oMz4KICAgICAgICAgICAgPHA+UHJvbXB0IHZvbHVtZSBhY3Jvc3Mgd29yayBhbmQgd2ViIGNoYXQgZXhwZXJpZW5jZXMuPC9wPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9oZWFkZXI+CiAgICAgICAgPGRpdiBjbGFzcz0iY2F0ZWdvcnktY2FyZF9fc3RhdHMiIGRhdGEtY2F0ZWdvcnktc3RhdHM9ImNvcGlsb3QtY2hhdCI+CiAgICAgICAgICA8cCBjbGFzcz0iY2F0ZWdvcnktY2FyZF9fcGxhY2Vob2xkZXIgbXV0ZWQiPlVwbG9hZCBkYXRhIHRvIHZpZXcgaW5zaWdodHMuPC9wPgogICAgICAgIDwvZGl2PgogICAgICA8L2FydGljbGU+CiAgICA8L3NlY3Rpb24+CiAgPC9tYWluPgogIDxmb290ZXIgY2xhc3M9InBhZ2UtZm9vdGVyIj4KICAgIDxwIGNsYXNzPSJtdXRlZCI+QnVpbHQgYnkgQ2hyaXN0b2ZmZXIgQmVzbGVyIEhhbnNlbiDCtyBMaWNlbnNlZCB1bmRlciBBR1BMLTMuMC48L3A+CiAgPC9mb290ZXI+CiAgPGRpYWxvZyBjbGFzcz0ic25hcHNob3QtZGlhbG9nIiBkYXRhLXNuYXBzaG90LWV4cG9ydC1kaWFsb2c+CiAgICA8Zm9ybSBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19mb3JtIiBkYXRhLXNuYXBzaG90LWV4cG9ydC1mb3JtPgogICAgICA8aDIgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fdGl0bGUiPlNhdmUgZW5jcnlwdGVkIHNuYXBzaG90PC9oMj4KICAgICAgPHAgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fZGVzY3JpcHRpb24gbXV0ZWQiPkVudGVyIGEgcGFzc3dvcmQgdG8gZW5jcnlwdCB0aGUgY3VycmVudCBkYXRhc2V0IGFuZCBmaWx0ZXJzLiBTaGFyZSB0aGUgcGFzc3dvcmQgb25seSB3aXRoIHBlb3BsZSB5b3UgdHJ1c3QuPC9wPgogICAgICA8bGFiZWwgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fbGFiZWwiPgogICAgICAgIDxzcGFuPlBhc3N3b3JkPC9zcGFuPgogICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgYXV0b2NvbXBsZXRlPSJuZXctcGFzc3dvcmQiIHJlcXVpcmVkIGRhdGEtc25hcHNob3QtcGFzc3dvcmQgLz4KICAgICAgPC9sYWJlbD4KICAgICAgPGxhYmVsIGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX2xhYmVsIj4KICAgICAgICA8c3Bhbj5Db25maXJtIHBhc3N3b3JkPC9zcGFuPgogICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgYXV0b2NvbXBsZXRlPSJuZXctcGFzc3dvcmQiIHJlcXVpcmVkIGRhdGEtc25hcHNob3QtcGFzc3dvcmQtY29uZmlybSAvPgogICAgICA8L2xhYmVsPgogICAgICA8ZGl2IGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX2Vycm9yIiBkYXRhLXNuYXBzaG90LWVycm9yIGhpZGRlbj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19vdXRwdXQiIGRhdGEtc25hcHNob3Qtb3V0cHV0IGhpZGRlbj4KICAgICAgICA8bGFiZWwgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fbGFiZWwiPgogICAgICAgICAgPHNwYW4+U25hcHNob3QgcGFja2FnZTwvc3Bhbj4KICAgICAgICAgIDx0ZXh0YXJlYSByZWFkb25seSByb3dzPSI2IiBkYXRhLXNuYXBzaG90LW91dHB1dC10ZXh0PjwvdGV4dGFyZWE+CiAgICAgICAgPC9sYWJlbD4KICAgICAgICA8ZGl2IGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX291dHB1dC1hY3Rpb25zIj4KICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0ic3RvcmFnZS1idXR0b24iIGRhdGEtc25hcHNob3QtY29weT5Db3B5IHRvIGNsaXBib2FyZDwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJzdG9yYWdlLWJ1dHRvbiIgZGF0YS1zbmFwc2hvdC1kb3dubG9hZD5Eb3dubG9hZCBmaWxlPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIiBkYXRhLXNuYXBzaG90LWV4cG9ydC1odG1sPkRvd25sb2FkIFNoYXJlUG9pbnQgYnVuZGxlIChaSVApPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX3N0YXRpYyIgZGF0YS1zbmFwc2hvdC1zdGF0aWMgaGlkZGVuPgogICAgICAgIDxwIGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX2hpbnQgbXV0ZWQiPk5lZWQgYSBwYXNzd29yZC1mcmVlIHBhY2thZ2UgZm9yIGludGVybmFsIHBvcnRhbHM/IERvd25sb2FkIHRoZSBzdGF0aWMgSFRNTCBidW5kbGUuPC9wPgogICAgICAgIDxkaXYgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fb3V0cHV0LWFjdGlvbnMiPgogICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJzdG9yYWdlLWJ1dHRvbiIgZGF0YS1zbmFwc2hvdC1leHBvcnQtc3RhdGljPkRvd25sb2FkIHN0YXRpYyBIVE1MIGJ1bmRsZTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19hY3Rpb25zIj4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1naG9zdCIgZGF0YS1zbmFwc2hvdC1jYW5jZWw+Q2FuY2VsPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJzdG9yYWdlLWJ1dHRvbiIgZGF0YS1zbmFwc2hvdC1nZW5lcmF0ZT5HZW5lcmF0ZSBzbmFwc2hvdDwvYnV0dG9uPgogICAgICA8L2Rpdj4KICAgIDwvZm9ybT4KICA8L2RpYWxvZz4KICA8ZGlhbG9nIGNsYXNzPSJzbmFwc2hvdC1kaWFsb2ciIGRhdGEtc25hcHNob3QtaW1wb3J0LWRpYWxvZz4KICAgIDxmb3JtIGNsYXNzPSJzbmFwc2hvdC1kaWFsb2dfX2Zvcm0iIGRhdGEtc25hcHNob3QtaW1wb3J0LWZvcm0+CiAgICAgIDxoMiBjbGFzcz0ic25hcHNob3QtZGlhbG9nX190aXRsZSI+TG9hZCBlbmNyeXB0ZWQgc25hcHNob3Q8L2gyPgogICAgICA8cCBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19kZXNjcmlwdGlvbiBtdXRlZCI+UGFzdGUgYW4gZXhwb3J0ZWQgc25hcHNob3Qgb3IgcGljayBhIHNhdmVkIGZpbGUsIHRoZW4gZW50ZXIgdGhlIHNoYXJlZCBwYXNzd29yZC48L3A+CiAgICAgIDxsYWJlbCBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19sYWJlbCI+CiAgICAgICAgPHNwYW4+U25hcHNob3QgdGV4dDwvc3Bhbj4KICAgICAgICA8dGV4dGFyZWEgcm93cz0iNiIgZGF0YS1zbmFwc2hvdC1pbXBvcnQtdGV4dCBwbGFjZWhvbGRlcj0iUGFzdGUgc25hcHNob3QgcGFja2FnZSBoZXJlIj48L3RleHRhcmVhPgogICAgICA8L2xhYmVsPgogICAgICA8bGFiZWwgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fbGFiZWwgc25hcHNob3QtZGlhbG9nX19maWxlIj4KICAgICAgICA8c3Bhbj5PciBzZWxlY3Qgc25hcHNob3QgZmlsZTwvc3Bhbj4KICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgYWNjZXB0PSIuY29waWxvdC1zbmFwc2hvdCwuanNvbiwudHh0IiBkYXRhLXNuYXBzaG90LWltcG9ydC1maWxlIC8+CiAgICAgIDwvbGFiZWw+CiAgICAgIDxsYWJlbCBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19sYWJlbCI+CiAgICAgICAgPHNwYW4+UGFzc3dvcmQ8L3NwYW4+CiAgICAgICAgPGlucHV0IHR5cGU9InBhc3N3b3JkIiBhdXRvY29tcGxldGU9ImN1cnJlbnQtcGFzc3dvcmQiIHJlcXVpcmVkIGRhdGEtc25hcHNob3QtaW1wb3J0LXBhc3N3b3JkIC8+CiAgICAgIDwvbGFiZWw+CiAgICAgIDxkaXYgY2xhc3M9InNuYXBzaG90LWRpYWxvZ19fZXJyb3IiIGRhdGEtc25hcHNob3QtaW1wb3J0LWVycm9yIGhpZGRlbj48L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ic25hcHNob3QtZGlhbG9nX19hY3Rpb25zIj4KICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InN0b3JhZ2UtYnV0dG9uIHN0b3JhZ2UtYnV0dG9uLS1naG9zdCIgZGF0YS1zbmFwc2hvdC1pbXBvcnQtY2FuY2VsPkNhbmNlbDwvYnV0dG9uPgogICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0ic3RvcmFnZS1idXR0b24iIGRhdGEtc25hcHNob3QtaW1wb3J0LXN1Ym1pdD5Mb2FkIHNuYXBzaG90PC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9mb3JtPgogIDwvZGlhbG9nPgogIDxzY3JpcHQKICAgIGRlZmVyCiAgICBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vcGFrb0AyLjEuMC9kaXN0L3Bha28ubWluLmpzIgogICAgY3Jvc3NvcmlnaW49ImFub255bW91cyIKICAgIGludGVncml0eT0ic2hhMzg0LXJObGFFNWZzOWRHSWpteFdEQUxRaC9SQkFhR1JZVDVDaHJ6SG82dFJmZ3JaMzZpUkZBaXF1UDVnNDFKc3YrMGoiCiAgPjwvc2NyaXB0PgogIDxzY3JpcHQgZGVmZXIgc3JjPSJhc3NldHMvc2hhcmVwb2ludC1zdGF0aWMtYXNzZXRzLmpzIj48L3NjcmlwdD4KICA8c2NyaXB0IGRlZmVyIHNyYz0iYXNzZXRzL3ZlbmRvci9mZmxhdGUubWluLmpzIj48L3NjcmlwdD4KICA8c2NyaXB0IGRlZmVyIHNyYz0iYXNzZXRzL2NvcGlsb3QtZGFzaGJvYXJkLmpzIj48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+Cg==
`;

(function (global) {
  global = global || (typeof globalThis === 'object' ? globalThis : typeof window === 'object' ? window : {});
  if ((!global.SHAREPOINT_CSS_BASE64 || !String(global.SHAREPOINT_CSS_BASE64).trim()) && typeof SHAREPOINT_CSS_BASE64 === 'string') {
    global.SHAREPOINT_CSS_BASE64 = SHAREPOINT_CSS_BASE64;
  }
  if ((!global.SHAREPOINT_JS_BASE64 || !String(global.SHAREPOINT_JS_BASE64).trim()) && typeof SHAREPOINT_JS_BASE64 === 'string') {
    global.SHAREPOINT_JS_BASE64 = SHAREPOINT_JS_BASE64;
  }
  if ((!global.SHAREPOINT_HTML_BASE64 || !String(global.SHAREPOINT_HTML_BASE64).trim()) && typeof SHAREPOINT_HTML_BASE64 === 'string') {
    global.SHAREPOINT_HTML_BASE64 = SHAREPOINT_HTML_BASE64;
  }
  const registry = global.__COPILOT_SHAREPOINT_ASSETS__ || {};
  if (SHAREPOINT_CSS_BASE64) registry.css = SHAREPOINT_CSS_BASE64;
  if (SHAREPOINT_JS_BASE64) registry.js = SHAREPOINT_JS_BASE64;
  if (SHAREPOINT_HTML_BASE64) registry.html = SHAREPOINT_HTML_BASE64;
  global.__COPILOT_SHAREPOINT_ASSETS__ = registry;
})(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : this)));
